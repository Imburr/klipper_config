[include moonraker_obico_macros.cfg]
##########################
##### BASE CONFIG #######
##########################

[include mainsail.cfg]
[include ./backup/backup.cfg]

##########################
##### HARDWARE STUFF #####
##########################

[include ./hardware/xyz-stepper.cfg]
[include ./hardware/extruder.cfg]
#[include ./klicky/klicky-probe.cfg]
#[include ./hardware/adxl345.cfg]  This config now in canbus.cfg
[include ./hardware/fans.cfg] # Some fans config in canbus.cfg
[include ./hardware/canbus.cfg]

##########################
##### LIGHTS #############
##########################

[include ./hardware/chamber-lighting.cfg]
[include ./hardware/stealthburner-led.cfg]

##########################
##### CALIBRATION ########
##########################

[include ./calibration/z-tilt.cfg]
[include ./calibration/bed-mesh.cfg]
[include ./macros/unsafe.cfg]
[include ./calibration/pressure_advance.cfg]
[include ./calibration/test_speed.cfg]
[include ./calibration/pika.cfg]
[include test_probe_accuracy.cfg]

##########################
##### MACROS #############
##########################

[include ./macros/chamber-led.cfg]
[include ./macros/conditional-homing.cfg]
[include ./macros/print-end.cfg]
[include ./macros/print-start-mmu.cfg]
[include ./macros/dump-variables.cfg]
[include ./macros/movement-check.cfg]
[include ./macros/cancel-change.cfg]
[include ./macros/pause-resume.cfg]         ; Overridden by ERCF / subsequantly disabled
[include ./macros/load-unload.cfg]
[include ./macros/filament-change.cfg]
[include ./macros/park.cfg]
[include ./macros/heatsoak.cfg]

##########################
##### THIRD PARTY ########
##########################

#[include ./third-party-cfg/nozzle_scrub.cfg]
[include KAMP_Settings.cfg]

##########################
##### ERCF ###############
##########################

[include mmu/base/*.cfg]
[include macros/mmu_adds.cfg]
[include mmu/optional/mmu_ercf_cutter.cfg]

##########################
##### LCD/MENU ###########
##########################

#[include ./third-party-cfg/nozzle_scrub_menu.cfg]
#[include ./menu/printer_menu.cfg]

##########################
##### NOT ENABLED YET ####
##########################

#[include ./todo/mini12864.cfg] Add this after adding mini12864 LED
#[include ./todo/lcd_tweaks.cfg] Need to figure this one out and then implement
#[include ./hardware/nevermore.cfg] Disabled as I prefer to chamber vent outside and needed the PWM

##########################
#### REPLACEMENT #########
##########################

[include ./replacement_macros/replace-m900.cfg]
[include ./replacement_macros/replace-m117.cfg]

[exclude_object]

[gcode_arcs]
resolution: 0.1

[respond]
default_type: echo
default_prefix:  

[force_move]
# Enable commands that force potentially unsafe movement
enable_force_move: True

[idle_timeout]
timeout: 14400

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_290040000750314D35323820-if00
restart_method: command

[mcu rpi]
# Add Rpi as secondary MCU to allow for ADXL use through SPI ribbon/adapter from LDO
serial: /tmp/klipper_host_mcu

[mcu sht]
canbus_uuid: 30993412e8e0

[printer]
kinematics: corexy
max_velocity: 200           # Changed from 200 on 7.11.23
max_accel:  6000            # tuned on 7.11.23 after beacon install.
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0 # Changed on 7.11.23

#####################################################################
#   Input Shaper
#####################################################################

[input_shaper]
#shaper_freq_x: 76.2               ; suggested max_accel <= 22600 mm/sec^2
#shaper_type_x: zv
#shaper_freq_y: 51.8               ; suggested max_accel <= 7900 mm/sec^2
#shaper_type_y: mzv


#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
heater_pin: PA2 #PA2 is LDO default
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 125
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  WAS TAP - NOW BEACON in CANBUS

#####################################################################
#   Additional Sensors
#####################################################################

[thermistor CMFB103F3950FANT]
temperature1: 0.0
resistance1: 32116.0
temperature2: 40.0
resistance2: 5309.0
temperature3: 80.0
resistance3: 1228.0

#[temperature_sensor sb_ambient_temp]
## Chamber Temperature - T1
#sensor_type: CMFB103F3950FANT
#sensor_pin: PF5
#min_temp: 0
#max_temp: 100
#gcode_id: chamber_th

[temperature_sensor back_chamber_temp]
## Chamber Temperature - T
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF6
min_temp: 0
max_temp: 100
gcode_id: chamber_th2

[temperature_sensor RPi4]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################

#[safe_z_home]
##  XY Location of the Z Endstop Switch
##  Update -10,-10 to the XY coordinates of your endstop pin 
##  (such as 157,305) after going through Z Endstop Pin
##  Location Definition step.
#home_xy_position: 147,256
#speed:100
#z_hop:10
#z_hop_speed:10


########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.889
#*# pid_ki = 0.964
#*# pid_kd = 412.851
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.008217, -0.000437, -0.001262, -0.002997, 0.000497, 0.010288, 0.014524, 0.001762, 0.008592, 0.012071, 0.015464, 0.007579, 0.009971, 0.011210, 0.014783, 0.015506, 0.016465, 0.016278, 0.020414, 0.025670, 0.023186, 0.026060, 0.036769, 0.038249, 0.036515
#*# 	  -0.009214, -0.002442, 0.002200, 0.000099, -0.000038, -0.000797, -0.000960, 0.002994, -0.001866, 0.005164, 0.005950, 0.012768, 0.007310, 0.003816, 0.004691, 0.006113, 0.003486, 0.011082, 0.013808, 0.014525, 0.020292, 0.022410, 0.033263, 0.035106, 0.036702
#*# 	  -0.017167, -0.002020, 0.003996, 0.004836, 0.001981, -0.001545, -0.001564, 0.009906, 0.007663, 0.001126, 0.005020, 0.005877, 0.008990, 0.003544, 0.006714, 0.002618, 0.006512, 0.009736, 0.008754, 0.011181, 0.023703, 0.022206, 0.034038, 0.040721, 0.041404
#*# 	  -0.020856, -0.003958, 0.000995, -0.006812, -0.000041, -0.014862, -0.001587, 0.004765, 0.006022, 0.006220, 0.004450, 0.000972, 0.003770, 0.003320, 0.002742, 0.005073, 0.004296, 0.007144, 0.007164, 0.007983, 0.019032, 0.019693, 0.028074, 0.032495, 0.024032
#*# 	  -0.016701, -0.005924, 0.005025, 0.001944, -0.004254, 0.000903, 0.002275, 0.000859, 0.002660, 0.001261, 0.003287, 0.003631, 0.004755, 0.003068, 0.005031, 0.007691, 0.005660, 0.004522, 0.009017, 0.016848, 0.019930, 0.036286, 0.035933, 0.040464, 0.021326
#*# 	  -0.019558, -0.002707, -0.003262, 0.001094, 0.000947, 0.002042, -0.007314, 0.001198, 0.001369, 0.000900, 0.001887, 0.006040, 0.003172, 0.003162, 0.008400, 0.009940, 0.004473, 0.011109, 0.012211, 0.020120, 0.017026, 0.033268, 0.039538, 0.040774, 0.033814
#*# 	  -0.021303, -0.007849, 0.001074, 0.000544, -0.000366, -0.002995, -0.000547, 0.000067, 0.001790, 0.002193, 0.000983, 0.001009, 0.000473, 0.009428, 0.003348, 0.009545, 0.007513, 0.009851, 0.012273, 0.015556, 0.014399, 0.036723, 0.033613, 0.035107, 0.036100
#*# 	  -0.001927, -0.001439, -0.000394, -0.002135, -0.010416, -0.001625, -0.000290, -0.002171, 0.001379, -0.005839, -0.003862, 0.000806, 0.000887, 0.005661, 0.003185, 0.003669, 0.004600, 0.012182, 0.009303, 0.016014, 0.017258, 0.023634, 0.033964, 0.030435, 0.026865
#*# 	  -0.017160, -0.002003, -0.002444, -0.003567, -0.011102, -0.001586, -0.012348, -0.003689, -0.004458, -0.004643, -0.003687, -0.002046, -0.000657, 0.003734, 0.005118, 0.005163, 0.009470, 0.006268, 0.008443, 0.017208, 0.019038, 0.024023, 0.034923, 0.030886, 0.027762
#*# 	  -0.024389, -0.003357, -0.004840, -0.002910, -0.002644, -0.008682, -0.005608, -0.003910, -0.005966, -0.006260, 0.002408, -0.001927, 0.001022, 0.002990, 0.007485, 0.005867, 0.011026, 0.006783, 0.006244, 0.006584, 0.020620, 0.022173, 0.024555, 0.037401, 0.021387
#*# 	  -0.020632, -0.013027, -0.003704, -0.006995, -0.010925, -0.006860, -0.002116, -0.003869, -0.005773, -0.029397, -0.000947, -0.003989, -0.001919, 0.002178, 0.005028, 0.007107, 0.001366, 0.000535, 0.008408, 0.015529, 0.022461, 0.031410, 0.033883, 0.032925, 0.022263
#*# 	  -0.019155, -0.011180, -0.005717, -0.017167, -0.007218, -0.008478, -0.007903, -0.009141, -0.008117, -0.007931, -0.003824, -0.004316, -0.000128, 0.001763, 0.005508, 0.015137, 0.007769, 0.009013, 0.010580, 0.018125, 0.021919, 0.020268, 0.017098, 0.038817, 0.032512
#*# 	  -0.026278, -0.008537, -0.031809, -0.008581, -0.011095, -0.009841, -0.004781, -0.008595, -0.007339, -0.006825, -0.005721, -0.001536, 0.004783, 0.002378, 0.005505, 0.001720, 0.007378, 0.008332, 0.012933, 0.020292, 0.034242, 0.030520, 0.033695, 0.043493, 0.028525
#*# 	  -0.023620, -0.012633, -0.012691, -0.009257, -0.010571, -0.008229, -0.006987, -0.010254, -0.008133, -0.005522, 0.000457, 0.005146, 0.012148, 0.010740, 0.009428, 0.012698, 0.009969, 0.015745, 0.014721, 0.011833, 0.027148, 0.032930, 0.031325, 0.050395, 0.030912
#*# 	  -0.017824, -0.008590, -0.009113, -0.012069, -0.009207, -0.010348, -0.009432, -0.008334, -0.007617, -0.005729, -0.004016, -0.001605, 0.001620, 0.002470, 0.009870, 0.015034, 0.013412, 0.015240, 0.028307, 0.025274, 0.026085, 0.032409, 0.047283, 0.044696, 0.046629
#*# 	  -0.015285, -0.010433, -0.013194, -0.013028, -0.011250, -0.009564, -0.009393, -0.011290, -0.005568, 0.001370, -0.008618, 0.004851, 0.015584, 0.011236, 0.014015, 0.015297, 0.021785, 0.014919, 0.021436, 0.025974, 0.028984, 0.036023, 0.035719, 0.047538, 0.047505
#*# 	  -0.017861, -0.016849, -0.011945, -0.012784, -0.010850, -0.011047, -0.011924, -0.013107, -0.006666, -0.006441, -0.001630, 0.007472, 0.011456, 0.008161, 0.010651, -0.011302, 0.015025, 0.021989, 0.025243, 0.026954, 0.025381, 0.030431, 0.045119, 0.050707, 0.048691
#*# 	  -0.020314, -0.014595, -0.017212, -0.022342, -0.021712, -0.017860, -0.015846, -0.018043, -0.016763, -0.012419, -0.011381, -0.009730, 0.013355, 0.014171, 0.009328, 0.016119, 0.023491, 0.022820, 0.023556, 0.023672, 0.029703, 0.035714, 0.049070, 0.050326, 0.049305
#*# 	  -0.020505, -0.019698, -0.033469, -0.018679, -0.018563, -0.020265, -0.019735, -0.018381, -0.018497, -0.015514, -0.011723, -0.009013, 0.001147, 0.015846, 0.015908, 0.016939, 0.015097, 0.018894, 0.018455, 0.024986, 0.028575, 0.035029, 0.035833, 0.024268, 0.039414
#*# 	  -0.038097, -0.019544, -0.018346, -0.018573, -0.017827, -0.017886, -0.019769, -0.017911, -0.017938, -0.014625, -0.015335, -0.010449, -0.007122, 0.007238, 0.007807, 0.008159, 0.020458, 0.020023, 0.021372, 0.020734, 0.023943, 0.034692, 0.030225, 0.035734, 0.031056
#*# 	  -0.020291, -0.018632, -0.019078, -0.019661, -0.019216, -0.017974, -0.018421, -0.019405, -0.018401, -0.016884, -0.008944, -0.006605, 0.000825, 0.015203, 0.014548, 0.015654, 0.012013, 0.020558, 0.019518, 0.029006, 0.027857, 0.029188, 0.042339, 0.036808, 0.036962
#*# 	  -0.019226, -0.017544, -0.020284, -0.016453, -0.018678, -0.013697, -0.017665, -0.013893, -0.015607, -0.006021, -0.007107, 0.002008, 0.009631, 0.018833, 0.017502, 0.017144, 0.020474, 0.019755, 0.022033, 0.027294, 0.031796, 0.033310, 0.045822, 0.039795, 0.039531
#*# 	  -0.018558, -0.017544, -0.017202, -0.016290, -0.016533, -0.016437, -0.015997, -0.008999, -0.010173, -0.006252, -0.006133, -0.000727, 0.006821, -0.001305, 0.018433, 0.020242, 0.018979, 0.019619, 0.023228, 0.022171, 0.029127, 0.030606, 0.036759, 0.039935, 0.028826
#*# x_count = 25
#*# y_count = 23
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 33.867000000000004
#*# max_x = 210.0
#*# min_y = 44.06999999999999
#*# max_y = 201.93
#*#
#*# [beacon model default]
#*# model_coef = 1.9263519575030055,
#*# 	2.1946743347503372,
#*# 	0.6208794249910773,
#*# 	0.2775896555222557,
#*# 	0.06526221562750463,
#*# 	-0.2611119885640586,
#*# 	-0.05461829170887029,
#*# 	0.36810740679885895,
#*# 	0.05685001457152785,
#*# 	-0.15547240310186372
#*# model_domain = 3.351987055417817e-07,3.359664588035842e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 63.925584
#*# model_offset = 1.27000
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 77.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 51.6
#*#
#*# [beacon model pei_hot]
#*# model_coef = 1.9263519575030055,
#*# 	2.1946743347503372,
#*# 	0.6208794249910773,
#*# 	0.2775896555222557,
#*# 	0.06526221562750463,
#*# 	-0.2611119885640586,
#*# 	-0.05461829170887029,
#*# 	0.36810740679885895,
#*# 	0.05685001457152785,
#*# 	-0.15547240310186372
#*# model_domain = 3.351987055417817e-07,3.359664588035842e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 63.925584
#*# model_offset = 0.00000
