[include moonraker_obico_macros.cfg]
##########################
##### BASE CONFIG #######
##########################

[include mainsail.cfg]
[include ./backup/backup.cfg]

##########################
##### HARDWARE STUFF #####
##########################

[include ./hardware/xyz-stepper.cfg]
[include ./hardware/extruder.cfg]
#[include ./klicky/klicky-probe.cfg]
#[include ./hardware/adxl345.cfg]  This config now in canbus.cfg
[include ./hardware/fans.cfg] # Some fans config in canbus.cfg
[include ./hardware/canbus.cfg]

##########################
##### LIGHTS #############
##########################

[include ./hardware/chamber-lighting.cfg]
[include ./hardware/stealthburner-led.cfg]

##########################
##### CALIBRATION ########
##########################

[include ./calibration/z-tilt.cfg]
[include ./calibration/bed-mesh.cfg]
[include ./macros/unsafe.cfg]
[include ./calibration/pressure_advance.cfg]
[include ./calibration/test_speed.cfg]
[include ./calibration/pika.cfg]
[include ./calibration/microadjust.cfg]
[include ./calibration/sensorless.cfg]
[include test_probe_accuracy.cfg]

##########################
##### MACROS #############
##########################

[include ./macros/chamber-led.cfg]
[include ./macros/conditional-homing.cfg]
[include ./macros/print-end.cfg]
[include ./macros/print-start-mmu.cfg]
[include ./macros/dump-variables.cfg]
[include ./macros/movement-check.cfg]
[include ./macros/cancel-change.cfg]
[include ./macros/pause-resume.cfg]         ; Overridden by ERCF / subsequantly disabled
[include ./macros/load-unload.cfg]
[include ./macros/filament-change.cfg]
[include ./macros/park.cfg]
[include ./macros/heatsoak.cfg]

##########################
##### THIRD PARTY ########
##########################

#[include ./third-party-cfg/nozzle_scrub.cfg]
[include KAMP_Settings.cfg]

##########################
##### ERCF ###############
##########################

[include mmu/base/*.cfg]
[include macros/mmu_adds.cfg]
[include mmu/optional/mmu_ercf_cutter.cfg]

##########################
##### LCD/MENU ###########
##########################

#[include ./third-party-cfg/nozzle_scrub_menu.cfg]
#[include ./menu/printer_menu.cfg]

##########################
##### NOT ENABLED YET ####
##########################

#[include ./todo/mini12864.cfg] Add this after adding mini12864 LED
#[include ./todo/lcd_tweaks.cfg] Need to figure this one out and then implement
#[include ./hardware/nevermore.cfg] Disabled as I prefer to chamber vent outside and needed the PWM

##########################
#### REPLACEMENT #########
##########################

[include ./replacement_macros/replace-m900.cfg]
[include ./replacement_macros/replace-m117.cfg]

[exclude_object]

[gcode_arcs]
resolution: 0.1

[respond]
default_type: echo
default_prefix:  

[force_move]
# Enable commands that force potentially unsafe movement
enable_force_move: True

[idle_timeout]
timeout: 14400

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_290040000750314D35323820-if00
restart_method: command

[mcu rpi]
# Add Rpi as secondary MCU to allow for ADXL use through SPI ribbon/adapter from LDO
serial: /tmp/klipper_host_mcu

[mcu sht]
canbus_uuid: 30993412e8e0

[printer]
kinematics: corexy
max_velocity: 200           # Changed from 200 on 7.11.23
max_accel:  6000            # tuned on 7.11.23 after beacon install.
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0 # Changed on 7.11.23

#####################################################################
#   Input Shaper
#####################################################################

[input_shaper]
#shaper_freq_x: 76.2               ; suggested max_accel <= 22600 mm/sec^2
#shaper_type_x: zv
#shaper_freq_y: 51.8               ; suggested max_accel <= 7900 mm/sec^2
#shaper_type_y: mzv

#####################################################################
#   AutoTune / https://github.com/andrewmcgr/klipper_tmc_autotune
#####################################################################

[motor_constants ldo-42sth48-2004mah_vrn]
resistance: 1.45
inductance: 0.002
holding_torque: 0.40
max_current: 2.0
steps_per_revolution: 400

#[autotune_tmc stepper_x]
#motor: ldo-42sth48-2004mah_vrn
#sg4_thrs: 105
#tuning_goal: silent
[autotune_tmc stepper_y]
motor: ldo-42sth48-2004mah_vrn
tuning_goal: silent

[autotune_tmc stepper_z]
motor: ldo-42sth40-1684l300e
[autotune_tmc stepper_z1]
motor: ldo-42sth40-1684l300e
[autotune_tmc stepper_z2]
motor: ldo-42sth40-1684l300e

[autotune_tmc extruder]
motor: moons-cse14hra1l410a

#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
heater_pin: PA2 #PA2 is LDO default
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 125
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  WAS TAP - NOW BEACON in CANBUS

#####################################################################
#   Additional Sensors
#####################################################################

[thermistor CMFB103F3950FANT]
temperature1: 0.0
resistance1: 32116.0
temperature2: 40.0
resistance2: 5309.0
temperature3: 80.0
resistance3: 1228.0

#[temperature_sensor sb_ambient_temp]
## Chamber Temperature - T1
#sensor_type: CMFB103F3950FANT
#sensor_pin: PF5
#min_temp: 0
#max_temp: 100
#gcode_id: chamber_th

[temperature_sensor back_chamber_temp]
## Chamber Temperature - T
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF6
min_temp: 0
max_temp: 100
gcode_id: chamber_th2

[temperature_sensor RPi4]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.889
#*# pid_ki = 0.964
#*# pid_kd = 412.851
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.031157, 0.028789, 0.026819, 0.022361, 0.023300, 0.019742, 0.014974, 0.011489, 0.010870, 0.011355, 0.009213, 0.007870, 0.002604, 0.002693, 0.003036, 0.003533, 0.008206, 0.009899, 0.008551, 0.005977, 0.004916, 0.007344, 0.010663, 0.014114, 0.020199
#*# 	  0.037439, 0.039488, 0.031159, 0.027821, 0.023068, 0.020686, 0.015859, 0.012896, 0.012409, 0.011688, 0.009468, 0.007841, 0.004614, 0.001801, 0.001797, 0.001101, 0.002902, 0.003989, 0.005468, 0.006324, 0.009150, 0.013982, 0.015642, 0.017869, 0.022092
#*# 	  0.049563, 0.033123, 0.032770, 0.027380, 0.025656, 0.021603, 0.017287, 0.016372, 0.013302, 0.012555, 0.009714, 0.007205, 0.002311, 0.000654, -0.001076, -0.005492, -0.003713, -0.001970, 0.000860, 0.002863, 0.010658, 0.016748, 0.019145, 0.019292, 0.022223
#*# 	  0.038868, 0.032624, 0.028730, 0.023002, 0.021085, 0.017733, 0.012354, 0.010086, 0.008171, 0.006676, 0.003503, 0.000005, -0.002751, -0.005008, -0.008746, -0.011230, -0.011758, -0.012254, -0.010095, -0.003685, 0.006851, 0.016211, 0.020228, 0.018505, 0.018682
#*# 	  0.034729, 0.028119, 0.024965, 0.018140, 0.022757, 0.013518, 0.009039, 0.005222, 0.006132, -0.000390, -0.001116, -0.004411, -0.006821, -0.008779, -0.012373, -0.015334, -0.018786, -0.017237, -0.016392, -0.007389, 0.003617, 0.017033, 0.021121, 0.018726, 0.016738
#*# 	  0.032463, 0.027302, 0.021608, 0.019660, 0.015905, 0.011725, 0.005327, -0.000629, -0.000059, -0.001323, -0.004451, -0.007698, -0.005029, -0.008337, -0.011482, -0.015768, -0.016700, -0.018250, -0.016423, -0.009385, 0.004092, 0.015916, 0.021420, 0.019523, 0.017098
#*# 	  0.036636, 0.032007, 0.024167, 0.020850, 0.016839, 0.010897, 0.000939, -0.001140, -0.001902, -0.000163, -0.007691, -0.004777, -0.002721, -0.003075, -0.005502, -0.010747, -0.012800, -0.015389, -0.013634, -0.007149, 0.004473, 0.015689, 0.019778, 0.020263, 0.016881
#*# 	  0.043620, 0.034318, 0.029668, 0.023791, 0.021715, 0.013481, 0.004416, 0.002987, -0.000749, -0.001544, -0.004655, 0.000801, 0.002564, 0.004108, 0.002711, -0.001212, -0.004993, -0.010130, -0.006865, -0.002362, 0.006378, 0.019309, 0.021310, 0.020429, 0.019672
#*# 	  0.056313, 0.042409, 0.037566, 0.031976, 0.023449, 0.020056, 0.012584, 0.007694, 0.005658, 0.003511, 0.004659, -0.000106, 0.007095, 0.009669, 0.012983, 0.006946, 0.004045, 0.000611, -0.000552, 0.003322, 0.010806, 0.016281, 0.021115, 0.018044, 0.023401
#*# 	  0.052245, 0.039492, 0.036610, 0.030609, 0.024295, 0.015419, 0.013682, 0.007692, 0.004601, 0.001662, -0.001463, -0.000687, 0.002990, 0.005399, 0.007046, 0.005781, 0.002324, 0.001645, -0.003065, -0.000120, 0.005015, 0.010609, 0.011986, 0.011060, 0.015277
#*# 	  0.047739, 0.036885, 0.030963, 0.024729, 0.019782, 0.009869, 0.006967, 0.004695, 0.002074, -0.002894, -0.007282, -0.005698, -0.007285, -0.002797, -0.000523, 0.001653, -0.004053, -0.005361, -0.009056, -0.008101, -0.003718, 0.001276, 0.001600, 0.002264, 0.006637
#*# 	  0.046731, 0.038035, 0.031097, 0.024802, 0.014332, 0.011965, 0.007156, 0.005887, 0.003947, -0.000836, -0.005364, -0.007252, -0.005834, -0.004095, -0.002221, -0.003422, -0.001030, -0.005443, -0.009283, -0.008791, -0.005700, -0.002783, 0.000264, 0.001541, 0.006392
#*# 	  0.048810, 0.040028, 0.032516, 0.023056, 0.015382, 0.011642, 0.004700, 0.005560, 0.005273, 0.001387, -0.003108, -0.003794, -0.002434, -0.002625, -0.000517, -0.000376, 0.000306, -0.006441, -0.008513, -0.008053, -0.006223, -0.001535, 0.001462, 0.005434, 0.009717
#*# 	  0.047009, 0.039592, 0.030583, 0.021144, 0.013544, 0.007226, 0.003310, 0.002671, 0.002506, 0.001433, -0.002628, -0.001563, 0.000569, 0.001185, -0.000196, 0.001708, 0.000170, -0.003049, -0.005707, -0.005809, -0.003649, 0.000335, 0.004028, 0.008568, 0.014134
#*# 	  0.046071, 0.038337, 0.029430, 0.020082, 0.011509, 0.006271, 0.003143, -0.000491, 0.000271, 0.000688, -0.000669, -0.000577, 0.001583, 0.001845, 0.001564, 0.001522, 0.001821, 0.000250, -0.002949, -0.002115, 0.000407, 0.003431, 0.006766, 0.012020, 0.019078
#*# 	  0.050514, 0.041643, 0.033887, 0.025295, 0.019408, 0.013864, 0.009221, 0.006666, 0.006566, 0.006678, 0.006929, 0.007400, 0.009375, 0.008176, 0.008291, 0.008352, 0.009628, 0.008812, 0.008092, 0.009261, 0.010422, 0.014487, 0.017247, 0.021942, 0.029560
#*# 	  0.054556, 0.046606, 0.038087, 0.030186, 0.025427, 0.020322, 0.016241, 0.013841, 0.012021, 0.012522, 0.012540, 0.014013, 0.015504, 0.014650, 0.013358, 0.012890, 0.015149, 0.015768, 0.016145, 0.017130, 0.020091, 0.022830, 0.025636, 0.029807, 0.037441
#*# 	  0.054098, 0.044917, 0.036583, 0.028731, 0.023311, 0.020228, 0.017026, 0.013913, 0.012079, 0.011660, 0.011447, 0.013247, 0.014496, 0.014029, 0.012361, 0.012836, 0.015411, 0.017717, 0.017663, 0.019843, 0.022359, 0.025228, 0.027239, 0.032222, 0.039587
#*# 	  0.052427, 0.042579, 0.033401, 0.025723, 0.020841, 0.016606, 0.013320, 0.009560, 0.009166, 0.007094, 0.007374, 0.008770, 0.011112, 0.011874, 0.011548, 0.012189, 0.015175, 0.016787, 0.017579, 0.019918, 0.021357, 0.025232, 0.027323, 0.031825, 0.039257
#*# 	  0.045392, 0.035244, 0.025473, 0.017301, 0.012173, 0.008407, 0.004046, 0.000586, -0.001211, -0.001362, -0.002472, -0.000803, 0.002479, 0.005283, 0.006695, 0.008470, 0.011126, 0.012072, 0.012664, 0.014841, 0.017058, 0.018457, 0.020463, 0.024965, 0.033649
#*# 	  0.038142, 0.026955, 0.017622, 0.008124, 0.002691, -0.001128, -0.006212, -0.009667, -0.010893, -0.011658, -0.012820, -0.010758, -0.007256, -0.003425, -0.000414, 0.002917, 0.005572, 0.006842, 0.006847, 0.008052, 0.009590, 0.008741, 0.010809, 0.015177, 0.023662
#*# 	  0.036064, 0.024377, 0.014361, 0.005637, 0.000502, -0.003592, -0.007938, -0.011098, -0.013051, -0.014372, -0.014872, -0.013463, -0.009826, -0.005752, -0.002598, 0.000929, 0.004333, 0.005251, 0.005474, 0.006008, 0.005219, 0.004935, 0.005930, 0.010399, 0.019044
#*# 	  0.042572, 0.029453, 0.019376, 0.010401, 0.005775, 0.002391, -0.000928, -0.003444, -0.006314, -0.008489, -0.009697, -0.008757, -0.004705, -0.000714, 0.001910, 0.004622, 0.008356, 0.008246, 0.007989, 0.007632, 0.006283, 0.005791, 0.006786, 0.011158, 0.019322
#*# 	  0.046773, 0.033611, 0.023439, 0.014909, 0.010006, 0.006955, 0.005485, 0.003217, -0.000464, -0.002699, -0.004884, -0.004046, -0.000955, 0.003081, 0.004648, 0.006024, 0.008959, 0.008987, 0.008212, 0.006988, 0.006475, 0.005895, 0.007120, 0.010693, 0.018180
#*# 	  0.047432, 0.034667, 0.024083, 0.016178, 0.011178, 0.007912, 0.006984, 0.005969, 0.003110, 0.000424, -0.002521, -0.002256, 0.000101, 0.003058, 0.004808, 0.005704, 0.007094, 0.007032, 0.004928, 0.002928, 0.001934, 0.002187, 0.003682, 0.007284, 0.013593
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 210.0
#*# min_y = 30.0
#*# max_y = 208.0
#*#
#*# [beacon model default]
#*# model_coef = 1.4532603356494098,
#*# 	1.769580308031507,
#*# 	0.7550942283882581,
#*# 	0.34526575506657253,
#*# 	0.34040372831563737,
#*# 	0.42743717713705115,
#*# 	-0.0899883378115169,
#*# 	-0.3527539363442453,
#*# 	0.14098067399753886,
#*# 	0.2128102649314121
#*# model_domain = 3.157443485776106e-07,3.3255277521783205e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 26.356094
#*# model_offset = 0.00000
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 77.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 51.6
#*#
#*# [beacon model pei_hot]
#*# model_coef = 1.9263519575030055,
#*# 	2.1946743347503372,
#*# 	0.6208794249910773,
#*# 	0.2775896555222557,
#*# 	0.06526221562750463,
#*# 	-0.2611119885640586,
#*# 	-0.05461829170887029,
#*# 	0.36810740679885895,
#*# 	0.05685001457152785,
#*# 	-0.15547240310186372
#*# model_domain = 3.351987055417817e-07,3.359664588035842e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 63.925584
#*# model_offset = 0.00000
