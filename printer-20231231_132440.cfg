[include moonraker_obico_macros.cfg]
##########################
##### BASE CONFIG #######
##########################

[include mainsail.cfg]
[include ./backup/backup.cfg]

##########################
##### HARDWARE STUFF #####
##########################

[include ./hardware/xyz-stepper.cfg]
[include ./hardware/extruder.cfg]
#[include ./klicky/klicky-probe.cfg]
#[include ./hardware/adxl345.cfg]  This config now in canbus.cfg
[include ./hardware/fans.cfg] # Some fans config in canbus.cfg
[include ./hardware/canbus.cfg]

##########################
##### LIGHTS #############
##########################

[include ./hardware/chamber-lighting.cfg]
[include ./hardware/stealthburner-led.cfg]

##########################
##### CALIBRATION ########
##########################

[include ./calibration/z-tilt.cfg]
[include ./calibration/bed-mesh.cfg]
[include ./macros/unsafe.cfg]
[include ./calibration/pressure_advance.cfg]
[include ./calibration/test_speed.cfg]
[include ./calibration/pika.cfg]
[include test_probe_accuracy.cfg]

##########################
##### MACROS #############
##########################

[include ./macros/chamber-led.cfg]
[include ./macros/conditional-homing.cfg]
[include ./macros/print-end.cfg]
[include ./macros/print-start-mmu.cfg]
[include ./macros/dump-variables.cfg]
[include ./macros/movement-check.cfg]
[include ./macros/cancel-change.cfg]
[include ./macros/pause-resume.cfg]         ; Overridden by ERCF / subsequantly disabled
[include ./macros/load-unload.cfg]
[include ./macros/filament-change.cfg]
[include ./macros/park.cfg]
[include ./macros/heatsoak.cfg]

##########################
##### THIRD PARTY ########
##########################

#[include ./third-party-cfg/nozzle_scrub.cfg]
[include KAMP_Settings.cfg]

##########################
##### ERCF ###############
##########################

[include mmu/base/*.cfg]
[include macros/mmu_adds.cfg]
[include mmu/optional/mmu_ercf_cutter.cfg]

##########################
##### LCD/MENU ###########
##########################

#[include ./third-party-cfg/nozzle_scrub_menu.cfg]
#[include ./menu/printer_menu.cfg]

##########################
##### NOT ENABLED YET ####
##########################

#[include ./todo/mini12864.cfg] Add this after adding mini12864 LED
#[include ./todo/lcd_tweaks.cfg] Need to figure this one out and then implement
#[include ./hardware/nevermore.cfg] Disabled as I prefer to chamber vent outside and needed the PWM

##########################
#### REPLACEMENT #########
##########################

[include ./replacement_macros/replace-m900.cfg]
[include ./replacement_macros/replace-m117.cfg]

[exclude_object]

[gcode_arcs]
resolution: 0.1

[respond]
default_type: echo
default_prefix:  

[force_move]
# Enable commands that force potentially unsafe movement
enable_force_move: True

[idle_timeout]
timeout: 14400

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_290040000750314D35323820-if00
restart_method: command

[mcu rpi]
# Add Rpi as secondary MCU to allow for ADXL use through SPI ribbon/adapter from LDO
serial: /tmp/klipper_host_mcu

[mcu sht]
canbus_uuid: 30993412e8e0

[printer]
kinematics: corexy
max_velocity: 200           # Changed from 200 on 7.11.23
max_accel:  6000            # tuned on 7.11.23 after beacon install.
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0 # Changed on 7.11.23

#####################################################################
#   Input Shaper
#####################################################################

[input_shaper]
#shaper_freq_x: 76.2               ; suggested max_accel <= 22600 mm/sec^2
#shaper_type_x: zv
#shaper_freq_y: 51.8               ; suggested max_accel <= 7900 mm/sec^2
#shaper_type_y: mzv


#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
heater_pin: PA2 #PA2 is LDO default
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 125
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  WAS TAP - NOW BEACON in CANBUS

#####################################################################
#   Additional Sensors
#####################################################################

[thermistor CMFB103F3950FANT]
temperature1: 0.0
resistance1: 32116.0
temperature2: 40.0
resistance2: 5309.0
temperature3: 80.0
resistance3: 1228.0

#[temperature_sensor sb_ambient_temp]
## Chamber Temperature - T1
#sensor_type: CMFB103F3950FANT
#sensor_pin: PF5
#min_temp: 0
#max_temp: 100
#gcode_id: chamber_th

[temperature_sensor back_chamber_temp]
## Chamber Temperature - T
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF6
min_temp: 0
max_temp: 100
gcode_id: chamber_th2

[temperature_sensor RPi4]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################

#[safe_z_home]
##  XY Location of the Z Endstop Switch
##  Update -10,-10 to the XY coordinates of your endstop pin 
##  (such as 157,305) after going through Z Endstop Pin
##  Location Definition step.
#home_xy_position: 147,256
#speed:100
#z_hop:10
#z_hop_speed:10


########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.889
#*# pid_ki = 0.964
#*# pid_kd = 412.851
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.060354, -0.022890, -0.013342, -0.011744, -0.031397, -0.012128, -0.012553, -0.009787, -0.030894, -0.019981, -0.021990, -0.012138, -0.019375, -0.011217, -0.021975, -0.022357, -0.021975, -0.020448, -0.023258, -0.030655, -0.007567, -0.010197, -0.003695, -0.010020, -0.009973
#*# 	  -0.021269, -0.030897, -0.006763, -0.004931, -0.008767, -0.007862, -0.015272, -0.007428, -0.009873, -0.007298, -0.007781, -0.004821, -0.010188, -0.020436, -0.022349, -0.021593, -0.031738, -0.018058, -0.007067, -0.009210, -0.007861, -0.002718, 0.009432, 0.015182, -0.011129
#*# 	  -0.018808, -0.024929, -0.006954, -0.003405, -0.008135, -0.006196, -0.006025, -0.011718, -0.009130, -0.008477, -0.008880, -0.007310, -0.008359, -0.017040, -0.010058, -0.014889, -0.018954, -0.010827, -0.012522, -0.004994, -0.008760, 0.013031, 0.006021, 0.007464, 0.004775
#*# 	  -0.025325, -0.026278, -0.015404, -0.008801, -0.017322, -0.009533, -0.009581, -0.004747, -0.018688, -0.004480, -0.007996, -0.005061, -0.009551, -0.016846, -0.018527, -0.019165, -0.020934, -0.021604, -0.001745, -0.002357, -0.008144, 0.004602, 0.005096, 0.010150, 0.016320
#*# 	  -0.020848, -0.029417, -0.020399, -0.018929, -0.019105, -0.027897, -0.001625, -0.017589, -0.018199, -0.007182, -0.007788, -0.009250, -0.004651, -0.009942, -0.016512, -0.017371, -0.004971, -0.013762, -0.004349, -0.019095, -0.002407, 0.028516, 0.007197, 0.020962, -0.006369
#*# 	  -0.022211, -0.020969, -0.020775, -0.014859, -0.022019, -0.019907, -0.020685, -0.021235, -0.027270, -0.021335, -0.020884, -0.007731, -0.020851, -0.021642, -0.008172, -0.018359, -0.006845, -0.009924, -0.018735, -0.004857, -0.002869, 0.006033, 0.009010, 0.015004, 0.015764
#*# 	  -0.032434, -0.022497, -0.021131, -0.022230, -0.029945, -0.029561, -0.022345, -0.020279, -0.019221, -0.020269, -0.015652, -0.015283, -0.017005, -0.020657, -0.016248, -0.016293, -0.008892, -0.010593, -0.003573, -0.007386, -0.004803, -0.002522, 0.007674, 0.013348, 0.003288
#*# 	  -0.040183, -0.027219, -0.020670, -0.022023, -0.024398, -0.021273, -0.020999, -0.020962, -0.024693, -0.020526, -0.017649, -0.020235, -0.024134, -0.018365, -0.016848, -0.013558, -0.011408, -0.014678, -0.006006, -0.013578, -0.013951, -0.000917, -0.001609, 0.014835, 0.003320
#*# 	  -0.040606, -0.026427, -0.019920, -0.036363, -0.017584, -0.025215, -0.020665, -0.022847, -0.019281, -0.025400, -0.020733, -0.026518, -0.019183, -0.016712, -0.018645, -0.019925, -0.020274, -0.017404, -0.009057, -0.008028, -0.009864, -0.001261, 0.021157, 0.012927, -0.004620
#*# 	  -0.049491, -0.024105, -0.020630, -0.024878, -0.020878, -0.023462, -0.023380, -0.024560, -0.018176, -0.018639, -0.017326, -0.024437, -0.021611, -0.019990, -0.021587, -0.025020, -0.018130, -0.019318, -0.019870, -0.005287, 0.000357, 0.002683, 0.017184, 0.017989, 0.001992
#*# 	  -0.049088, -0.048787, -0.022498, -0.020664, -0.019525, -0.022749, -0.023177, -0.024445, -0.020836, -0.019340, -0.020023, -0.021358, -0.020676, -0.022148, -0.020698, -0.018035, -0.014433, -0.010766, -0.009077, -0.000442, 0.000246, 0.017060, 0.017170, 0.022305, 0.009346
#*# 	  -0.023839, -0.019280, -0.020648, -0.020523, -0.019132, -0.020297, -0.021398, -0.019559, -0.020008, -0.018534, -0.018253, -0.020274, -0.020041, -0.019335, -0.015284, -0.017488, -0.014509, -0.012547, -0.008706, -0.006100, -0.003705, 0.012532, 0.019161, 0.022429, 0.022632
#*# 	  -0.045123, -0.018667, -0.018698, -0.019744, -0.019463, -0.023479, -0.019611, -0.019003, -0.014004, -0.017191, -0.007113, -0.011272, -0.015895, -0.007262, -0.011538, -0.010083, -0.011032, -0.009150, -0.006910, 0.003441, 0.001088, 0.021510, 0.021940, 0.027377, 0.022468
#*# 	  -0.043814, -0.025090, -0.020120, -0.019542, -0.019024, -0.018964, -0.019459, -0.019652, -0.019517, -0.019470, -0.019184, -0.018390, -0.014178, -0.011637, -0.013439, -0.008936, -0.016961, -0.016533, -0.016434, 0.003610, -0.008089, 0.021798, 0.021870, 0.026590, 0.024125
#*# 	  -0.041698, -0.024218, -0.019163, -0.018446, -0.019649, -0.017915, -0.027645, -0.017863, -0.017396, -0.020292, -0.019575, -0.013200, -0.016900, -0.013460, -0.016033, -0.012681, -0.013754, -0.007817, -0.003861, 0.009349, 0.018428, 0.023585, 0.025369, 0.023007, 0.024555
#*# 	  -0.027901, -0.029417, -0.021993, -0.015025, -0.016062, -0.014900, -0.021310, -0.020249, -0.016289, -0.008721, -0.015835, -0.013258, -0.014039, -0.016997, -0.014650, -0.015455, -0.014900, -0.013893, -0.002574, 0.008530, 0.010789, 0.022383, 0.025109, 0.028443, 0.032340
#*# 	  -0.029397, -0.020892, -0.034892, -0.018855, -0.016543, -0.017962, -0.019516, -0.019891, -0.017457, -0.015849, -0.011842, -0.016355, -0.010999, -0.014276, -0.009809, -0.012337, -0.004041, -0.003463, 0.011545, 0.009656, 0.020090, 0.020276, 0.026968, 0.027765, 0.027891
#*# 	  -0.027761, -0.020883, -0.014563, -0.013510, -0.018699, -0.014279, -0.010998, -0.010797, -0.020870, -0.014428, -0.015367, -0.013788, -0.014288, -0.013113, -0.014738, -0.013301, -0.012516, 0.013571, 0.016829, 0.013001, 0.018977, 0.020517, 0.029421, 0.037618, 0.034661
#*# 	  -0.030394, -0.020630, -0.020771, -0.015580, -0.019548, -0.014338, -0.014138, -0.018096, -0.016540, -0.017839, -0.019757, -0.019879, -0.014425, -0.011512, -0.010492, -0.000785, -0.002166, -0.004879, 0.011348, 0.018641, 0.019580, 0.025061, 0.027220, 0.037916, 0.042815
#*# 	  -0.039477, -0.025621, -0.034507, -0.018662, -0.019581, -0.014271, -0.015199, -0.013338, -0.016845, -0.015479, -0.014960, -0.015813, -0.014025, -0.015654, -0.014463, -0.004047, -0.012846, 0.000738, 0.008604, 0.010776, 0.017761, 0.026630, 0.026870, 0.033457, 0.037378
#*# 	  -0.043258, -0.024675, -0.018197, -0.014900, -0.019010, -0.018524, -0.018263, -0.015150, -0.018100, -0.016094, -0.018398, -0.015794, -0.018222, -0.015600, -0.014063, -0.013734, -0.003560, -0.005531, -0.013293, 0.004125, 0.019852, 0.020176, 0.027116, 0.027115, 0.027915
#*# 	  -0.048740, -0.038802, -0.028056, -0.017584, -0.016529, -0.029277, -0.019111, -0.021271, -0.024992, -0.032497, -0.017812, -0.016974, -0.017275, -0.013484, -0.016698, -0.014182, -0.009036, -0.007745, -0.012185, 0.002107, -0.001988, 0.022756, 0.026865, 0.025500, 0.026024
#*# 	  -0.041740, -0.028590, -0.018568, -0.017944, -0.015334, -0.028956, -0.017896, -0.016402, -0.023387, -0.018318, -0.033346, -0.024010, -0.014338, -0.017586, -0.016938, -0.014581, -0.012860, -0.012566, -0.004179, -0.008861, 0.008599, 0.017352, 0.022901, 0.026178, 0.026039
#*# 	  -0.043366, -0.041895, -0.032860, -0.016201, -0.023781, -0.020826, -0.022315, -0.019118, -0.037827, -0.035589, -0.052005, -0.019698, -0.017484, -0.028856, -0.017058, -0.017303, -0.018032, -0.005967, -0.002480, -0.002961, 0.003910, 0.019549, 0.019753, 0.021894, 0.023892
#*# 	  -0.051836, -0.040333, -0.035482, -0.019682, -0.028241, -0.034678, -0.036580, -0.035116, -0.033286, -0.032962, -0.039924, -0.032855, -0.037349, -0.022261, -0.020436, -0.019085, -0.016525, -0.016223, -0.016062, -0.014323, -0.010503, -0.001487, 0.008361, 0.004826, 0.006972
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 210.0
#*# min_y = 30.0
#*# max_y = 210.0
#*#
#*# [beacon model default]
#*# model_coef = 1.9263519575030055,
#*# 	  2.1946743347503372,
#*# 	  0.6208794249910773,
#*# 	  0.2775896555222557,
#*# 	  0.06526221562750463,
#*# 	  -0.2611119885640586,
#*# 	  -0.05461829170887029,
#*# 	  0.36810740679885895,
#*# 	  0.05685001457152785,
#*# 	  -0.15547240310186372
#*# model_domain = 3.351987055417817e-07,3.359664588035842e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 63.925584
#*# model_offset = 1.59000
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 77.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 51.6
#*#
#*# [beacon model pei_hot]
#*# model_coef = 1.9263519575030055,
#*# 	2.1946743347503372,
#*# 	0.6208794249910773,
#*# 	0.2775896555222557,
#*# 	0.06526221562750463,
#*# 	-0.2611119885640586,
#*# 	-0.05461829170887029,
#*# 	0.36810740679885895,
#*# 	0.05685001457152785,
#*# 	-0.15547240310186372
#*# model_domain = 3.351987055417817e-07,3.359664588035842e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 63.925584
#*# model_offset = 0.00000
