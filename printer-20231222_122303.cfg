[include moonraker_obico_macros.cfg]
##########################
##### BASE CONFIG #######
##########################

[include mainsail.cfg]
[include ./backup/backup.cfg]

##########################
##### HARDWARE STUFF #####
##########################

[include ./hardware/xyz-stepper.cfg]
[include ./hardware/extruder.cfg]
#[include ./klicky/klicky-probe.cfg]
#[include ./hardware/adxl345.cfg]  This config now in canbus.cfg
[include ./hardware/fans.cfg] # Some fans config in canbus.cfg
[include ./hardware/canbus.cfg]

##########################
##### LIGHTS #############
##########################

[include ./hardware/chamber-lighting.cfg]
[include ./hardware/stealthburner-led.cfg]

##########################
##### CALIBRATION ########
##########################

[include ./calibration/z-tilt.cfg]
[include ./calibration/bed-mesh.cfg]
[include ./macros/unsafe.cfg]
[include ./calibration/pressure_advance.cfg]
[include ./calibration/test_speed.cfg]
[include ./calibration/pika.cfg]
[include test_probe_accuracy.cfg]

##########################
##### MACROS #############
##########################

[include ./macros/chamber-led.cfg]
[include ./macros/conditional-homing.cfg]
[include ./macros/print-end.cfg]
[include ./macros/print-start-mmu.cfg]
[include ./macros/dump-variables.cfg]
[include ./macros/movement-check.cfg]
[include ./macros/cancel-change.cfg]
[include ./macros/pause-resume.cfg]         ; Overridden by ERCF / subsequantly disabled
[include ./macros/load-unload.cfg]
[include ./macros/filament-change.cfg]
[include ./macros/park.cfg]
#[include ./macros/prusaslicer-accel.cfg]

##########################
##### THIRD PARTY ########
##########################

#[include ./third-party-cfg/nozzle_scrub.cfg]
[include KAMP_Settings.cfg]

##########################
##### ERCF ###############
##########################

[include mmu/base/*.cfg]
[include macros/mmu_adds.cfg]
[include mmu/optional/mmu_ercf_cutter.cfg]

##########################
##### LCD/MENU ###########
##########################

#[include ./third-party-cfg/nozzle_scrub_menu.cfg]
#[include ./menu/printer_menu.cfg]

##########################
##### NOT ENABLED YET ####
##########################

#[include ./todo/mini12864.cfg] Add this after adding mini12864 LED
#[include ./todo/lcd_tweaks.cfg] Need to figure this one out and then implement
#[include ./hardware/nevermore.cfg] Disabled as I prefer to chamber vent outside and needed the PWM

##########################
#### REPLACEMENT #########
##########################

[include ./replacement_macros/replace-m900.cfg]
[include ./replacement_macros/replace-m117.cfg]

[exclude_object]

[gcode_arcs]
resolution: 0.1

[respond]
default_type: echo
default_prefix:  

[force_move]
# Enable commands that force potentially unsafe movement
enable_force_move: True

[idle_timeout]
timeout: 14400

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_290040000750314D35323820-if00
restart_method: command

[mcu rpi]
# Add Rpi as secondary MCU to allow for ADXL use through SPI ribbon/adapter from LDO
serial: /tmp/klipper_host_mcu

[mcu sht]
canbus_uuid: 30993412e8e0

[printer]
kinematics: corexy
max_velocity: 200           # Changed from 200 on 7.11.23
max_accel:  6000            # tuned on 7.11.23 after beacon install.
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0 # Changed on 7.11.23

#####################################################################
#   Input Shaper
#####################################################################

[input_shaper]
#shaper_freq_x: 76.2               ; suggested max_accel <= 22600 mm/sec^2
#shaper_type_x: zv
#shaper_freq_y: 51.8               ; suggested max_accel <= 7900 mm/sec^2
#shaper_type_y: mzv


#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
heater_pin: PA2 #PA2 is LDO default
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 125
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  WAS TAP - NOW BEACON in CANBUS

#####################################################################
#   Additional Sensors
#####################################################################

[thermistor CMFB103F3950FANT]
temperature1: 0.0
resistance1: 32116.0
temperature2: 40.0
resistance2: 5309.0
temperature3: 80.0
resistance3: 1228.0

#[temperature_sensor sb_ambient_temp]
## Chamber Temperature - T1
#sensor_type: CMFB103F3950FANT
#sensor_pin: PF5
#min_temp: 0
#max_temp: 100
#gcode_id: chamber_th

[temperature_sensor back_chamber_temp]
## Chamber Temperature - T
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF6
min_temp: 0
max_temp: 100
gcode_id: chamber_th2

[temperature_sensor RPi4]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################

#[safe_z_home]
##  XY Location of the Z Endstop Switch
##  Update -10,-10 to the XY coordinates of your endstop pin 
##  (such as 157,305) after going through Z Endstop Pin
##  Location Definition step.
#home_xy_position: 147,256
#speed:100
#z_hop:10
#z_hop_speed:10


########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.889
#*# pid_ki = 0.964
#*# pid_kd = 412.851
#*#
#*# [probe]
#*# z_offset = -1.270
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.040704, -0.028840, -0.030942, -0.028552, -0.021022, -0.012564, -0.031778, -0.020429, -0.011686, -0.016993, -0.031611, -0.011573, -0.027443, -0.021580, -0.022254, -0.011709, -0.017743, -0.028871, -0.016949, -0.015467, -0.023695, -0.019250, -0.011630, -0.014101, -0.015958
#*# 	  -0.033005, -0.018308, -0.021831, -0.017438, -0.018786, -0.021350, -0.017923, -0.017317, -0.018156, -0.022483, -0.020922, -0.021089, -0.021260, -0.016249, -0.032295, -0.020278, -0.028878, -0.020955, -0.024237, -0.016841, -0.022178, -0.013821, -0.014367, -0.011949, -0.013790
#*# 	  -0.032792, -0.022377, -0.020317, -0.028510, -0.020710, -0.021212, -0.020098, -0.020976, -0.022509, -0.021071, -0.023086, -0.021539, -0.025213, -0.025301, -0.030289, -0.021318, -0.030239, -0.029893, -0.025886, -0.022425, -0.018384, -0.015931, -0.009472, -0.006485, -0.009914
#*# 	  -0.023742, -0.026850, -0.021564, -0.018249, -0.021172, -0.021902, -0.023631, -0.022876, -0.019310, -0.021234, -0.022725, -0.023831, -0.024340, -0.028655, -0.027187, -0.028198, -0.029372, -0.028335, -0.029474, -0.022540, -0.022380, -0.018819, -0.012493, -0.012565, -0.007976
#*# 	  -0.032573, -0.027842, -0.023875, -0.024219, -0.021734, -0.029321, -0.028957, -0.028439, -0.028175, -0.025792, -0.025283, -0.023903, -0.024807, -0.028419, -0.026494, -0.029686, -0.026663, -0.029543, -0.026915, -0.029188, -0.026481, -0.016576, -0.012598, -0.008235, -0.010506
#*# 	  -0.029192, -0.022355, -0.023569, -0.026120, -0.025168, -0.026167, -0.024081, -0.028459, -0.024615, -0.024947, -0.025156, -0.026388, -0.026185, -0.024606, -0.022921, -0.027536, -0.026597, -0.024476, -0.026484, -0.026669, -0.020924, -0.025586, -0.003396, -0.005259, -0.006974
#*# 	  -0.026312, -0.019710, -0.017358, -0.021770, -0.021746, -0.018996, -0.019664, -0.022783, -0.024497, -0.018680, -0.025563, -0.024093, -0.019787, -0.018872, -0.019652, -0.026290, -0.024457, -0.025625, -0.019848, -0.023621, -0.020553, -0.005715, -0.014363, 0.001433, -0.004117
#*# 	  -0.021706, -0.017566, -0.007180, -0.020638, -0.020954, -0.020127, -0.022656, -0.024350, -0.026153, -0.024353, -0.026079, -0.023083, -0.025698, -0.013533, -0.022328, -0.024572, -0.014356, -0.024376, -0.018460, -0.020258, -0.016793, -0.012649, -0.007171, -0.001064, -0.004588
#*# 	  -0.023127, -0.007649, -0.013341, -0.014689, -0.024068, -0.022423, -0.024475, -0.022341, -0.022816, -0.023753, -0.026894, -0.026574, -0.014069, -0.008571, -0.023456, -0.020344, -0.010105, -0.022946, -0.015541, -0.022451, -0.018200, -0.009365, -0.009948, -0.007282, -0.009673
#*# 	  -0.021027, -0.019996, -0.019313, -0.020208, -0.018980, -0.021013, -0.026387, -0.025389, -0.028181, -0.021542, -0.019668, -0.021004, -0.020703, -0.019997, -0.018279, -0.019582, -0.020147, -0.020087, -0.018562, -0.019415, -0.015664, -0.010927, -0.014959, -0.009475, -0.014483
#*# 	  -0.019801, -0.023738, -0.020672, -0.020418, -0.020149, -0.020799, -0.018920, -0.021389, -0.018967, -0.042997, -0.019218, -0.044898, -0.020204, -0.020334, -0.019153, -0.016343, -0.019776, -0.019768, -0.019938, -0.016980, -0.015644, -0.013456, -0.003055, -0.006523, -0.017443
#*# 	  -0.030039, -0.027909, -0.017860, -0.019584, -0.017577, -0.017302, -0.018356, -0.024983, -0.018920, -0.019804, -0.017906, -0.017035, -0.017924, -0.022371, -0.017030, -0.011637, -0.016172, -0.019692, -0.014246, -0.011857, -0.007586, -0.010860, 0.003504, -0.004100, -0.015003
#*# 	  -0.029292, -0.027933, -0.019017, -0.021979, -0.019546, -0.015969, -0.017038, -0.014341, -0.020098, -0.026371, -0.014743, -0.025697, -0.019522, -0.018362, -0.013469, -0.013780, -0.012091, -0.010917, -0.018566, -0.001524, -0.006891, -0.005141, 0.000327, -0.002571, -0.010003
#*# 	  -0.037362, -0.014997, -0.017540, -0.012208, -0.021039, -0.009497, -0.007947, -0.010100, -0.011567, -0.024487, -0.039140, -0.009108, -0.013047, -0.009823, -0.023068, -0.010767, -0.006055, -0.005286, -0.009317, -0.009149, -0.001936, 0.002626, 0.006978, 0.003971, 0.001451
#*# 	  -0.032717, -0.020180, -0.011906, -0.021828, -0.007741, -0.012979, -0.011986, -0.008579, -0.041448, -0.007041, -0.024020, -0.008667, -0.013653, -0.008602, -0.008098, -0.007859, -0.004117, -0.004950, 0.001508, 0.003970, 0.000925, 0.010882, 0.005268, 0.010599, 0.004824
#*# 	  -0.025654, -0.017650, -0.013714, -0.013817, -0.021854, -0.005282, -0.006732, -0.006351, -0.002063, -0.006124, -0.010213, -0.015577, -0.012219, -0.004848, -0.003609, -0.002763, -0.003411, 0.000510, -0.002131, 0.006444, 0.008386, 0.018703, 0.021582, 0.019125, 0.015642
#*# 	  -0.025597, -0.012192, -0.014428, -0.015072, -0.014860, -0.015888, -0.003947, -0.007105, -0.007609, -0.015690, -0.009461, -0.009772, -0.002795, -0.001137, -0.001122, 0.002463, 0.000201, 0.016854, 0.008793, 0.009193, 0.010955, 0.019920, 0.016539, 0.021485, 0.020662
#*# 	  -0.027567, -0.015228, -0.006702, -0.009141, -0.008219, -0.008575, -0.009499, -0.003538, -0.011497, -0.012028, -0.014858, 0.002074, -0.010041, -0.003899, 0.005294, 0.004002, 0.010308, 0.009674, 0.007102, 0.014644, 0.014538, 0.014850, 0.019037, 0.031052, 0.021440
#*# 	  -0.023469, -0.017678, -0.017179, -0.009149, -0.014981, -0.014719, -0.010309, -0.014900, -0.018107, -0.015925, -0.015171, -0.006971, -0.006018, 0.007954, 0.003915, 0.007639, 0.009336, 0.008965, 0.009445, 0.013454, 0.010562, 0.020780, 0.020175, 0.024821, 0.023572
#*# 	  -0.037099, -0.026029, -0.028221, -0.022408, -0.020707, -0.016868, -0.019979, -0.021284, -0.014492, -0.021601, -0.016375, -0.018296, -0.010378, 0.001274, 0.000552, 0.003384, 0.009945, 0.008776, 0.004536, 0.012176, 0.014175, 0.013933, 0.018494, 0.023137, 0.021801
#*# 	  -0.036701, -0.028847, -0.029635, -0.033311, -0.026532, -0.025939, -0.018197, -0.034739, -0.024100, -0.018741, -0.019323, -0.014648, -0.014359, -0.002794, 0.002042, 0.014262, 0.015466, 0.015350, 0.016079, 0.015371, 0.016567, 0.018454, 0.019024, 0.031009, 0.016227
#*# 	  -0.039620, -0.026232, -0.031650, -0.027261, -0.027943, -0.023964, -0.030272, -0.037825, -0.034496, -0.014450, -0.020380, -0.016566, -0.007360, -0.002971, 0.001541, 0.004088, 0.012538, 0.018482, 0.015861, 0.010106, 0.009922, 0.018968, 0.026404, 0.021827, 0.017280
#*# 	  -0.029771, -0.025720, -0.030759, -0.021850, -0.026667, -0.022122, -0.025682, -0.027414, -0.024588, -0.025384, -0.009507, -0.011357, -0.009317, -0.001182, 0.007634, 0.014979, 0.022346, 0.021736, 0.023418, 0.021956, 0.022278, 0.023521, 0.023605, 0.023407, 0.019922
#*# x_count = 25
#*# y_count = 23
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 210.0
#*# min_y = 33.18899999999999
#*# max_y = 192.064
#*#
#*# [beacon model default]
#*# model_coef = 1.9539239218487328,
#*# 	  2.217610580286093,
#*# 	  0.5838330148479706,
#*# 	  0.21129485203849432,
#*# 	  0.027544304581982575,
#*# 	  -0.22121169694453344,
#*# 	  0.07731325565858146,
#*# 	  0.47663341794200753,
#*# 	  -0.030328462280996143,
#*# 	  -0.2626594202878769
#*# model_domain = 3.3550721302532535e-07,3.361416437008564e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 76.600451
#*# model_offset = 0.01000
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 77.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 51.6
