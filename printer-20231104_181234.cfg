##########################
##### BASE CONFIG #######
##########################

[include mainsail.cfg]
[include ./backup/backup.cfg]

##########################
##### HARDWARE STUFF #####
##########################

[include ./hardware/xyz-stepper.cfg]
[include ./hardware/extruder.cfg]
#[include ./klicky/klicky-probe.cfg]
#[include ./hardware/adxl345.cfg]  This config now in canbus.cfg
[include ./hardware/fans.cfg] # Some fans config in canbus.cfg
[include ./hardware/canbus.cfg]

##########################
##### LIGHTS #############
##########################

[include ./hardware/chamber-lighting.cfg]
[include ./hardware/stealthburner-led.cfg]

##########################
##### CALIBRATION ########
##########################

[include ./calibration/z-tilt.cfg]
[include ./calibration/bed-mesh.cfg]
[include ./macros/unsafe.cfg]
[include ./calibration/pressure_advance.cfg]
[include ./calibration/test_speed.cfg]
[include ./calibration/pika.cfg]
[include test_probe_accuracy.cfg]

##########################
##### MACROS #############
##########################

[include ./macros/chamber-led.cfg]
[include ./macros/conditional-homing.cfg]
[include ./macros/print-end.cfg]
[include ./macros/print-start-mmu.cfg]
[include ./macros/dump-variables.cfg]
[include ./macros/movement-check.cfg]
[include ./macros/cancel-change.cfg]
[include ./macros/pause-resume.cfg]         ; Overridden by ERCF / subsequantly disabled
[include ./macros/load-unload.cfg]
[include ./macros/filament-change.cfg]
[include ./macros/park.cfg]
#[include ./macros/prusaslicer-accel.cfg]

##########################
##### THIRD PARTY ########
##########################

#[include ./third-party-cfg/nozzle_scrub.cfg]
[include KAMP_Settings.cfg]

##########################
##### ERCF ###############
##########################

[include mmu/base/*.cfg]
[include macros/mmu_adds.cfg]



##########################
##### LCD/MENU ###########
##########################

#[include ./third-party-cfg/nozzle_scrub_menu.cfg]
#[include ./menu/printer_menu.cfg]

##########################
##### NOT ENABLED YET ####
##########################

#[include ./todo/mini12864.cfg] Add this after adding mini12864 LED
#[include ./todo/lcd_tweaks.cfg] Need to figure this one out and then implement
#[include ./hardware/nevermore.cfg] Disabled as I prefer to chamber vent outside and needed the PWM

##########################
#### REPLACEMENT #########
##########################

[include ./replacement_macros/replace-m900.cfg]
[include ./replacement_macros/replace-m117.cfg]

[exclude_object]

[gcode_arcs]
resolution: 0.1

[respond]
default_type: echo
default_prefix:  

[force_move]
# Enable commands that force potentially unsafe movement
enable_force_move: True

[idle_timeout]
timeout: 14400

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_290040000750314D35323820-if00
restart_method: command

[mcu rpi]
# Add Rpi as secondary MCU to allow for ADXL use through SPI ribbon/adapter from LDO
serial: /tmp/klipper_host_mcu

[mcu sht]
canbus_uuid: 30993412e8e0

[printer]
kinematics: corexy
max_velocity: 200           # Changed from 200 on 7.11.23
max_accel:  6000            # tuned on 7.11.23 after beacon install.
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0 # Changed on 7.11.23

#####################################################################
#   Input Shaper
#####################################################################

[input_shaper]
#shaper_freq_x: 76.2               ; suggested max_accel <= 22600 mm/sec^2
#shaper_type_x: zv
#shaper_freq_y: 51.8               ; suggested max_accel <= 7900 mm/sec^2
#shaper_type_y: mzv


#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
heater_pin: PA2 #PA2 is LDO default
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 125
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  WAS TAP - NOW BEACON in CANBUS

#####################################################################
#   Additional Sensors
#####################################################################

[thermistor CMFB103F3950FANT]
temperature1: 0.0
resistance1: 32116.0
temperature2: 40.0
resistance2: 5309.0
temperature3: 80.0
resistance3: 1228.0

#[temperature_sensor sb_ambient_temp]
## Chamber Temperature - T1
#sensor_type: CMFB103F3950FANT
#sensor_pin: PF5
#min_temp: 0
#max_temp: 100
#gcode_id: chamber_th

[temperature_sensor back_chamber_temp]
## Chamber Temperature - T
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF6
min_temp: 0
max_temp: 100
gcode_id: chamber_th2

[temperature_sensor RPi4]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################

#[safe_z_home]
##  XY Location of the Z Endstop Switch
##  Update -10,-10 to the XY coordinates of your endstop pin 
##  (such as 157,305) after going through Z Endstop Pin
##  Location Definition step.
#home_xy_position: 147,256
#speed:100
#z_hop:10
#z_hop_speed:10


########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.889
#*# pid_ki = 0.964
#*# pid_kd = 412.851
#*#
#*# [probe]
#*# z_offset = -1.270
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.033761, -0.038837, -0.038152, -0.037847, -0.038919, -0.035026, -0.030157, -0.034238, -0.044718, -0.039535, -0.039215, -0.037868, -0.039206, -0.039178, -0.024918, -0.015179, -0.002402, 0.002675
#*# 	  -0.026295, -0.039169, -0.037084, -0.029127, -0.035569, -0.028782, -0.032466, -0.040712, -0.038933, -0.028629, -0.040952, -0.047509, -0.036846, -0.029115, -0.024538, -0.008687, 0.006326, 0.012976
#*# 	  -0.033815, -0.033045, -0.027114, -0.031643, -0.029704, -0.030692, -0.035086, -0.029795, -0.030061, -0.034094, -0.028959, -0.031183, -0.028313, -0.028981, -0.016342, 0.000049, 0.004400, 0.021742
#*# 	  -0.025792, -0.027767, -0.029706, -0.028167, -0.035022, -0.030290, -0.025727, -0.028312, -0.029305, -0.028031, -0.027229, -0.025310, -0.029345, -0.023206, -0.016634, -0.006280, 0.008722, 0.009930
#*# 	  -0.028390, -0.026867, -0.031081, -0.026761, -0.028732, -0.029946, -0.025286, -0.031581, -0.024397, -0.032087, -0.026811, -0.026409, -0.024432, -0.015747, -0.018582, -0.011115, -0.000854, 0.005271
#*# 	  -0.023997, -0.026173, -0.025118, -0.022491, -0.024459, -0.024669, -0.023000, -0.023799, -0.030178, -0.026732, -0.026760, -0.025534, -0.030414, -0.023689, -0.023957, -0.023285, -0.014678, 0.002255
#*# 	  -0.021943, -0.021950, -0.023757, -0.022586, -0.025151, -0.021855, -0.024131, -0.018595, -0.020786, -0.021702, -0.023262, -0.022016, -0.024137, -0.023364, -0.022246, -0.022078, -0.018822, -0.018523
#*# 	  -0.021923, -0.021634, -0.024231, -0.022706, -0.024705, -0.020765, -0.023095, -0.023009, -0.020556, -0.019678, -0.022602, -0.018628, -0.020404, -0.021048, -0.021572, -0.021763, -0.018502, -0.017287
#*# 	  -0.021834, -0.020637, -0.021143, -0.021137, -0.020455, -0.021158, -0.016651, -0.020384, -0.019955, -0.020873, -0.017762, -0.020348, -0.017559, -0.016061, -0.021175, -0.019708, -0.019147, -0.013763
#*# 	  -0.018039, -0.020175, -0.015374, -0.015602, -0.017395, -0.013457, -0.019336, -0.014474, -0.013763, -0.013251, -0.012618, -0.014612, -0.010317, -0.015641, -0.019821, -0.008156, -0.015595, -0.009722
#*# 	  -0.015350, -0.014047, -0.013034, -0.008894, -0.009525, -0.010076, -0.010112, -0.010479, -0.011481, -0.010260, -0.009224, -0.011719, -0.010579, -0.018891, -0.009733, -0.014525, -0.008988, 0.000817
#*# 	  -0.008002, -0.004405, -0.007199, -0.008730, -0.001835, -0.007793, -0.014269, -0.018316, -0.000532, 0.004255, -0.006748, -0.013542, 0.000661, -0.003791, -0.003401, 0.002935, -0.007476, 0.001161
#*# 	  0.005594, 0.002067, -0.002825, -0.000069, 0.000101, 0.003237, -0.000382, 0.001925, 0.001967, 0.001243, 0.000509, -0.000029, 0.002814, 0.001154, 0.004313, 0.002272, 0.004059, 0.012056
#*# 	  0.000749, -0.001389, 0.002953, 0.003786, 0.000096, 0.002829, 0.002051, -0.007689, 0.002696, 0.003816, 0.003726, 0.001646, 0.003233, 0.003148, 0.005049, 0.005150, 0.006115, 0.013317
#*# 	  0.002115, 0.001185, 0.004198, 0.001509, 0.002874, 0.001709, -0.003917, 0.004901, 0.002211, 0.001475, 0.005027, 0.005007, 0.003781, 0.002927, 0.005433, 0.005985, 0.009101, 0.010806
#*# 	  -0.001885, -0.004040, 0.001689, -0.002907, -0.006403, -0.010938, 0.001407, 0.002900, 0.001871, 0.004362, -0.000141, 0.001321, 0.002557, 0.002308, 0.005001, 0.004651, 0.006439, 0.007474
#*# 	  -0.009438, -0.009172, -0.008303, -0.013923, -0.012804, -0.014330, -0.008695, -0.001703, -0.006710, -0.019424, 0.002514, 0.002782, 0.000389, 0.004258, 0.006734, 0.004272, 0.006646, 0.004463
#*# 	  -0.008213, -0.006192, -0.001586, -0.010168, -0.003830, -0.006220, -0.007731, -0.012325, 0.001769, -0.017316, -0.001325, -0.001231, 0.002857, 0.000866, 0.002617, 0.003655, 0.004370, 0.005144
#*# x_count = 18
#*# y_count = 18
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 59.939
#*# max_x = 186.09
#*# min_y = 62.434
#*# max_y = 183.56
#*#
#*# [beacon model default]
#*# model_coef = 1.9257982386737142,
#*# 	  2.1904011986275074,
#*# 	  0.5881661108028357,
#*# 	  0.30341866940870527,
#*# 	  0.14823890288711727,
#*# 	  -0.42807822476666274,
#*# 	  -0.13716254071061182,
#*# 	  0.612855529187592,
#*# 	  0.08376843001203003,
#*# 	  -0.2664564217100284
#*# model_domain = 3.352922478536077e-07,3.360945745364866e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 72.578002
#*# model_offset = 0.11500
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 77.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 51.6
