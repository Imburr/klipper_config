[include moonraker_obico_macros.cfg]
##########################
##### BASE CONFIG #######
##########################

[include mainsail.cfg]
[include ./backup/backup.cfg]

##########################
##### HARDWARE STUFF #####
##########################

[include ./hardware/xyz-stepper.cfg]
[include ./hardware/extruder.cfg]
#[include ./klicky/klicky-probe.cfg]
#[include ./hardware/adxl345.cfg]  This config now in canbus.cfg
[include ./hardware/fans.cfg] # Some fans config in canbus.cfg
[include ./hardware/canbus.cfg]

##########################
##### LIGHTS #############
##########################

[include ./hardware/chamber-lighting.cfg]
[include ./hardware/stealthburner-led.cfg]

##########################
##### CALIBRATION ########
##########################

[include ./calibration/z-tilt.cfg]
[include ./calibration/bed-mesh.cfg]
[include ./macros/unsafe.cfg]
[include ./calibration/pressure_advance.cfg]
[include ./calibration/test_speed.cfg]
[include ./calibration/pika.cfg]
[include test_probe_accuracy.cfg]

##########################
##### MACROS #############
##########################

[include ./macros/chamber-led.cfg]
[include ./macros/conditional-homing.cfg]
[include ./macros/print-end.cfg]
[include ./macros/print-start-mmu.cfg]
[include ./macros/dump-variables.cfg]
[include ./macros/movement-check.cfg]
[include ./macros/cancel-change.cfg]
[include ./macros/pause-resume.cfg]         ; Overridden by ERCF / subsequantly disabled
[include ./macros/load-unload.cfg]
[include ./macros/filament-change.cfg]
[include ./macros/park.cfg]
#[include ./macros/prusaslicer-accel.cfg]

##########################
##### THIRD PARTY ########
##########################

#[include ./third-party-cfg/nozzle_scrub.cfg]
[include KAMP_Settings.cfg]

##########################
##### ERCF ###############
##########################

[include mmu/base/*.cfg]
[include macros/mmu_adds.cfg]
[include mmu/optional/mmu_ercf_cutter.cfg]

##########################
##### LCD/MENU ###########
##########################

#[include ./third-party-cfg/nozzle_scrub_menu.cfg]
#[include ./menu/printer_menu.cfg]

##########################
##### NOT ENABLED YET ####
##########################

#[include ./todo/mini12864.cfg] Add this after adding mini12864 LED
#[include ./todo/lcd_tweaks.cfg] Need to figure this one out and then implement
#[include ./hardware/nevermore.cfg] Disabled as I prefer to chamber vent outside and needed the PWM

##########################
#### REPLACEMENT #########
##########################

[include ./replacement_macros/replace-m900.cfg]
[include ./replacement_macros/replace-m117.cfg]

[exclude_object]

[gcode_arcs]
resolution: 0.1

[respond]
default_type: echo
default_prefix:  

[force_move]
# Enable commands that force potentially unsafe movement
enable_force_move: True

[idle_timeout]
timeout: 14400

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_290040000750314D35323820-if00
restart_method: command

[mcu rpi]
# Add Rpi as secondary MCU to allow for ADXL use through SPI ribbon/adapter from LDO
serial: /tmp/klipper_host_mcu

[mcu sht]
canbus_uuid: 30993412e8e0

[printer]
kinematics: corexy
max_velocity: 200           # Changed from 200 on 7.11.23
max_accel:  6000            # tuned on 7.11.23 after beacon install.
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0 # Changed on 7.11.23

#####################################################################
#   Input Shaper
#####################################################################

[input_shaper]
#shaper_freq_x: 76.2               ; suggested max_accel <= 22600 mm/sec^2
#shaper_type_x: zv
#shaper_freq_y: 51.8               ; suggested max_accel <= 7900 mm/sec^2
#shaper_type_y: mzv


#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
heater_pin: PA2 #PA2 is LDO default
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 125
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  WAS TAP - NOW BEACON in CANBUS

#####################################################################
#   Additional Sensors
#####################################################################

[thermistor CMFB103F3950FANT]
temperature1: 0.0
resistance1: 32116.0
temperature2: 40.0
resistance2: 5309.0
temperature3: 80.0
resistance3: 1228.0

#[temperature_sensor sb_ambient_temp]
## Chamber Temperature - T1
#sensor_type: CMFB103F3950FANT
#sensor_pin: PF5
#min_temp: 0
#max_temp: 100
#gcode_id: chamber_th

[temperature_sensor back_chamber_temp]
## Chamber Temperature - T
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF6
min_temp: 0
max_temp: 100
gcode_id: chamber_th2

[temperature_sensor RPi4]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################

#[safe_z_home]
##  XY Location of the Z Endstop Switch
##  Update -10,-10 to the XY coordinates of your endstop pin 
##  (such as 157,305) after going through Z Endstop Pin
##  Location Definition step.
#home_xy_position: 147,256
#speed:100
#z_hop:10
#z_hop_speed:10


########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.889
#*# pid_ki = 0.964
#*# pid_kd = 412.851
#*#
#*# [probe]
#*# z_offset = -1.270
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.005438, -0.000976, 0.005018, 0.006304, 0.011070, 0.012884, 0.003075, 0.010841, 0.012921, 0.013113, 0.013247, 0.013005, 0.011685, 0.015831, 0.014339, 0.020868, 0.013016, 0.033001, 0.026646, 0.038148, 0.043509, 0.046590, 0.048390, 0.047888
#*# 	  -0.002093, -0.004415, 0.006301, 0.006877, 0.005903, 0.006118, 0.013076, 0.014827, 0.010828, 0.013656, 0.013737, 0.015124, 0.012630, 0.013796, 0.012673, 0.020790, 0.027977, 0.026728, 0.028565, 0.031287, 0.042574, 0.046685, 0.047993, 0.046133
#*# 	  0.007588, -0.004785, -0.004334, 0.003326, 0.004986, 0.008245, 0.008761, 0.009529, 0.009882, 0.011991, 0.008943, 0.009551, 0.017285, 0.013457, 0.010538, 0.019829, 0.031742, 0.023174, 0.040696, 0.032239, 0.044424, 0.047480, 0.047628, 0.069844
#*# 	  0.004037, 0.002233, -0.001950, 0.005333, 0.003207, 0.006307, 0.004190, 0.007282, 0.009567, 0.010133, 0.014474, 0.011492, 0.012545, 0.011264, 0.013073, 0.010154, 0.026779, 0.018811, 0.031909, 0.035971, 0.040397, 0.046252, 0.045957, 0.048270
#*# 	  -0.004571, 0.001585, 0.000289, -0.005988, -0.005598, -0.000922, -0.007686, 0.003810, 0.003806, 0.006214, 0.006741, 0.011771, 0.011357, 0.012165, 0.013043, 0.011511, 0.016540, 0.018376, 0.028847, 0.034951, 0.040625, 0.043188, 0.045884, 0.052794
#*# 	  -0.008738, -0.000192, -0.008910, -0.008306, -0.001727, -0.000664, -0.003115, -0.000730, 0.001378, 0.006115, 0.007218, 0.008741, 0.007478, 0.001956, 0.011509, 0.002580, 0.012464, 0.010874, 0.012117, 0.030361, 0.036078, 0.041258, 0.040805, 0.046833
#*# 	  -0.004694, -0.011053, -0.004862, -0.005669, -0.008981, -0.004002, -0.000005, 0.002141, 0.001976, 0.003279, 0.004395, 0.008580, 0.003038, -0.012672, 0.019644, 0.013004, 0.022846, 0.016542, 0.024340, 0.028722, 0.031177, 0.034985, 0.047694, 0.048121
#*# 	  -0.009323, -0.007342, -0.005961, -0.006425, -0.003775, -0.011219, -0.004041, -0.001047, -0.001248, 0.003080, 0.007899, 0.006705, -0.002283, 0.015503, 0.014980, 0.015763, 0.014785, 0.016556, 0.025518, 0.028017, 0.032257, 0.037834, 0.035753, 0.041748
#*# 	  -0.005673, -0.008809, -0.007741, -0.008036, -0.007654, -0.008156, -0.006063, -0.004710, -0.001069, -0.002271, 0.004500, 0.020733, 0.016030, 0.019988, 0.022407, 0.020206, 0.023221, 0.021131, 0.023142, 0.036414, 0.041357, 0.046278, 0.054805, 0.050664
#*# 	  -0.009877, -0.011765, -0.008248, -0.004623, -0.009932, -0.007263, -0.007514, 0.004747, 0.004593, 0.002807, 0.012918, 0.018082, 0.019701, 0.017078, 0.020383, 0.020869, 0.026367, 0.028448, 0.032238, 0.035995, 0.038855, 0.039617, 0.053156, 0.052426
#*# 	  -0.010126, -0.008001, -0.005741, -0.004886, -0.006769, -0.004553, -0.001457, -0.007120, 0.013055, 0.002186, 0.009069, 0.016439, 0.019181, 0.006095, 0.022572, 0.021578, 0.022205, 0.026839, 0.021921, 0.025506, 0.044029, 0.049241, 0.056244, 0.058692
#*# 	  -0.007490, -0.008262, -0.004127, -0.005569, -0.006634, -0.005579, -0.000571, -0.002764, 0.013062, 0.011131, 0.012271, 0.011898, 0.020010, 0.023262, 0.022696, 0.025123, 0.026623, 0.026047, 0.046905, 0.042476, 0.048834, 0.046485, 0.055918, 0.054800
#*# 	  -0.012140, -0.006444, -0.001025, -0.003302, -0.006064, -0.000965, 0.010917, 0.005141, 0.008664, 0.001528, 0.009573, 0.013898, 0.011819, 0.023232, 0.024423, 0.029716, 0.033128, 0.026169, 0.043364, 0.043576, 0.054614, 0.055127, 0.059662, 0.060489
#*# 	  -0.006640, -0.008179, -0.007018, -0.007138, -0.004037, -0.005728, -0.005005, -0.004875, 0.000275, 0.005802, 0.007348, 0.013759, 0.010240, 0.028494, 0.024111, 0.029823, 0.028614, 0.035398, 0.040006, 0.039989, 0.054124, 0.060192, 0.059885, 0.055909
#*# 	  -0.018984, -0.005039, -0.007984, -0.021010, -0.007756, -0.018963, -0.006970, -0.007393, 0.001006, 0.001026, 0.002894, 0.006123, 0.009981, 0.015070, 0.024599, 0.013791, 0.032781, 0.034114, 0.034896, 0.039391, 0.044471, 0.047466, 0.048060, 0.064078
#*# 	  -0.025057, -0.018175, -0.018043, -0.015785, -0.022073, -0.022295, -0.016849, -0.005358, -0.002414, -0.001360, -0.001685, -0.000916, 0.009633, 0.013552, 0.009221, 0.020945, 0.021065, 0.026237, 0.032248, 0.035690, 0.034761, 0.042812, 0.051523, 0.046696
#*# 	  -0.019885, -0.020618, -0.021050, -0.019186, -0.020337, -0.017325, -0.017777, -0.015667, -0.012866, -0.001121, -0.000478, -0.002206, 0.006646, 0.008255, 0.012762, 0.019151, 0.020741, 0.027417, 0.029391, 0.034542, 0.035932, 0.041834, 0.043278, 0.044824
#*# x_count = 24
#*# y_count = 17
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 39.8
#*# max_x = 206.2
#*# min_y = 66.022
#*# max_y = 179.978
#*#
#*# [beacon model default]
#*# model_coef = 1.934243930597146,
#*# 	  2.206808199797723,
#*# 	  0.6436025413836176,
#*# 	  0.3095345837351202,
#*# 	  -0.15977813582327796,
#*# 	  -0.5908394974077775,
#*# 	  0.4266719892497021,
#*# 	  1.046422592108256,
#*# 	  -0.23184944767066623,
#*# 	  -0.5507144312738391
#*# model_domain = 3.353607345856729e-07,3.361070372275538e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 79.449632
#*# model_offset = 0.62000
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 77.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 51.6
