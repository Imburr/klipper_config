[include moonraker_obico_macros.cfg]
##########################
##### BASE CONFIG #######
##########################

[include mainsail.cfg]
[include ./backup/backup.cfg]

##########################
##### HARDWARE STUFF #####
##########################

[include ./hardware/xyz-stepper.cfg]
[include ./hardware/extruder.cfg]
#[include ./klicky/klicky-probe.cfg]
#[include ./hardware/adxl345.cfg]  This config now in canbus.cfg
[include ./hardware/fans.cfg] # Some fans config in canbus.cfg
[include ./hardware/canbus.cfg]

##########################
##### LIGHTS #############
##########################

[include ./hardware/chamber-lighting.cfg]
[include ./hardware/stealthburner-led.cfg]

##########################
##### CALIBRATION ########
##########################

[include ./calibration/z-tilt.cfg]
[include ./calibration/bed-mesh.cfg]
[include ./macros/unsafe.cfg]
[include ./calibration/pressure_advance.cfg]
[include ./calibration/test_speed.cfg]
[include ./calibration/pika.cfg]
[include test_probe_accuracy.cfg]

##########################
##### MACROS #############
##########################

[include ./macros/chamber-led.cfg]
[include ./macros/conditional-homing.cfg]
[include ./macros/print-end.cfg]
[include ./macros/print-start-mmu.cfg]
[include ./macros/dump-variables.cfg]
[include ./macros/movement-check.cfg]
[include ./macros/cancel-change.cfg]
[include ./macros/pause-resume.cfg]         ; Overridden by ERCF / subsequantly disabled
[include ./macros/load-unload.cfg]
[include ./macros/filament-change.cfg]
[include ./macros/park.cfg]
#[include ./macros/prusaslicer-accel.cfg]

##########################
##### THIRD PARTY ########
##########################

#[include ./third-party-cfg/nozzle_scrub.cfg]
[include KAMP_Settings.cfg]

##########################
##### ERCF ###############
##########################

[include mmu/base/*.cfg]
[include macros/mmu_adds.cfg]
[include mmu/optional/mmu_ercf_cutter.cfg]

##########################
##### LCD/MENU ###########
##########################

#[include ./third-party-cfg/nozzle_scrub_menu.cfg]
#[include ./menu/printer_menu.cfg]

##########################
##### NOT ENABLED YET ####
##########################

#[include ./todo/mini12864.cfg] Add this after adding mini12864 LED
#[include ./todo/lcd_tweaks.cfg] Need to figure this one out and then implement
#[include ./hardware/nevermore.cfg] Disabled as I prefer to chamber vent outside and needed the PWM

##########################
#### REPLACEMENT #########
##########################

[include ./replacement_macros/replace-m900.cfg]
[include ./replacement_macros/replace-m117.cfg]

[exclude_object]

[gcode_arcs]
resolution: 0.1

[respond]
default_type: echo
default_prefix:  

[force_move]
# Enable commands that force potentially unsafe movement
enable_force_move: True

[idle_timeout]
timeout: 14400

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_290040000750314D35323820-if00
restart_method: command

[mcu rpi]
# Add Rpi as secondary MCU to allow for ADXL use through SPI ribbon/adapter from LDO
serial: /tmp/klipper_host_mcu

[mcu sht]
canbus_uuid: 30993412e8e0

[printer]
kinematics: corexy
max_velocity: 200           # Changed from 200 on 7.11.23
max_accel:  6000            # tuned on 7.11.23 after beacon install.
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0 # Changed on 7.11.23

#####################################################################
#   Input Shaper
#####################################################################

[input_shaper]
#shaper_freq_x: 76.2               ; suggested max_accel <= 22600 mm/sec^2
#shaper_type_x: zv
#shaper_freq_y: 51.8               ; suggested max_accel <= 7900 mm/sec^2
#shaper_type_y: mzv


#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
heater_pin: PA2 #PA2 is LDO default
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 125
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  WAS TAP - NOW BEACON in CANBUS

#####################################################################
#   Additional Sensors
#####################################################################

[thermistor CMFB103F3950FANT]
temperature1: 0.0
resistance1: 32116.0
temperature2: 40.0
resistance2: 5309.0
temperature3: 80.0
resistance3: 1228.0

#[temperature_sensor sb_ambient_temp]
## Chamber Temperature - T1
#sensor_type: CMFB103F3950FANT
#sensor_pin: PF5
#min_temp: 0
#max_temp: 100
#gcode_id: chamber_th

[temperature_sensor back_chamber_temp]
## Chamber Temperature - T
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF6
min_temp: 0
max_temp: 100
gcode_id: chamber_th2

[temperature_sensor RPi4]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################

#[safe_z_home]
##  XY Location of the Z Endstop Switch
##  Update -10,-10 to the XY coordinates of your endstop pin 
##  (such as 157,305) after going through Z Endstop Pin
##  Location Definition step.
#home_xy_position: 147,256
#speed:100
#z_hop:10
#z_hop_speed:10


########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.889
#*# pid_ki = 0.964
#*# pid_kd = 412.851
#*#
#*# [probe]
#*# z_offset = -1.270
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.013160, -0.013761, -0.007786, -0.006830, -0.007655, -0.002051, -0.003741, -0.004545, -0.006647, -0.000613, -0.000510, 0.000452, 0.000795, -0.001601, 0.002711, 0.007253, 0.016496, 0.009224, 0.011051, 0.010484, 0.016248
#*# 	  -0.025886, -0.027541, -0.026187, -0.006415, -0.023524, -0.004451, -0.007793, -0.012877, -0.005204, -0.006237, -0.005350, -0.007817, -0.003120, -0.001895, -0.001385, 0.002952, 0.004447, -0.007692, 0.014125, 0.019817, 0.014744
#*# 	  -0.034637, -0.030059, -0.032621, -0.022091, -0.024862, -0.013860, -0.021775, -0.016096, -0.020577, -0.008192, -0.009947, -0.021980, -0.009521, -0.015955, -0.002249, -0.004930, -0.000596, 0.005902, 0.004268, 0.006285, 0.014981
#*# 	  -0.041791, -0.030550, -0.029599, -0.036996, -0.035674, -0.034976, -0.030767, -0.028891, -0.024185, -0.017058, -0.017304, -0.018392, -0.012545, -0.007600, -0.008060, -0.000972, 0.002898, 0.004433, 0.004106, 0.007160, 0.023052
#*# 	  -0.036649, -0.032146, -0.034876, -0.023571, -0.028725, -0.027500, -0.028944, -0.029809, -0.024329, -0.010724, -0.027757, -0.011246, -0.015990, -0.015281, -0.007695, -0.008280, -0.002273, -0.000802, 0.008095, 0.017069, 0.017418
#*# 	  -0.040479, -0.036745, -0.037305, -0.040821, -0.038247, -0.026060, -0.028524, -0.029496, -0.029143, -0.024161, -0.018012, -0.014607, -0.012858, -0.011012, -0.013361, -0.009928, -0.004165, -0.000114, 0.014505, 0.010535, 0.020570
#*# 	  -0.042029, -0.042820, -0.044774, -0.040312, -0.039469, -0.036915, -0.037050, -0.030381, -0.014899, -0.038958, -0.025521, -0.028501, -0.016584, -0.020929, -0.018618, -0.016177, -0.010078, -0.005838, 0.002938, 0.014899, 0.014310
#*# 	  -0.045635, -0.048346, -0.047109, -0.046527, -0.042885, -0.042035, -0.039799, -0.034769, -0.029722, -0.029779, -0.028654, -0.029825, -0.022276, -0.021993, -0.018734, -0.014775, -0.007267, -0.008076, -0.003664, 0.002878, 0.004003
#*# 	  -0.044583, -0.039762, -0.047716, -0.048616, -0.045086, -0.041607, -0.041922, -0.037987, -0.041072, -0.028177, -0.025731, -0.018539, -0.021512, -0.023524, -0.017954, -0.015371, -0.014229, -0.011001, -0.005631, 0.003698, 0.007384
#*# 	  -0.048154, -0.051163, -0.048101, -0.047964, -0.045533, -0.041576, -0.042271, -0.035915, -0.037752, -0.029023, -0.023562, -0.024901, -0.020323, -0.022349, -0.015664, -0.011935, -0.010777, -0.009350, -0.004582, 0.007613, 0.009987
#*# 	  -0.048907, -0.048151, -0.045815, -0.047472, -0.039355, -0.040897, -0.045121, -0.027335, -0.022695, -0.021929, -0.019522, -0.021777, -0.017815, -0.014907, -0.015658, -0.014642, -0.010724, -0.006229, 0.000406, 0.015390, 0.012773
#*# 	  -0.045255, -0.047145, -0.044663, -0.037020, -0.041460, -0.042145, -0.034460, -0.038083, -0.025172, -0.020142, -0.020654, -0.019301, -0.018167, -0.018985, -0.012936, -0.005615, -0.001474, 0.005899, 0.010360, 0.011878, 0.012168
#*# 	  -0.043714, -0.044271, -0.041066, -0.036879, -0.041893, -0.028846, -0.032323, -0.024587, -0.020124, -0.019879, -0.019651, -0.013914, -0.014548, -0.012562, -0.011850, -0.010195, 0.001505, 0.008881, 0.015200, 0.012196, 0.016018
#*# 	  -0.044761, -0.041819, -0.039470, -0.042253, -0.043377, -0.044107, -0.031602, -0.031391, -0.028205, -0.013159, -0.023081, -0.015574, -0.013118, -0.013501, -0.005224, 0.005099, 0.007683, 0.016297, 0.009273, 0.018228, 0.028189
#*# 	  -0.043005, -0.046174, -0.043859, -0.039684, -0.039726, -0.032366, -0.029794, -0.031099, -0.023677, -0.021047, -0.019710, -0.015509, -0.013677, -0.002639, -0.012122, 0.005469, 0.012399, 0.009056, 0.016723, 0.020967, 0.031385
#*# 	  -0.046561, -0.047248, -0.046246, -0.045911, -0.042600, -0.042315, -0.037723, -0.032081, -0.033677, -0.025529, -0.014199, -0.014716, -0.014626, -0.008628, 0.004500, -0.005603, 0.005721, 0.009251, 0.017041, 0.018952, 0.028181
#*# 	  -0.054253, -0.048877, -0.058629, -0.055769, -0.044018, -0.048357, -0.043296, -0.041061, -0.036888, -0.031381, -0.024917, -0.023664, -0.013534, -0.012295, -0.003184, -0.001387, -0.000599, 0.005421, 0.007659, 0.016588, 0.022193
#*# 	  -0.060846, -0.061417, -0.061655, -0.060763, -0.052815, -0.046979, -0.048264, -0.042582, -0.039366, -0.034109, -0.031168, -0.027422, -0.021513, -0.009709, -0.011159, -0.016991, -0.005087, -0.001762, 0.002510, 0.012174, 0.022318
#*# 	  -0.063675, -0.058791, -0.058740, -0.061595, -0.058055, -0.053735, -0.047229, -0.052325, -0.042302, -0.033393, -0.033429, -0.028886, -0.022158, -0.021909, -0.032831, -0.010006, -0.004499, -0.002659, -0.002771, 0.006481, 0.010720
#*# 	  -0.054825, -0.058967, -0.058905, -0.054249, -0.055640, -0.042006, -0.039840, -0.038260, -0.038382, -0.026549, -0.033847, -0.021146, -0.017864, -0.031670, -0.008643, -0.008199, -0.003374, -0.001772, 0.002188, 0.003801, 0.012354
#*# 	  -0.057959, -0.051549, -0.047318, -0.052360, -0.045121, -0.053330, -0.045366, -0.038942, -0.036156, -0.030856, -0.023477, -0.019527, -0.020597, -0.030707, -0.005286, -0.008547, -0.007676, -0.005458, -0.002646, 0.003856, 0.005090
#*# x_count = 21
#*# y_count = 21
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 48.0
#*# max_x = 198.0
#*# min_y = 48.0
#*# max_y = 198.0
#*#
#*# [beacon model default]
#*# model_coef = 1.934243930597146,
#*# 	  2.206808199797723,
#*# 	  0.6436025413836176,
#*# 	  0.3095345837351202,
#*# 	  -0.15977813582327796,
#*# 	  -0.5908394974077775,
#*# 	  0.4266719892497021,
#*# 	  1.046422592108256,
#*# 	  -0.23184944767066623,
#*# 	  -0.5507144312738391
#*# model_domain = 3.353607345856729e-07,3.361070372275538e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 79.449632
#*# model_offset = 0.57000
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 77.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 51.6
