[include moonraker_obico_macros.cfg]
##########################
##### BASE CONFIG #######
##########################

[include mainsail.cfg]
[include ./backup/backup.cfg]

##########################
##### HARDWARE STUFF #####
##########################

[include ./hardware/xyz-stepper.cfg]
[include ./hardware/extruder.cfg]
#[include ./klicky/klicky-probe.cfg]
#[include ./hardware/adxl345.cfg]  This config now in canbus.cfg
[include ./hardware/fans.cfg] # Some fans config in canbus.cfg
[include ./hardware/canbus.cfg]

##########################
##### LIGHTS #############
##########################

[include ./hardware/chamber-lighting.cfg]
[include ./hardware/stealthburner-led.cfg]

##########################
##### CALIBRATION ########
##########################

[include ./calibration/z-tilt.cfg]
[include ./calibration/bed-mesh.cfg]
[include ./macros/unsafe.cfg]
[include ./calibration/pressure_advance.cfg]
[include ./calibration/test_speed.cfg]
[include ./calibration/pika.cfg]
[include ./calibration/microadjust.cfg]
[include ./calibration/sensorless.cfg]
[include test_probe_accuracy.cfg]

##########################
##### MACROS #############
##########################

[include ./macros/chamber-led.cfg]
[include ./macros/conditional-homing.cfg]
[include ./macros/print-end.cfg]
[include ./macros/print-start-mmu.cfg]
[include ./macros/dump-variables.cfg]
[include ./macros/movement-check.cfg]
[include ./macros/cancel-change.cfg]
[include ./macros/pause-resume.cfg]         ; Overridden by ERCF / subsequantly disabled
[include ./macros/load-unload.cfg]
[include ./macros/filament-change.cfg]
[include ./macros/park.cfg]
[include ./macros/heatsoak.cfg]

##########################
##### THIRD PARTY ########
##########################

#[include ./third-party-cfg/nozzle_scrub.cfg]
[include KAMP_Settings.cfg]

##########################
##### ERCF ###############
##########################

[include mmu/base/*.cfg]
[include macros/mmu_adds.cfg]
[include mmu/optional/mmu_ercf_cutter.cfg]

##########################
##### LCD/MENU ###########
##########################

#[include ./third-party-cfg/nozzle_scrub_menu.cfg]
#[include ./menu/printer_menu.cfg]

##########################
##### NOT ENABLED YET ####
##########################

#[include ./todo/mini12864.cfg] Add this after adding mini12864 LED
#[include ./todo/lcd_tweaks.cfg] Need to figure this one out and then implement
#[include ./hardware/nevermore.cfg] Disabled as I prefer to chamber vent outside and needed the PWM

##########################
#### REPLACEMENT #########
##########################

[include ./replacement_macros/replace-m900.cfg]
[include ./replacement_macros/replace-m117.cfg]

[exclude_object]

[gcode_arcs]
resolution: 0.1

[respond]
default_type: echo
default_prefix:  

[force_move]
# Enable commands that force potentially unsafe movement
enable_force_move: True

[idle_timeout]
timeout: 14400

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_290040000750314D35323820-if00
restart_method: command

[mcu rpi]
# Add Rpi as secondary MCU to allow for ADXL use through SPI ribbon/adapter from LDO
serial: /tmp/klipper_host_mcu

[mcu sht]
canbus_uuid: 30993412e8e0

[printer]
kinematics: corexy
max_velocity: 200           # Changed from 200 on 7.11.23
max_accel:  6000            # tuned on 7.11.23 after beacon install.
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0 # Changed on 7.11.23

#####################################################################
#   Input Shaper
#####################################################################

[input_shaper]
#shaper_freq_x: 76.2               ; suggested max_accel <= 22600 mm/sec^2
#shaper_type_x: zv
#shaper_freq_y: 51.8               ; suggested max_accel <= 7900 mm/sec^2
#shaper_type_y: mzv


#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
heater_pin: PA2 #PA2 is LDO default
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 125
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  WAS TAP - NOW BEACON in CANBUS

#####################################################################
#   Additional Sensors
#####################################################################

[thermistor CMFB103F3950FANT]
temperature1: 0.0
resistance1: 32116.0
temperature2: 40.0
resistance2: 5309.0
temperature3: 80.0
resistance3: 1228.0

#[temperature_sensor sb_ambient_temp]
## Chamber Temperature - T1
#sensor_type: CMFB103F3950FANT
#sensor_pin: PF5
#min_temp: 0
#max_temp: 100
#gcode_id: chamber_th

[temperature_sensor back_chamber_temp]
## Chamber Temperature - T
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF6
min_temp: 0
max_temp: 100
gcode_id: chamber_th2

[temperature_sensor RPi4]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.889
#*# pid_ki = 0.964
#*# pid_kd = 412.851
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.002824, 0.002575, 0.003947, 0.010494, 0.006727, 0.008630, 0.011923, 0.015463, 0.008571, 0.007080, 0.010930, 0.011814, 0.014061, 0.003575, 0.004881, 0.012696, 0.026326, 0.027987, 0.010647, 0.017357, 0.017764, 0.021822, 0.037717, 0.032718, 0.031972
#*# 	  -0.001264, 0.003992, 0.012423, 0.010657, 0.013145, 0.014581, 0.011753, 0.011908, 0.007371, 0.009231, 0.012353, 0.013691, 0.012992, 0.012436, 0.011538, 0.013292, 0.028733, 0.003651, 0.029227, 0.019570, 0.023757, 0.027293, 0.040532, 0.042643, 0.038205
#*# 	  -0.002447, 0.009588, 0.011061, 0.010581, 0.010039, 0.009639, 0.007792, 0.012760, 0.014448, 0.008740, 0.012593, 0.005427, 0.011990, 0.016009, 0.010309, 0.018967, 0.012010, 0.012035, 0.009001, 0.008970, 0.035114, 0.038119, 0.036364, 0.034882, 0.026191
#*# 	  -0.003452, 0.006800, 0.012144, 0.011755, 0.013543, 0.010240, 0.009578, 0.010686, 0.011924, 0.007063, 0.009598, 0.013301, 0.009784, 0.007321, -0.000480, 0.013482, 0.013742, 0.012196, 0.014985, 0.011925, 0.037542, 0.030564, 0.039842, 0.037769, 0.027083
#*# 	  0.000686, 0.004260, 0.008979, 0.012500, 0.011021, 0.011728, 0.009261, -0.001128, 0.012295, 0.013085, 0.009824, 0.004808, 0.002144, 0.009125, 0.011442, 0.015542, 0.009795, -0.014442, 0.009785, 0.016445, 0.030575, 0.020829, 0.038832, 0.035935, 0.024174
#*# 	  -0.002454, 0.003985, 0.007625, 0.006595, 0.008826, 0.007579, 0.011669, 0.008933, 0.010584, 0.009661, -0.003094, 0.010965, 0.007786, 0.009812, 0.007863, 0.010408, 0.008165, 0.008672, 0.010872, 0.010277, 0.012433, 0.028877, 0.038647, 0.044539, 0.036783
#*# 	  0.001629, 0.009827, 0.009311, 0.008856, 0.012102, 0.010370, 0.007281, 0.007058, 0.008389, 0.015136, 0.009712, 0.004773, 0.011907, 0.009757, 0.019614, 0.010445, 0.013970, 0.008823, 0.008078, 0.015898, 0.028755, 0.032117, 0.038283, 0.040975, 0.030086
#*# 	  0.004552, 0.008653, 0.012259, 0.020139, 0.008694, 0.004290, 0.017175, 0.009618, 0.010781, 0.011747, 0.013185, 0.017008, 0.008564, 0.021252, 0.015387, 0.015108, 0.005100, 0.011354, 0.025735, 0.008250, 0.030143, 0.028647, 0.040626, 0.032186, 0.016218
#*# 	  0.003948, 0.002153, 0.007793, 0.014002, 0.005905, 0.013547, 0.007276, 0.011541, 0.006897, 0.010454, 0.006640, 0.010091, 0.024644, 0.019869, 0.019132, 0.017169, 0.016546, 0.013769, 0.020016, 0.026980, 0.020259, 0.033146, 0.031995, 0.031116, 0.019430
#*# 	  0.001630, 0.008125, 0.007502, 0.005728, 0.003274, 0.003719, 0.004160, 0.002813, 0.002074, 0.017700, 0.004878, 0.002406, 0.004186, 0.012395, 0.016196, 0.007355, 0.014088, 0.011321, 0.015948, 0.007226, 0.021583, 0.015186, 0.022307, 0.032918, 0.016813
#*# 	  0.003984, 0.003458, 0.005407, 0.002573, 0.003020, 0.004207, 0.003213, 0.003072, 0.003614, 0.004143, 0.002264, 0.005465, 0.005226, 0.005551, 0.007347, 0.005616, 0.007647, 0.006920, 0.007131, 0.006827, 0.004311, 0.009666, 0.023167, 0.011843, 0.007049
#*# 	  -0.001569, -0.016996, 0.005773, 0.004337, 0.004840, 0.002721, -0.005959, 0.002654, -0.004251, 0.004873, -0.019048, 0.001650, 0.005598, 0.004566, 0.006081, 0.005581, 0.005648, 0.004151, 0.005692, 0.007819, 0.007920, 0.007258, 0.019065, 0.018466, 0.016428
#*# 	  0.000330, -0.002371, 0.005718, 0.006750, 0.005168, 0.003874, 0.009249, 0.003150, -0.009886, -0.000445, 0.011078, 0.006626, 0.002025, 0.002756, 0.004129, 0.004173, 0.005865, 0.004370, 0.006081, 0.009275, 0.012324, 0.010358, 0.013389, 0.012694, 0.013927
#*# 	  0.000076, -0.001742, -0.000714, 0.002560, 0.000579, 0.004988, 0.001257, 0.010108, 0.005231, -0.000237, 0.000940, 0.002915, 0.006140, 0.006961, 0.006431, 0.008624, 0.007114, 0.005797, 0.008279, 0.022144, 0.006726, 0.005842, 0.033440, 0.031410, 0.005341
#*# 	  -0.007994, 0.006532, 0.004399, 0.003914, 0.004238, 0.005414, 0.006083, 0.008707, 0.003927, 0.005806, 0.008946, 0.007302, 0.009325, 0.004950, 0.006478, 0.020108, 0.007684, 0.005506, 0.011353, 0.017867, 0.009543, 0.023592, 0.018904, 0.026113, 0.006666
#*# 	  -0.003166, 0.010532, 0.006503, 0.009210, 0.006204, 0.011061, -0.000090, 0.008265, 0.006722, 0.006448, 0.006090, 0.007451, 0.007563, 0.012127, 0.009596, 0.009248, 0.011827, 0.017788, 0.009660, 0.007397, 0.029619, 0.028044, 0.033719, 0.027721, 0.032796
#*# 	  0.005147, 0.010556, 0.007055, 0.011443, 0.006779, 0.004699, 0.005420, 0.006400, 0.007008, 0.006088, 0.007045, 0.007263, 0.005290, 0.007302, 0.013242, 0.012916, 0.031482, 0.014550, 0.017428, 0.025029, 0.033006, 0.034219, 0.038013, 0.037828, 0.032464
#*# 	  -0.000824, 0.010512, 0.011925, 0.013049, 0.013437, 0.012497, 0.010272, 0.012543, 0.008914, 0.010788, 0.006794, 0.009956, 0.009834, 0.026292, 0.007362, 0.025034, 0.025568, 0.020997, 0.031032, 0.034305, 0.033215, 0.033191, 0.046927, 0.041374, 0.032642
#*# 	  0.003107, 0.009184, 0.010504, 0.010160, 0.007288, 0.010563, 0.006618, 0.009123, -0.000765, 0.008247, 0.004143, 0.006619, 0.012530, 0.001538, 0.018240, 0.011901, 0.025825, 0.025677, 0.027887, 0.028764, 0.031577, 0.033536, 0.032559, 0.038228, 0.027735
#*# 	  -0.003133, -0.001714, 0.008678, 0.008019, -0.004886, -0.005087, -0.005305, -0.008106, 0.007681, -0.004777, -0.001452, 0.010496, -0.002591, 0.007703, 0.006898, 0.015240, 0.011604, 0.026167, 0.012733, 0.026208, 0.015202, 0.028220, 0.026453, 0.031634, 0.020497
#*# 	  -0.005501, 0.006387, 0.006891, 0.011066, 0.000425, -0.000346, -0.004270, -0.006218, -0.002529, 0.000394, -0.008912, -0.003109, -0.010829, 0.008774, 0.010098, 0.014136, 0.019161, 0.011439, 0.010445, 0.025465, 0.023370, 0.027993, 0.027900, 0.020764, 0.016669
#*# 	  -0.003811, 0.015809, 0.006393, -0.006189, 0.008770, 0.009165, 0.000320, -0.000328, 0.007153, -0.000255, -0.006560, 0.002321, 0.015988, 0.010465, 0.015943, 0.021879, 0.017195, 0.015995, 0.019781, 0.024204, 0.023866, 0.018842, 0.025244, 0.025107, 0.016814
#*# 	  -0.001680, 0.009695, 0.008651, 0.008570, 0.014385, -0.005555, -0.007612, 0.014264, 0.001924, -0.001887, 0.004465, 0.015255, 0.016164, 0.015047, -0.011652, 0.015852, 0.015199, 0.015151, 0.013806, 0.016546, 0.017386, 0.019103, 0.022939, 0.025306, 0.019314
#*# 	  -0.009552, 0.014915, 0.023504, 0.019687, 0.015591, 0.016900, 0.017470, 0.014192, 0.007864, -0.000064, 0.006408, 0.001213, 0.017190, -0.002586, 0.011874, 0.018203, 0.014183, 0.019087, 0.011822, 0.011064, 0.011102, 0.018773, 0.019030, 0.019303, -0.003629
#*# 	  -0.004981, 0.010506, 0.002337, -0.005727, -0.003443, -0.000513, -0.001158, 0.000802, -0.005235, -0.008696, -0.007890, -0.003531, -0.007728, -0.010577, -0.004295, 0.002698, -0.002003, -0.003236, -0.002925, -0.000812, -0.000201, 0.002338, 0.000793, 0.001304, -0.005572
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 210.0
#*# min_y = 30.0
#*# max_y = 208.0
#*#
#*# [beacon model default]
#*# model_coef = 1.9986101587394336,
#*# 	  2.2330294655815703,
#*# 	  0.5683538419617058,
#*# 	  0.27303609554992636,
#*# 	  -0.13052055779098906,
#*# 	  -0.5026341317225997,
#*# 	  0.33763613969702233,
#*# 	  0.8024061151415637,
#*# 	  -0.15799795308980943,
#*# 	  -0.378283680492853
#*# model_domain = 3.356731262483608e-07,3.361668943651104e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 69.596304
#*# model_offset = -0.15500
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 77.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 51.6
#*#
#*# [beacon model pei_hot]
#*# model_coef = 1.9263519575030055,
#*# 	2.1946743347503372,
#*# 	0.6208794249910773,
#*# 	0.2775896555222557,
#*# 	0.06526221562750463,
#*# 	-0.2611119885640586,
#*# 	-0.05461829170887029,
#*# 	0.36810740679885895,
#*# 	0.05685001457152785,
#*# 	-0.15547240310186372
#*# model_domain = 3.351987055417817e-07,3.359664588035842e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 63.925584
#*# model_offset = 0.00000
