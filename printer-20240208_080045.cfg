[include moonraker_obico_macros.cfg]
##########################
##### BASE CONFIG #######
##########################

[include mainsail.cfg]
[include ./backup/backup.cfg]

##########################
##### HARDWARE STUFF #####
##########################

[include ./hardware/xyz-stepper.cfg]
[include ./hardware/extruder.cfg]
#[include ./klicky/klicky-probe.cfg]
#[include ./hardware/adxl345.cfg]  This config now in canbus.cfg
[include ./hardware/fans.cfg] # Some fans config in canbus.cfg
[include ./hardware/canbus.cfg]

##########################
##### LIGHTS #############
##########################

[include ./hardware/chamber-lighting.cfg]
[include ./hardware/stealthburner-led.cfg]

##########################
##### CALIBRATION ########
##########################

[include ./calibration/z-tilt.cfg]
[include ./calibration/bed-mesh.cfg]
[include ./macros/unsafe.cfg]
[include ./calibration/pressure_advance.cfg]
[include ./calibration/test_speed.cfg]
[include ./calibration/pika.cfg]
[include ./calibration/microadjust.cfg]
[include ./calibration/sensorless.cfg]
[include test_probe_accuracy.cfg]
[include K-ShakeTune/*.cfg]

##########################
##### MACROS #############
##########################

[include ./macros/chamber-led.cfg]
[include ./macros/conditional-homing.cfg]
[include ./macros/print-end.cfg]
[include ./macros/print-start-mmu.cfg]
[include ./macros/dump-variables.cfg]
[include ./macros/movement-check.cfg]
[include ./macros/cancel-change.cfg]
[include ./macros/pause-resume.cfg]         ; Overridden by ERCF / subsequantly disabled
[include ./macros/load-unload.cfg]
[include ./macros/filament-change.cfg]
[include ./macros/park.cfg]
[include ./macros/heatsoak.cfg]

##########################
##### THIRD PARTY ########
##########################

#[include ./third-party-cfg/nozzle_scrub.cfg]
[include KAMP_Settings.cfg]

##########################
##### ERCF ###############
##########################

#[include mmu/base/*.cfg]
#[include macros/mmu_adds.cfg]
#[include mmu/optional/mmu_ercf_cutter.cfg]

##########################
##### LCD/MENU ###########
##########################

#[include ./third-party-cfg/nozzle_scrub_menu.cfg]
#[include ./menu/printer_menu.cfg]

##########################
##### NOT ENABLED YET ####
##########################

#[include ./todo/mini12864.cfg] Add this after adding mini12864 LED
#[include ./todo/lcd_tweaks.cfg] Need to figure this one out and then implement
#[include ./hardware/nevermore.cfg] Disabled as I prefer to chamber vent outside and needed the PWM

##########################
#### REPLACEMENT #########
##########################

[include ./replacement_macros/replace-m900.cfg]
[include ./replacement_macros/replace-m117.cfg]

[exclude_object]

[gcode_arcs]
resolution: 0.1

[respond]
default_type: echo
default_prefix:  

[force_move]
# Enable commands that force potentially unsafe movement
enable_force_move: True

[idle_timeout]
timeout: 14400

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_290040000750314D35323820-if00
restart_method: command

[mcu rpi]
# Add Rpi as secondary MCU to allow for ADXL use through SPI ribbon/adapter from LDO
serial: /tmp/klipper_host_mcu

[mcu sht]
canbus_uuid: 30993412e8e0

[printer]
kinematics: corexy           # TESTING HIGHER SPEEDS ON 2/7/24 DUE TO SLICER SLOWWWWWWWW / ALSO SET IN PRINT START
max_velocity: 450            # Changed from 200 on 7.11.23
max_accel: 10000             # tuned on 7.11.23 after beacon install.
max_accel_to_decel:5000
max_z_velocity: 15           #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0 # Changed on 7.11.23

#####################################################################
#   Input Shaper
#####################################################################

[input_shaper]
shaper_freq_x: 71.0
shaper_type_x: mzv # 14900
shaper_freq_y: 47.8
shaper_type_y: mzv # 6700
damping_ratio_x: 0.043
damping_ratio_y: 0.055
# Not Noisy: 20-22.5 / 60.6-96.7 / 30.2-48 / 111.4-200 mm/s

#####################################################################
#   AutoTune / https://github.com/andrewmcgr/klipper_tmc_autotune
#####################################################################

#[motor_constants ldo-42sth48-2004mah_vrn]
#resistance: 1.45
#inductance: 0.002
#holding_torque: 0.40
#max_current: 2.0
#steps_per_revolution: 400

#[autotune_tmc stepper_x]
#motor: ldo-42sth48-2004mah_vrn
#sg4_thrs: 105
#tuning_goal: silent
#[autotune_tmc stepper_y]
#motor: ldo-42sth48-2004mah_vrn
#tuning_goal: silent

#[autotune_tmc stepper_z]
#motor: ldo-42sth40-1684l300e
#[autotune_tmc stepper_z1]
#motor: ldo-42sth40-1684l300e
#[autotune_tmc stepper_z2]
#motor: ldo-42sth40-1684l300e

#[autotune_tmc extruder]
#motor: moons-cse14hra1l410a

#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
heater_pin: PA2 #PA2 is LDO default
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 1
min_temp: 0
max_temp: 125
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  WAS TAP - NOW BEACON in CANBUS

#####################################################################
#   Additional Sensors
#####################################################################

[thermistor CMFB103F3950FANT]
temperature1: 0.0
resistance1: 32116.0
temperature2: 40.0
resistance2: 5309.0
temperature3: 80.0
resistance3: 1228.0

#[temperature_sensor sb_ambient_temp]
## Chamber Temperature - T1
#sensor_type: CMFB103F3950FANT
#sensor_pin: PF5
#min_temp: 0
#max_temp: 100
#gcode_id: chamber_th

[temperature_sensor back_chamber_temp]
## Chamber Temperature - T
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF6
min_temp: 0
max_temp: 100
gcode_id: chamber_th2

[temperature_sensor RPi4]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.889
#*# pid_ki = 0.964
#*# pid_kd = 412.851
#*#
#*# [beacon model default]
#*# model_coef = 1.4512742510883585,
#*# 	  1.761046808550891,
#*# 	  0.7522864365853444,
#*# 	  0.3549299144690959,
#*# 	  0.31534556763425187,
#*# 	  0.38069145890810696,
#*# 	  -0.06467795303797856,
#*# 	  -0.28719882396266333,
#*# 	  0.145761488672838,
#*# 	  0.19251093552947954
#*# model_domain = 3.1531639165734805e-07,3.326954675116541e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 66.388976
#*# model_offset = 0.03000
#*#
#*# [beacon model pei_hot]
#*# model_coef = 1.9263519575030055,
#*# 	2.1946743347503372,
#*# 	0.6208794249910773,
#*# 	0.2775896555222557,
#*# 	0.06526221562750463,
#*# 	-0.2611119885640586,
#*# 	-0.05461829170887029,
#*# 	0.36810740679885895,
#*# 	0.05685001457152785,
#*# 	-0.15547240310186372
#*# model_domain = 3.351987055417817e-07,3.359664588035842e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 63.925584
#*# model_offset = 0.00000
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.013887, -0.001877, -0.011755, -0.020227, -0.025883, -0.031219, -0.035437, -0.033400, -0.039981, -0.042530, -0.047927, -0.052752, -0.053741, -0.052929, -0.057403, -0.052015, -0.050551, -0.052203, -0.052731, -0.052124, -0.050849, -0.047325, -0.042070, -0.034135, -0.021244
#*# 	  0.009122, -0.004097, -0.016080, -0.025177, -0.031457, -0.037909, -0.043995, -0.046413, -0.047750, -0.049662, -0.055158, -0.059644, -0.060840, -0.065363, -0.061264, -0.060781, -0.059607, -0.058963, -0.058646, -0.057357, -0.055374, -0.052010, -0.048726, -0.042783, -0.032110
#*# 	  0.007550, -0.005861, -0.015558, -0.026503, -0.034185, -0.041817, -0.047931, -0.050595, -0.057794, -0.052644, -0.057694, -0.062552, -0.065754, -0.066839, -0.067940, -0.068375, -0.066005, -0.064932, -0.064393, -0.060723, -0.057399, -0.054020, -0.050600, -0.046763, -0.039325
#*# 	  0.006373, -0.004062, -0.014533, -0.024571, -0.033464, -0.041157, -0.046713, -0.049982, -0.055071, -0.052361, -0.058783, -0.065137, -0.068457, -0.071117, -0.072281, -0.072777, -0.070537, -0.068932, -0.066503, -0.061810, -0.057264, -0.052018, -0.049215, -0.045294, -0.038439
#*# 	  0.010545, 0.000544, -0.009531, -0.018714, -0.026200, -0.033109, -0.038832, -0.041860, -0.044458, -0.048212, -0.055777, -0.063287, -0.068225, -0.076365, -0.072850, -0.072666, -0.070269, -0.068310, -0.065019, -0.059792, -0.052287, -0.046546, -0.042076, -0.037832, -0.030947
#*# 	  0.016491, 0.009134, 0.000839, -0.004116, -0.014330, -0.020072, -0.023483, -0.026825, -0.030279, -0.036556, -0.047610, -0.056405, -0.062327, -0.065819, -0.072884, -0.067514, -0.064941, -0.062342, -0.058036, -0.053407, -0.046714, -0.038347, -0.032406, -0.026513, -0.017668
#*# 	  0.024414, 0.013543, 0.006255, -0.000496, -0.005421, -0.009023, -0.010886, -0.020277, -0.018168, -0.027257, -0.040892, -0.052287, -0.058023, -0.062272, -0.064531, -0.063369, -0.061776, -0.059346, -0.056494, -0.050632, -0.043436, -0.035652, -0.028172, -0.021551, -0.010612
#*# 	  0.031085, 0.020770, 0.014513, 0.008317, 0.003653, 0.001840, 0.001462, 0.001371, -0.003568, -0.019777, -0.031010, -0.041985, -0.049759, -0.053459, -0.055493, -0.054856, -0.052597, -0.051086, -0.048025, -0.044018, -0.043019, -0.030335, -0.024126, -0.015012, -0.003506
#*# 	  0.034157, 0.025250, 0.019449, 0.020240, 0.010371, 0.015636, 0.011999, 0.013089, 0.008503, -0.002909, -0.018123, -0.030532, -0.043895, -0.040833, -0.042198, -0.041862, -0.040640, -0.040457, -0.039249, -0.036356, -0.032281, -0.027322, -0.021231, -0.012985, -0.001529
#*# 	  0.031843, 0.024972, 0.018669, 0.013654, 0.010235, 0.012225, 0.016246, 0.018555, 0.016647, 0.006681, -0.006490, -0.018376, -0.025844, -0.028675, -0.030211, -0.034767, -0.030575, -0.032501, -0.033928, -0.032272, -0.031878, -0.029239, -0.025326, -0.019149, -0.008414
#*# 	  0.026562, 0.021557, 0.015796, 0.009803, 0.008289, 0.012272, 0.014747, 0.023778, 0.023505, 0.015071, 0.006062, -0.008482, -0.014571, -0.018660, -0.021790, -0.024434, -0.025955, -0.034530, -0.033376, -0.034975, -0.040147, -0.037052, -0.035935, -0.031428, -0.022291
#*# 	  0.028388, 0.026477, 0.019214, 0.013397, 0.013950, 0.019650, 0.028197, 0.035610, 0.036767, 0.028749, 0.013928, 0.004777, -0.002176, -0.008089, -0.013064, -0.017415, -0.021233, -0.023348, -0.031903, -0.036107, -0.038846, -0.040303, -0.040559, -0.038154, -0.031694
#*# 	  0.036573, 0.033005, 0.025375, 0.021194, 0.022937, 0.030434, 0.040470, 0.048925, 0.050170, 0.041694, 0.027077, 0.011564, 0.005735, -0.001316, -0.008322, -0.013978, -0.018372, -0.024741, -0.030168, -0.031805, -0.037039, -0.039148, -0.040360, -0.037675, -0.029473
#*# 	  0.041266, 0.034555, 0.028780, 0.023249, 0.027779, 0.033769, 0.046512, 0.055027, 0.058850, 0.046609, 0.030667, 0.017337, 0.007526, -0.000865, -0.007777, -0.013516, -0.020227, -0.023337, -0.027683, -0.031595, -0.033253, -0.034690, -0.035161, -0.032878, -0.024704
#*# 	  0.045097, 0.037158, 0.029674, 0.024975, 0.028044, 0.034957, 0.046533, 0.053969, 0.053969, 0.043790, 0.027477, 0.012747, 0.003301, -0.001167, -0.010966, -0.015063, -0.021539, -0.022301, -0.025156, -0.027211, -0.028456, -0.028024, -0.029223, -0.026437, -0.018794
#*# 	  0.052326, 0.042859, 0.034160, 0.027717, 0.029272, 0.036246, 0.046978, 0.054421, 0.053457, 0.041664, 0.025464, 0.010210, 0.002055, -0.004611, -0.009118, -0.010856, -0.013199, -0.016093, -0.017616, -0.018831, -0.018498, -0.017508, -0.017546, -0.016333, -0.007399
#*# 	  0.055534, 0.045881, 0.034668, 0.025916, 0.027333, 0.032876, 0.043138, 0.051506, 0.050729, 0.037910, 0.018658, 0.006421, -0.001153, -0.005403, -0.008170, -0.008851, -0.009099, -0.011568, -0.010308, -0.012130, -0.010805, -0.007492, -0.007437, -0.004685, 0.001274
#*# 	  0.053237, 0.043452, 0.031643, 0.022444, 0.021119, 0.029422, 0.040777, 0.049221, 0.047312, 0.034860, 0.016761, 0.002823, -0.003294, -0.006232, -0.008276, -0.008164, -0.008183, -0.011066, -0.009429, -0.008424, -0.006458, -0.003529, -0.001464, 0.001876, 0.007854
#*# 	  0.046274, 0.037657, 0.027343, 0.019228, 0.019476, 0.028417, 0.039906, 0.049341, 0.048330, 0.034453, 0.016017, 0.003025, -0.003236, -0.005556, -0.006812, -0.009389, -0.007237, -0.007463, -0.006866, -0.005454, -0.003662, -0.001204, 0.001238, 0.005488, 0.012452
#*# 	  0.037167, 0.028524, 0.020582, 0.015135, 0.017088, 0.027101, 0.039805, 0.048753, 0.047599, 0.034007, 0.015482, 0.002255, -0.004544, -0.006739, -0.009215, -0.010182, -0.009405, -0.009314, -0.008395, -0.006177, -0.004288, -0.002402, -0.000867, 0.003305, 0.010735
#*# 	  0.032868, 0.024720, 0.018109, 0.014972, 0.019240, 0.029137, 0.041727, 0.050318, 0.049327, 0.035583, 0.018704, 0.004531, -0.002050, -0.005275, -0.006743, -0.007370, -0.006981, -0.005744, -0.005690, -0.004532, -0.002755, -0.001204, 0.000685, 0.004572, 0.012263
#*# 	  0.037034, 0.027920, 0.022725, 0.020605, 0.024750, 0.034270, 0.045032, 0.052442, 0.050489, 0.039063, 0.022927, 0.010178, 0.003549, 0.001116, -0.000277, -0.000722, 0.001898, 0.000858, 0.000679, 0.002487, 0.004057, 0.005648, 0.006903, 0.011146, 0.018541
#*# 	  0.041370, 0.031200, 0.027454, 0.025350, 0.028412, 0.036643, 0.045493, 0.052001, 0.050345, 0.039567, 0.025307, 0.013867, 0.008409, 0.006353, 0.006221, 0.007199, 0.009451, 0.008628, 0.008357, 0.008788, 0.010569, 0.012278, 0.013764, 0.017194, 0.025221
#*# 	  0.044171, 0.035381, 0.030255, 0.027903, 0.030693, 0.037494, 0.044103, 0.049936, 0.049139, 0.038137, 0.024768, 0.016184, 0.012658, 0.010907, 0.010909, 0.012254, 0.015083, 0.013474, 0.012085, 0.013148, 0.014184, 0.016720, 0.018226, 0.021747, 0.029665
#*# 	  0.041999, 0.033876, 0.030049, 0.027570, 0.029841, 0.033895, 0.039943, 0.044397, 0.043759, 0.035051, 0.022589, 0.015251, 0.011984, 0.010457, 0.010534, 0.012521, 0.013712, 0.011769, 0.009434, 0.010244, 0.012353, 0.014899, 0.017201, 0.021112, 0.028882
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 210.0
#*# min_y = 30.0
#*# max_y = 208.0
