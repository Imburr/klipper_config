##########################
##### BASE CONFIG #######
##########################

[include mainsail.cfg]
[include ./backup/backup.cfg]

##########################
##### HARDWARE STUFF #####
##########################

[include ./hardware/xyz-stepper.cfg]
[include ./hardware/extruder.cfg]
#[include ./klicky/klicky-probe.cfg]
#[include ./hardware/adxl345.cfg]  This config now in canbus.cfg
[include ./hardware/fans.cfg] # Some fans config in canbus.cfg
[include ./hardware/canbus.cfg]

##########################
##### LIGHTS #############
##########################

[include ./hardware/chamber-lighting.cfg]
[include ./hardware/stealthburner-led.cfg]

##########################
##### CALIBRATION ########
##########################

[include ./calibration/z-tilt.cfg]
[include ./calibration/bed-mesh.cfg]
[include ./macros/unsafe.cfg]
[include ./calibration/pressure_advance.cfg]
[include ./calibration/test_speed.cfg]
[include ./calibration/pika.cfg]
[include test_probe_accuracy.cfg]

##########################
##### MACROS #############
##########################

[include ./macros/chamber-led.cfg]
[include ./macros/conditional-homing.cfg]
[include ./macros/print-end.cfg]
[include ./macros/print-start-mmu.cfg]
[include ./macros/dump-variables.cfg]
[include ./macros/movement-check.cfg]
[include ./macros/cancel-change.cfg]
[include ./macros/pause-resume.cfg]         ; Overridden by ERCF / subsequantly disabled
[include ./macros/load-unload.cfg]
[include ./macros/filament-change.cfg]
[include ./macros/park.cfg]
#[include ./macros/prusaslicer-accel.cfg]

##########################
##### THIRD PARTY ########
##########################

#[include ./third-party-cfg/nozzle_scrub.cfg]
[include KAMP_Settings.cfg]

##########################
##### ERCF ###############
##########################

[include mmu/base/*.cfg]
[include macros/mmu_adds.cfg]
[include mmu/optional/mmu_ercf_cutter.cfg]

##########################
##### LCD/MENU ###########
##########################

#[include ./third-party-cfg/nozzle_scrub_menu.cfg]
#[include ./menu/printer_menu.cfg]

##########################
##### NOT ENABLED YET ####
##########################

#[include ./todo/mini12864.cfg] Add this after adding mini12864 LED
#[include ./todo/lcd_tweaks.cfg] Need to figure this one out and then implement
#[include ./hardware/nevermore.cfg] Disabled as I prefer to chamber vent outside and needed the PWM

##########################
#### REPLACEMENT #########
##########################

[include ./replacement_macros/replace-m900.cfg]
[include ./replacement_macros/replace-m117.cfg]

[exclude_object]

[gcode_arcs]
resolution: 0.1

[respond]
default_type: echo
default_prefix:  

[force_move]
# Enable commands that force potentially unsafe movement
enable_force_move: True

[idle_timeout]
timeout: 14400

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_290040000750314D35323820-if00
restart_method: command

[mcu rpi]
# Add Rpi as secondary MCU to allow for ADXL use through SPI ribbon/adapter from LDO
serial: /tmp/klipper_host_mcu

[mcu sht]
canbus_uuid: 30993412e8e0

[printer]
kinematics: corexy
max_velocity: 200           # Changed from 200 on 7.11.23
max_accel:  6000            # tuned on 7.11.23 after beacon install.
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0 # Changed on 7.11.23

#####################################################################
#   Input Shaper
#####################################################################

[input_shaper]
#shaper_freq_x: 76.2               ; suggested max_accel <= 22600 mm/sec^2
#shaper_type_x: zv
#shaper_freq_y: 51.8               ; suggested max_accel <= 7900 mm/sec^2
#shaper_type_y: mzv


#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
heater_pin: PA2 #PA2 is LDO default
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 125
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  WAS TAP - NOW BEACON in CANBUS

#####################################################################
#   Additional Sensors
#####################################################################

[thermistor CMFB103F3950FANT]
temperature1: 0.0
resistance1: 32116.0
temperature2: 40.0
resistance2: 5309.0
temperature3: 80.0
resistance3: 1228.0

#[temperature_sensor sb_ambient_temp]
## Chamber Temperature - T1
#sensor_type: CMFB103F3950FANT
#sensor_pin: PF5
#min_temp: 0
#max_temp: 100
#gcode_id: chamber_th

[temperature_sensor back_chamber_temp]
## Chamber Temperature - T
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF6
min_temp: 0
max_temp: 100
gcode_id: chamber_th2

[temperature_sensor RPi4]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################

#[safe_z_home]
##  XY Location of the Z Endstop Switch
##  Update -10,-10 to the XY coordinates of your endstop pin 
##  (such as 157,305) after going through Z Endstop Pin
##  Location Definition step.
#home_xy_position: 147,256
#speed:100
#z_hop:10
#z_hop_speed:10


########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.889
#*# pid_ki = 0.964
#*# pid_kd = 412.851
#*#
#*# [probe]
#*# z_offset = -1.260
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.011322, -0.011289, -0.008276, -0.008787, -0.011265, -0.010215, -0.007385, -0.011552, -0.003278, -0.003850, -0.004690, -0.005420, -0.001884, 0.000432, -0.006463, -0.004965, -0.008473, -0.005686, -0.007942, -0.006881
#*# 	  -0.009918, -0.009768, -0.006945, -0.007485, -0.008262, -0.007218, -0.007448, -0.009158, -0.005087, -0.007140, -0.006983, -0.000593, -0.004007, 0.000567, 0.001552, -0.006636, -0.004986, -0.004624, -0.011747, 0.002565
#*# 	  -0.006674, -0.009028, -0.011618, -0.005412, -0.005975, -0.008135, -0.012713, -0.007475, -0.007114, -0.011507, -0.006874, -0.006878, -0.006008, -0.008867, -0.010047, -0.013280, -0.005708, -0.007805, -0.004761, -0.001381
#*# 	  -0.016437, -0.011453, -0.010763, -0.009733, -0.012455, -0.010733, -0.011770, -0.016509, -0.010402, -0.008098, -0.012381, -0.012355, -0.014615, -0.011054, -0.010504, -0.010778, -0.007950, -0.006860, -0.000560, -0.001769
#*# 	  -0.017976, -0.016974, -0.016936, -0.014420, -0.019703, -0.011348, -0.012149, -0.018992, -0.013992, -0.012481, -0.012686, -0.017466, -0.016728, -0.016696, -0.015005, -0.010608, -0.011121, -0.009476, -0.005893, -0.003408
#*# 	  -0.018148, -0.020581, -0.021138, -0.019065, -0.018968, -0.021599, -0.019797, -0.018909, -0.018695, -0.019123, -0.018174, -0.019835, -0.019163, -0.017755, -0.010753, -0.017966, -0.009579, -0.007696, -0.005128, 0.002382
#*# 	  -0.018980, -0.027654, -0.020443, -0.015782, -0.022564, -0.021603, -0.020767, -0.021045, -0.023353, -0.014303, -0.025952, -0.014928, -0.020233, -0.016426, -0.020593, -0.010386, -0.007218, -0.002092, 0.007979, 0.005567
#*# 	  -0.023347, -0.022022, -0.021189, -0.015679, -0.016489, -0.014068, -0.018959, -0.012747, -0.014589, -0.016874, -0.010027, -0.016453, -0.013046, -0.008167, -0.013345, -0.011009, -0.003432, 0.001564, 0.001831, 0.008058
#*# 	  -0.020095, -0.021958, -0.023228, -0.016770, -0.014762, -0.016934, -0.008789, -0.015077, -0.017994, -0.014694, -0.009477, -0.010703, -0.007827, -0.009504, -0.009419, -0.009725, -0.002893, 0.007055, -0.000039, 0.006092
#*# 	  -0.025096, -0.022717, -0.026136, -0.024421, -0.021433, -0.023295, -0.010616, -0.026005, -0.019845, -0.014838, -0.014748, -0.014855, -0.016530, -0.011279, -0.010087, -0.009911, -0.005206, 0.001104, 0.003060, 0.001977
#*# 	  -0.022712, -0.023871, -0.023010, -0.023539, -0.019521, -0.008605, -0.017314, -0.009938, -0.015495, -0.013876, -0.014579, -0.009828, -0.009222, -0.009615, -0.007755, -0.007885, -0.005035, 0.006182, 0.004293, 0.006222
#*# 	  -0.024867, -0.021039, -0.025004, -0.021809, -0.018084, -0.016800, -0.011797, -0.010185, -0.014702, -0.012458, -0.011123, -0.009529, -0.007619, -0.010835, -0.007606, -0.004030, -0.001135, -0.000815, 0.001882, 0.004278
#*# 	  -0.022516, -0.021704, -0.022070, -0.019748, -0.009754, -0.009723, -0.014429, -0.011634, -0.009746, -0.010628, -0.010046, -0.008833, -0.008050, -0.007353, -0.007243, 0.005373, 0.001914, 0.005432, 0.006702, 0.008891
#*# 	  -0.019627, -0.020619, -0.011359, -0.016907, -0.018821, -0.008715, -0.011492, -0.010417, -0.007444, -0.003890, -0.009041, 0.004271, 0.000939, -0.001898, -0.000953, 0.004870, 0.007778, 0.001896, 0.014371, 0.014778
#*# 	  -0.022267, -0.022225, -0.016051, -0.011399, -0.013153, -0.011360, -0.012144, -0.012364, -0.002647, 0.007612, 0.003328, 0.003748, 0.004714, 0.008992, 0.009488, 0.007937, 0.008962, 0.015487, 0.018902, 0.015716
#*# 	  -0.012584, -0.018394, -0.017496, -0.012972, -0.012657, -0.009998, -0.005833, -0.006397, -0.007980, 0.000919, 0.006322, 0.006635, 0.005215, 0.013527, 0.015650, 0.013301, 0.015290, 0.016710, 0.021983, 0.027711
#*# 	  -0.015683, -0.010408, -0.013799, -0.013105, -0.010429, -0.008291, -0.006988, 0.008764, -0.005486, 0.006071, 0.005138, 0.009360, 0.012890, 0.018342, 0.015375, 0.020880, 0.021824, 0.013109, 0.035987, 0.019295
#*# 	  -0.013142, -0.014584, -0.012704, -0.011129, -0.006963, -0.006336, -0.004979, -0.003481, 0.004616, 0.008842, 0.006569, 0.011917, 0.012853, 0.014084, 0.022203, 0.021780, 0.032806, 0.035027, 0.036051, 0.038872
#*# 	  -0.015680, -0.012939, -0.010127, -0.013961, -0.008924, -0.007537, -0.002352, 0.001109, 0.010735, 0.006724, 0.013463, 0.008965, 0.013942, 0.013025, 0.023445, 0.025610, 0.038317, 0.039501, 0.038515, 0.041122
#*# 	  -0.015543, -0.018516, -0.016723, -0.015653, -0.014437, -0.011443, -0.008754, -0.002346, 0.009006, 0.012618, 0.008809, 0.009003, 0.013311, 0.017672, 0.017507, 0.022559, 0.030784, 0.039028, 0.038584, 0.038367
#*# 	  -0.016731, -0.018374, -0.017896, -0.019645, -0.014876, -0.011757, -0.010114, -0.004291, -0.005023, 0.004480, 0.007348, 0.009468, 0.012372, 0.017533, 0.014934, 0.018196, 0.028090, 0.018114, 0.038714, 0.037772
#*# 	  -0.016995, -0.017168, -0.017708, -0.016118, -0.012626, -0.010128, -0.007013, -0.007030, -0.001558, 0.009364, 0.009928, 0.009915, 0.012579, 0.019369, 0.016922, 0.025953, 0.026151, 0.031257, 0.037347, 0.038397
#*# 	  -0.009453, -0.017234, -0.007813, -0.005837, -0.005599, -0.001959, 0.008959, 0.006978, 0.010190, 0.011109, 0.009785, 0.020082, 0.017527, 0.014773, 0.019582, 0.024632, 0.025596, 0.038123, 0.037677, 0.037793
#*# x_count = 20
#*# y_count = 23
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 63.471999999999994
#*# max_x = 199.364
#*# min_y = 30.0
#*# max_y = 191.725
#*#
#*# [beacon model default]
#*# model_coef = 1.9257982386737142,
#*# 	  2.1904011986275074,
#*# 	  0.5881661108028357,
#*# 	  0.30341866940870527,
#*# 	  0.14823890288711727,
#*# 	  -0.42807822476666274,
#*# 	  -0.13716254071061182,
#*# 	  0.612855529187592,
#*# 	  0.08376843001203003,
#*# 	  -0.2664564217100284
#*# model_domain = 3.352922478536077e-07,3.360945745364866e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 72.578002
#*# model_offset = 0.32500
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 77.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 51.6
