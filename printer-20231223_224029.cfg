[include moonraker_obico_macros.cfg]
##########################
##### BASE CONFIG #######
##########################

[include mainsail.cfg]
[include ./backup/backup.cfg]

##########################
##### HARDWARE STUFF #####
##########################

[include ./hardware/xyz-stepper.cfg]
[include ./hardware/extruder.cfg]
#[include ./klicky/klicky-probe.cfg]
#[include ./hardware/adxl345.cfg]  This config now in canbus.cfg
[include ./hardware/fans.cfg] # Some fans config in canbus.cfg
[include ./hardware/canbus.cfg]

##########################
##### LIGHTS #############
##########################

[include ./hardware/chamber-lighting.cfg]
[include ./hardware/stealthburner-led.cfg]

##########################
##### CALIBRATION ########
##########################

[include ./calibration/z-tilt.cfg]
[include ./calibration/bed-mesh.cfg]
[include ./macros/unsafe.cfg]
[include ./calibration/pressure_advance.cfg]
[include ./calibration/test_speed.cfg]
[include ./calibration/pika.cfg]
[include test_probe_accuracy.cfg]

##########################
##### MACROS #############
##########################

[include ./macros/chamber-led.cfg]
[include ./macros/conditional-homing.cfg]
[include ./macros/print-end.cfg]
[include ./macros/print-start-mmu.cfg]
[include ./macros/dump-variables.cfg]
[include ./macros/movement-check.cfg]
[include ./macros/cancel-change.cfg]
[include ./macros/pause-resume.cfg]         ; Overridden by ERCF / subsequantly disabled
[include ./macros/load-unload.cfg]
[include ./macros/filament-change.cfg]
[include ./macros/park.cfg]
[include ./macros/heatsoak.cfg]

##########################
##### THIRD PARTY ########
##########################

#[include ./third-party-cfg/nozzle_scrub.cfg]
[include KAMP_Settings.cfg]

##########################
##### ERCF ###############
##########################

[include mmu/base/*.cfg]
[include macros/mmu_adds.cfg]
[include mmu/optional/mmu_ercf_cutter.cfg]

##########################
##### LCD/MENU ###########
##########################

#[include ./third-party-cfg/nozzle_scrub_menu.cfg]
#[include ./menu/printer_menu.cfg]

##########################
##### NOT ENABLED YET ####
##########################

#[include ./todo/mini12864.cfg] Add this after adding mini12864 LED
#[include ./todo/lcd_tweaks.cfg] Need to figure this one out and then implement
#[include ./hardware/nevermore.cfg] Disabled as I prefer to chamber vent outside and needed the PWM

##########################
#### REPLACEMENT #########
##########################

[include ./replacement_macros/replace-m900.cfg]
[include ./replacement_macros/replace-m117.cfg]

[exclude_object]

[gcode_arcs]
resolution: 0.1

[respond]
default_type: echo
default_prefix:  

[force_move]
# Enable commands that force potentially unsafe movement
enable_force_move: True

[idle_timeout]
timeout: 14400

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_290040000750314D35323820-if00
restart_method: command

[mcu rpi]
# Add Rpi as secondary MCU to allow for ADXL use through SPI ribbon/adapter from LDO
serial: /tmp/klipper_host_mcu

[mcu sht]
canbus_uuid: 30993412e8e0

[printer]
kinematics: corexy
max_velocity: 200           # Changed from 200 on 7.11.23
max_accel:  6000            # tuned on 7.11.23 after beacon install.
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0 # Changed on 7.11.23

#####################################################################
#   Input Shaper
#####################################################################

[input_shaper]
#shaper_freq_x: 76.2               ; suggested max_accel <= 22600 mm/sec^2
#shaper_type_x: zv
#shaper_freq_y: 51.8               ; suggested max_accel <= 7900 mm/sec^2
#shaper_type_y: mzv


#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
heater_pin: PA2 #PA2 is LDO default
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 125
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  WAS TAP - NOW BEACON in CANBUS

#####################################################################
#   Additional Sensors
#####################################################################

[thermistor CMFB103F3950FANT]
temperature1: 0.0
resistance1: 32116.0
temperature2: 40.0
resistance2: 5309.0
temperature3: 80.0
resistance3: 1228.0

#[temperature_sensor sb_ambient_temp]
## Chamber Temperature - T1
#sensor_type: CMFB103F3950FANT
#sensor_pin: PF5
#min_temp: 0
#max_temp: 100
#gcode_id: chamber_th

[temperature_sensor back_chamber_temp]
## Chamber Temperature - T
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF6
min_temp: 0
max_temp: 100
gcode_id: chamber_th2

[temperature_sensor RPi4]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################

#[safe_z_home]
##  XY Location of the Z Endstop Switch
##  Update -10,-10 to the XY coordinates of your endstop pin 
##  (such as 157,305) after going through Z Endstop Pin
##  Location Definition step.
#home_xy_position: 147,256
#speed:100
#z_hop:10
#z_hop_speed:10


########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.889
#*# pid_ki = 0.964
#*# pid_kd = 412.851
#*#
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.004903, 0.022282, 0.021603, 0.018483, 0.017727, 0.014774, 0.021270, 0.021145, 0.020216, 0.015455, 0.008883, 0.010233, 0.016313, 0.010752, 0.009220, 0.010908, 0.014316, 0.010184, 0.023271, 0.022759, 0.024919, 0.023175, 0.027537, 0.026655, 0.026822
#*# 	  0.013241, 0.014492, 0.022074, 0.014427, 0.021669, 0.015613, 0.015105, 0.021491, 0.014120, 0.020468, 0.010518, 0.009624, 0.008849, 0.009181, 0.009183, 0.001792, 0.009485, 0.009169, 0.013992, 0.009213, 0.014515, 0.019549, 0.023402, 0.032179, 0.025100
#*# 	  0.008315, 0.013797, 0.008193, 0.016077, 0.008924, 0.008440, 0.009253, 0.013896, 0.009376, 0.017447, 0.015509, 0.009856, -0.003579, 0.009572, -0.002953, 0.002667, 0.010692, 0.011052, 0.007747, 0.010160, 0.013708, 0.021167, 0.016368, 0.031443, 0.032050
#*# 	  -0.004435, 0.007737, 0.004662, 0.009906, 0.005679, 0.003182, 0.009909, 0.013403, 0.003660, 0.010052, 0.018162, -0.005963, 0.008579, 0.008999, 0.003493, 0.001859, 0.001027, 0.003642, 0.000765, 0.001208, 0.003079, 0.013786, 0.021374, 0.024543, 0.025241
#*# 	  0.000146, 0.008146, 0.007756, 0.004236, -0.001864, 0.006343, 0.001584, 0.006315, 0.009079, -0.005398, 0.011912, 0.000454, -0.003915, 0.007060, -0.000347, 0.000388, -0.001215, 0.004157, 0.004226, 0.005314, 0.014852, 0.013550, 0.016391, 0.023374, 0.022455
#*# 	  -0.004573, -0.002616, 0.008994, 0.005026, 0.002331, 0.004821, 0.008303, 0.004375, 0.007320, 0.012683, 0.012857, 0.009044, 0.013338, 0.004362, -0.004142, 0.012472, -0.008541, -0.002747, 0.008189, -0.001195, 0.010237, 0.015960, 0.016603, 0.020089, 0.023595
#*# 	  0.007611, 0.001782, 0.015477, 0.011598, -0.001441, 0.012249, 0.011712, 0.008856, 0.012270, 0.010038, 0.002151, 0.012278, 0.013837, 0.014369, 0.011599, 0.012794, 0.011905, 0.011788, 0.009479, 0.010583, 0.008973, 0.015237, 0.019253, 0.025587, 0.023945
#*# 	  0.011253, 0.014041, 0.013193, 0.008432, 0.006243, -0.001998, 0.003480, 0.003085, 0.008750, 0.010148, 0.001268, 0.003895, 0.008725, 0.011887, 0.013981, 0.001041, 0.010258, 0.006835, 0.010560, 0.011264, 0.014665, 0.013756, 0.016297, 0.018211, 0.015757
#*# 	  0.005250, 0.012582, 0.011107, 0.012734, 0.009841, 0.006568, -0.005747, -0.000323, 0.001364, 0.012327, 0.000433, 0.008038, 0.009907, 0.007746, 0.010088, 0.009377, 0.013336, 0.012735, 0.009799, 0.004112, 0.009716, 0.016703, 0.020115, 0.017180, 0.016321
#*# 	  0.007692, 0.008244, 0.008685, 0.001458, 0.006878, -0.002018, -0.000999, 0.009399, 0.001290, 0.000937, 0.007032, 0.001224, 0.003240, 0.001433, 0.003039, 0.009158, 0.001863, -0.009805, 0.008495, -0.002161, 0.003844, 0.013858, 0.016948, 0.016511, 0.016243
#*# 	  -0.001430, 0.004590, 0.007559, 0.008529, -0.007056, -0.004355, -0.003993, 0.000348, 0.011919, -0.005962, 0.011575, 0.010461, 0.008876, 0.006620, 0.011226, 0.005043, 0.007109, 0.008377, -0.001484, 0.004736, 0.011087, 0.013680, 0.016835, 0.018768, 0.021453
#*# 	  0.000796, 0.004315, 0.012137, -0.001834, 0.008272, 0.012741, -0.005212, 0.010876, 0.003774, -0.001933, 0.001863, 0.000411, 0.008831, 0.004489, 0.005332, 0.006647, 0.007229, 0.000539, 0.011091, 0.011771, 0.011499, 0.017144, 0.018822, 0.020163, 0.017472
#*# 	  -0.007334, -0.010843, 0.010462, -0.000556, 0.001268, -0.005310, -0.000882, -0.001781, 0.000622, -0.001076, -0.000485, 0.010472, -0.000682, 0.000077, 0.008351, 0.010274, 0.009541, 0.011752, 0.009748, 0.011216, 0.011281, 0.021152, 0.025396, 0.023197, 0.023409
#*# 	  -0.006245, -0.003152, 0.009961, 0.011359, -0.003452, -0.006026, 0.008951, 0.011739, 0.004039, -0.006325, -0.002984, 0.010845, 0.005681, 0.009093, 0.009676, 0.012039, 0.010339, 0.013942, 0.012335, 0.016340, 0.018626, 0.022599, 0.023862, 0.023175, 0.029429
#*# 	  -0.002575, -0.000250, 0.008329, 0.007946, -0.000064, 0.004080, 0.006413, -0.000276, 0.005240, -0.001075, 0.009508, 0.012850, 0.007718, 0.011107, 0.005995, 0.016313, 0.014251, 0.018032, 0.019350, 0.022968, 0.024861, 0.026492, 0.028894, 0.036931, 0.040185
#*# 	  0.001965, 0.003231, 0.006414, 0.005689, 0.002506, -0.003514, 0.002020, 0.002930, 0.003293, 0.013760, 0.005101, 0.010325, 0.013117, 0.019035, 0.018512, 0.016379, 0.018470, 0.020113, 0.019151, 0.024802, 0.023531, 0.038836, 0.031817, 0.044955, 0.042909
#*# 	  0.000788, 0.008923, 0.009644, 0.005875, 0.009705, 0.007333, 0.007160, 0.013345, 0.000061, 0.008338, 0.013570, 0.009190, 0.013436, 0.016726, 0.014620, 0.017698, 0.019673, 0.023413, 0.027345, 0.034222, 0.024226, 0.043372, 0.033981, 0.044777, 0.048847
#*# 	  -0.002608, 0.010255, 0.008872, 0.011617, 0.009938, 0.002118, 0.000690, 0.002761, -0.001630, 0.000025, 0.002775, 0.007595, 0.007192, 0.015385, 0.014510, 0.022914, 0.026358, 0.025354, 0.027677, 0.022731, 0.036705, 0.036935, 0.036410, 0.043814, 0.045048
#*# 	  -0.007192, -0.000024, -0.000461, -0.006449, -0.007747, -0.007627, -0.000981, -0.007614, -0.009472, -0.009788, -0.007797, -0.003701, 0.001068, 0.009926, 0.013852, 0.019340, 0.019528, 0.019779, 0.018504, 0.019754, 0.024463, 0.030313, 0.025887, 0.041851, 0.041046
#*# 	  -0.011595, -0.010300, -0.004854, -0.010654, -0.012732, -0.011426, -0.010604, -0.012448, -0.013601, -0.014302, -0.013167, -0.007221, 0.002620, 0.015457, 0.015993, 0.017026, 0.017643, 0.016715, 0.019682, 0.016264, 0.017839, 0.025944, 0.030995, 0.039348, 0.030041
#*# 	  -0.012865, -0.011179, -0.011347, -0.011875, -0.009458, -0.009432, -0.012036, -0.012591, -0.013169, -0.011403, -0.012920, -0.006418, 0.003474, 0.010600, 0.014717, 0.017583, 0.016024, 0.024654, 0.017635, 0.016539, 0.023981, 0.020481, 0.029119, 0.032427, 0.038203
#*# 	  -0.013388, -0.011683, -0.008816, -0.010862, -0.011643, -0.010940, -0.013103, -0.013225, -0.011499, -0.013081, -0.007686, 0.001224, 0.009667, 0.014411, 0.014004, 0.016683, 0.023104, 0.023767, 0.021068, 0.016063, 0.025098, 0.021545, 0.029653, 0.038282, 0.024385
#*# x_count = 25
#*# y_count = 22
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 209.501
#*# min_y = 37.501000000000005
#*# max_y = 192.499
#*#
#*# [beacon model default]
#*# model_coef = 1.9263519575030055,
#*# 	  2.1946743347503372,
#*# 	  0.6208794249910773,
#*# 	  0.2775896555222557,
#*# 	  0.06526221562750463,
#*# 	  -0.2611119885640586,
#*# 	  -0.05461829170887029,
#*# 	  0.36810740679885895,
#*# 	  0.05685001457152785,
#*# 	  -0.15547240310186372
#*# model_domain = 3.351987055417817e-07,3.359664588035842e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 63.925584
#*# model_offset = 0.75000
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 77.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 51.6
#*#
#*# [beacon model pei_hot]
#*# model_coef = 1.9263519575030055,
#*# 	2.1946743347503372,
#*# 	0.6208794249910773,
#*# 	0.2775896555222557,
#*# 	0.06526221562750463,
#*# 	-0.2611119885640586,
#*# 	-0.05461829170887029,
#*# 	0.36810740679885895,
#*# 	0.05685001457152785,
#*# 	-0.15547240310186372
#*# model_domain = 3.351987055417817e-07,3.359664588035842e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 63.925584
#*# model_offset = 0.00000
