[include moonraker_obico_macros.cfg]
##########################
##### BASE CONFIG #######
##########################

[include mainsail.cfg]
[include ./backup/backup.cfg]

##########################
##### HARDWARE STUFF #####
##########################

[include ./hardware/xyz-stepper.cfg]
[include ./hardware/extruder.cfg]
#[include ./klicky/klicky-probe.cfg]
#[include ./hardware/adxl345.cfg]  This config now in canbus.cfg
[include ./hardware/fans.cfg] # Some fans config in canbus.cfg
[include ./hardware/canbus.cfg]

##########################
##### LIGHTS #############
##########################

[include ./hardware/chamber-lighting.cfg]
[include ./hardware/stealthburner-led.cfg]

##########################
##### CALIBRATION ########
##########################

[include ./calibration/z-tilt.cfg]
[include ./calibration/bed-mesh.cfg]
[include ./macros/unsafe.cfg]
[include ./calibration/pressure_advance.cfg]
[include ./calibration/test_speed.cfg]
[include ./calibration/pika.cfg]
[include test_probe_accuracy.cfg]

##########################
##### MACROS #############
##########################

[include ./macros/chamber-led.cfg]
[include ./macros/conditional-homing.cfg]
[include ./macros/print-end.cfg]
[include ./macros/print-start-mmu.cfg]
[include ./macros/dump-variables.cfg]
[include ./macros/movement-check.cfg]
[include ./macros/cancel-change.cfg]
[include ./macros/pause-resume.cfg]         ; Overridden by ERCF / subsequantly disabled
[include ./macros/load-unload.cfg]
[include ./macros/filament-change.cfg]
[include ./macros/park.cfg]
[include ./macros/heatsoak.cfg]

##########################
##### THIRD PARTY ########
##########################

#[include ./third-party-cfg/nozzle_scrub.cfg]
[include KAMP_Settings.cfg]

##########################
##### ERCF ###############
##########################

[include mmu/base/*.cfg]
[include macros/mmu_adds.cfg]
[include mmu/optional/mmu_ercf_cutter.cfg]

##########################
##### LCD/MENU ###########
##########################

#[include ./third-party-cfg/nozzle_scrub_menu.cfg]
#[include ./menu/printer_menu.cfg]

##########################
##### NOT ENABLED YET ####
##########################

#[include ./todo/mini12864.cfg] Add this after adding mini12864 LED
#[include ./todo/lcd_tweaks.cfg] Need to figure this one out and then implement
#[include ./hardware/nevermore.cfg] Disabled as I prefer to chamber vent outside and needed the PWM

##########################
#### REPLACEMENT #########
##########################

[include ./replacement_macros/replace-m900.cfg]
[include ./replacement_macros/replace-m117.cfg]

[exclude_object]

[gcode_arcs]
resolution: 0.1

[respond]
default_type: echo
default_prefix:  

[force_move]
# Enable commands that force potentially unsafe movement
enable_force_move: True

[idle_timeout]
timeout: 14400

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_290040000750314D35323820-if00
restart_method: command

[mcu rpi]
# Add Rpi as secondary MCU to allow for ADXL use through SPI ribbon/adapter from LDO
serial: /tmp/klipper_host_mcu

[mcu sht]
canbus_uuid: 30993412e8e0

[printer]
kinematics: corexy
max_velocity: 200           # Changed from 200 on 7.11.23
max_accel:  6000            # tuned on 7.11.23 after beacon install.
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0 # Changed on 7.11.23

#####################################################################
#   Input Shaper
#####################################################################

[input_shaper]
#shaper_freq_x: 76.2               ; suggested max_accel <= 22600 mm/sec^2
#shaper_type_x: zv
#shaper_freq_y: 51.8               ; suggested max_accel <= 7900 mm/sec^2
#shaper_type_y: mzv


#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
heater_pin: PA2 #PA2 is LDO default
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 125
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  WAS TAP - NOW BEACON in CANBUS

#####################################################################
#   Additional Sensors
#####################################################################

[thermistor CMFB103F3950FANT]
temperature1: 0.0
resistance1: 32116.0
temperature2: 40.0
resistance2: 5309.0
temperature3: 80.0
resistance3: 1228.0

#[temperature_sensor sb_ambient_temp]
## Chamber Temperature - T1
#sensor_type: CMFB103F3950FANT
#sensor_pin: PF5
#min_temp: 0
#max_temp: 100
#gcode_id: chamber_th

[temperature_sensor back_chamber_temp]
## Chamber Temperature - T
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF6
min_temp: 0
max_temp: 100
gcode_id: chamber_th2

[temperature_sensor RPi4]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################

#[safe_z_home]
##  XY Location of the Z Endstop Switch
##  Update -10,-10 to the XY coordinates of your endstop pin 
##  (such as 157,305) after going through Z Endstop Pin
##  Location Definition step.
#home_xy_position: 147,256
#speed:100
#z_hop:10
#z_hop_speed:10


########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.889
#*# pid_ki = 0.964
#*# pid_kd = 412.851
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.011630, -0.005519, -0.004310, -0.003575, 0.001076, 0.000900, 0.002962, 0.008940, 0.015186, 0.018847, 0.016244, 0.023222, 0.018781, 0.018162, 0.022044, 0.016551, 0.018459, 0.027200, 0.032156, 0.034446, 0.031305, 0.032977, 0.035902, 0.037071, 0.037650
#*# 	  -0.008500, 0.002757, 0.013217, 0.011964, 0.022624, 0.019050, 0.024789, 0.013917, 0.023584, 0.022955, 0.028570, 0.027161, 0.019694, 0.024331, 0.022304, 0.027340, 0.030507, 0.020416, 0.030898, 0.036050, 0.035186, 0.032525, 0.036207, 0.048979, 0.043589
#*# 	  -0.003421, 0.021673, 0.010614, 0.015013, 0.019513, 0.013920, 0.005994, 0.025070, 0.026788, 0.021343, 0.028272, 0.017191, 0.028419, 0.031153, 0.015653, 0.028017, 0.028866, 0.028675, 0.028856, 0.029591, 0.033484, 0.037309, 0.040326, 0.044264, 0.042396
#*# 	  0.003009, 0.009679, 0.011095, 0.011401, 0.009686, 0.013102, 0.007991, 0.004089, 0.014102, 0.025088, 0.001544, 0.011689, 0.014896, 0.012326, 0.023920, 0.009985, 0.026332, 0.025745, 0.028096, 0.033278, 0.031271, 0.042080, 0.036634, 0.040612, 0.039083
#*# 	  -0.003913, 0.009858, 0.010103, 0.007992, 0.000194, 0.001625, 0.003769, 0.007680, 0.005045, 0.004541, 0.008656, 0.010926, 0.007023, 0.006965, 0.007292, 0.009001, 0.007842, 0.023967, 0.025678, 0.032852, 0.031072, 0.027766, 0.036986, 0.038865, 0.038566
#*# 	  -0.008360, -0.006091, -0.001779, 0.001199, 0.003753, 0.003819, 0.002818, -0.002556, 0.000535, 0.003206, 0.003709, 0.007547, 0.017510, 0.012076, 0.012459, 0.013670, 0.007890, 0.021645, 0.024292, 0.027143, 0.031143, 0.035748, 0.035076, 0.032068, 0.041350
#*# 	  -0.008976, -0.012897, -0.003512, -0.004390, -0.002935, -0.001382, 0.000075, -0.009686, -0.005793, 0.005770, 0.004218, 0.009817, 0.003508, 0.004109, 0.016432, 0.009048, 0.021149, 0.006343, 0.011426, 0.021289, 0.021423, 0.028250, 0.033615, 0.037106, 0.034665
#*# 	  -0.016560, -0.011290, -0.008985, -0.012470, -0.007689, -0.000801, -0.000538, -0.008448, -0.004249, -0.001226, 0.002328, 0.015355, 0.018241, 0.020493, 0.012125, 0.013848, 0.002907, 0.012437, 0.019665, 0.012896, 0.022559, 0.027839, 0.027187, 0.028613, 0.026317
#*# 	  -0.013733, -0.011347, -0.013305, -0.013720, -0.006512, -0.000927, -0.004311, -0.003610, -0.003882, -0.005704, 0.000142, 0.003297, 0.002692, 0.004885, 0.015894, 0.016632, 0.002002, 0.004943, -0.001688, 0.009271, 0.022364, 0.025329, 0.026195, 0.030029, 0.028760
#*# 	  -0.015272, -0.013773, -0.011941, -0.009653, -0.007041, -0.012123, -0.012366, -0.009963, -0.000557, -0.001349, -0.002915, 0.007825, 0.018115, 0.008410, 0.007674, 0.016379, 0.010836, 0.002988, 0.009387, 0.016066, 0.014729, 0.022874, 0.024246, 0.023496, 0.021564
#*# 	  -0.014061, -0.006960, -0.009742, -0.011471, -0.010492, -0.008087, -0.008659, -0.011874, 0.001480, 0.000103, -0.000654, 0.011005, 0.013546, 0.015988, 0.009823, -0.001692, 0.014439, 0.005789, -0.001402, 0.012243, 0.016802, 0.016465, 0.022674, 0.025221, 0.020950
#*# 	  -0.009478, -0.006216, -0.008856, -0.002896, -0.013679, -0.008945, -0.003665, -0.009533, 0.001262, 0.012394, -0.004947, 0.015687, 0.016435, 0.010964, 0.017621, 0.015348, 0.015803, 0.013341, 0.013809, 0.016970, 0.021773, 0.025372, 0.023546, 0.024383, 0.027122
#*# 	  -0.009168, -0.013123, -0.008185, -0.005520, -0.006713, 0.000750, -0.008676, -0.007323, -0.001559, 0.017768, 0.002809, 0.018938, 0.008302, 0.016799, 0.011779, 0.013898, 0.010508, 0.010058, 0.007645, 0.018264, 0.023998, 0.019478, 0.022275, 0.025432, 0.026304
#*# 	  -0.001417, -0.000883, 0.002998, -0.005830, -0.003244, -0.011044, -0.010853, 0.001646, -0.002421, 0.008563, 0.012229, 0.009709, 0.017632, 0.013705, 0.016162, 0.006464, 0.005821, 0.007726, 0.011911, 0.015540, 0.020679, 0.021701, 0.023604, 0.030442, 0.019799
#*# 	  -0.002453, 0.000224, -0.000520, -0.002681, -0.001623, 0.002984, -0.008875, -0.003158, 0.002085, 0.010254, 0.013406, 0.024231, 0.010046, 0.020556, 0.018066, 0.015523, 0.016157, 0.018344, 0.018808, 0.017424, 0.024761, 0.021987, 0.032025, 0.026221, 0.027409
#*# 	  0.000047, 0.013067, -0.002178, 0.009083, 0.014654, -0.003868, -0.002219, 0.001769, 0.015023, 0.013672, 0.018253, 0.020427, 0.020966, 0.020575, 0.020787, 0.019599, 0.020119, 0.021695, 0.027127, 0.023972, 0.028901, 0.023858, 0.032183, 0.036101, 0.039788
#*# 	  0.017677, 0.017830, 0.015470, 0.011700, 0.009897, -0.004537, 0.003036, 0.017479, 0.016319, 0.016403, 0.018979, 0.021892, 0.020701, 0.020092, 0.019200, 0.021174, 0.022101, 0.029673, 0.021983, 0.032628, 0.031298, 0.038916, 0.054608, 0.054488, 0.036391
#*# 	  0.008656, 0.014706, 0.010251, 0.010087, 0.008126, 0.009870, 0.009924, 0.004925, 0.014683, 0.012673, 0.022901, 0.020767, 0.020995, 0.025189, 0.024044, 0.037139, 0.032874, 0.033704, 0.033651, 0.033592, 0.045500, 0.050600, 0.048503, 0.053469, 0.055476
#*# 	  0.013368, 0.008419, 0.009478, 0.009543, 0.010376, -0.010178, 0.003800, -0.004783, 0.008605, 0.019260, 0.020241, 0.017540, 0.026284, 0.019698, 0.022747, 0.028749, 0.032931, 0.028960, 0.030026, 0.040242, 0.044231, 0.046376, 0.047949, 0.059963, 0.059591
#*# 	  0.009777, 0.008517, -0.009443, -0.007360, 0.007345, 0.006309, 0.001262, 0.006653, 0.008759, 0.004427, 0.021063, 0.016927, 0.019072, 0.016624, 0.025667, 0.027225, 0.026977, 0.034418, 0.031136, 0.041445, 0.030680, 0.053859, 0.054657, 0.052394, 0.060124
#*# 	  0.007083, 0.005042, 0.009534, -0.003265, 0.000166, 0.007609, 0.004378, -0.011476, -0.000085, 0.003965, 0.002204, 0.016283, 0.023481, 0.027128, 0.026121, 0.026098, 0.030677, 0.037211, 0.030350, 0.042040, 0.042124, 0.047113, 0.058256, 0.052985, 0.049657
#*# 	  0.002477, 0.002059, -0.001589, -0.001657, 0.001203, 0.001853, 0.002815, -0.001552, 0.002301, 0.009341, 0.004470, 0.005313, 0.011598, 0.004348, 0.010937, 0.025344, 0.031253, 0.024735, 0.039572, 0.035228, 0.042829, 0.036872, 0.048637, 0.046083, 0.043540
#*# 	  -0.002819, -0.000530, 0.003510, 0.001438, 0.002509, -0.001962, -0.000007, -0.002239, 0.003116, 0.003900, 0.010311, 0.007903, 0.016893, 0.024056, 0.012822, 0.025084, 0.029025, 0.035040, 0.034807, 0.035386, 0.034321, 0.038211, 0.049941, 0.045550, 0.050188
#*# 	  -0.003829, 0.003014, -0.000183, 0.007039, 0.000778, 0.001149, -0.004229, -0.003030, 0.000158, 0.000187, 0.005214, 0.005211, 0.017669, 0.011522, 0.005128, 0.028320, 0.017478, 0.023742, 0.019431, 0.032705, 0.033264, 0.033653, 0.040370, 0.046226, 0.037654
#*# 	  -0.009021, -0.007631, -0.002596, -0.003728, -0.003806, -0.004397, -0.008009, -0.008308, -0.010109, -0.004069, -0.003769, -0.004137, -0.002303, -0.002296, -0.003908, -0.002903, 0.010414, 0.010073, 0.011490, 0.014390, 0.033958, 0.030761, 0.031914, 0.030868, 0.036850
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 210.0
#*# min_y = 30.0
#*# max_y = 210.0
#*#
#*# [beacon model default]
#*# model_coef = 1.9263519575030055,
#*# 	  2.1946743347503372,
#*# 	  0.6208794249910773,
#*# 	  0.2775896555222557,
#*# 	  0.06526221562750463,
#*# 	  -0.2611119885640586,
#*# 	  -0.05461829170887029,
#*# 	  0.36810740679885895,
#*# 	  0.05685001457152785,
#*# 	  -0.15547240310186372
#*# model_domain = 3.351987055417817e-07,3.359664588035842e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 63.925584
#*# model_offset = 1.66000
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 77.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 51.6
#*#
#*# [beacon model pei_hot]
#*# model_coef = 1.9263519575030055,
#*# 	2.1946743347503372,
#*# 	0.6208794249910773,
#*# 	0.2775896555222557,
#*# 	0.06526221562750463,
#*# 	-0.2611119885640586,
#*# 	-0.05461829170887029,
#*# 	0.36810740679885895,
#*# 	0.05685001457152785,
#*# 	-0.15547240310186372
#*# model_domain = 3.351987055417817e-07,3.359664588035842e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 63.925584
#*# model_offset = 0.00000
