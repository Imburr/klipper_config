[include moonraker_obico_macros.cfg]
##########################
##### BASE CONFIG #######
##########################

[include mainsail.cfg]
[include ./backup/backup.cfg]

##########################
##### HARDWARE STUFF #####
##########################

[include ./hardware/xyz-stepper.cfg]
[include ./hardware/extruder.cfg]
#[include ./klicky/klicky-probe.cfg]
#[include ./hardware/adxl345.cfg]  This config now in canbus.cfg
[include ./hardware/fans.cfg] # Some fans config in canbus.cfg
[include ./hardware/canbus.cfg]

##########################
##### LIGHTS #############
##########################

[include ./hardware/chamber-lighting.cfg]
[include ./hardware/stealthburner-led.cfg]

##########################
##### CALIBRATION ########
##########################

[include ./calibration/z-tilt.cfg]
[include ./calibration/bed-mesh.cfg]
[include ./macros/unsafe.cfg]
[include ./calibration/pressure_advance.cfg]
[include ./calibration/test_speed.cfg]
[include ./calibration/pika.cfg]
[include test_probe_accuracy.cfg]

##########################
##### MACROS #############
##########################

[include ./macros/chamber-led.cfg]
[include ./macros/conditional-homing.cfg]
[include ./macros/print-end.cfg]
[include ./macros/print-start-mmu.cfg]
[include ./macros/dump-variables.cfg]
[include ./macros/movement-check.cfg]
[include ./macros/cancel-change.cfg]
[include ./macros/pause-resume.cfg]         ; Overridden by ERCF / subsequantly disabled
[include ./macros/load-unload.cfg]
[include ./macros/filament-change.cfg]
[include ./macros/park.cfg]
[include ./macros/heatsoak.cfg]

##########################
##### THIRD PARTY ########
##########################

#[include ./third-party-cfg/nozzle_scrub.cfg]
[include KAMP_Settings.cfg]

##########################
##### ERCF ###############
##########################

[include mmu/base/*.cfg]
[include macros/mmu_adds.cfg]
[include mmu/optional/mmu_ercf_cutter.cfg]

##########################
##### LCD/MENU ###########
##########################

#[include ./third-party-cfg/nozzle_scrub_menu.cfg]
#[include ./menu/printer_menu.cfg]

##########################
##### NOT ENABLED YET ####
##########################

#[include ./todo/mini12864.cfg] Add this after adding mini12864 LED
#[include ./todo/lcd_tweaks.cfg] Need to figure this one out and then implement
#[include ./hardware/nevermore.cfg] Disabled as I prefer to chamber vent outside and needed the PWM

##########################
#### REPLACEMENT #########
##########################

[include ./replacement_macros/replace-m900.cfg]
[include ./replacement_macros/replace-m117.cfg]

[exclude_object]

[gcode_arcs]
resolution: 0.1

[respond]
default_type: echo
default_prefix:  

[force_move]
# Enable commands that force potentially unsafe movement
enable_force_move: True

[idle_timeout]
timeout: 14400

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_290040000750314D35323820-if00
restart_method: command

[mcu rpi]
# Add Rpi as secondary MCU to allow for ADXL use through SPI ribbon/adapter from LDO
serial: /tmp/klipper_host_mcu

[mcu sht]
canbus_uuid: 30993412e8e0

[printer]
kinematics: corexy
max_velocity: 200           # Changed from 200 on 7.11.23
max_accel:  6000            # tuned on 7.11.23 after beacon install.
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0 # Changed on 7.11.23

#####################################################################
#   Input Shaper
#####################################################################

[input_shaper]
#shaper_freq_x: 76.2               ; suggested max_accel <= 22600 mm/sec^2
#shaper_type_x: zv
#shaper_freq_y: 51.8               ; suggested max_accel <= 7900 mm/sec^2
#shaper_type_y: mzv


#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
heater_pin: PA2 #PA2 is LDO default
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 125
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  WAS TAP - NOW BEACON in CANBUS

#####################################################################
#   Additional Sensors
#####################################################################

[thermistor CMFB103F3950FANT]
temperature1: 0.0
resistance1: 32116.0
temperature2: 40.0
resistance2: 5309.0
temperature3: 80.0
resistance3: 1228.0

#[temperature_sensor sb_ambient_temp]
## Chamber Temperature - T1
#sensor_type: CMFB103F3950FANT
#sensor_pin: PF5
#min_temp: 0
#max_temp: 100
#gcode_id: chamber_th

[temperature_sensor back_chamber_temp]
## Chamber Temperature - T
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF6
min_temp: 0
max_temp: 100
gcode_id: chamber_th2

[temperature_sensor RPi4]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################

#[safe_z_home]
##  XY Location of the Z Endstop Switch
##  Update -10,-10 to the XY coordinates of your endstop pin 
##  (such as 157,305) after going through Z Endstop Pin
##  Location Definition step.
#home_xy_position: 147,256
#speed:100
#z_hop:10
#z_hop_speed:10


########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.889
#*# pid_ki = 0.964
#*# pid_kd = 412.851
#*#
#*# [probe]
#*# z_offset = -1.270
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	-0.008161, -0.005264, 0.003231, -0.000671, 0.004654, 0.007159, 0.007264, 0.011323, 0.007047, 0.004426, 0.001898, 0.006663, 0.017386, 0.013841, 0.018194, 0.008990, 0.007336, 0.004666, 0.019572, 0.017142, 0.024286, 0.027501, 0.024974, 0.024348
#*# 	-0.000667, 0.008029, 0.007986, 0.008711, 0.003911, 0.011592, 0.011782, 0.009871, 0.011342, 0.010481, 0.009265, 0.013038, 0.012642, 0.012689, 0.011526, 0.011643, 0.008697, 0.012386, 0.014445, 0.018154, 0.031417, 0.034312, 0.025940, 0.036413
#*# 	0.005212, -0.000564, 0.006103, 0.003333, 0.000107, -0.003735, 0.008688, 0.013055, 0.009814, 0.013171, 0.007925, 0.010940, 0.010328, 0.011281, 0.012028, 0.011736, 0.011236, 0.013482, 0.008908, 0.020767, 0.032706, 0.035618, 0.040787, 0.033561
#*# 	-0.001431, -0.002644, 0.000655, -0.003549, -0.001538, -0.001074, 0.006048, 0.010556, 0.012052, 0.010382, 0.009806, 0.002424, 0.016427, 0.015182, 0.014096, 0.014991, 0.013733, 0.005454, 0.013759, 0.012649, 0.027519, 0.033317, 0.035419, 0.021567
#*# 	-0.000980, -0.007711, -0.006455, -0.004996, -0.007301, -0.005424, 0.005211, 0.004684, 0.004588, 0.004582, 0.009115, 0.004162, 0.014969, 0.012112, 0.019527, 0.018314, 0.010381, 0.003250, 0.012596, 0.022362, 0.033890, 0.042330, 0.042354, 0.029809
#*# 	-0.000647, -0.000247, -0.000841, -0.002938, -0.007429, 0.008294, 0.008785, 0.001850, -0.003587, 0.012478, 0.015150, 0.006005, 0.018062, 0.009041, 0.015365, 0.014091, 0.016082, 0.012461, 0.019927, 0.020618, 0.036148, 0.048330, 0.053847, 0.033256
#*# 	-0.009432, -0.009670, -0.005858, -0.004044, -0.011628, -0.004689, 0.001129, 0.010446, 0.005013, -0.000090, 0.005909, 0.003336, 0.012642, 0.005216, 0.014801, 0.013150, 0.013622, 0.016506, 0.016978, 0.025103, 0.034144, 0.051205, 0.051234, 0.038117
#*# 	0.001754, -0.000984, -0.005698, -0.008319, -0.000367, 0.000569, 0.003498, 0.001362, 0.009560, 0.004958, 0.004699, 0.003866, 0.004745, 0.012039, 0.005381, 0.007113, 0.006084, 0.014962, 0.019156, 0.021994, 0.037757, 0.041884, 0.039945, 0.040100
#*# 	-0.001935, -0.007826, -0.005274, -0.007965, -0.003399, -0.007578, -0.001215, 0.004736, 0.002110, 0.004912, 0.001608, -0.001961, 0.002533, 0.007817, 0.003788, 0.002840, 0.007641, 0.007973, 0.010698, 0.027759, 0.031834, 0.040032, 0.038588, 0.031187
#*# 	-0.000753, -0.003160, -0.002306, -0.002635, -0.000326, 0.002352, 0.005492, 0.003260, 0.009360, 0.004561, 0.003971, 0.003912, 0.004193, 0.009580, 0.004497, 0.012825, 0.007943, 0.008023, 0.011414, 0.022067, 0.030039, 0.031134, 0.035819, 0.031709
#*# 	-0.001056, -0.001616, -0.000047, -0.000887, 0.001013, 0.006884, 0.012837, 0.017901, 0.003861, 0.004025, 0.002364, 0.004853, 0.007559, 0.018410, 0.009577, 0.007385, 0.005903, 0.008015, 0.010761, 0.020169, 0.033969, 0.034105, 0.034360, 0.026952
#*# 	-0.008620, -0.004523, 0.007460, 0.003880, 0.005278, 0.011429, 0.005364, 0.013335, 0.009901, 0.008964, 0.010302, 0.007843, 0.008758, 0.014259, 0.008883, 0.003341, 0.004587, 0.005620, 0.004774, 0.014351, 0.016836, 0.025978, 0.038329, 0.031290
#*# 	0.005784, 0.006335, 0.008492, 0.007357, 0.008294, 0.010164, 0.007630, 0.010884, 0.007697, 0.008370, 0.008602, 0.009537, 0.008433, 0.009322, 0.013189, 0.010528, 0.007889, 0.008577, 0.007512, 0.010913, 0.018496, 0.030659, 0.028327, 0.039906
#*# 	0.001939, 0.002097, 0.006857, 0.010112, 0.005220, 0.015486, 0.010805, 0.011839, 0.015298, 0.009728, 0.013195, 0.012472, 0.015463, 0.014088, 0.011897, 0.012075, 0.008662, 0.012981, 0.012854, 0.013046, 0.020367, 0.024081, 0.037469, 0.038353
#*# 	-0.001106, 0.000353, 0.001161, 0.002058, 0.006581, 0.017012, 0.017141, 0.015570, 0.018317, 0.017330, 0.009219, 0.005296, 0.017270, 0.016865, 0.022274, 0.023200, 0.019680, 0.005606, 0.017625, 0.007175, 0.019494, 0.028915, 0.038911, 0.045581
#*# 	0.003256, 0.001346, 0.000124, -0.000269, 0.005230, 0.017795, 0.016300, 0.017042, 0.022777, 0.004197, 0.020317, 0.023035, 0.017551, 0.023883, 0.020453, 0.020434, 0.016432, 0.022777, 0.022859, 0.022206, 0.026546, 0.036880, 0.056991, 0.031514
#*# 	0.000623, 0.005982, 0.008791, 0.014921, 0.010190, 0.014417, 0.015433, 0.025840, 0.024817, 0.014685, 0.017376, 0.015597, 0.017306, 0.022619, 0.023305, 0.025218, 0.022883, 0.024479, 0.027000, 0.025171, 0.040348, 0.044072, 0.055946, 0.049344
#*# 	0.004830, 0.003901, 0.006999, 0.006988, 0.003748, 0.011617, 0.007193, 0.015080, 0.026165, 0.015224, 0.023572, 0.024434, 0.026149, 0.023640, 0.027441, 0.029984, 0.027421, 0.011588, 0.031272, 0.028848, 0.034700, 0.043079, 0.057743, 0.055082
#*# 	0.000038, 0.001569, 0.002761, 0.001642, 0.002147, 0.006601, 0.009989, 0.009640, 0.015907, 0.015815, 0.018832, 0.013031, 0.022629, 0.019089, 0.030142, 0.031321, 0.032322, 0.033097, 0.031462, 0.012330, 0.036623, 0.040617, 0.050232, 0.049464
#*# 	-0.003506, 0.001302, 0.001894, 0.007794, -0.002784, 0.007427, 0.010019, 0.010003, 0.010091, 0.010093, 0.014252, 0.010427, 0.011327, 0.019490, 0.025494, 0.025245, 0.022551, 0.028687, 0.026580, 0.026983, 0.032321, 0.038003, 0.041398, 0.044660
#*# 	-0.011446, -0.003858, -0.004792, -0.003465, 0.005579, 0.010321, 0.009505, 0.008584, 0.001114, 0.015834, 0.010032, 0.004279, 0.012628, 0.021424, 0.019012, 0.024307, 0.016658, 0.018683, 0.020711, 0.024207, 0.030271, 0.036963, 0.038196, 0.044139
#*# 	-0.010974, -0.014558, -0.011844, -0.010694, -0.005468, 0.004541, 0.012285, 0.004784, 0.013596, 0.016608, 0.016777, 0.006724, 0.015800, 0.015909, 0.017959, 0.019810, 0.016893, 0.015689, 0.016568, 0.018360, 0.026734, 0.034667, 0.043350, 0.049718
#*# 	-0.019426, -0.012344, -0.012863, -0.011864, -0.011126, 0.006895, 0.001835, 0.009498, 0.008393, 0.008280, 0.006343, 0.009177, 0.009389, 0.023263, 0.022427, 0.019577, -0.000871, 0.020764, 0.025785, 0.025494, 0.024732, 0.037964, 0.040656, 0.045311
#*# 	-0.034363, -0.029805, -0.027583, -0.026075, -0.021659, -0.008385, -0.002759, -0.007755, -0.004620, -0.004005, -0.005061, -0.003810, 0.001622, 0.003835, 0.001966, 0.007482, 0.009108, 0.007623, 0.011107, 0.018411, 0.007017, 0.017107, 0.032434, 0.036798
#*# x_count = 24
#*# y_count = 24
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 37.501999999999995
#*# max_x = 208.498
#*# min_y = 37.501000000000005
#*# max_y = 208.495
#*#
#*# [beacon model default]
#*# model_coef = 1.9263519575030055,
#*# 	  2.1946743347503372,
#*# 	  0.6208794249910773,
#*# 	  0.2775896555222557,
#*# 	  0.06526221562750463,
#*# 	  -0.2611119885640586,
#*# 	  -0.05461829170887029,
#*# 	  0.36810740679885895,
#*# 	  0.05685001457152785,
#*# 	  -0.15547240310186372
#*# model_domain = 3.351987055417817e-07,3.359664588035842e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 63.925584
#*# model_offset = 0.00000
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 77.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 51.6
