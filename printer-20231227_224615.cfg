[include moonraker_obico_macros.cfg]
##########################
##### BASE CONFIG #######
##########################

[include mainsail.cfg]
[include ./backup/backup.cfg]

##########################
##### HARDWARE STUFF #####
##########################

[include ./hardware/xyz-stepper.cfg]
[include ./hardware/extruder.cfg]
#[include ./klicky/klicky-probe.cfg]
#[include ./hardware/adxl345.cfg]  This config now in canbus.cfg
[include ./hardware/fans.cfg] # Some fans config in canbus.cfg
[include ./hardware/canbus.cfg]

##########################
##### LIGHTS #############
##########################

[include ./hardware/chamber-lighting.cfg]
[include ./hardware/stealthburner-led.cfg]

##########################
##### CALIBRATION ########
##########################

[include ./calibration/z-tilt.cfg]
[include ./calibration/bed-mesh.cfg]
[include ./macros/unsafe.cfg]
[include ./calibration/pressure_advance.cfg]
[include ./calibration/test_speed.cfg]
[include ./calibration/pika.cfg]
[include test_probe_accuracy.cfg]

##########################
##### MACROS #############
##########################

[include ./macros/chamber-led.cfg]
[include ./macros/conditional-homing.cfg]
[include ./macros/print-end.cfg]
[include ./macros/print-start-mmu.cfg]
[include ./macros/dump-variables.cfg]
[include ./macros/movement-check.cfg]
[include ./macros/cancel-change.cfg]
[include ./macros/pause-resume.cfg]         ; Overridden by ERCF / subsequantly disabled
[include ./macros/load-unload.cfg]
[include ./macros/filament-change.cfg]
[include ./macros/park.cfg]
[include ./macros/heatsoak.cfg]

##########################
##### THIRD PARTY ########
##########################

#[include ./third-party-cfg/nozzle_scrub.cfg]
[include KAMP_Settings.cfg]

##########################
##### ERCF ###############
##########################

[include mmu/base/*.cfg]
[include macros/mmu_adds.cfg]
[include mmu/optional/mmu_ercf_cutter.cfg]

##########################
##### LCD/MENU ###########
##########################

#[include ./third-party-cfg/nozzle_scrub_menu.cfg]
#[include ./menu/printer_menu.cfg]

##########################
##### NOT ENABLED YET ####
##########################

#[include ./todo/mini12864.cfg] Add this after adding mini12864 LED
#[include ./todo/lcd_tweaks.cfg] Need to figure this one out and then implement
#[include ./hardware/nevermore.cfg] Disabled as I prefer to chamber vent outside and needed the PWM

##########################
#### REPLACEMENT #########
##########################

[include ./replacement_macros/replace-m900.cfg]
[include ./replacement_macros/replace-m117.cfg]

[exclude_object]

[gcode_arcs]
resolution: 0.1

[respond]
default_type: echo
default_prefix:  

[force_move]
# Enable commands that force potentially unsafe movement
enable_force_move: True

[idle_timeout]
timeout: 14400

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_290040000750314D35323820-if00
restart_method: command

[mcu rpi]
# Add Rpi as secondary MCU to allow for ADXL use through SPI ribbon/adapter from LDO
serial: /tmp/klipper_host_mcu

[mcu sht]
canbus_uuid: 30993412e8e0

[printer]
kinematics: corexy
max_velocity: 200           # Changed from 200 on 7.11.23
max_accel:  6000            # tuned on 7.11.23 after beacon install.
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0 # Changed on 7.11.23

#####################################################################
#   Input Shaper
#####################################################################

[input_shaper]
#shaper_freq_x: 76.2               ; suggested max_accel <= 22600 mm/sec^2
#shaper_type_x: zv
#shaper_freq_y: 51.8               ; suggested max_accel <= 7900 mm/sec^2
#shaper_type_y: mzv


#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
heater_pin: PA2 #PA2 is LDO default
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 125
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  WAS TAP - NOW BEACON in CANBUS

#####################################################################
#   Additional Sensors
#####################################################################

[thermistor CMFB103F3950FANT]
temperature1: 0.0
resistance1: 32116.0
temperature2: 40.0
resistance2: 5309.0
temperature3: 80.0
resistance3: 1228.0

#[temperature_sensor sb_ambient_temp]
## Chamber Temperature - T1
#sensor_type: CMFB103F3950FANT
#sensor_pin: PF5
#min_temp: 0
#max_temp: 100
#gcode_id: chamber_th

[temperature_sensor back_chamber_temp]
## Chamber Temperature - T
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF6
min_temp: 0
max_temp: 100
gcode_id: chamber_th2

[temperature_sensor RPi4]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################

#[safe_z_home]
##  XY Location of the Z Endstop Switch
##  Update -10,-10 to the XY coordinates of your endstop pin 
##  (such as 157,305) after going through Z Endstop Pin
##  Location Definition step.
#home_xy_position: 147,256
#speed:100
#z_hop:10
#z_hop_speed:10


########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.889
#*# pid_ki = 0.964
#*# pid_kd = 412.851
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.016044, -0.010549, -0.004439, 0.003493, 0.007811, 0.012816, 0.009451, 0.011167, 0.008740, 0.007969, 0.012507, 0.009887, 0.025084, 0.015888, 0.023180, 0.028856, 0.022014, 0.024187, 0.028499, 0.029341, 0.036748, 0.028731, 0.030130, 0.031891, 0.032519
#*# 	  -0.008780, 0.001962, 0.016532, 0.005140, 0.010696, 0.000008, 0.022122, 0.024470, 0.022843, 0.010462, 0.017925, 0.022316, 0.025282, 0.026076, 0.024777, 0.027980, 0.031163, 0.030777, 0.028782, 0.029451, 0.031819, 0.033931, 0.033354, 0.036299, 0.032412
#*# 	  -0.009873, -0.001185, 0.019921, 0.013575, 0.010995, 0.006741, 0.011799, 0.012384, 0.023062, 0.012780, 0.014549, 0.018784, 0.020986, 0.022393, 0.021266, 0.025114, 0.013281, 0.027689, 0.025480, 0.027409, 0.025099, 0.031878, 0.036457, 0.041959, 0.035632
#*# 	  -0.006236, 0.000797, -0.000387, 0.015349, 0.018464, -0.005210, -0.001372, 0.003715, 0.009595, 0.015873, 0.007007, 0.013682, 0.018658, 0.014872, 0.021083, 0.020954, 0.019498, 0.011654, 0.014193, 0.025241, 0.026311, 0.032354, 0.031603, 0.045222, 0.033764
#*# 	  -0.016403, -0.006310, 0.009574, 0.000872, -0.002108, -0.004112, 0.015675, -0.003470, 0.014659, 0.009839, 0.010725, 0.013958, 0.012439, 0.008490, 0.013497, 0.012961, 0.020340, 0.017487, 0.024985, 0.015532, 0.022157, 0.026915, 0.038086, 0.035112, 0.029687
#*# 	  -0.015154, -0.003989, 0.004222, 0.000884, 0.001986, 0.007388, -0.003546, 0.005960, 0.012301, 0.006794, 0.012394, 0.011203, 0.011980, 0.013772, 0.030671, 0.025144, 0.015486, 0.026682, 0.023253, 0.018040, 0.030343, 0.025012, 0.035572, 0.035806, 0.034184
#*# 	  -0.021190, -0.005850, 0.010854, 0.004659, 0.001240, 0.010318, 0.010313, 0.005514, 0.004904, 0.011053, 0.015840, 0.019651, 0.027170, 0.025961, 0.028669, 0.030796, 0.022262, 0.023638, 0.019600, 0.013010, 0.023058, 0.029875, 0.043739, 0.035961, 0.034911
#*# 	  -0.009669, -0.006271, -0.004099, -0.005281, -0.005723, 0.010230, 0.008632, 0.010626, 0.002850, 0.010369, 0.010876, 0.017076, 0.024237, 0.029699, 0.034927, 0.032008, 0.032294, 0.027759, 0.022385, 0.030298, 0.028472, 0.035144, 0.032795, 0.032470, 0.035939
#*# 	  -0.011130, -0.004652, -0.002713, 0.009473, 0.002630, 0.009916, 0.009507, 0.001090, 0.005902, 0.008284, 0.010069, 0.026902, 0.018430, 0.031768, 0.030424, 0.032996, 0.027818, 0.024345, 0.027279, 0.024863, 0.027085, 0.033647, 0.032554, 0.030808, 0.029095
#*# 	  -0.009946, -0.003534, 0.001142, 0.000297, -0.003643, 0.003251, 0.002894, -0.005887, -0.003416, 0.007971, 0.007062, 0.016034, 0.025617, 0.028373, 0.032762, 0.030517, 0.017714, 0.017232, 0.018636, 0.024928, 0.015370, 0.029301, 0.035154, 0.030067, 0.029570
#*# 	  -0.011502, -0.007849, -0.006575, -0.004496, -0.004275, -0.001114, -0.000987, 0.005808, -0.005364, 0.008607, 0.009828, 0.011412, 0.013683, 0.019213, 0.025607, 0.019889, 0.018914, 0.026175, 0.013367, 0.028971, 0.028879, 0.030927, 0.032907, 0.040453, 0.021223
#*# 	  -0.007618, -0.007207, -0.002744, -0.005301, -0.004637, -0.003351, -0.001083, -0.002790, 0.009129, -0.005444, -0.005743, 0.011420, 0.012477, 0.011370, 0.013232, 0.018953, 0.026711, 0.018041, 0.014025, 0.025433, 0.022992, 0.033280, 0.032728, 0.040762, 0.026781
#*# 	  -0.021972, -0.007826, -0.004696, -0.005706, -0.004229, -0.001357, -0.003986, -0.006451, 0.003073, 0.000334, -0.000684, 0.006865, 0.005084, 0.007009, 0.013461, 0.011699, 0.021062, 0.023242, 0.029503, 0.027503, 0.026615, 0.031923, 0.035245, 0.030601, 0.030959
#*# 	  -0.026285, -0.013431, -0.002882, -0.010325, 0.001446, -0.000418, -0.001840, 0.004210, -0.007512, 0.003404, 0.007636, 0.006735, 0.005615, 0.008749, 0.009153, 0.016237, 0.007173, 0.028214, 0.019712, 0.032142, 0.033934, 0.042470, 0.035779, 0.041687, 0.036579
#*# 	  -0.021385, -0.012740, -0.006074, 0.000927, -0.004450, 0.000789, 0.005035, 0.001473, 0.006263, -0.002184, -0.008103, 0.008075, 0.007074, 0.008324, 0.008549, 0.009482, 0.019094, 0.031662, 0.025952, 0.033178, 0.030598, 0.042025, 0.041335, 0.045070, 0.039758
#*# 	  -0.018305, -0.013889, -0.005811, 0.000673, -0.006649, 0.002217, 0.002613, -0.005504, -0.007242, 0.001886, 0.002678, 0.001520, 0.005175, 0.012042, 0.016796, 0.017524, 0.027412, 0.031442, 0.026893, 0.029772, 0.039301, 0.046005, 0.040317, 0.042587, 0.040506
#*# 	  -0.021371, -0.008270, -0.002779, -0.002684, 0.006904, 0.004061, -0.000397, 0.001072, 0.001811, 0.003685, 0.006787, 0.008274, 0.015178, 0.009785, 0.015406, 0.025939, 0.024875, 0.030700, 0.028000, 0.037767, 0.042964, 0.043445, 0.051368, 0.053216, 0.042311
#*# 	  -0.015980, -0.011272, -0.005580, -0.008844, -0.008711, 0.001435, 0.004944, 0.009092, 0.004761, 0.003727, 0.000205, -0.000133, 0.007733, 0.009427, 0.023035, 0.026218, 0.029647, 0.034952, 0.033252, 0.038479, 0.039305, 0.046526, 0.039668, 0.053870, 0.045014
#*# 	  -0.024696, -0.017828, -0.006475, -0.011200, -0.003830, -0.009002, -0.014380, -0.014993, -0.001802, 0.001760, -0.003256, 0.003329, 0.009357, 0.009445, 0.015160, 0.020473, 0.030426, 0.038912, 0.039982, 0.031213, 0.039435, 0.045488, 0.043675, 0.048260, 0.044048
#*# 	  -0.031508, -0.019850, -0.020849, -0.026304, -0.006939, -0.022540, -0.023026, -0.010555, -0.018357, -0.020987, -0.003098, 0.000516, 0.002456, 0.007341, 0.013967, 0.025873, 0.031304, 0.035000, 0.035693, 0.039196, 0.038092, 0.042079, 0.040831, 0.051071, 0.042008
#*# 	  -0.030074, -0.028855, -0.020492, -0.018415, -0.020555, -0.025737, -0.013716, -0.020558, -0.020194, -0.016099, -0.004169, -0.016414, 0.001237, 0.008148, 0.012186, 0.023622, 0.039262, 0.035744, 0.012126, 0.040444, 0.036733, 0.037262, 0.041190, 0.039123, 0.038774
#*# 	  -0.031102, -0.022274, -0.019167, -0.018994, -0.016490, -0.018916, -0.017367, -0.012964, -0.023348, -0.014738, -0.016511, -0.009862, 0.001518, 0.007698, 0.013114, 0.028811, 0.030638, 0.016144, 0.039230, 0.037500, 0.039166, 0.036952, 0.038760, 0.041847, 0.038210
#*# 	  -0.027309, -0.015786, -0.021961, -0.014375, -0.011654, -0.021031, -0.015630, -0.012578, -0.015719, -0.007263, 0.002688, -0.003667, 0.002605, 0.010632, 0.018684, 0.025245, 0.040649, 0.023712, 0.022393, 0.039673, 0.033336, 0.035468, 0.038334, 0.040217, 0.040354
#*# 	  -0.019115, -0.008805, -0.015946, -0.014217, -0.013771, -0.002885, -0.016039, 0.000324, 0.001209, -0.023701, -0.015034, -0.011727, 0.001997, 0.011701, 0.014120, 0.023081, 0.026370, 0.031693, 0.006835, 0.022912, 0.035503, 0.038099, 0.031670, 0.037990, 0.033421
#*# 	  -0.035074, -0.023592, -0.025199, -0.028303, -0.031580, -0.020947, -0.025841, -0.023517, -0.015956, -0.017945, -0.013586, -0.014193, 0.000294, -0.007460, 0.001401, -0.000253, 0.005076, 0.001691, 0.013460, 0.005890, 0.007826, 0.017749, 0.019563, 0.011464, 0.009779
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 210.0
#*# min_y = 30.0
#*# max_y = 210.0
#*#
#*# [beacon model default]
#*# model_coef = 1.9263519575030055,
#*# 	  2.1946743347503372,
#*# 	  0.6208794249910773,
#*# 	  0.2775896555222557,
#*# 	  0.06526221562750463,
#*# 	  -0.2611119885640586,
#*# 	  -0.05461829170887029,
#*# 	  0.36810740679885895,
#*# 	  0.05685001457152785,
#*# 	  -0.15547240310186372
#*# model_domain = 3.351987055417817e-07,3.359664588035842e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 63.925584
#*# model_offset = 1.33000
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 77.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 51.6
#*#
#*# [beacon model pei_hot]
#*# model_coef = 1.9263519575030055,
#*# 	2.1946743347503372,
#*# 	0.6208794249910773,
#*# 	0.2775896555222557,
#*# 	0.06526221562750463,
#*# 	-0.2611119885640586,
#*# 	-0.05461829170887029,
#*# 	0.36810740679885895,
#*# 	0.05685001457152785,
#*# 	-0.15547240310186372
#*# model_domain = 3.351987055417817e-07,3.359664588035842e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 63.925584
#*# model_offset = 0.00000
