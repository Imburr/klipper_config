[include moonraker_obico_macros.cfg]
##########################
##### BASE CONFIG #######
##########################

[include mainsail.cfg]
[include ./backup/backup.cfg]

##########################
##### HARDWARE STUFF #####
##########################

[include ./hardware/xyz-stepper.cfg]
[include ./hardware/extruder.cfg]
#[include ./klicky/klicky-probe.cfg]
#[include ./hardware/adxl345.cfg]  This config now in canbus.cfg
[include ./hardware/fans.cfg] # Some fans config in canbus.cfg
[include ./hardware/canbus.cfg]

##########################
##### LIGHTS #############
##########################

[include ./hardware/chamber-lighting.cfg]
[include ./hardware/stealthburner-led.cfg]

##########################
##### CALIBRATION ########
##########################

[include ./calibration/z-tilt.cfg]
[include ./calibration/bed-mesh.cfg]
[include ./macros/unsafe.cfg]
[include ./calibration/pressure_advance.cfg]
[include ./calibration/test_speed.cfg]
[include ./calibration/pika.cfg]
[include test_probe_accuracy.cfg]

##########################
##### MACROS #############
##########################

[include ./macros/chamber-led.cfg]
[include ./macros/conditional-homing.cfg]
[include ./macros/print-end.cfg]
[include ./macros/print-start-mmu.cfg]
[include ./macros/dump-variables.cfg]
[include ./macros/movement-check.cfg]
[include ./macros/cancel-change.cfg]
[include ./macros/pause-resume.cfg]         ; Overridden by ERCF / subsequantly disabled
[include ./macros/load-unload.cfg]
[include ./macros/filament-change.cfg]
[include ./macros/park.cfg]
[include ./macros/heatsoak.cfg]

##########################
##### THIRD PARTY ########
##########################

#[include ./third-party-cfg/nozzle_scrub.cfg]
[include KAMP_Settings.cfg]

##########################
##### ERCF ###############
##########################

[include mmu/base/*.cfg]
[include macros/mmu_adds.cfg]
[include mmu/optional/mmu_ercf_cutter.cfg]

##########################
##### LCD/MENU ###########
##########################

#[include ./third-party-cfg/nozzle_scrub_menu.cfg]
#[include ./menu/printer_menu.cfg]

##########################
##### NOT ENABLED YET ####
##########################

#[include ./todo/mini12864.cfg] Add this after adding mini12864 LED
#[include ./todo/lcd_tweaks.cfg] Need to figure this one out and then implement
#[include ./hardware/nevermore.cfg] Disabled as I prefer to chamber vent outside and needed the PWM

##########################
#### REPLACEMENT #########
##########################

[include ./replacement_macros/replace-m900.cfg]
[include ./replacement_macros/replace-m117.cfg]

[exclude_object]

[gcode_arcs]
resolution: 0.1

[respond]
default_type: echo
default_prefix:  

[force_move]
# Enable commands that force potentially unsafe movement
enable_force_move: True

[idle_timeout]
timeout: 14400

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_290040000750314D35323820-if00
restart_method: command

[mcu rpi]
# Add Rpi as secondary MCU to allow for ADXL use through SPI ribbon/adapter from LDO
serial: /tmp/klipper_host_mcu

[mcu sht]
canbus_uuid: 30993412e8e0

[printer]
kinematics: corexy
max_velocity: 200           # Changed from 200 on 7.11.23
max_accel:  6000            # tuned on 7.11.23 after beacon install.
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0 # Changed on 7.11.23

#####################################################################
#   Input Shaper
#####################################################################

[input_shaper]
#shaper_freq_x: 76.2               ; suggested max_accel <= 22600 mm/sec^2
#shaper_type_x: zv
#shaper_freq_y: 51.8               ; suggested max_accel <= 7900 mm/sec^2
#shaper_type_y: mzv


#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
heater_pin: PA2 #PA2 is LDO default
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 125
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  WAS TAP - NOW BEACON in CANBUS

#####################################################################
#   Additional Sensors
#####################################################################

[thermistor CMFB103F3950FANT]
temperature1: 0.0
resistance1: 32116.0
temperature2: 40.0
resistance2: 5309.0
temperature3: 80.0
resistance3: 1228.0

#[temperature_sensor sb_ambient_temp]
## Chamber Temperature - T1
#sensor_type: CMFB103F3950FANT
#sensor_pin: PF5
#min_temp: 0
#max_temp: 100
#gcode_id: chamber_th

[temperature_sensor back_chamber_temp]
## Chamber Temperature - T
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF6
min_temp: 0
max_temp: 100
gcode_id: chamber_th2

[temperature_sensor RPi4]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################

#[safe_z_home]
##  XY Location of the Z Endstop Switch
##  Update -10,-10 to the XY coordinates of your endstop pin 
##  (such as 157,305) after going through Z Endstop Pin
##  Location Definition step.
#home_xy_position: 147,256
#speed:100
#z_hop:10
#z_hop_speed:10


########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.889
#*# pid_ki = 0.964
#*# pid_kd = 412.851
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.023889, -0.005768, -0.000467, 0.003860, 0.001844, 0.014064, 0.012243, 0.012163, 0.008228, 0.005399, 0.007416, 0.007256, 0.009509, 0.015801, 0.017932, 0.020054, 0.022491, 0.019608, 0.022081, 0.021845, 0.019709, 0.020843, 0.022786, 0.025534, 0.024888
#*# 	  -0.013135, 0.004236, 0.009974, 0.014130, 0.005532, 0.012754, 0.008640, 0.005504, 0.012682, 0.012515, 0.013086, 0.020712, 0.020680, 0.011242, 0.018688, 0.022902, 0.021094, 0.019626, 0.023643, 0.022677, 0.028561, 0.027676, 0.045890, 0.035484, 0.027954
#*# 	  -0.014261, 0.006756, 0.009198, 0.011825, 0.008791, 0.012378, 0.011797, 0.013012, 0.011470, 0.013506, 0.012140, 0.016749, 0.012824, 0.014931, 0.006562, 0.017864, 0.025680, 0.022133, 0.026239, 0.020872, 0.028502, 0.028934, 0.036112, 0.030524, 0.034369
#*# 	  -0.011716, -0.003563, 0.001742, 0.005058, 0.005538, 0.003490, 0.007816, 0.002785, 0.006408, 0.011819, 0.007555, 0.006127, 0.011320, 0.016788, 0.013144, 0.010294, 0.016576, 0.014480, 0.009409, 0.013437, 0.025755, 0.028780, 0.038453, 0.035231, 0.039455
#*# 	  -0.014609, -0.013265, 0.005772, 0.001239, 0.004848, 0.004033, 0.001742, 0.001557, 0.004302, 0.010235, 0.005549, 0.007962, 0.008707, 0.009319, 0.008915, 0.011616, 0.012189, 0.007094, 0.010164, 0.015143, 0.017678, 0.028501, 0.030734, 0.030201, 0.031334
#*# 	  -0.013624, 0.000657, -0.000666, -0.000405, 0.001004, -0.003003, 0.001470, 0.001129, 0.001316, -0.002197, 0.009188, 0.017127, 0.023856, 0.026487, 0.009506, 0.008167, 0.017765, 0.012048, 0.017921, 0.011612, 0.018731, 0.021434, 0.028500, 0.032517, 0.031224
#*# 	  -0.010281, -0.006019, -0.005367, -0.001720, 0.001495, 0.007213, 0.007020, 0.004494, 0.002414, 0.006431, 0.005976, 0.025810, 0.028185, 0.026089, 0.037181, 0.026054, 0.024886, 0.024239, 0.025833, 0.027278, 0.020959, 0.034233, 0.027869, 0.036629, 0.039247
#*# 	  -0.004703, -0.003818, -0.001009, -0.002845, 0.002130, 0.000329, 0.002330, 0.005163, -0.002042, 0.003718, 0.011616, 0.009546, 0.023121, 0.032264, 0.039198, 0.031677, 0.033788, 0.027604, 0.019918, 0.025167, 0.028306, 0.035327, 0.034811, 0.035709, 0.019630
#*# 	  -0.002559, -0.003200, 0.000793, -0.003509, -0.002389, -0.001311, 0.001643, 0.004588, -0.002587, 0.000362, 0.009411, 0.007073, 0.024629, 0.031994, 0.031772, 0.033401, 0.028500, 0.017179, 0.022484, 0.016358, 0.025498, 0.034567, 0.034912, 0.032889, 0.027714
#*# 	  -0.007552, -0.007502, -0.004235, -0.002978, -0.005839, -0.008745, -0.003533, -0.002466, -0.003776, 0.003109, 0.000327, 0.004781, 0.018342, 0.028425, 0.023345, 0.027599, 0.025948, 0.009571, 0.020887, 0.016631, 0.024365, 0.027995, 0.032313, 0.022439, 0.025654
#*# 	  -0.014874, -0.004870, -0.005814, -0.007475, -0.009144, -0.004524, -0.002875, -0.004710, -0.001619, 0.003840, -0.004172, 0.009829, 0.001066, 0.015499, 0.021520, 0.014909, 0.019810, 0.016213, 0.023104, 0.023206, 0.023297, 0.023582, 0.034794, 0.024999, 0.019227
#*# 	  -0.023445, -0.012107, -0.005275, -0.008292, -0.005686, -0.004966, -0.004692, -0.008608, -0.003763, -0.003946, 0.001895, 0.003462, 0.008180, 0.021376, 0.010580, 0.017676, 0.015888, 0.016786, 0.011504, 0.015876, 0.019441, 0.023258, 0.022645, 0.032861, 0.025347
#*# 	  -0.019268, -0.004334, -0.007097, -0.006424, -0.006679, -0.008899, -0.003627, -0.006224, -0.007184, -0.001020, -0.001150, -0.001673, 0.001044, 0.017263, 0.004563, 0.021705, 0.017646, 0.018353, 0.018393, 0.023342, 0.034601, 0.030733, 0.030681, 0.028923, 0.027449
#*# 	  -0.015606, -0.003855, -0.005944, -0.004460, -0.004660, -0.008887, -0.006042, -0.003668, -0.005602, 0.004196, -0.003038, 0.000591, 0.007607, 0.022095, 0.004451, 0.014466, 0.019547, 0.018472, 0.026489, 0.013993, 0.029166, 0.034965, 0.040789, 0.033225, 0.032970
#*# 	  -0.038254, -0.015258, -0.007001, -0.007534, -0.003685, -0.007395, 0.001993, -0.006659, 0.002679, 0.001353, -0.002368, 0.008853, 0.009503, 0.013694, 0.023317, 0.021031, 0.025845, 0.021560, 0.025056, 0.031862, 0.035418, 0.033680, 0.038455, 0.038619, 0.032667
#*# 	  -0.026740, -0.005317, -0.010485, -0.008101, -0.000676, -0.000506, 0.005519, 0.002266, -0.001844, 0.003620, 0.006156, 0.009559, -0.001717, 0.009185, 0.017716, 0.014243, 0.025211, 0.026389, 0.029876, 0.031673, 0.036193, 0.037592, 0.048965, 0.041618, 0.035932
#*# 	  -0.023046, -0.007017, -0.002662, -0.006267, -0.008719, 0.003692, -0.002377, 0.002954, 0.001467, 0.003724, -0.000097, -0.001435, 0.011506, 0.013163, 0.014165, 0.024628, 0.028320, 0.028053, 0.032723, 0.036777, 0.036202, 0.045159, 0.058654, 0.064361, 0.041948
#*# 	  -0.008755, -0.009214, -0.006425, -0.004043, -0.008778, 0.000268, -0.003068, -0.005075, 0.000214, 0.000655, 0.002289, 0.001581, 0.018535, 0.024693, 0.027859, 0.025833, 0.023985, 0.030294, 0.030884, 0.034134, 0.038086, 0.035859, 0.044135, 0.055243, 0.045606
#*# 	  -0.013878, -0.012975, -0.011625, -0.009515, -0.010312, -0.011821, -0.008319, -0.007938, -0.011986, -0.007271, -0.003224, -0.002243, 0.010436, -0.004909, 0.015815, 0.022691, 0.026009, 0.025163, 0.032099, 0.036246, 0.031777, 0.038322, 0.047241, 0.045663, 0.039031
#*# 	  -0.028300, -0.008662, -0.010766, -0.011736, -0.012321, -0.014215, -0.010605, -0.009755, -0.011531, -0.010145, -0.008536, -0.003750, 0.000343, 0.002120, 0.026242, 0.020841, 0.028046, 0.027303, 0.025499, 0.029780, 0.031100, 0.030160, 0.032444, 0.045312, 0.032298
#*# 	  -0.029863, -0.013210, -0.010116, -0.014795, -0.019787, -0.013766, -0.013786, -0.011233, -0.014863, -0.012618, -0.010305, -0.005835, -0.001750, 0.008998, 0.022243, 0.024642, 0.027887, 0.026120, 0.025646, 0.029602, 0.025444, 0.030899, 0.036327, 0.038891, 0.029525
#*# 	  -0.033589, -0.022844, -0.022055, -0.012001, -0.011861, -0.012052, -0.011527, -0.013712, -0.011088, -0.011517, -0.011100, 0.001935, 0.003650, 0.016216, 0.027103, 0.026277, 0.027972, 0.028763, 0.030746, 0.029769, 0.029347, 0.030043, 0.030569, 0.033000, 0.031224
#*# 	  -0.017294, -0.010487, -0.011833, -0.013182, -0.010607, -0.011620, -0.011068, -0.012377, -0.009987, -0.008519, -0.010040, -0.006463, 0.011452, 0.017790, 0.021195, 0.030585, 0.030276, 0.024394, 0.026169, 0.027743, 0.026253, 0.026577, 0.028430, 0.029291, 0.030800
#*# 	  -0.025167, -0.013308, -0.017595, -0.018614, -0.012520, -0.015154, -0.011872, -0.011740, -0.007788, -0.009638, -0.004230, -0.005714, 0.003984, 0.004222, 0.015861, 0.026439, 0.026134, 0.021876, 0.026992, 0.028085, 0.028082, 0.027425, 0.028091, 0.031237, 0.029706
#*# 	  -0.033835, -0.032843, -0.027688, -0.023449, -0.026480, -0.035956, -0.033302, -0.010902, -0.011570, -0.010766, -0.010598, -0.015568, -0.008741, -0.006186, -0.003794, 0.001798, 0.000434, 0.001682, 0.004566, 0.000207, 0.011340, 0.012985, 0.009617, 0.008316, 0.008440
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 210.0
#*# min_y = 30.0
#*# max_y = 210.0
#*#
#*# [beacon model default]
#*# model_coef = 1.9263519575030055,
#*# 	  2.1946743347503372,
#*# 	  0.6208794249910773,
#*# 	  0.2775896555222557,
#*# 	  0.06526221562750463,
#*# 	  -0.2611119885640586,
#*# 	  -0.05461829170887029,
#*# 	  0.36810740679885895,
#*# 	  0.05685001457152785,
#*# 	  -0.15547240310186372
#*# model_domain = 3.351987055417817e-07,3.359664588035842e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 63.925584
#*# model_offset = 1.38000
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 77.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 51.6
#*#
#*# [beacon model pei_hot]
#*# model_coef = 1.9263519575030055,
#*# 	2.1946743347503372,
#*# 	0.6208794249910773,
#*# 	0.2775896555222557,
#*# 	0.06526221562750463,
#*# 	-0.2611119885640586,
#*# 	-0.05461829170887029,
#*# 	0.36810740679885895,
#*# 	0.05685001457152785,
#*# 	-0.15547240310186372
#*# model_domain = 3.351987055417817e-07,3.359664588035842e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 63.925584
#*# model_offset = 0.00000
