##########################
##### BASE CONFIG #######
##########################

[include mainsail.cfg]
[include ./backup/backup.cfg]

##########################
##### HARDWARE STUFF #####
##########################

[include ./hardware/xyz-stepper.cfg]
[include ./hardware/extruder.cfg]
#[include ./klicky/klicky-probe.cfg]
#[include ./hardware/adxl345.cfg]  This config now in canbus.cfg
[include ./hardware/fans.cfg] # Some fans config in canbus.cfg
[include ./hardware/canbus.cfg]

##########################
##### LIGHTS #############
##########################

[include ./hardware/chamber-lighting.cfg]
[include ./hardware/stealthburner-led.cfg]

##########################
##### CALIBRATION ########
##########################

[include ./calibration/z-tilt.cfg]
[include ./calibration/bed-mesh.cfg]
[include ./macros/unsafe.cfg]
[include ./calibration/pressure_advance.cfg]
[include ./calibration/test_speed.cfg]
[include ./calibration/pika.cfg]
[include test_probe_accuracy.cfg]

##########################
##### MACROS #############
##########################

[include ./macros/chamber-led.cfg]
[include ./macros/conditional-homing.cfg]
[include ./macros/print-end.cfg]
[include ./macros/print-start-mmu.cfg]
[include ./macros/dump-variables.cfg]
[include ./macros/movement-check.cfg]
[include ./macros/cancel-change.cfg]
[include ./macros/pause-resume.cfg]         ; Overridden by ERCF / subsequantly disabled
[include ./macros/load-unload.cfg]
[include ./macros/filament-change.cfg]
[include ./macros/park.cfg]
#[include ./macros/prusaslicer-accel.cfg]

##########################
##### THIRD PARTY ########
##########################

#[include ./third-party-cfg/nozzle_scrub.cfg]
[include KAMP_Settings.cfg]

##########################
##### ERCF ###############
##########################

[include mmu/base/*.cfg]
[include macros/mmu_adds.cfg]
[include mmu/optional/mmu_ercf_cutter.cfg]

##########################
##### LCD/MENU ###########
##########################

#[include ./third-party-cfg/nozzle_scrub_menu.cfg]
#[include ./menu/printer_menu.cfg]

##########################
##### NOT ENABLED YET ####
##########################

#[include ./todo/mini12864.cfg] Add this after adding mini12864 LED
#[include ./todo/lcd_tweaks.cfg] Need to figure this one out and then implement
#[include ./hardware/nevermore.cfg] Disabled as I prefer to chamber vent outside and needed the PWM

##########################
#### REPLACEMENT #########
##########################

[include ./replacement_macros/replace-m900.cfg]
[include ./replacement_macros/replace-m117.cfg]

[exclude_object]

[gcode_arcs]
resolution: 0.1

[respond]
default_type: echo
default_prefix:  

[force_move]
# Enable commands that force potentially unsafe movement
enable_force_move: True

[idle_timeout]
timeout: 14400

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_290040000750314D35323820-if00
restart_method: command

[mcu rpi]
# Add Rpi as secondary MCU to allow for ADXL use through SPI ribbon/adapter from LDO
serial: /tmp/klipper_host_mcu

[mcu sht]
canbus_uuid: 30993412e8e0

[printer]
kinematics: corexy
max_velocity: 200           # Changed from 200 on 7.11.23
max_accel:  6000            # tuned on 7.11.23 after beacon install.
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0 # Changed on 7.11.23

#####################################################################
#   Input Shaper
#####################################################################

[input_shaper]
#shaper_freq_x: 76.2               ; suggested max_accel <= 22600 mm/sec^2
#shaper_type_x: zv
#shaper_freq_y: 51.8               ; suggested max_accel <= 7900 mm/sec^2
#shaper_type_y: mzv


#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
heater_pin: PA2 #PA2 is LDO default
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 125
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  WAS TAP - NOW BEACON in CANBUS

#####################################################################
#   Additional Sensors
#####################################################################

[thermistor CMFB103F3950FANT]
temperature1: 0.0
resistance1: 32116.0
temperature2: 40.0
resistance2: 5309.0
temperature3: 80.0
resistance3: 1228.0

#[temperature_sensor sb_ambient_temp]
## Chamber Temperature - T1
#sensor_type: CMFB103F3950FANT
#sensor_pin: PF5
#min_temp: 0
#max_temp: 100
#gcode_id: chamber_th

[temperature_sensor back_chamber_temp]
## Chamber Temperature - T
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF6
min_temp: 0
max_temp: 100
gcode_id: chamber_th2

[temperature_sensor RPi4]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################

#[safe_z_home]
##  XY Location of the Z Endstop Switch
##  Update -10,-10 to the XY coordinates of your endstop pin 
##  (such as 157,305) after going through Z Endstop Pin
##  Location Definition step.
#home_xy_position: 147,256
#speed:100
#z_hop:10
#z_hop_speed:10


########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.889
#*# pid_ki = 0.964
#*# pid_kd = 412.851
#*#
#*# [probe]
#*# z_offset = -1.270
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.025648, -0.022657, -0.022709, -0.025646, -0.025018, -0.023554, -0.022145, -0.023588, -0.025294, -0.022795, -0.022565, -0.024611, -0.023891, -0.023954, -0.023413, -0.021863, -0.018125, -0.014842, -0.000168, -0.007833
#*# 	  -0.029324, -0.026610, -0.024709, -0.024048, -0.023990, -0.023380, -0.023919, -0.023484, -0.023218, -0.021816, -0.021781, -0.024650, -0.023389, -0.023985, -0.020406, -0.013670, -0.015719, -0.015968, -0.004614, -0.002997
#*# 	  -0.026875, -0.023418, -0.022363, -0.022878, -0.023435, -0.020063, -0.021687, -0.020182, -0.019141, -0.020530, -0.019376, -0.019445, -0.018599, -0.018856, -0.013468, -0.015712, -0.013430, -0.006849, 0.001538, 0.003441
#*# 	  -0.024287, -0.022867, -0.025131, -0.014594, -0.018442, -0.015845, -0.014379, -0.017552, -0.013380, -0.015000, -0.017811, -0.018060, -0.012571, -0.012738, -0.017906, -0.006425, -0.001006, -0.004624, 0.000117, 0.003558
#*# 	  -0.019062, -0.022839, -0.022037, -0.016499, -0.021030, -0.014199, -0.016529, -0.013677, -0.015192, -0.012315, -0.018870, -0.017947, -0.017490, -0.005769, -0.007920, -0.009256, -0.001766, -0.002830, 0.001623, 0.003712
#*# 	  -0.023077, -0.024189, -0.022740, -0.020586, -0.018305, -0.019883, -0.018183, -0.016269, -0.019561, -0.015663, -0.014284, -0.012334, -0.018324, -0.014308, -0.005402, -0.007187, 0.002901, 0.001411, 0.000233, 0.001760
#*# 	  -0.022455, -0.021146, -0.018454, -0.024845, -0.021764, -0.020277, -0.012846, -0.020776, -0.015291, -0.016653, -0.013557, -0.003932, -0.005126, -0.007206, 0.003365, -0.000021, -0.013501, -0.001211, 0.002158, 0.001775
#*# 	  -0.022799, -0.024071, -0.016543, -0.022239, -0.021279, -0.016090, -0.013431, -0.016539, -0.011117, -0.008960, -0.005485, -0.009597, 0.002377, -0.003292, -0.005905, -0.000286, -0.002311, -0.000174, 0.005639, 0.004512
#*# 	  -0.024027, -0.018541, -0.021652, -0.020170, -0.014226, -0.015200, -0.016234, -0.011694, -0.010902, -0.012774, -0.012446, -0.006201, 0.000872, -0.000498, 0.000889, 0.001973, 0.002906, 0.002811, 0.005442, 0.009552
#*# 	  -0.021224, -0.021902, -0.016364, -0.020470, -0.017024, -0.011744, -0.011105, -0.007780, -0.006321, -0.000432, 0.000608, 0.003007, -0.000588, 0.002782, 0.000946, 0.003025, 0.010385, 0.005129, 0.014367, 0.016197
#*# 	  -0.021213, -0.018611, -0.018272, -0.013655, -0.014018, -0.009792, -0.017648, -0.009737, -0.003030, -0.000643, 0.000254, 0.000847, 0.001916, 0.003483, 0.005387, 0.005494, 0.005527, 0.012274, 0.022442, 0.021567
#*# 	  -0.014555, -0.021113, -0.018307, -0.011205, -0.012125, -0.014784, -0.004003, -0.001531, -0.010782, 0.001402, -0.000775, 0.001471, 0.006304, 0.003750, 0.009799, 0.011302, 0.012197, 0.012928, 0.030866, 0.026258
#*# 	  -0.011816, -0.015267, -0.015149, -0.006514, -0.010170, -0.006045, -0.014592, -0.009145, -0.004909, 0.002491, -0.000240, 0.007226, 0.003689, 0.011199, 0.015135, 0.013213, 0.019700, 0.012747, 0.026468, 0.029764
#*# 	  -0.011717, -0.012993, -0.010926, -0.010560, -0.012722, -0.009877, -0.004990, 0.001099, -0.000860, 0.001685, 0.003014, 0.004337, 0.008626, 0.015340, 0.015208, 0.022466, 0.028931, 0.027662, 0.027862, 0.033299
#*# 	  -0.013259, -0.016999, -0.014314, -0.008423, -0.013913, -0.004820, -0.008504, -0.004324, 0.000060, -0.000095, 0.003737, 0.010096, 0.008418, 0.010310, 0.014923, 0.016279, 0.027114, 0.027750, 0.030351, 0.030801
#*# 	  -0.017176, -0.019436, -0.018795, -0.020437, -0.017875, -0.018162, -0.011202, -0.015445, 0.000092, -0.000682, 0.001935, 0.006942, 0.007609, 0.011000, 0.020180, 0.015885, 0.029025, 0.025472, 0.029022, 0.029501
#*# 	  -0.022309, -0.022673, -0.022848, -0.017860, -0.021278, -0.017977, -0.013583, -0.011823, -0.003610, 0.000254, 0.000219, 0.004322, 0.005671, 0.007600, 0.012313, 0.013162, 0.019563, 0.020259, 0.026076, 0.028994
#*# 	  -0.019841, -0.021648, -0.021392, -0.022471, -0.021976, -0.017854, -0.014332, -0.010225, -0.010147, -0.000012, 0.001746, 0.003248, 0.004559, 0.006756, 0.011306, 0.016693, 0.011851, 0.024645, 0.016335, 0.028060
#*# 	  -0.017993, -0.017994, -0.016580, -0.015193, -0.017622, -0.010467, -0.008747, 0.001127, 0.000781, -0.001063, 0.003498, 0.006656, 0.009534, 0.011975, 0.011899, 0.017466, 0.018790, 0.024503, 0.016951, 0.028149
#*# x_count = 20
#*# y_count = 19
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 54.652
#*# max_x = 191.225
#*# min_y = 57.854
#*# max_y = 188.15
#*#
#*# [beacon model default]
#*# model_coef = 1.9257982386737142,
#*# 	  2.1904011986275074,
#*# 	  0.5881661108028357,
#*# 	  0.30341866940870527,
#*# 	  0.14823890288711727,
#*# 	  -0.42807822476666274,
#*# 	  -0.13716254071061182,
#*# 	  0.612855529187592,
#*# 	  0.08376843001203003,
#*# 	  -0.2664564217100284
#*# model_domain = 3.352922478536077e-07,3.360945745364866e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 72.578002
#*# model_offset = 0.18500
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 77.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 51.6
