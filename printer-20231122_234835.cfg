[include moonraker_obico_macros.cfg]
##########################
##### BASE CONFIG #######
##########################

[include mainsail.cfg]
[include ./backup/backup.cfg]

##########################
##### HARDWARE STUFF #####
##########################

[include ./hardware/xyz-stepper.cfg]
[include ./hardware/extruder.cfg]
#[include ./klicky/klicky-probe.cfg]
#[include ./hardware/adxl345.cfg]  This config now in canbus.cfg
[include ./hardware/fans.cfg] # Some fans config in canbus.cfg
[include ./hardware/canbus.cfg]

##########################
##### LIGHTS #############
##########################

[include ./hardware/chamber-lighting.cfg]
[include ./hardware/stealthburner-led.cfg]

##########################
##### CALIBRATION ########
##########################

[include ./calibration/z-tilt.cfg]
[include ./calibration/bed-mesh.cfg]
[include ./macros/unsafe.cfg]
[include ./calibration/pressure_advance.cfg]
[include ./calibration/test_speed.cfg]
[include ./calibration/pika.cfg]
[include test_probe_accuracy.cfg]

##########################
##### MACROS #############
##########################

[include ./macros/chamber-led.cfg]
[include ./macros/conditional-homing.cfg]
[include ./macros/print-end.cfg]
[include ./macros/print-start-mmu.cfg]
[include ./macros/dump-variables.cfg]
[include ./macros/movement-check.cfg]
[include ./macros/cancel-change.cfg]
[include ./macros/pause-resume.cfg]         ; Overridden by ERCF / subsequantly disabled
[include ./macros/load-unload.cfg]
[include ./macros/filament-change.cfg]
[include ./macros/park.cfg]
#[include ./macros/prusaslicer-accel.cfg]

##########################
##### THIRD PARTY ########
##########################

#[include ./third-party-cfg/nozzle_scrub.cfg]
[include KAMP_Settings.cfg]

##########################
##### ERCF ###############
##########################

[include mmu/base/*.cfg]
[include macros/mmu_adds.cfg]
[include mmu/optional/mmu_ercf_cutter.cfg]

##########################
##### LCD/MENU ###########
##########################

#[include ./third-party-cfg/nozzle_scrub_menu.cfg]
#[include ./menu/printer_menu.cfg]

##########################
##### NOT ENABLED YET ####
##########################

#[include ./todo/mini12864.cfg] Add this after adding mini12864 LED
#[include ./todo/lcd_tweaks.cfg] Need to figure this one out and then implement
#[include ./hardware/nevermore.cfg] Disabled as I prefer to chamber vent outside and needed the PWM

##########################
#### REPLACEMENT #########
##########################

[include ./replacement_macros/replace-m900.cfg]
[include ./replacement_macros/replace-m117.cfg]

[exclude_object]

[gcode_arcs]
resolution: 0.1

[respond]
default_type: echo
default_prefix:  

[force_move]
# Enable commands that force potentially unsafe movement
enable_force_move: True

[idle_timeout]
timeout: 14400

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_290040000750314D35323820-if00
restart_method: command

[mcu rpi]
# Add Rpi as secondary MCU to allow for ADXL use through SPI ribbon/adapter from LDO
serial: /tmp/klipper_host_mcu

[mcu sht]
canbus_uuid: 30993412e8e0

[printer]
kinematics: corexy
max_velocity: 200           # Changed from 200 on 7.11.23
max_accel:  6000            # tuned on 7.11.23 after beacon install.
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0 # Changed on 7.11.23

#####################################################################
#   Input Shaper
#####################################################################

[input_shaper]
#shaper_freq_x: 76.2               ; suggested max_accel <= 22600 mm/sec^2
#shaper_type_x: zv
#shaper_freq_y: 51.8               ; suggested max_accel <= 7900 mm/sec^2
#shaper_type_y: mzv


#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
heater_pin: PA2 #PA2 is LDO default
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 125
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  WAS TAP - NOW BEACON in CANBUS

#####################################################################
#   Additional Sensors
#####################################################################

[thermistor CMFB103F3950FANT]
temperature1: 0.0
resistance1: 32116.0
temperature2: 40.0
resistance2: 5309.0
temperature3: 80.0
resistance3: 1228.0

#[temperature_sensor sb_ambient_temp]
## Chamber Temperature - T1
#sensor_type: CMFB103F3950FANT
#sensor_pin: PF5
#min_temp: 0
#max_temp: 100
#gcode_id: chamber_th

[temperature_sensor back_chamber_temp]
## Chamber Temperature - T
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF6
min_temp: 0
max_temp: 100
gcode_id: chamber_th2

[temperature_sensor RPi4]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################

#[safe_z_home]
##  XY Location of the Z Endstop Switch
##  Update -10,-10 to the XY coordinates of your endstop pin 
##  (such as 157,305) after going through Z Endstop Pin
##  Location Definition step.
#home_xy_position: 147,256
#speed:100
#z_hop:10
#z_hop_speed:10


########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.889
#*# pid_ki = 0.964
#*# pid_kd = 412.851
#*#
#*# [probe]
#*# z_offset = -1.270
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.015839, -0.030818, -0.004228, -0.002278, 0.004230, 0.004232, 0.015064, 0.010180, 0.011750, 0.011822, 0.022517, 0.020902, 0.011885, 0.012092, 0.017118, 0.019831, 0.021605, 0.022429, 0.024190, 0.025506, 0.028314, 0.040399, 0.037853, 0.040947
#*# 	  -0.004341, 0.001642, 0.000173, 0.004519, 0.004340, 0.002157, 0.002943, 0.001839, 0.011411, 0.012351, 0.009565, 0.012145, 0.011445, 0.011531, 0.017625, 0.031767, 0.026621, 0.023069, 0.027123, 0.024207, 0.039926, 0.038474, 0.044234, 0.046687
#*# 	  0.003776, -0.003118, 0.004615, 0.009252, 0.001255, 0.015969, 0.020005, 0.009231, 0.011188, 0.010147, 0.013419, 0.019007, 0.013256, 0.018909, 0.018022, 0.020142, 0.021802, 0.022800, 0.022483, 0.028670, 0.031583, 0.041056, 0.051841, 0.051995
#*# 	  0.001988, -0.002294, 0.004347, 0.004580, -0.002050, 0.000277, 0.005750, 0.002106, 0.010962, 0.010343, 0.002228, 0.003801, 0.011276, 0.009447, 0.011684, 0.012349, 0.017094, 0.013090, 0.029087, 0.035871, 0.032706, 0.048728, 0.049694, 0.047579
#*# 	  -0.004983, -0.008834, -0.008902, -0.005361, 0.001874, 0.004900, -0.007450, 0.008050, 0.002978, 0.002067, 0.005687, 0.011741, 0.012112, 0.011747, 0.012994, 0.012582, 0.015023, 0.020404, 0.023318, 0.032019, 0.031050, 0.041094, 0.043197, 0.046334
#*# 	  -0.003806, 0.006052, -0.003594, -0.003784, -0.004773, -0.007304, -0.003775, 0.014342, 0.002424, 0.005471, 0.001998, 0.009091, 0.009494, 0.008131, 0.011758, 0.006082, 0.008959, 0.006011, 0.015676, 0.021303, 0.024598, 0.039518, 0.038956, 0.042435
#*# 	  0.008673, -0.005897, -0.002764, -0.006810, -0.008220, -0.008347, -0.009840, 0.009035, 0.008417, 0.003478, 0.003700, 0.010684, 0.013416, 0.017345, 0.010946, 0.012042, 0.011552, 0.012521, 0.013377, 0.017986, 0.020509, 0.030466, 0.029539, 0.034199
#*# 	  -0.004084, -0.008585, -0.013100, -0.011231, -0.009620, -0.003866, -0.003994, 0.001647, 0.001519, 0.007794, 0.007101, 0.011069, 0.018072, 0.016723, 0.020013, 0.014255, 0.012296, 0.013871, 0.016593, 0.015628, 0.022806, 0.034913, 0.035006, 0.040666
#*# 	  -0.003546, -0.002541, -0.009590, -0.000042, -0.002718, 0.001931, -0.003359, 0.011738, 0.005399, 0.007277, 0.006310, 0.010229, 0.011700, 0.014699, 0.012975, 0.014519, 0.018937, 0.011071, 0.026313, 0.027213, 0.036840, 0.037531, 0.038436, 0.041201
#*# 	  0.002235, -0.008935, -0.007118, -0.004865, -0.009047, -0.006945, 0.006573, 0.004322, 0.006488, 0.008114, 0.012275, 0.007696, 0.013084, 0.017855, 0.013625, 0.013194, 0.020901, 0.017981, 0.023798, 0.028391, 0.036971, 0.040221, 0.042883, 0.042920
#*# 	  -0.004660, 0.002641, -0.003775, -0.008187, -0.008158, -0.003071, 0.011851, 0.006941, 0.008118, 0.002767, 0.013723, 0.007814, 0.008514, 0.013492, 0.016045, 0.023193, 0.023121, 0.020710, 0.031451, 0.037117, 0.044979, 0.044372, 0.049692, 0.045329
#*# 	  -0.002622, -0.006706, -0.008245, -0.006467, -0.007091, 0.000676, -0.002096, 0.004345, 0.008051, 0.007794, 0.012539, 0.015568, 0.015685, 0.018125, 0.026017, 0.022385, 0.038771, 0.028381, 0.032794, 0.035644, 0.043430, 0.049992, 0.056739, 0.054949
#*# 	  -0.005456, -0.001002, -0.012655, -0.009713, -0.012511, -0.010408, -0.007021, -0.006758, -0.007365, -0.000331, 0.004846, 0.010031, 0.016377, 0.015589, 0.021133, 0.022756, 0.026574, 0.027155, 0.035905, 0.041252, 0.049013, 0.053638, 0.051736, 0.050699
#*# 	  -0.002235, -0.020857, -0.022433, -0.010803, -0.004262, -0.001823, -0.007770, -0.010954, -0.002097, -0.001803, 0.010348, 0.020367, 0.015052, 0.015477, 0.017855, 0.024309, 0.027784, 0.026703, 0.029523, 0.034248, 0.048853, 0.053843, 0.057264, 0.063582
#*# 	  -0.008522, -0.021500, -0.021781, -0.016826, -0.013092, -0.010140, -0.011387, -0.009204, -0.000777, -0.001336, 0.018005, 0.008737, 0.009013, 0.015210, 0.017081, 0.024993, 0.028691, 0.026053, 0.036177, 0.037452, 0.040613, 0.053702, 0.056601, 0.056616
#*# 	  -0.027375, -0.020294, -0.024384, -0.015518, -0.020184, -0.023109, -0.014105, -0.016957, -0.004683, -0.003490, 0.005501, 0.005717, 0.005869, 0.011004, 0.012412, 0.025530, 0.029032, 0.030442, 0.031948, 0.033402, 0.031614, 0.045299, 0.050070, 0.050147
#*# 	  -0.023428, -0.026364, -0.025650, -0.027029, -0.024128, -0.026676, -0.022518, -0.023486, -0.011773, 0.001874, 0.000966, -0.004642, 0.003927, 0.003589, 0.012974, 0.010390, 0.015968, 0.019472, 0.031087, 0.029969, 0.030562, 0.033643, 0.031135, 0.038031
#*# x_count = 24
#*# y_count = 17
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 39.8
#*# max_x = 206.2
#*# min_y = 66.022
#*# max_y = 179.978
#*#
#*# [beacon model default]
#*# model_coef = 1.934243930597146,
#*# 	  2.206808199797723,
#*# 	  0.6436025413836176,
#*# 	  0.3095345837351202,
#*# 	  -0.15977813582327796,
#*# 	  -0.5908394974077775,
#*# 	  0.4266719892497021,
#*# 	  1.046422592108256,
#*# 	  -0.23184944767066623,
#*# 	  -0.5507144312738391
#*# model_domain = 3.353607345856729e-07,3.361070372275538e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 79.449632
#*# model_offset = 0.67000
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 77.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 51.6
