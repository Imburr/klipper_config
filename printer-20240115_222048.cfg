[include moonraker_obico_macros.cfg]
##########################
##### BASE CONFIG #######
##########################

[include mainsail.cfg]
[include ./backup/backup.cfg]

##########################
##### HARDWARE STUFF #####
##########################

[include ./hardware/xyz-stepper.cfg]
[include ./hardware/extruder.cfg]
#[include ./klicky/klicky-probe.cfg]
#[include ./hardware/adxl345.cfg]  This config now in canbus.cfg
[include ./hardware/fans.cfg] # Some fans config in canbus.cfg
[include ./hardware/canbus.cfg]

##########################
##### LIGHTS #############
##########################

[include ./hardware/chamber-lighting.cfg]
[include ./hardware/stealthburner-led.cfg]

##########################
##### CALIBRATION ########
##########################

[include ./calibration/z-tilt.cfg]
[include ./calibration/bed-mesh.cfg]
[include ./macros/unsafe.cfg]
[include ./calibration/pressure_advance.cfg]
[include ./calibration/test_speed.cfg]
[include ./calibration/pika.cfg]
[include ./calibration/microadjust.cfg]
[include ./calibration/sensorless.cfg]
[include test_probe_accuracy.cfg]

##########################
##### MACROS #############
##########################

[include ./macros/chamber-led.cfg]
[include ./macros/conditional-homing.cfg]
[include ./macros/print-end.cfg]
[include ./macros/print-start-mmu.cfg]
[include ./macros/dump-variables.cfg]
[include ./macros/movement-check.cfg]
[include ./macros/cancel-change.cfg]
[include ./macros/pause-resume.cfg]         ; Overridden by ERCF / subsequantly disabled
[include ./macros/load-unload.cfg]
[include ./macros/filament-change.cfg]
[include ./macros/park.cfg]
[include ./macros/heatsoak.cfg]

##########################
##### THIRD PARTY ########
##########################

#[include ./third-party-cfg/nozzle_scrub.cfg]
[include KAMP_Settings.cfg]

##########################
##### ERCF ###############
##########################

[include mmu/base/*.cfg]
[include macros/mmu_adds.cfg]
[include mmu/optional/mmu_ercf_cutter.cfg]

##########################
##### LCD/MENU ###########
##########################

#[include ./third-party-cfg/nozzle_scrub_menu.cfg]
#[include ./menu/printer_menu.cfg]

##########################
##### NOT ENABLED YET ####
##########################

#[include ./todo/mini12864.cfg] Add this after adding mini12864 LED
#[include ./todo/lcd_tweaks.cfg] Need to figure this one out and then implement
#[include ./hardware/nevermore.cfg] Disabled as I prefer to chamber vent outside and needed the PWM

##########################
#### REPLACEMENT #########
##########################

[include ./replacement_macros/replace-m900.cfg]
[include ./replacement_macros/replace-m117.cfg]

[exclude_object]

[gcode_arcs]
resolution: 0.1

[respond]
default_type: echo
default_prefix:  

[force_move]
# Enable commands that force potentially unsafe movement
enable_force_move: True

[idle_timeout]
timeout: 14400

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_290040000750314D35323820-if00
restart_method: command

[mcu rpi]
# Add Rpi as secondary MCU to allow for ADXL use through SPI ribbon/adapter from LDO
serial: /tmp/klipper_host_mcu

[mcu sht]
canbus_uuid: 30993412e8e0

[printer]
kinematics: corexy
max_velocity: 200           # Changed from 200 on 7.11.23
max_accel:  6000            # tuned on 7.11.23 after beacon install.
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0 # Changed on 7.11.23

#####################################################################
#   Input Shaper
#####################################################################

[input_shaper]
#shaper_freq_x: 76.2               ; suggested max_accel <= 22600 mm/sec^2
#shaper_type_x: zv
#shaper_freq_y: 51.8               ; suggested max_accel <= 7900 mm/sec^2
#shaper_type_y: mzv

#####################################################################
#   AutoTune / https://github.com/andrewmcgr/klipper_tmc_autotune
#####################################################################

[motor_constants ldo-42sth48-2004mah_vrn]
resistance: 1.45
inductance: 0.002
holding_torque: 0.40
max_current: 2.0
steps_per_revolution: 400

#[autotune_tmc stepper_x]
#motor: ldo-42sth48-2004mah_vrn
#sg4_thrs: 105
#tuning_goal: silent
#[autotune_tmc stepper_y]
#motor: ldo-42sth48-2004mah_vrn
#tuning_goal: silent

[autotune_tmc stepper_z]
motor: ldo-42sth40-1684l300e
[autotune_tmc stepper_z1]
motor: ldo-42sth40-1684l300e
[autotune_tmc stepper_z2]
motor: ldo-42sth40-1684l300e

[autotune_tmc extruder]
motor: moons-cse14hra1l410a

#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
heater_pin: PA2 #PA2 is LDO default
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 125
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  WAS TAP - NOW BEACON in CANBUS

#####################################################################
#   Additional Sensors
#####################################################################

[thermistor CMFB103F3950FANT]
temperature1: 0.0
resistance1: 32116.0
temperature2: 40.0
resistance2: 5309.0
temperature3: 80.0
resistance3: 1228.0

#[temperature_sensor sb_ambient_temp]
## Chamber Temperature - T1
#sensor_type: CMFB103F3950FANT
#sensor_pin: PF5
#min_temp: 0
#max_temp: 100
#gcode_id: chamber_th

[temperature_sensor back_chamber_temp]
## Chamber Temperature - T
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF6
min_temp: 0
max_temp: 100
gcode_id: chamber_th2

[temperature_sensor RPi4]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.889
#*# pid_ki = 0.964
#*# pid_kd = 412.851
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.034245, 0.036023, 0.033740, 0.028530, 0.025726, 0.021762, 0.017139, 0.012130, 0.010851, 0.009253, 0.006114, 0.006413, 0.004729, 0.006597, 0.006267, 0.006606, 0.008731, 0.008897, 0.005908, 0.001503, -0.002309, -0.003208, -0.002429, -0.000313, 0.007156
#*# 	  0.038072, 0.038724, 0.034192, 0.031054, 0.026538, 0.023585, 0.019335, 0.014258, 0.013199, 0.012276, 0.008727, 0.007658, 0.006734, 0.004662, 0.003614, 0.001650, 0.004558, 0.004052, 0.001717, 0.000365, -0.001611, -0.002256, -0.002476, -0.001685, 0.005765
#*# 	  0.039299, 0.030864, 0.031738, 0.029375, 0.028212, 0.022854, 0.018982, 0.015756, 0.013595, 0.012491, 0.009675, 0.007631, 0.001731, 0.000960, -0.002808, -0.003303, -0.004744, -0.003790, -0.004824, -0.004834, -0.005047, -0.003553, -0.004451, -0.002785, 0.002997
#*# 	  0.036186, 0.030448, 0.028317, 0.025529, 0.022580, 0.018703, 0.014892, 0.010186, 0.009498, 0.007102, 0.004666, 0.000611, -0.002427, -0.006865, -0.009723, -0.012173, -0.011593, -0.012697, -0.014245, -0.012724, -0.010371, -0.008440, -0.007630, -0.006074, 0.000082
#*# 	  0.029365, 0.027147, 0.023298, 0.021473, 0.019266, 0.017382, 0.008260, 0.005092, 0.002197, 0.003621, -0.003923, -0.005033, -0.008388, -0.011962, -0.015966, -0.018474, -0.017933, -0.020266, -0.021280, -0.019640, -0.015674, -0.011927, -0.009921, -0.006815, -0.002657
#*# 	  0.026014, 0.021093, 0.018908, 0.016879, 0.017662, 0.011562, 0.003648, 0.000044, -0.002378, -0.003142, -0.006938, -0.008691, -0.010828, -0.013111, -0.017142, -0.019495, -0.021026, -0.023144, -0.023042, -0.022500, -0.019741, -0.013752, -0.011767, -0.007484, -0.004707
#*# 	  0.031058, 0.022346, 0.019535, 0.017903, 0.013512, 0.009963, 0.003130, -0.001693, -0.003864, -0.004237, -0.005785, -0.010053, -0.007007, -0.009225, -0.011093, -0.018677, -0.017870, -0.020641, -0.022220, -0.020799, -0.017723, -0.015125, -0.011652, -0.008750, -0.003908
#*# 	  0.035697, 0.027870, 0.025338, 0.022855, 0.019210, 0.012071, 0.006535, 0.001741, -0.000705, -0.002472, -0.004491, -0.004118, -0.003305, -0.001110, -0.007118, -0.008936, -0.010692, -0.012938, -0.015986, -0.015495, -0.013677, -0.010364, -0.008644, -0.005937, -0.001757
#*# 	  0.043958, 0.037350, 0.033107, 0.027866, 0.027734, 0.018695, 0.014454, 0.008363, 0.009145, 0.001326, 0.001207, 0.001601, 0.003852, 0.003528, 0.001296, -0.001263, -0.004251, -0.006023, -0.008925, -0.007933, -0.009757, -0.004793, -0.004942, -0.003117, 0.001979
#*# 	  0.043948, 0.038278, 0.032154, 0.028005, 0.023820, 0.018586, 0.013081, 0.008750, 0.006402, 0.003048, -0.000488, -0.002754, 0.000800, 0.000393, -0.000559, -0.001661, -0.003815, -0.007699, -0.012832, -0.011252, -0.010421, -0.008656, -0.008161, -0.007624, -0.003891
#*# 	  0.040584, 0.035304, 0.029291, 0.023853, 0.018509, 0.012279, 0.009140, 0.006473, 0.003076, -0.001232, -0.006482, -0.006907, -0.005153, -0.004225, -0.006155, -0.005699, -0.008292, -0.012665, -0.017456, -0.018044, -0.013801, -0.013078, -0.013601, -0.013992, -0.010986
#*# 	  0.042976, 0.032144, 0.028236, 0.021971, 0.015230, 0.010761, 0.007995, 0.005772, 0.004469, -0.000077, -0.005105, -0.007367, -0.006170, -0.006131, -0.004536, -0.006424, -0.008513, -0.014740, -0.018109, -0.018785, -0.016257, -0.011559, -0.012616, -0.012927, -0.009693
#*# 	  0.044155, 0.036090, 0.030996, 0.023692, 0.017921, 0.012493, 0.009449, 0.009501, 0.004778, 0.004334, -0.000902, -0.002430, -0.000157, -0.000579, -0.001970, -0.002763, -0.004344, -0.010026, -0.013355, -0.016427, -0.012467, -0.009964, -0.008779, -0.008074, -0.004414
#*# 	  0.043998, 0.037270, 0.030254, 0.023353, 0.016295, 0.012818, 0.007324, 0.005431, 0.004580, 0.005451, 0.001508, 0.000062, 0.001339, 0.002061, 0.000659, -0.000523, -0.001611, -0.006333, -0.010555, -0.010977, -0.009861, -0.007492, -0.005498, -0.003368, 0.000735
#*# 	  0.044747, 0.038643, 0.030399, 0.022697, 0.019199, 0.012956, 0.009045, 0.006818, 0.006815, 0.004658, 0.003843, 0.002831, 0.006300, 0.003971, 0.003455, 0.003100, 0.003736, -0.001521, -0.004300, -0.003967, -0.004313, -0.000830, 0.000629, 0.004773, 0.007744
#*# 	  0.051749, 0.045302, 0.039103, 0.032465, 0.027581, 0.023948, 0.019089, 0.015780, 0.016043, 0.015349, 0.013386, 0.013216, 0.013696, 0.013632, 0.012242, 0.013391, 0.013495, 0.011205, 0.009624, 0.009025, 0.010335, 0.012058, 0.013696, 0.016072, 0.020719
#*# 	  0.060007, 0.053238, 0.046307, 0.041391, 0.035143, 0.031923, 0.029739, 0.022541, 0.023646, 0.022839, 0.022184, 0.020254, 0.020726, 0.020526, 0.019108, 0.019552, 0.021566, 0.021005, 0.020207, 0.020329, 0.022438, 0.022687, 0.023595, 0.026382, 0.032164
#*# 	  0.059302, 0.051197, 0.046533, 0.039358, 0.035220, 0.031831, 0.028133, 0.023630, 0.022896, 0.021131, 0.019197, 0.018801, 0.019641, 0.019137, 0.019129, 0.019811, 0.022776, 0.022562, 0.021752, 0.022033, 0.023616, 0.024720, 0.025315, 0.028125, 0.033610
#*# 	  0.057264, 0.048596, 0.041606, 0.034562, 0.031295, 0.027077, 0.022852, 0.019431, 0.017008, 0.017205, 0.014999, 0.014612, 0.014562, 0.016779, 0.017130, 0.020040, 0.020999, 0.020682, 0.020238, 0.021265, 0.022117, 0.023087, 0.023896, 0.026289, 0.031748
#*# 	  0.051141, 0.042158, 0.034520, 0.027921, 0.023028, 0.018740, 0.014243, 0.009808, 0.009392, 0.008628, 0.006454, 0.007053, 0.010361, 0.012235, 0.013313, 0.015287, 0.017137, 0.015824, 0.016104, 0.017366, 0.017603, 0.017845, 0.017727, 0.021046, 0.026675
#*# 	  0.047456, 0.037415, 0.029408, 0.023079, 0.017322, 0.014636, 0.007628, 0.004332, 0.003362, 0.003641, 0.001908, 0.003284, 0.005847, 0.008741, 0.011402, 0.013238, 0.015444, 0.013254, 0.013078, 0.013745, 0.012749, 0.011663, 0.011778, 0.015423, 0.021040
#*# 	  0.048796, 0.039569, 0.030299, 0.023771, 0.019557, 0.014192, 0.010080, 0.006715, 0.005120, 0.004781, 0.003408, 0.004398, 0.008141, 0.011407, 0.014058, 0.016639, 0.017880, 0.016235, 0.015222, 0.014028, 0.012233, 0.010991, 0.010018, 0.013422, 0.019104
#*# 	  0.058458, 0.047867, 0.039323, 0.031767, 0.027544, 0.024902, 0.021055, 0.018023, 0.015620, 0.014906, 0.013896, 0.013576, 0.017005, 0.019971, 0.021682, 0.024020, 0.025136, 0.023872, 0.021280, 0.019675, 0.018111, 0.015483, 0.015078, 0.017035, 0.022633
#*# 	  0.068287, 0.056876, 0.048215, 0.040758, 0.037543, 0.034379, 0.032338, 0.030039, 0.027055, 0.024977, 0.022681, 0.023235, 0.026399, 0.027628, 0.028734, 0.031262, 0.031339, 0.029833, 0.027205, 0.023799, 0.021595, 0.019726, 0.018858, 0.020669, 0.025158
#*# 	  0.072276, 0.061468, 0.052587, 0.045198, 0.041362, 0.038727, 0.037683, 0.035077, 0.033267, 0.031719, 0.028197, 0.028759, 0.030308, 0.031500, 0.032365, 0.032648, 0.033343, 0.031281, 0.028052, 0.024385, 0.021705, 0.020267, 0.019479, 0.020603, 0.024766
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 210.0
#*# min_y = 30.0
#*# max_y = 208.0
#*#
#*# [beacon model default]
#*# model_coef = 1.4613818954269993,
#*# 	  1.7756600472438397,
#*# 	  0.7384172744186067,
#*# 	  0.3398904593101075,
#*# 	  0.3899746104559005,
#*# 	  0.4162951819734925,
#*# 	  -0.2058487068481297,
#*# 	  -0.3393668279079826,
#*# 	  0.21620390616642218,
#*# 	  0.20874618374099485
#*# model_domain = 3.168808091292228e-07,3.3288555528608446e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 67.017932
#*# model_offset = -0.10000
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 77.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 51.6
#*#
#*# [beacon model pei_hot]
#*# model_coef = 1.9263519575030055,
#*# 	2.1946743347503372,
#*# 	0.6208794249910773,
#*# 	0.2775896555222557,
#*# 	0.06526221562750463,
#*# 	-0.2611119885640586,
#*# 	-0.05461829170887029,
#*# 	0.36810740679885895,
#*# 	0.05685001457152785,
#*# 	-0.15547240310186372
#*# model_domain = 3.351987055417817e-07,3.359664588035842e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 63.925584
#*# model_offset = 0.00000
