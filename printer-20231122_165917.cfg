##########################
##### BASE CONFIG #######
##########################

[include mainsail.cfg]
[include ./backup/backup.cfg]

##########################
##### HARDWARE STUFF #####
##########################

[include ./hardware/xyz-stepper.cfg]
[include ./hardware/extruder.cfg]
#[include ./klicky/klicky-probe.cfg]
#[include ./hardware/adxl345.cfg]  This config now in canbus.cfg
[include ./hardware/fans.cfg] # Some fans config in canbus.cfg
[include ./hardware/canbus.cfg]

##########################
##### LIGHTS #############
##########################

[include ./hardware/chamber-lighting.cfg]
[include ./hardware/stealthburner-led.cfg]

##########################
##### CALIBRATION ########
##########################

[include ./calibration/z-tilt.cfg]
[include ./calibration/bed-mesh.cfg]
[include ./macros/unsafe.cfg]
[include ./calibration/pressure_advance.cfg]
[include ./calibration/test_speed.cfg]
[include ./calibration/pika.cfg]
[include test_probe_accuracy.cfg]

##########################
##### MACROS #############
##########################

[include ./macros/chamber-led.cfg]
[include ./macros/conditional-homing.cfg]
[include ./macros/print-end.cfg]
[include ./macros/print-start-mmu.cfg]
[include ./macros/dump-variables.cfg]
[include ./macros/movement-check.cfg]
[include ./macros/cancel-change.cfg]
[include ./macros/pause-resume.cfg]         ; Overridden by ERCF / subsequantly disabled
[include ./macros/load-unload.cfg]
[include ./macros/filament-change.cfg]
[include ./macros/park.cfg]
#[include ./macros/prusaslicer-accel.cfg]

##########################
##### THIRD PARTY ########
##########################

#[include ./third-party-cfg/nozzle_scrub.cfg]
[include KAMP_Settings.cfg]

##########################
##### ERCF ###############
##########################

[include mmu/base/*.cfg]
[include macros/mmu_adds.cfg]
[include mmu/optional/mmu_ercf_cutter.cfg]

##########################
##### LCD/MENU ###########
##########################

#[include ./third-party-cfg/nozzle_scrub_menu.cfg]
#[include ./menu/printer_menu.cfg]

##########################
##### NOT ENABLED YET ####
##########################

#[include ./todo/mini12864.cfg] Add this after adding mini12864 LED
#[include ./todo/lcd_tweaks.cfg] Need to figure this one out and then implement
#[include ./hardware/nevermore.cfg] Disabled as I prefer to chamber vent outside and needed the PWM

##########################
#### REPLACEMENT #########
##########################

[include ./replacement_macros/replace-m900.cfg]
[include ./replacement_macros/replace-m117.cfg]

[exclude_object]

[gcode_arcs]
resolution: 0.1

[respond]
default_type: echo
default_prefix:  

[force_move]
# Enable commands that force potentially unsafe movement
enable_force_move: True

[idle_timeout]
timeout: 14400

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_290040000750314D35323820-if00
restart_method: command

[mcu rpi]
# Add Rpi as secondary MCU to allow for ADXL use through SPI ribbon/adapter from LDO
serial: /tmp/klipper_host_mcu

[mcu sht]
canbus_uuid: 30993412e8e0

[printer]
kinematics: corexy
max_velocity: 200           # Changed from 200 on 7.11.23
max_accel:  6000            # tuned on 7.11.23 after beacon install.
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0 # Changed on 7.11.23

#####################################################################
#   Input Shaper
#####################################################################

[input_shaper]
#shaper_freq_x: 76.2               ; suggested max_accel <= 22600 mm/sec^2
#shaper_type_x: zv
#shaper_freq_y: 51.8               ; suggested max_accel <= 7900 mm/sec^2
#shaper_type_y: mzv


#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
heater_pin: PA2 #PA2 is LDO default
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 125
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  WAS TAP - NOW BEACON in CANBUS

#####################################################################
#   Additional Sensors
#####################################################################

[thermistor CMFB103F3950FANT]
temperature1: 0.0
resistance1: 32116.0
temperature2: 40.0
resistance2: 5309.0
temperature3: 80.0
resistance3: 1228.0

#[temperature_sensor sb_ambient_temp]
## Chamber Temperature - T1
#sensor_type: CMFB103F3950FANT
#sensor_pin: PF5
#min_temp: 0
#max_temp: 100
#gcode_id: chamber_th

[temperature_sensor back_chamber_temp]
## Chamber Temperature - T
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF6
min_temp: 0
max_temp: 100
gcode_id: chamber_th2

[temperature_sensor RPi4]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################

#[safe_z_home]
##  XY Location of the Z Endstop Switch
##  Update -10,-10 to the XY coordinates of your endstop pin 
##  (such as 157,305) after going through Z Endstop Pin
##  Location Definition step.
#home_xy_position: 147,256
#speed:100
#z_hop:10
#z_hop_speed:10


########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.889
#*# pid_ki = 0.964
#*# pid_kd = 412.851
#*#
#*# [probe]
#*# z_offset = -1.270
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	-0.030022, -0.005524, 0.003167, -0.007252, -0.010553, -0.005449, -0.013118, -0.000669, -0.009502, 0.000150, -0.006617, 0.001259, -0.021731, -0.007295, -0.004246, -0.004717
#*# 	0.001884, -0.003970, -0.005918, -0.000136, 0.004914, -0.002706, -0.001042, 0.003681, -0.000138, -0.003261, -0.002599, -0.000923, 0.002018, -0.000378, 0.010712, -0.002343
#*# 	-0.001251, -0.005052, -0.004622, -0.005957, 0.007457, -0.001495, -0.003588, -0.007594, 0.018303, -0.011118, 0.019455, -0.005522, 0.000512, -0.006046, 0.001882, 0.001739
#*# 	-0.011272, -0.008379, -0.014359, -0.008600, -0.004473, -0.009048, -0.011147, 0.002138, -0.019760, -0.010769, -0.015103, -0.011173, -0.011911, -0.011675, -0.002113, -0.007158
#*# 	-0.016884, -0.010487, -0.010377, -0.027000, -0.010307, -0.016095, -0.016059, -0.015779, -0.008233, -0.013943, -0.011272, -0.026153, -0.013655, -0.015248, -0.012163, -0.011753
#*# 	-0.017017, -0.017314, -0.016658, -0.012361, -0.009821, -0.011434, -0.018476, -0.008527, -0.010914, -0.012929, -0.015928, -0.007305, -0.016790, 0.004431, -0.007349, -0.001545
#*# 	-0.011862, -0.006459, -0.009579, -0.008609, -0.017186, 0.014329, 0.004567, -0.009139, -0.007756, -0.005202, -0.004088, -0.004044, 0.002237, 0.002046, -0.001228, 0.014902
#*# 	-0.010876, 0.002826, -0.016405, -0.006140, -0.004717, -0.006013, -0.000270, -0.004756, -0.003264, -0.001729, 0.001141, -0.001237, 0.003885, 0.008019, 0.009627, 0.010832
#*# 	-0.021632, -0.009417, -0.004290, -0.010675, -0.009867, -0.010414, -0.010089, 0.000462, -0.002285, -0.000819, 0.000030, -0.001711, 0.005156, 0.009520, 0.007225, 0.006749
#*# 	-0.016073, -0.005592, 0.001384, -0.005763, -0.003518, -0.003755, -0.007195, 0.005660, 0.000770, 0.009327, 0.006722, 0.004890, 0.011205, 0.013337, 0.009734, 0.011003
#*# 	-0.003761, -0.003881, -0.005119, -0.006166, 0.001005, 0.007169, 0.001863, 0.009381, 0.013341, 0.012241, 0.013262, 0.011571, 0.012734, 0.012605, 0.015514, 0.014004
#*# 	-0.010545, -0.004504, -0.002119, 0.001369, 0.000288, 0.002079, 0.000701, 0.010156, 0.009195, 0.012276, 0.012008, 0.014179, 0.013720, 0.016822, 0.014702, 0.014733
#*# 	0.003904, -0.005811, -0.003375, 0.001617, 0.010561, 0.003319, 0.010265, 0.008855, 0.014084, 0.008963, 0.014045, 0.018642, 0.013835, 0.010559, 0.020309, 0.023913
#*# 	-0.005982, 0.002777, 0.005749, 0.007083, 0.010745, 0.011922, 0.010522, 0.013914, 0.013449, 0.018232, 0.012734, 0.013018, 0.031631, 0.020391, 0.027479, 0.026611
#*# 	0.000703, 0.002810, 0.005748, 0.013263, 0.009712, 0.012977, 0.014837, 0.016682, 0.015158, 0.018264, 0.024846, 0.034435, 0.023650, 0.028783, 0.033138, 0.038680
#*# 	0.010386, 0.014627, 0.012060, 0.013022, 0.014578, 0.017557, 0.019587, 0.014875, 0.016335, 0.026279, 0.029950, 0.026854, 0.031477, 0.037761, 0.037669, 0.041723
#*# 	0.000518, 0.004297, 0.007231, 0.012220, 0.010371, 0.013372, 0.011669, 0.022996, 0.023905, 0.022851, 0.032774, 0.039494, 0.039210, 0.040335, 0.042665, 0.044297
#*# 	0.011437, 0.012067, 0.012462, 0.012641, 0.009966, 0.014385, 0.018865, 0.017767, 0.023769, 0.023405, 0.036474, 0.043037, 0.035961, 0.041304, 0.045879, 0.050498
#*# 	0.011809, 0.009048, 0.013100, 0.012613, 0.014991, 0.019102, 0.022591, 0.023152, 0.024491, 0.025752, 0.033032, 0.039757, 0.039494, 0.039802, 0.042239, 0.040760
#*# 	0.000801, -0.000583, 0.012620, 0.010175, 0.011908, 0.011698, 0.018063, 0.014369, 0.024289, 0.025850, 0.023022, 0.030471, 0.026667, 0.037568, 0.046291, 0.042186
#*# 	0.002921, 0.004512, 0.002420, 0.009240, 0.010808, 0.014601, 0.015182, 0.019966, 0.020206, 0.029647, 0.023316, 0.035552, 0.038004, 0.038220, 0.039226, 0.040501
#*# 	-0.006514, 0.008433, 0.012590, 0.011845, 0.012884, 0.012574, 0.022504, 0.020323, 0.036287, 0.022001, 0.031734, 0.039231, 0.035562, 0.040653, 0.038874, 0.039074
#*# 	0.011446, 0.014029, 0.011753, 0.015646, 0.014043, 0.019903, 0.025441, 0.033810, 0.038765, 0.038766, 0.037260, 0.039297, 0.039703, 0.040009, 0.040207, 0.040844
#*# 	0.013688, 0.012400, 0.013544, 0.016524, 0.018433, 0.019346, 0.030631, 0.017928, 0.035346, 0.036831, 0.038004, 0.038126, 0.034872, 0.039319, 0.040192, 0.040768
#*# 	0.006625, 0.012755, 0.009956, 0.009054, 0.010281, 0.013344, 0.016965, 0.018227, 0.019968, 0.025763, 0.023532, 0.023952, 0.024710, 0.028075, 0.030203, 0.038671
#*# x_count = 16
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 68.0
#*# max_x = 178.0
#*# min_y = 33.0
#*# max_y = 210.0
#*#
#*# [beacon model default]
#*# model_coef = 1.934243930597146,
#*# 	  2.206808199797723,
#*# 	  0.6436025413836176,
#*# 	  0.3095345837351202,
#*# 	  -0.15977813582327796,
#*# 	  -0.5908394974077775,
#*# 	  0.4266719892497021,
#*# 	  1.046422592108256,
#*# 	  -0.23184944767066623,
#*# 	  -0.5507144312738391
#*# model_domain = 3.353607345856729e-07,3.361070372275538e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 79.449632
#*# model_offset = 0.00000
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 77.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 51.6
