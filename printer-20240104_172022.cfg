[include moonraker_obico_macros.cfg]
##########################
##### BASE CONFIG #######
##########################

[include mainsail.cfg]
[include ./backup/backup.cfg]

##########################
##### HARDWARE STUFF #####
##########################

[include ./hardware/xyz-stepper.cfg]
[include ./hardware/extruder.cfg]
#[include ./klicky/klicky-probe.cfg]
#[include ./hardware/adxl345.cfg]  This config now in canbus.cfg
[include ./hardware/fans.cfg] # Some fans config in canbus.cfg
[include ./hardware/canbus.cfg]

##########################
##### LIGHTS #############
##########################

[include ./hardware/chamber-lighting.cfg]
[include ./hardware/stealthburner-led.cfg]

##########################
##### CALIBRATION ########
##########################

[include ./calibration/z-tilt.cfg]
[include ./calibration/bed-mesh.cfg]
[include ./macros/unsafe.cfg]
[include ./calibration/pressure_advance.cfg]
[include ./calibration/test_speed.cfg]
[include ./calibration/pika.cfg]
[include ./calibration/microadjust.cfg]
[include test_probe_accuracy.cfg]

##########################
##### MACROS #############
##########################

[include ./macros/chamber-led.cfg]
[include ./macros/conditional-homing.cfg]
[include ./macros/print-end.cfg]
[include ./macros/print-start-mmu.cfg]
[include ./macros/dump-variables.cfg]
[include ./macros/movement-check.cfg]
[include ./macros/cancel-change.cfg]
[include ./macros/pause-resume.cfg]         ; Overridden by ERCF / subsequantly disabled
[include ./macros/load-unload.cfg]
[include ./macros/filament-change.cfg]
[include ./macros/park.cfg]
[include ./macros/heatsoak.cfg]

##########################
##### THIRD PARTY ########
##########################

#[include ./third-party-cfg/nozzle_scrub.cfg]
[include KAMP_Settings.cfg]

##########################
##### ERCF ###############
##########################

[include mmu/base/*.cfg]
[include macros/mmu_adds.cfg]
[include mmu/optional/mmu_ercf_cutter.cfg]

##########################
##### LCD/MENU ###########
##########################

#[include ./third-party-cfg/nozzle_scrub_menu.cfg]
#[include ./menu/printer_menu.cfg]

##########################
##### NOT ENABLED YET ####
##########################

#[include ./todo/mini12864.cfg] Add this after adding mini12864 LED
#[include ./todo/lcd_tweaks.cfg] Need to figure this one out and then implement
#[include ./hardware/nevermore.cfg] Disabled as I prefer to chamber vent outside and needed the PWM

##########################
#### REPLACEMENT #########
##########################

[include ./replacement_macros/replace-m900.cfg]
[include ./replacement_macros/replace-m117.cfg]

[exclude_object]

[gcode_arcs]
resolution: 0.1

[respond]
default_type: echo
default_prefix:  

[force_move]
# Enable commands that force potentially unsafe movement
enable_force_move: True

[idle_timeout]
timeout: 14400

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_290040000750314D35323820-if00
restart_method: command

[mcu rpi]
# Add Rpi as secondary MCU to allow for ADXL use through SPI ribbon/adapter from LDO
serial: /tmp/klipper_host_mcu

[mcu sht]
canbus_uuid: 30993412e8e0

[printer]
kinematics: corexy
max_velocity: 200           # Changed from 200 on 7.11.23
max_accel:  6000            # tuned on 7.11.23 after beacon install.
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0 # Changed on 7.11.23

#####################################################################
#   Input Shaper
#####################################################################

[input_shaper]
#shaper_freq_x: 76.2               ; suggested max_accel <= 22600 mm/sec^2
#shaper_type_x: zv
#shaper_freq_y: 51.8               ; suggested max_accel <= 7900 mm/sec^2
#shaper_type_y: mzv


#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
heater_pin: PA2 #PA2 is LDO default
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 125
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  WAS TAP - NOW BEACON in CANBUS

#####################################################################
#   Additional Sensors
#####################################################################

[thermistor CMFB103F3950FANT]
temperature1: 0.0
resistance1: 32116.0
temperature2: 40.0
resistance2: 5309.0
temperature3: 80.0
resistance3: 1228.0

#[temperature_sensor sb_ambient_temp]
## Chamber Temperature - T1
#sensor_type: CMFB103F3950FANT
#sensor_pin: PF5
#min_temp: 0
#max_temp: 100
#gcode_id: chamber_th

[temperature_sensor back_chamber_temp]
## Chamber Temperature - T
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF6
min_temp: 0
max_temp: 100
gcode_id: chamber_th2

[temperature_sensor RPi4]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################

#[safe_z_home]
##  XY Location of the Z Endstop Switch
##  Update -10,-10 to the XY coordinates of your endstop pin 
##  (such as 157,305) after going through Z Endstop Pin
##  Location Definition step.
#home_xy_position: 147,256
#speed:100
#z_hop:10
#z_hop_speed:10


########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.889
#*# pid_ki = 0.964
#*# pid_kd = 412.851
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.022632, -0.022771, -0.017689, -0.016385, 0.000418, -0.014604, -0.000873, -0.013454, 0.001447, 0.005544, -0.001304, 0.016297, 0.014838, 0.014700, 0.019739, 0.021270, 0.016174, 0.021809, 0.024902, 0.025199, 0.025031, 0.026207, 0.032123, 0.041671, 0.025547
#*# 	  -0.023499, -0.012347, -0.007986, -0.002363, -0.002873, 0.000376, -0.005681, 0.007793, 0.005465, 0.006614, -0.003263, 0.010582, 0.012286, 0.012357, 0.017559, 0.024157, 0.025076, 0.021961, 0.026403, 0.027756, 0.031766, 0.031811, 0.028308, 0.037407, 0.030149
#*# 	  -0.029373, -0.017075, -0.006934, 0.000016, -0.004273, -0.003851, 0.001905, 0.003226, -0.001498, 0.017757, -0.003745, 0.016042, 0.023282, 0.006966, 0.008975, 0.019016, 0.019582, 0.015706, 0.019109, 0.025502, 0.028139, 0.038113, 0.038529, 0.040599, 0.039113
#*# 	  -0.024002, -0.010481, -0.002200, -0.005246, 0.002787, -0.003680, -0.004988, 0.001676, 0.007120, 0.012374, 0.012268, 0.012662, 0.002719, 0.007485, 0.026277, 0.009269, 0.016844, 0.010179, 0.020068, 0.027646, 0.024089, 0.024405, 0.034495, 0.036114, 0.037373
#*# 	  -0.027029, -0.018354, -0.005013, -0.007155, -0.006159, -0.000367, -0.001246, -0.004928, -0.004494, -0.005972, -0.003757, 0.011170, 0.000754, 0.008548, -0.004500, 0.008317, 0.003574, 0.005282, 0.004002, 0.013923, 0.016183, 0.035687, 0.043233, 0.037801, 0.031412
#*# 	  -0.028701, -0.012544, -0.003335, -0.008630, -0.000214, -0.007679, -0.003579, -0.005010, -0.000674, 0.003502, -0.002356, -0.001354, 0.007282, 0.003708, 0.004228, 0.003040, 0.011614, 0.019219, 0.010131, 0.012096, 0.031294, 0.031449, 0.038362, 0.034262, 0.030817
#*# 	  -0.031720, -0.008367, -0.005329, -0.002068, -0.005317, 0.007210, -0.002446, 0.002446, 0.001585, -0.000443, 0.010253, 0.008100, -0.020423, 0.013510, 0.010450, 0.021770, 0.021324, 0.021493, 0.011773, 0.008889, 0.021586, 0.034941, 0.043805, 0.039367, 0.027216
#*# 	  -0.017949, -0.003483, 0.008276, 0.007661, 0.007315, 0.008638, 0.001545, 0.008739, 0.009612, 0.003866, 0.009830, 0.004153, 0.004807, 0.011358, 0.017778, 0.011091, 0.010931, 0.023889, 0.013009, 0.012860, 0.032522, 0.036551, 0.037820, 0.043387, 0.033066
#*# 	  -0.014267, -0.009192, -0.002922, 0.002541, -0.002335, 0.007485, -0.000877, 0.000619, 0.003784, -0.003961, 0.000832, 0.004915, 0.006563, 0.007510, -0.004025, 0.028117, 0.012859, 0.025768, 0.011801, 0.014768, 0.013085, 0.031239, 0.024533, 0.034867, 0.021094
#*# 	  -0.014345, -0.010816, -0.003367, -0.001226, -0.002466, -0.000227, 0.005548, 0.005741, 0.002837, -0.010175, 0.001662, 0.004355, 0.005633, 0.001594, 0.007531, 0.016058, 0.000782, 0.010110, 0.006982, 0.027635, 0.018395, 0.023581, 0.032944, 0.034112, 0.016109
#*# 	  -0.025366, -0.008042, -0.001573, -0.000031, -0.002197, 0.001501, 0.002704, 0.000073, -0.005001, -0.007537, 0.000601, -0.005779, 0.002471, 0.008697, 0.001054, 0.002170, 0.004784, 0.003225, 0.013961, 0.011206, 0.016228, 0.024204, 0.025447, 0.030014, 0.027599
#*# 	  -0.014068, -0.001708, 0.002379, 0.000255, -0.010090, -0.004792, 0.004139, 0.001512, 0.001903, 0.002809, 0.005215, 0.001517, 0.003895, 0.003033, 0.006867, 0.014010, 0.026317, 0.023097, 0.005317, 0.006981, 0.027284, 0.021984, 0.026496, 0.026027, 0.021992
#*# 	  -0.018981, -0.002219, -0.003515, -0.006302, -0.001556, 0.002432, 0.001637, 0.001867, 0.005730, -0.002379, 0.006144, 0.001376, 0.013793, 0.006153, 0.005512, 0.027386, 0.002812, 0.005117, 0.002291, 0.028609, 0.015583, 0.019847, 0.029781, 0.033431, 0.017339
#*# 	  -0.013621, -0.004111, -0.002359, 0.007637, 0.008478, 0.007352, 0.005094, 0.000990, 0.006268, 0.003155, 0.006866, 0.002723, 0.006342, 0.018306, 0.015899, 0.007199, 0.026957, 0.008370, 0.007622, 0.018930, 0.033660, 0.030434, 0.032389, 0.031691, 0.007792
#*# 	  -0.014758, -0.008857, 0.004353, 0.002863, -0.002670, 0.001284, -0.001264, 0.006527, -0.000550, 0.008419, 0.005591, 0.000265, 0.005162, 0.017636, 0.009465, 0.018698, 0.018066, 0.021935, 0.011598, 0.015067, 0.025279, 0.034800, 0.030480, 0.030289, 0.029795
#*# 	  -0.018802, -0.011939, 0.002904, 0.006162, -0.003944, 0.006153, 0.009936, 0.006329, -0.002823, 0.000192, 0.002575, 0.015141, 0.006333, 0.010666, 0.016562, 0.012330, 0.013740, 0.025672, 0.031044, 0.026577, 0.031701, 0.030531, 0.035596, 0.036231, 0.028253
#*# 	  -0.013527, 0.005228, 0.007293, -0.001015, 0.007422, 0.008547, 0.007996, -0.009621, 0.007237, -0.005880, 0.006677, 0.000106, 0.004690, 0.017428, 0.012682, 0.023936, 0.027680, 0.024667, 0.024287, 0.029617, 0.033532, 0.032839, 0.043880, 0.041333, 0.026414
#*# 	  -0.009663, -0.000727, 0.002687, 0.003421, 0.004137, 0.007363, -0.000878, 0.003832, 0.006592, 0.006133, 0.001366, 0.015989, 0.007913, 0.013095, 0.018591, 0.016537, 0.019355, 0.022506, 0.027646, 0.029292, 0.029090, 0.033977, 0.043038, 0.033265, 0.036269
#*# 	  -0.011206, -0.004341, 0.005092, 0.004462, 0.003909, 0.005678, -0.001692, -0.001544, 0.006910, -0.001523, -0.007008, 0.003980, 0.003890, 0.009361, 0.017618, 0.022418, 0.015137, 0.022461, 0.021024, 0.026152, 0.029967, 0.030025, 0.035642, 0.033121, 0.027806
#*# 	  -0.019672, -0.014742, 0.001360, -0.008869, -0.014260, -0.008790, -0.015562, -0.008644, -0.004127, -0.016200, -0.005717, -0.009931, 0.008945, 0.008540, 0.010465, 0.013774, 0.014499, 0.015155, 0.021042, 0.022564, 0.028514, 0.024763, 0.026881, 0.033203, 0.032964
#*# 	  -0.024742, -0.014484, -0.014879, -0.002180, -0.009871, -0.014361, -0.010909, -0.015936, -0.013282, -0.010574, -0.018379, -0.007492, -0.012790, -0.013235, 0.007174, 0.010038, 0.009806, 0.012024, 0.012333, 0.015565, 0.025182, 0.025861, 0.028950, 0.023015, 0.020651
#*# 	  -0.025453, -0.011959, -0.015607, -0.014154, -0.011957, -0.015652, -0.011122, -0.007966, -0.018994, -0.008367, -0.007190, 0.002453, -0.000583, -0.004691, -0.008666, 0.014972, 0.012402, 0.017807, 0.013417, 0.019612, 0.020458, 0.023642, 0.020616, 0.017467, 0.013498
#*# 	  -0.013253, -0.012150, -0.007415, -0.005255, -0.016969, -0.003891, -0.006301, -0.009782, -0.001137, -0.007282, -0.009654, -0.003072, -0.006274, 0.000630, -0.013549, 0.005734, 0.011589, 0.014818, 0.011659, 0.015524, 0.016063, 0.021725, 0.018839, 0.031418, 0.011457
#*# 	  -0.004228, 0.003557, -0.002269, -0.003634, -0.007195, -0.007598, -0.004837, -0.004563, -0.003268, -0.001823, -0.001519, -0.008024, 0.001801, -0.006111, 0.013553, -0.001458, 0.006431, 0.017454, 0.008239, 0.015656, 0.014256, 0.018124, 0.017646, 0.017706, 0.013429
#*# 	  -0.026423, -0.015410, -0.006385, -0.018523, -0.016368, -0.009038, -0.018643, -0.018276, -0.013878, -0.015724, -0.016865, -0.016947, -0.020214, -0.017455, -0.015931, -0.003043, -0.008297, -0.000596, -0.007421, 0.003534, -0.007295, 0.004453, -0.003810, 0.002347, -0.011607
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 210.0
#*# min_y = 30.0
#*# max_y = 208.0
#*#
#*# [beacon model default]
#*# model_coef = 1.9986101587394336,
#*# 	  2.2330294655815703,
#*# 	  0.5683538419617058,
#*# 	  0.27303609554992636,
#*# 	  -0.13052055779098906,
#*# 	  -0.5026341317225997,
#*# 	  0.33763613969702233,
#*# 	  0.8024061151415637,
#*# 	  -0.15799795308980943,
#*# 	  -0.378283680492853
#*# model_domain = 3.356731262483608e-07,3.361668943651104e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 69.596304
#*# model_offset = -0.17000
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 77.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 51.6
#*#
#*# [beacon model pei_hot]
#*# model_coef = 1.9263519575030055,
#*# 	2.1946743347503372,
#*# 	0.6208794249910773,
#*# 	0.2775896555222557,
#*# 	0.06526221562750463,
#*# 	-0.2611119885640586,
#*# 	-0.05461829170887029,
#*# 	0.36810740679885895,
#*# 	0.05685001457152785,
#*# 	-0.15547240310186372
#*# model_domain = 3.351987055417817e-07,3.359664588035842e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 63.925584
#*# model_offset = 0.00000
