##########################
##### BASE CONFIG #######
##########################

[include mainsail.cfg]
[include ./backup/backup.cfg]

##########################
##### HARDWARE STUFF #####
##########################

[include ./hardware/xyz-stepper.cfg]
[include ./hardware/extruder.cfg]
#[include ./klicky/klicky-probe.cfg]
#[include ./hardware/adxl345.cfg]  This config now in canbus.cfg
[include ./hardware/fans.cfg] # Some fans config in canbus.cfg
[include ./hardware/canbus.cfg]

##########################
##### LIGHTS #############
##########################

[include ./hardware/chamber-lighting.cfg]
[include ./hardware/stealthburner-led.cfg]

##########################
##### CALIBRATION ########
##########################

[include ./calibration/z-tilt.cfg]
[include ./calibration/bed-mesh.cfg]
[include ./macros/unsafe.cfg]
[include ./calibration/pressure_advance.cfg]
[include ./calibration/test_speed.cfg]
[include ./calibration/pika.cfg]
[include test_probe_accuracy.cfg]

##########################
##### MACROS #############
##########################

[include ./macros/chamber-led.cfg]
[include ./macros/conditional-homing.cfg]
[include ./macros/print-end.cfg]
[include ./macros/print-start-mmu.cfg]
[include ./macros/dump-variables.cfg]
[include ./macros/movement-check.cfg]
[include ./macros/cancel-change.cfg]
[include ./macros/pause-resume.cfg]         ; Overridden by ERCF / subsequantly disabled
[include ./macros/load-unload.cfg]
[include ./macros/filament-change.cfg]
[include ./macros/park.cfg]
#[include ./macros/prusaslicer-accel.cfg]

##########################
##### THIRD PARTY ########
##########################

#[include ./third-party-cfg/nozzle_scrub.cfg]
[include KAMP_Settings.cfg]

##########################
##### ERCF ###############
##########################

[include mmu/base/*.cfg]
[include macros/mmu_adds.cfg]



##########################
##### LCD/MENU ###########
##########################

#[include ./third-party-cfg/nozzle_scrub_menu.cfg]
#[include ./menu/printer_menu.cfg]

##########################
##### NOT ENABLED YET ####
##########################

#[include ./todo/mini12864.cfg] Add this after adding mini12864 LED
#[include ./todo/lcd_tweaks.cfg] Need to figure this one out and then implement
#[include ./hardware/nevermore.cfg] Disabled as I prefer to chamber vent outside and needed the PWM

##########################
#### REPLACEMENT #########
##########################

[include ./replacement_macros/replace-m900.cfg]
[include ./replacement_macros/replace-m117.cfg]

[exclude_object]

[gcode_arcs]
resolution: 0.1

[respond]
default_type: echo
default_prefix:  

[force_move]
# Enable commands that force potentially unsafe movement
enable_force_move: True

[idle_timeout]
timeout: 14400

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_290040000750314D35323820-if00
restart_method: command

[mcu rpi]
# Add Rpi as secondary MCU to allow for ADXL use through SPI ribbon/adapter from LDO
serial: /tmp/klipper_host_mcu

[mcu sht]
canbus_uuid: 30993412e8e0

[printer]
kinematics: corexy
max_velocity: 200           # Changed from 200 on 7.11.23
max_accel:  6000            # tuned on 7.11.23 after beacon install.
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0 # Changed on 7.11.23

#####################################################################
#   Input Shaper
#####################################################################

[input_shaper]
#shaper_freq_x: 76.2               ; suggested max_accel <= 22600 mm/sec^2
#shaper_type_x: zv
#shaper_freq_y: 51.8               ; suggested max_accel <= 7900 mm/sec^2
#shaper_type_y: mzv


#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
heater_pin: PA2 #PA2 is LDO default
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 125
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  WAS TAP - NOW BEACON in CANBUS

#####################################################################
#   Additional Sensors
#####################################################################

[thermistor CMFB103F3950FANT]
temperature1: 0.0
resistance1: 32116.0
temperature2: 40.0
resistance2: 5309.0
temperature3: 80.0
resistance3: 1228.0

#[temperature_sensor sb_ambient_temp]
## Chamber Temperature - T1
#sensor_type: CMFB103F3950FANT
#sensor_pin: PF5
#min_temp: 0
#max_temp: 100
#gcode_id: chamber_th

[temperature_sensor back_chamber_temp]
## Chamber Temperature - T
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF6
min_temp: 0
max_temp: 100
gcode_id: chamber_th2

[temperature_sensor RPi4]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################

#[safe_z_home]
##  XY Location of the Z Endstop Switch
##  Update -10,-10 to the XY coordinates of your endstop pin 
##  (such as 157,305) after going through Z Endstop Pin
##  Location Definition step.
#home_xy_position: 147,256
#speed:100
#z_hop:10
#z_hop_speed:10


########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.889
#*# pid_ki = 0.964
#*# pid_kd = 412.851
#*#
#*# [probe]
#*# z_offset = -1.270
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.075688, -0.061468, -0.055961, -0.054421, -0.049781, -0.054927, -0.054680, -0.051821, -0.050225, -0.045190, -0.051441, -0.054571, -0.051705, -0.055553, -0.054558, -0.058002, -0.062167, -0.063305, -0.061250, -0.062000, -0.065825, -0.059825, -0.061321, -0.060412, -0.062399
#*# 	  -0.068563, -0.050396, -0.046340, -0.048318, -0.046433, -0.045169, -0.045210, -0.044225, -0.037335, -0.041190, -0.041742, -0.041935, -0.045927, -0.046399, -0.045999, -0.046011, -0.046529, -0.058645, -0.045347, -0.053430, -0.047403, -0.049785, -0.050335, -0.042945, -0.053527
#*# 	  -0.054885, -0.046768, -0.047738, -0.047104, -0.043053, -0.044393, -0.043300, -0.037030, -0.038855, -0.036500, -0.041608, -0.034739, -0.035482, -0.033178, -0.043519, -0.042641, -0.046054, -0.045103, -0.043357, -0.046041, -0.043709, -0.056275, -0.046492, -0.044310, -0.049953
#*# 	  -0.062737, -0.050671, -0.046927, -0.045154, -0.039805, -0.045625, -0.045232, -0.042095, -0.028382, -0.025886, -0.035195, -0.036550, -0.041888, -0.031835, -0.044799, -0.043685, -0.042034, -0.043710, -0.044503, -0.041830, -0.043238, -0.043278, -0.044658, -0.044753, -0.045676
#*# 	  -0.062717, -0.059000, -0.049920, -0.047771, -0.044133, -0.044178, -0.042626, -0.040577, -0.026530, -0.027968, -0.027972, -0.036165, -0.035705, -0.027642, -0.039027, -0.040336, -0.042701, -0.044815, -0.044575, -0.040684, -0.041512, -0.035180, -0.038164, -0.040708, -0.048834
#*# 	  -0.057091, -0.056182, -0.054540, -0.051113, -0.048928, -0.039781, -0.033025, -0.029355, -0.030898, -0.026887, -0.024098, -0.024283, -0.026171, -0.025069, -0.026566, -0.033300, -0.036517, -0.038791, -0.038304, -0.035857, -0.035930, -0.036880, -0.035535, -0.040843, -0.049813
#*# 	  -0.058619, -0.063606, -0.056121, -0.055293, -0.052771, -0.043489, -0.036815, -0.031253, -0.027763, -0.027791, -0.025371, -0.027811, -0.025024, -0.029564, -0.033829, -0.036792, -0.033508, -0.032107, -0.036258, -0.031669, -0.033433, -0.032318, -0.036663, -0.033940, -0.040904
#*# 	  -0.054854, -0.053774, -0.047889, -0.051060, -0.047021, -0.037808, -0.035291, -0.030659, -0.030809, -0.027864, -0.026010, -0.028169, -0.032376, -0.032253, -0.030865, -0.031130, -0.031160, -0.034033, -0.032359, -0.033696, -0.034103, -0.031597, -0.033944, -0.044451, -0.034568
#*# 	  -0.056019, -0.050457, -0.040645, -0.040800, -0.040040, -0.037315, -0.034450, -0.032758, -0.029744, -0.031965, -0.020516, -0.027717, -0.029689, -0.025426, -0.031572, -0.030724, -0.030457, -0.033115, -0.030008, -0.031371, -0.032693, -0.030372, -0.031977, -0.037493, -0.035690
#*# 	  -0.041606, -0.037221, -0.034832, -0.033763, -0.029089, -0.037269, -0.033074, -0.021307, -0.025619, -0.022510, -0.023797, -0.023993, -0.020632, -0.017714, -0.021125, -0.030217, -0.029789, -0.031969, -0.030376, -0.030795, -0.030951, -0.031937, -0.031097, -0.029698, -0.031076
#*# 	  -0.037664, -0.031543, -0.032830, -0.029835, -0.028813, -0.030706, -0.020512, -0.021196, -0.022647, -0.014925, -0.013289, -0.013055, -0.016492, -0.013370, -0.023859, -0.024461, -0.029418, -0.028187, -0.032693, -0.027036, -0.026995, -0.030176, -0.026259, -0.028175, -0.026617
#*# 	  -0.032722, -0.018353, -0.014072, -0.022632, -0.015456, -0.013584, -0.017651, -0.014767, -0.013905, -0.013734, -0.010412, -0.012716, -0.009631, -0.010240, -0.013922, -0.013957, -0.018054, -0.021826, -0.022957, -0.021818, -0.025490, -0.027139, -0.018956, -0.028094, -0.026919
#*# 	  -0.023287, -0.018985, -0.017078, -0.014891, -0.015006, -0.014987, -0.014177, -0.013009, -0.012123, -0.013723, -0.009830, -0.013665, -0.009711, -0.008041, -0.007634, -0.009983, -0.014809, -0.018108, -0.014749, -0.018713, -0.015238, -0.015610, -0.017889, -0.019829, -0.026227
#*# 	  -0.020135, -0.020663, -0.019993, -0.014912, -0.015066, -0.014336, -0.014634, -0.017762, -0.015017, -0.011584, -0.012013, -0.012509, -0.011739, -0.012892, -0.012096, -0.012429, -0.015196, -0.023644, -0.022567, -0.023692, -0.021953, -0.014325, -0.018977, -0.023297, -0.024197
#*# 	  -0.020515, -0.020922, -0.022848, -0.022047, -0.015905, -0.014174, -0.015774, -0.014583, -0.014253, -0.014680, -0.012923, -0.013287, -0.012753, -0.013266, -0.014220, -0.013771, -0.017427, -0.017747, -0.015302, -0.024152, -0.017205, -0.015531, -0.018248, -0.014201, -0.016012
#*# 	  -0.024895, -0.020192, -0.018501, -0.018148, -0.019766, -0.014184, -0.015640, -0.014878, -0.015578, -0.013484, -0.011779, -0.012662, -0.007063, -0.012173, -0.013196, -0.013260, -0.013310, -0.021612, -0.023982, -0.012567, -0.015870, -0.010407, -0.012123, -0.008498, -0.011374
#*# 	  -0.019511, -0.015761, -0.015824, -0.013497, -0.012841, -0.014578, -0.011944, -0.012802, -0.012094, -0.011794, -0.008818, -0.010363, -0.009768, -0.004725, -0.010611, -0.012231, -0.007743, -0.011163, -0.010395, -0.010944, -0.006682, -0.008397, -0.005602, -0.002036, -0.005466
#*# 	  -0.016880, -0.017043, -0.011658, -0.010788, -0.010214, -0.010493, -0.013158, -0.011350, -0.012130, -0.013930, -0.006779, -0.005565, -0.005066, -0.009701, -0.006101, -0.009809, -0.009013, -0.011869, -0.009168, -0.003968, -0.001206, -0.015017, 0.007782, -0.013692, 0.004737
#*# 	  -0.014685, -0.010655, -0.011776, -0.013415, -0.011242, -0.012643, -0.015642, -0.011074, -0.006811, -0.007859, -0.005702, -0.007436, -0.002639, -0.005148, -0.009807, -0.006637, -0.004867, -0.011955, -0.004688, -0.002781, 0.001213, 0.000278, -0.003199, 0.000293, -0.002106
#*# 	  -0.024390, -0.021482, -0.019160, -0.014221, -0.017924, -0.017072, -0.014701, -0.015007, -0.015107, -0.016759, -0.014199, -0.011839, -0.009834, -0.011249, -0.010147, -0.011260, -0.010660, -0.010443, -0.011626, -0.013411, -0.006311, -0.004030, -0.016966, -0.008856, -0.007769
#*# 	  -0.023833, -0.022309, -0.021319, -0.019969, -0.013368, -0.019427, -0.019776, -0.019045, -0.013650, -0.015049, -0.017017, -0.016025, -0.015756, -0.015637, -0.011157, -0.013199, -0.013225, -0.012485, -0.015160, -0.012516, -0.012319, -0.009364, -0.004908, -0.008631, -0.013638
#*# 	  -0.027208, -0.022793, -0.023597, -0.022061, -0.021451, -0.022310, -0.021738, -0.021178, -0.018945, -0.017760, -0.016645, -0.017444, -0.018790, -0.017784, -0.018986, -0.017736, -0.016076, -0.014972, -0.013939, -0.016421, -0.014189, -0.014096, -0.010299, -0.009874, -0.012926
#*# 	  -0.032007, -0.026666, -0.023434, -0.025253, -0.021290, -0.015877, -0.018755, -0.023330, -0.022146, -0.020098, -0.019468, -0.021877, -0.019112, -0.019891, -0.017410, -0.017274, -0.020685, -0.021506, -0.023523, -0.022741, -0.021482, -0.017580, -0.015752, -0.011144, -0.015634
#*# 	  -0.024633, -0.022571, -0.023734, -0.025204, -0.022544, -0.022450, -0.023307, -0.022957, -0.023242, -0.024262, -0.024561, -0.023380, -0.023024, -0.023214, -0.024871, -0.023972, -0.024069, -0.023195, -0.023696, -0.023887, -0.022293, -0.022071, -0.022393, -0.022756, -0.019367
#*# 	  -0.036754, -0.031442, -0.026104, -0.023384, -0.025647, -0.024843, -0.026558, -0.030556, -0.025234, -0.043288, -0.043705, -0.025040, -0.023035, -0.027017, -0.044077, -0.034120, -0.035065, -0.028090, -0.027505, -0.038550, -0.023646, -0.043675, -0.023253, -0.029799, -0.024068
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 210.0
#*# min_y = 30.0
#*# max_y = 210.0
#*#
#*# [beacon model default]
#*# model_coef = 1.9257982386737142,
#*# 	  2.1904011986275074,
#*# 	  0.5881661108028357,
#*# 	  0.30341866940870527,
#*# 	  0.14823890288711727,
#*# 	  -0.42807822476666274,
#*# 	  -0.13716254071061182,
#*# 	  0.612855529187592,
#*# 	  0.08376843001203003,
#*# 	  -0.2664564217100284
#*# model_domain = 3.352922478536077e-07,3.360945745364866e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 72.578002
#*# model_offset = -0.12500
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 77.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 51.6
