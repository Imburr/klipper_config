[include moonraker_obico_macros.cfg]
##########################
##### BASE CONFIG #######
##########################

[include mainsail.cfg]
[include ./backup/backup.cfg]

##########################
##### HARDWARE STUFF #####
##########################

[include ./hardware/xyz-stepper.cfg]
[include ./hardware/extruder.cfg]
#[include ./klicky/klicky-probe.cfg]
#[include ./hardware/adxl345.cfg]  This config now in canbus.cfg
[include ./hardware/fans.cfg] # Some fans config in canbus.cfg
[include ./hardware/canbus.cfg]

##########################
##### LIGHTS #############
##########################

[include ./hardware/chamber-lighting.cfg]
[include ./hardware/stealthburner-led.cfg]

##########################
##### CALIBRATION ########
##########################

[include ./calibration/z-tilt.cfg]
[include ./calibration/bed-mesh.cfg]
[include ./macros/unsafe.cfg]
[include ./calibration/pressure_advance.cfg]
[include ./calibration/test_speed.cfg]
[include ./calibration/pika.cfg]
[include ./calibration/microadjust.cfg]
[include ./calibration/sensorless.cfg]
[include test_probe_accuracy.cfg]

##########################
##### MACROS #############
##########################

[include ./macros/chamber-led.cfg]
[include ./macros/conditional-homing.cfg]
[include ./macros/print-end.cfg]
[include ./macros/print-start-mmu.cfg]
[include ./macros/dump-variables.cfg]
[include ./macros/movement-check.cfg]
[include ./macros/cancel-change.cfg]
[include ./macros/pause-resume.cfg]         ; Overridden by ERCF / subsequantly disabled
[include ./macros/load-unload.cfg]
[include ./macros/filament-change.cfg]
[include ./macros/park.cfg]
[include ./macros/heatsoak.cfg]

##########################
##### THIRD PARTY ########
##########################

#[include ./third-party-cfg/nozzle_scrub.cfg]
[include KAMP_Settings.cfg]

##########################
##### ERCF ###############
##########################

[include mmu/base/*.cfg]
[include macros/mmu_adds.cfg]
[include mmu/optional/mmu_ercf_cutter.cfg]

##########################
##### LCD/MENU ###########
##########################

#[include ./third-party-cfg/nozzle_scrub_menu.cfg]
#[include ./menu/printer_menu.cfg]

##########################
##### NOT ENABLED YET ####
##########################

#[include ./todo/mini12864.cfg] Add this after adding mini12864 LED
#[include ./todo/lcd_tweaks.cfg] Need to figure this one out and then implement
#[include ./hardware/nevermore.cfg] Disabled as I prefer to chamber vent outside and needed the PWM

##########################
#### REPLACEMENT #########
##########################

[include ./replacement_macros/replace-m900.cfg]
[include ./replacement_macros/replace-m117.cfg]

[exclude_object]

[gcode_arcs]
resolution: 0.1

[respond]
default_type: echo
default_prefix:  

[force_move]
# Enable commands that force potentially unsafe movement
enable_force_move: True

[idle_timeout]
timeout: 14400

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_290040000750314D35323820-if00
restart_method: command

[mcu rpi]
# Add Rpi as secondary MCU to allow for ADXL use through SPI ribbon/adapter from LDO
serial: /tmp/klipper_host_mcu

[mcu sht]
canbus_uuid: 30993412e8e0

[printer]
kinematics: corexy
max_velocity: 250           # Changed from 200 on 7.11.23
max_accel: 8000             # tuned on 7.11.23 after beacon install.
max_accel_to_decel: 3000
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0 # Changed on 7.11.23

#####################################################################
#   Input Shaper
#####################################################################

[input_shaper]
#shaper_freq_x: 76.2               ; suggested max_accel <= 22600 mm/sec^2
#shaper_type_x: zv
#shaper_freq_y: 51.8               ; suggested max_accel <= 7900 mm/sec^2
#shaper_type_y: mzv

#####################################################################
#   AutoTune / https://github.com/andrewmcgr/klipper_tmc_autotune
#####################################################################

#[motor_constants ldo-42sth48-2004mah_vrn]
#resistance: 1.45
#inductance: 0.002
#holding_torque: 0.40
#max_current: 2.0
#steps_per_revolution: 400

#[autotune_tmc stepper_x]
#motor: ldo-42sth48-2004mah_vrn
#sg4_thrs: 105
#tuning_goal: silent
#[autotune_tmc stepper_y]
#motor: ldo-42sth48-2004mah_vrn
#tuning_goal: silent

#[autotune_tmc stepper_z]
#motor: ldo-42sth40-1684l300e
#[autotune_tmc stepper_z1]
#motor: ldo-42sth40-1684l300e
#[autotune_tmc stepper_z2]
#motor: ldo-42sth40-1684l300e

#[autotune_tmc extruder]
#motor: moons-cse14hra1l410a

#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
heater_pin: PA2 #PA2 is LDO default
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 125
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  WAS TAP - NOW BEACON in CANBUS

#####################################################################
#   Additional Sensors
#####################################################################

[thermistor CMFB103F3950FANT]
temperature1: 0.0
resistance1: 32116.0
temperature2: 40.0
resistance2: 5309.0
temperature3: 80.0
resistance3: 1228.0

#[temperature_sensor sb_ambient_temp]
## Chamber Temperature - T1
#sensor_type: CMFB103F3950FANT
#sensor_pin: PF5
#min_temp: 0
#max_temp: 100
#gcode_id: chamber_th

[temperature_sensor back_chamber_temp]
## Chamber Temperature - T
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF6
min_temp: 0
max_temp: 100
gcode_id: chamber_th2

[temperature_sensor RPi4]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.889
#*# pid_ki = 0.964
#*# pid_kd = 412.851
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.047170, 0.045933, 0.041650, 0.035937, 0.030357, 0.024295, 0.020316, 0.021201, 0.025249, 0.030664, 0.029401, 0.022015, 0.016152, 0.011628, 0.005768, 0.001977, 0.005204, 0.002396, -0.003491, -0.008631, -0.010042, -0.013456, -0.016621, -0.014547, -0.000038
#*# 	  0.059304, 0.048287, 0.041104, 0.033249, 0.027094, 0.019502, 0.013962, 0.013330, 0.016593, 0.021628, 0.020639, 0.013973, 0.009412, 0.006442, 0.001789, -0.002321, -0.001691, -0.005079, -0.011241, -0.014974, -0.016243, -0.019788, -0.024473, -0.022552, -0.010997
#*# 	  0.061631, 0.048963, 0.040375, 0.030918, 0.023732, 0.015162, 0.007369, 0.004281, 0.006677, 0.009853, 0.009833, 0.004060, -0.000098, -0.003470, -0.007528, -0.011688, -0.011119, -0.014507, -0.019685, -0.021979, -0.021250, -0.025221, -0.030408, -0.030117, -0.021383
#*# 	  0.059756, 0.046052, 0.035768, 0.026087, 0.017679, 0.007875, -0.002045, -0.005425, -0.005310, -0.001549, -0.001922, -0.007524, -0.011289, -0.015196, -0.020052, -0.024207, -0.022663, -0.025720, -0.028740, -0.028971, -0.026776, -0.029117, -0.035007, -0.036377, -0.028803
#*# 	  0.052861, 0.037911, 0.029329, 0.020070, 0.012459, 0.002239, -0.007917, -0.012700, -0.012453, -0.009240, -0.010045, -0.015771, -0.019635, -0.024037, -0.028858, -0.034207, -0.032993, -0.033497, -0.037166, -0.035990, -0.031672, -0.033520, -0.039142, -0.041698, -0.035780
#*# 	  0.045353, 0.032105, 0.024128, 0.017065, 0.010401, 0.000050, -0.009519, -0.014129, -0.015012, -0.012483, -0.012563, -0.017648, -0.022395, -0.025779, -0.031523, -0.037147, -0.035547, -0.036730, -0.040122, -0.039168, -0.035175, -0.036251, -0.042338, -0.044957, -0.039463
#*# 	  0.037537, 0.025747, 0.020189, 0.014778, 0.009076, -0.001325, -0.009534, -0.013954, -0.015148, -0.012852, -0.013331, -0.017763, -0.020964, -0.024756, -0.030482, -0.035655, -0.035981, -0.038414, -0.041861, -0.041872, -0.038864, -0.040983, -0.045735, -0.046822, -0.041074
#*# 	  0.034322, 0.024658, 0.019734, 0.014715, 0.010210, 0.001346, -0.006017, -0.009733, -0.010997, -0.009848, -0.010838, -0.015451, -0.017203, -0.019846, -0.024225, -0.030206, -0.032637, -0.036617, -0.041907, -0.041946, -0.039688, -0.042115, -0.046273, -0.044893, -0.038679
#*# 	  0.031373, 0.022886, 0.019094, 0.013719, 0.008606, 0.001548, -0.004917, -0.007851, -0.008823, -0.008686, -0.010978, -0.016105, -0.017110, -0.018414, -0.021366, -0.028347, -0.031428, -0.037870, -0.044621, -0.045846, -0.043493, -0.045097, -0.047023, -0.045673, -0.039173
#*# 	  0.032061, 0.024193, 0.019855, 0.012673, 0.006939, 0.001000, -0.005557, -0.007778, -0.008860, -0.009074, -0.010536, -0.016009, -0.018188, -0.019514, -0.022309, -0.028521, -0.032378, -0.038746, -0.046524, -0.047829, -0.045213, -0.046097, -0.047566, -0.045335, -0.040569
#*# 	  0.037095, 0.027561, 0.022020, 0.014321, 0.007392, 0.000282, -0.006984, -0.009230, -0.009715, -0.008904, -0.009768, -0.014696, -0.017992, -0.019661, -0.024320, -0.030491, -0.032646, -0.039616, -0.046972, -0.048997, -0.046715, -0.046854, -0.047576, -0.046430, -0.040913
#*# 	  0.047291, 0.036288, 0.029461, 0.020719, 0.011551, 0.003882, -0.004346, -0.007438, -0.007724, -0.005131, -0.004520, -0.008969, -0.012120, -0.015397, -0.019702, -0.026935, -0.028611, -0.035276, -0.042881, -0.044666, -0.042702, -0.043891, -0.045499, -0.044294, -0.038311
#*# 	  0.053222, 0.043009, 0.035171, 0.026401, 0.016988, 0.007877, -0.000629, -0.003634, -0.003364, 0.000125, 0.001676, -0.001955, -0.004774, -0.009299, -0.014115, -0.021250, -0.024819, -0.030876, -0.038611, -0.041186, -0.038625, -0.040654, -0.042126, -0.040515, -0.034768
#*# 	  0.056923, 0.045746, 0.040366, 0.032323, 0.023107, 0.013616, 0.004221, 0.000816, 0.002247, 0.006374, 0.007617, 0.004955, 0.002168, -0.001395, -0.005671, -0.013879, -0.017905, -0.024453, -0.032364, -0.035329, -0.033404, -0.035244, -0.036610, -0.034817, -0.028790
#*# 	  0.058361, 0.049110, 0.043325, 0.036551, 0.027981, 0.016137, 0.007169, 0.004192, 0.004508, 0.008649, 0.011140, 0.007872, 0.005549, 0.002380, -0.002056, -0.009448, -0.012451, -0.019934, -0.027636, -0.030839, -0.029322, -0.031917, -0.032678, -0.029873, -0.022020
#*# 	  0.063121, 0.054433, 0.049421, 0.042588, 0.033205, 0.021981, 0.011036, 0.008016, 0.008975, 0.014466, 0.015436, 0.012024, 0.009939, 0.007186, 0.002677, -0.003431, -0.005545, -0.011160, -0.019051, -0.023212, -0.022585, -0.024608, -0.025419, -0.020355, -0.011202
#*# 	  0.068988, 0.060839, 0.056379, 0.049012, 0.039437, 0.028147, 0.017877, 0.014474, 0.015929, 0.019755, 0.021178, 0.018106, 0.015435, 0.012031, 0.008989, 0.004144, 0.004035, -0.000010, -0.008411, -0.012441, -0.013239, -0.014554, -0.013657, -0.007935, 0.002101
#*# 	  0.073967, 0.064898, 0.061753, 0.055402, 0.045533, 0.034776, 0.024925, 0.022532, 0.023118, 0.027079, 0.027639, 0.024210, 0.021473, 0.018628, 0.016463, 0.013479, 0.014115, 0.009962, 0.002080, -0.002310, -0.002343, -0.003722, -0.002387, 0.003819, 0.013263
#*# 	  0.075259, 0.067577, 0.064465, 0.058524, 0.050161, 0.039228, 0.030814, 0.027934, 0.028716, 0.032231, 0.032571, 0.028448, 0.025118, 0.023271, 0.022374, 0.020682, 0.022374, 0.018369, 0.010233, 0.006468, 0.007142, 0.006232, 0.007006, 0.012395, 0.019857
#*# 	  0.073027, 0.065115, 0.062553, 0.057476, 0.049451, 0.038647, 0.029612, 0.026627, 0.026393, 0.030584, 0.030829, 0.026604, 0.023608, 0.022079, 0.021732, 0.021223, 0.023796, 0.019999, 0.012395, 0.009689, 0.010237, 0.008896, 0.009058, 0.012379, 0.018680
#*# 	  0.072682, 0.064851, 0.061984, 0.056515, 0.047714, 0.037487, 0.028290, 0.024476, 0.024484, 0.028321, 0.029265, 0.024682, 0.021546, 0.020338, 0.020253, 0.019764, 0.022041, 0.019944, 0.013553, 0.011052, 0.012096, 0.010930, 0.010037, 0.012026, 0.017621
#*# 	  0.076723, 0.068153, 0.063430, 0.058531, 0.050734, 0.039875, 0.031366, 0.027071, 0.025841, 0.029422, 0.030157, 0.026067, 0.022749, 0.020570, 0.020152, 0.019072, 0.021785, 0.020604, 0.015626, 0.013349, 0.014124, 0.012408, 0.011468, 0.013697, 0.018395
#*# 	  0.083288, 0.074085, 0.068709, 0.063719, 0.055726, 0.046196, 0.037184, 0.032589, 0.032087, 0.034736, 0.034805, 0.029826, 0.027161, 0.024361, 0.023718, 0.022058, 0.025631, 0.024550, 0.019855, 0.017397, 0.019078, 0.016707, 0.016264, 0.019166, 0.023917
#*# 	  0.090718, 0.081579, 0.076536, 0.070670, 0.063911, 0.054348, 0.046441, 0.042214, 0.040333, 0.042954, 0.042058, 0.037567, 0.034321, 0.031229, 0.029488, 0.028222, 0.030974, 0.029764, 0.024539, 0.022512, 0.023391, 0.022615, 0.022329, 0.025440, 0.031817
#*# 	  0.095486, 0.087350, 0.083381, 0.078118, 0.070594, 0.060933, 0.052372, 0.048507, 0.046483, 0.048160, 0.048237, 0.042864, 0.039332, 0.036011, 0.034035, 0.031196, 0.033840, 0.031976, 0.026789, 0.024733, 0.026367, 0.024861, 0.023968, 0.027675, 0.034290
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 210.0
#*# min_y = 30.0
#*# max_y = 208.0
#*#
#*# [beacon model default]
#*# model_coef = 1.4613818954269993,
#*# 	  1.7756600472438397,
#*# 	  0.7384172744186067,
#*# 	  0.3398904593101075,
#*# 	  0.3899746104559005,
#*# 	  0.4162951819734925,
#*# 	  -0.2058487068481297,
#*# 	  -0.3393668279079826,
#*# 	  0.21620390616642218,
#*# 	  0.20874618374099485
#*# model_domain = 3.168808091292228e-07,3.3288555528608446e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 67.017932
#*# model_offset = -0.19000
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 77.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 51.6
#*#
#*# [beacon model pei_hot]
#*# model_coef = 1.9263519575030055,
#*# 	2.1946743347503372,
#*# 	0.6208794249910773,
#*# 	0.2775896555222557,
#*# 	0.06526221562750463,
#*# 	-0.2611119885640586,
#*# 	-0.05461829170887029,
#*# 	0.36810740679885895,
#*# 	0.05685001457152785,
#*# 	-0.15547240310186372
#*# model_domain = 3.351987055417817e-07,3.359664588035842e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 63.925584
#*# model_offset = 0.00000
