##########################
##### BASE CONFIG #######
##########################

[include mainsail.cfg]
[include ./backup/backup.cfg]

##########################
##### HARDWARE STUFF #####
##########################

[include ./hardware/xyz-stepper.cfg]
[include ./hardware/extruder.cfg]
#[include ./klicky/klicky-probe.cfg]
#[include ./hardware/adxl345.cfg]  This config now in canbus.cfg
[include ./hardware/fans.cfg] # Some fans config in canbus.cfg
[include ./hardware/canbus.cfg]

##########################
##### LIGHTS #############
##########################

[include ./hardware/chamber-lighting.cfg]
[include ./hardware/stealthburner-led.cfg]

##########################
##### CALIBRATION ########
##########################

[include ./calibration/z-tilt.cfg]
[include ./calibration/bed-mesh.cfg]
[include ./macros/unsafe.cfg]
[include ./calibration/pressure_advance.cfg]
[include ./calibration/test_speed.cfg]
[include ./calibration/pika.cfg]
[include test_probe_accuracy.cfg]

##########################
##### MACROS #############
##########################

[include ./macros/chamber-led.cfg]
[include ./macros/conditional-homing.cfg]
[include ./macros/print-end.cfg]
[include ./macros/print-start-mmu.cfg]
[include ./macros/dump-variables.cfg]
[include ./macros/movement-check.cfg]
[include ./macros/cancel-change.cfg]
[include ./macros/pause-resume.cfg]         ; Overridden by ERCF / subsequantly disabled
[include ./macros/load-unload.cfg]
[include ./macros/filament-change.cfg]
[include ./macros/park.cfg]
#[include ./macros/prusaslicer-accel.cfg]

##########################
##### THIRD PARTY ########
##########################

#[include ./third-party-cfg/nozzle_scrub.cfg]
[include KAMP_Settings.cfg]

##########################
##### ERCF ###############
##########################

[include mmu/base/*.cfg]
[include macros/mmu_adds.cfg]
[include mmu/optional/mmu_ercf_cutter.cfg]

##########################
##### LCD/MENU ###########
##########################

#[include ./third-party-cfg/nozzle_scrub_menu.cfg]
#[include ./menu/printer_menu.cfg]

##########################
##### NOT ENABLED YET ####
##########################

#[include ./todo/mini12864.cfg] Add this after adding mini12864 LED
#[include ./todo/lcd_tweaks.cfg] Need to figure this one out and then implement
#[include ./hardware/nevermore.cfg] Disabled as I prefer to chamber vent outside and needed the PWM

##########################
#### REPLACEMENT #########
##########################

[include ./replacement_macros/replace-m900.cfg]
[include ./replacement_macros/replace-m117.cfg]

[exclude_object]

[gcode_arcs]
resolution: 0.1

[respond]
default_type: echo
default_prefix:  

[force_move]
# Enable commands that force potentially unsafe movement
enable_force_move: True

[idle_timeout]
timeout: 14400

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_290040000750314D35323820-if00
restart_method: command

[mcu rpi]
# Add Rpi as secondary MCU to allow for ADXL use through SPI ribbon/adapter from LDO
serial: /tmp/klipper_host_mcu

[mcu sht]
canbus_uuid: 30993412e8e0

[printer]
kinematics: corexy
max_velocity: 200           # Changed from 200 on 7.11.23
max_accel:  6000            # tuned on 7.11.23 after beacon install.
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0 # Changed on 7.11.23

#####################################################################
#   Input Shaper
#####################################################################

[input_shaper]
#shaper_freq_x: 76.2               ; suggested max_accel <= 22600 mm/sec^2
#shaper_type_x: zv
#shaper_freq_y: 51.8               ; suggested max_accel <= 7900 mm/sec^2
#shaper_type_y: mzv


#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
heater_pin: PA2 #PA2 is LDO default
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 125
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  WAS TAP - NOW BEACON in CANBUS

#####################################################################
#   Additional Sensors
#####################################################################

[thermistor CMFB103F3950FANT]
temperature1: 0.0
resistance1: 32116.0
temperature2: 40.0
resistance2: 5309.0
temperature3: 80.0
resistance3: 1228.0

#[temperature_sensor sb_ambient_temp]
## Chamber Temperature - T1
#sensor_type: CMFB103F3950FANT
#sensor_pin: PF5
#min_temp: 0
#max_temp: 100
#gcode_id: chamber_th

[temperature_sensor back_chamber_temp]
## Chamber Temperature - T
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF6
min_temp: 0
max_temp: 100
gcode_id: chamber_th2

[temperature_sensor RPi4]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################

#[safe_z_home]
##  XY Location of the Z Endstop Switch
##  Update -10,-10 to the XY coordinates of your endstop pin 
##  (such as 157,305) after going through Z Endstop Pin
##  Location Definition step.
#home_xy_position: 147,256
#speed:100
#z_hop:10
#z_hop_speed:10


########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.889
#*# pid_ki = 0.964
#*# pid_kd = 412.851
#*#
#*# [probe]
#*# z_offset = -1.270
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.051630, -0.043668, -0.028176, -0.028084, -0.028305, -0.028334, -0.025385, -0.026427, -0.023013, -0.028082, -0.027243, -0.020205, -0.028768, -0.024404, -0.028294, -0.027746, -0.026797, -0.022871, -0.013300, -0.015117, -0.016651, -0.001859, 0.001729, -0.000201, 0.002835
#*# 	  -0.048478, -0.041386, -0.030182, -0.031629, -0.031909, -0.027778, -0.026620, -0.022878, -0.026413, -0.024486, -0.023123, -0.022211, -0.023363, -0.021798, -0.023928, -0.022499, -0.022801, -0.018653, -0.018565, -0.020447, -0.003335, 0.001805, 0.002640, 0.003720, 0.001901
#*# 	  -0.047682, -0.033835, -0.033857, -0.026336, -0.030311, -0.028146, -0.023599, -0.021666, -0.021125, -0.021838, -0.021669, -0.020355, -0.018893, -0.017654, -0.021713, -0.019226, -0.006903, -0.012118, -0.006030, -0.007135, -0.001486, 0.005916, 0.003723, 0.007373, 0.002516
#*# 	  -0.046663, -0.033332, -0.020525, -0.027851, -0.024088, -0.026636, -0.021070, -0.025561, -0.021481, -0.020873, -0.018912, -0.020213, -0.015977, -0.007476, -0.011286, -0.018476, -0.018094, -0.011415, -0.007037, -0.003917, -0.004700, 0.002997, 0.004364, 0.006889, 0.009086
#*# 	  -0.040859, -0.034657, -0.032752, -0.024700, -0.023548, -0.027209, -0.025572, -0.020785, -0.022654, -0.021074, -0.020175, -0.018227, -0.018342, -0.015161, -0.006753, -0.012134, -0.011050, -0.009645, -0.008464, -0.006756, -0.008284, -0.003186, 0.002339, 0.005234, 0.008271
#*# 	  -0.035556, -0.033932, -0.034189, -0.032288, -0.033442, -0.027010, -0.027166, -0.021455, -0.018345, -0.014122, -0.017674, -0.018503, -0.011968, -0.011272, -0.010845, -0.009402, -0.008955, -0.007230, -0.007751, -0.007766, 0.007521, 0.001106, 0.011362, 0.010287, 0.004717
#*# 	  -0.036655, -0.035020, -0.027213, -0.019322, -0.038681, -0.034514, -0.030551, -0.020867, -0.015287, -0.016776, -0.010397, -0.013202, -0.011303, -0.008342, -0.006736, -0.008010, -0.002191, -0.008014, 0.000043, -0.000204, 0.012280, 0.013767, 0.016548, 0.016303, 0.013025
#*# 	  -0.041248, -0.034282, -0.027192, -0.027875, -0.022539, -0.018828, -0.019022, -0.018108, -0.013848, -0.016441, -0.018621, -0.012721, -0.012379, -0.008944, -0.007254, -0.006274, -0.007976, -0.004252, -0.000283, -0.003472, 0.005880, 0.014395, 0.012829, 0.013862, 0.013153
#*# 	  -0.034372, -0.027714, -0.033170, -0.028630, -0.017119, -0.030272, -0.020421, -0.017392, -0.021574, -0.016196, -0.014769, -0.011103, -0.009876, -0.002513, -0.003090, -0.000802, -0.002303, -0.000487, 0.003993, 0.004750, 0.013875, 0.014386, 0.018091, 0.022865, 0.015723
#*# 	  -0.031864, -0.034805, -0.031058, -0.023028, -0.021420, -0.018130, -0.020671, -0.015090, -0.019486, -0.012605, -0.008028, -0.008443, -0.005192, -0.007610, -0.003464, 0.001746, -0.002388, 0.009176, 0.007126, 0.006688, 0.011330, 0.013954, 0.016182, 0.027874, 0.021379
#*# 	  -0.029515, -0.025590, -0.019364, -0.020048, -0.015182, -0.020543, -0.014506, -0.013423, -0.015329, -0.014898, -0.013066, -0.009552, -0.008886, -0.002299, -0.001662, -0.009459, 0.004992, 0.011427, 0.011009, 0.011876, 0.019934, 0.025058, 0.028889, 0.038833, 0.025060
#*# 	  -0.026573, -0.014884, -0.024875, -0.013656, -0.020238, -0.015194, -0.014377, -0.016659, -0.009848, -0.010852, -0.010489, -0.006528, -0.001201, 0.003771, 0.011157, 0.005169, 0.012013, 0.011805, 0.015312, 0.022712, 0.024886, 0.033112, 0.039854, 0.036634, 0.038521
#*# 	  -0.020940, -0.024205, -0.018104, -0.013513, -0.013087, -0.016449, -0.014235, -0.013379, -0.013244, -0.010654, -0.005249, -0.001580, 0.001746, 0.013325, 0.013353, 0.014920, 0.011739, 0.018563, 0.018777, 0.025003, 0.029712, 0.036109, 0.039781, 0.042155, 0.039167
#*# 	  -0.024082, -0.013792, -0.012505, -0.018845, -0.015473, -0.012966, -0.014287, -0.016234, -0.016002, -0.010299, -0.008076, -0.008171, -0.005692, 0.003808, 0.012564, 0.011116, 0.011545, 0.016997, 0.018350, 0.018593, 0.023749, 0.035498, 0.041052, 0.041790, 0.040738
#*# 	  -0.030170, -0.025546, -0.028583, -0.026718, -0.025299, -0.023195, -0.024353, -0.015143, -0.013223, -0.014549, -0.014057, -0.012993, -0.004482, -0.003912, -0.000059, 0.011482, 0.005467, 0.012179, 0.015938, 0.019588, 0.018519, 0.027692, 0.025892, 0.033633, 0.029536
#*# 	  -0.036753, -0.033646, -0.027551, -0.033372, -0.029882, -0.029727, -0.029187, -0.031443, -0.024219, -0.016825, -0.014956, -0.013273, -0.009368, -0.008290, -0.000776, -0.002540, -0.006960, 0.001089, 0.013127, 0.014110, 0.017475, 0.024676, 0.030192, 0.038710, 0.033970
#*# 	  -0.035536, -0.034394, -0.036117, -0.034995, -0.033538, -0.034478, -0.028108, -0.025956, -0.027730, -0.018684, -0.014185, -0.014254, -0.011088, -0.007515, -0.005423, 0.001463, 0.002821, 0.010787, 0.012218, 0.012900, 0.016932, 0.018411, 0.020758, 0.024662, 0.034519
#*# 	  -0.032561, -0.026603, -0.026600, -0.026702, -0.029534, -0.031805, -0.028487, -0.023028, -0.014277, -0.017887, -0.015932, -0.016331, -0.008836, -0.007021, -0.002930, 0.002525, 0.009662, 0.008996, 0.012068, 0.014678, 0.018253, 0.018593, 0.024886, 0.022409, 0.028128
#*# 	  -0.030493, -0.018105, -0.015972, -0.016204, -0.018057, -0.016270, -0.015331, -0.039623, -0.019946, -0.016603, -0.016509, -0.009381, -0.007560, -0.001150, -0.001605, -0.002003, -0.003287, 0.011114, 0.013172, 0.014861, 0.018198, 0.021879, 0.019931, 0.021356, 0.019631
#*# x_count = 25
#*# y_count = 19
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 210.0
#*# min_y = 66.887
#*# max_y = 198.284
#*#
#*# [beacon model default]
#*# model_coef = 1.9257982386737142,
#*# 	2.1904011986275074,
#*# 	0.5881661108028357,
#*# 	0.30341866940870527,
#*# 	0.14823890288711727,
#*# 	-0.42807822476666274,
#*# 	-0.13716254071061182,
#*# 	0.612855529187592,
#*# 	0.08376843001203003,
#*# 	-0.2664564217100284
#*# model_domain = 3.352922478536077e-07,3.360945745364866e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 72.578002
#*# model_offset = 0.18500
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 77.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 51.6
