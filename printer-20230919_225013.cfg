##########################
##### BASE CONFIG #######
##########################

[include mainsail.cfg]
[include ./backup/backup.cfg]

##########################
##### HARDWARE STUFF #####
##########################

[include ./hardware/xyz-stepper.cfg]
[include ./hardware/extruder.cfg]
#[include ./klicky/klicky-probe.cfg]
#[include ./hardware/adxl345.cfg]  This config now in canbus.cfg
[include ./hardware/fans.cfg] # Some fans config in canbus.cfg
[include ./hardware/canbus.cfg]

##########################
##### LIGHTS #############
##########################

[include ./hardware/chamber-lighting.cfg]
[include ./hardware/stealthburner-led.cfg]

##########################
##### CALIBRATION ########
##########################

[include ./calibration/z-tilt.cfg]
[include ./calibration/bed-mesh.cfg]
[include ./macros/unsafe.cfg]
[include ./calibration/pressure_advance.cfg]
[include ./calibration/test_speed.cfg]
[include ./calibration/pika.cfg]
[include test_probe_accuracy.cfg]

##########################
##### MACROS #############
##########################

[include ./macros/chamber-led.cfg]
[include ./macros/conditional-homing.cfg]
[include ./macros/print-end.cfg]
[include ./macros/print-start-mmu.cfg]
[include ./macros/dump-variables.cfg]
[include ./macros/movement-check.cfg]
[include ./macros/cancel-change.cfg]
[include ./macros/pause-resume.cfg]         ; Overridden by ERCF / subsequantly disabled
[include ./macros/load-unload.cfg]
[include ./macros/filament-change.cfg]
[include ./macros/park.cfg]
#[include ./macros/prusaslicer-accel.cfg]

##########################
##### THIRD PARTY ########
##########################

#[include ./third-party-cfg/nozzle_scrub.cfg]
[include KAMP_Settings.cfg]

##########################
##### ERCF ###############
##########################

[include mmu/base/*.cfg]


##########################
##### LCD/MENU ###########
##########################

#[include ./third-party-cfg/nozzle_scrub_menu.cfg]
#[include ./menu/printer_menu.cfg]

##########################
##### NOT ENABLED YET ####
##########################

#[include ./todo/mini12864.cfg] Add this after adding mini12864 LED
#[include ./todo/lcd_tweaks.cfg] Need to figure this one out and then implement
#[include ./hardware/nevermore.cfg] Disabled as I prefer to chamber vent outside and needed the PWM

##########################
#### REPLACEMENT #########
##########################

[include ./replacement_macros/replace-m900.cfg]
[include ./replacement_macros/replace-m117.cfg]

[exclude_object]

[gcode_arcs]
resolution: 0.1

[respond]
default_type: echo
default_prefix:  

[force_move]
# Enable commands that force potentially unsafe movement
enable_force_move: True

[idle_timeout]
timeout: 14400

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_290040000750314D35323820-if00
restart_method: command

[mcu rpi]
# Add Rpi as secondary MCU to allow for ADXL use through SPI ribbon/adapter from LDO
serial: /tmp/klipper_host_mcu

[mcu sht]
canbus_uuid: 30993412e8e0

[printer]
kinematics: corexy
max_velocity: 200           # Changed from 200 on 7.11.23
max_accel:  6000            # tuned on 7.11.23 after beacon install.
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0 # Changed on 7.11.23

#####################################################################
#   Input Shaper
#####################################################################

[input_shaper]
#shaper_freq_x: 76.2               ; suggested max_accel <= 22600 mm/sec^2
#shaper_type_x: zv
#shaper_freq_y: 51.8               ; suggested max_accel <= 7900 mm/sec^2
#shaper_type_y: mzv


#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
heater_pin: PA2 #PA2 is LDO default
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 125
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  WAS TAP - NOW BEACON in CANBUS

#####################################################################
#   Additional Sensors
#####################################################################

[thermistor CMFB103F3950FANT]
temperature1: 0.0
resistance1: 32116.0
temperature2: 40.0
resistance2: 5309.0
temperature3: 80.0
resistance3: 1228.0

#[temperature_sensor sb_ambient_temp]
## Chamber Temperature - T1
#sensor_type: CMFB103F3950FANT
#sensor_pin: PF5
#min_temp: 0
#max_temp: 100
#gcode_id: chamber_th

[temperature_sensor back_chamber_temp]
## Chamber Temperature - T
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF6
min_temp: 0
max_temp: 100
gcode_id: chamber_th2

[temperature_sensor RPi4]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################

#[safe_z_home]
##  XY Location of the Z Endstop Switch
##  Update -10,-10 to the XY coordinates of your endstop pin 
##  (such as 157,305) after going through Z Endstop Pin
##  Location Definition step.
#home_xy_position: 147,256
#speed:100
#z_hop:10
#z_hop_speed:10


########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.889
#*# pid_ki = 0.964
#*# pid_kd = 412.851
#*#
#*# [probe]
#*# z_offset = -1.270
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.030351, -0.026227, -0.015834, -0.016073, -0.013209, -0.014722, -0.013713, -0.014260, -0.011012, -0.013885, -0.012485, -0.014148, -0.016369, -0.013128, -0.014321, -0.018557, -0.021658, -0.016400, -0.022472, -0.025059, -0.019296, -0.022077, -0.018792, -0.024562, -0.018590
#*# 	  -0.022017, -0.015392, -0.016970, -0.014765, -0.012241, -0.013023, -0.007642, -0.007601, -0.009959, -0.007066, -0.008610, -0.009569, -0.008147, -0.011448, -0.013652, -0.014713, -0.014752, -0.015354, -0.014180, -0.016033, -0.014021, -0.013863, -0.013174, -0.013825, -0.014622
#*# 	  -0.025081, -0.018224, -0.018626, -0.016040, -0.014769, -0.011114, -0.004420, -0.000895, 0.002559, 0.002568, -0.001468, -0.007368, -0.007330, -0.007963, -0.008306, -0.013986, -0.006865, -0.013381, -0.009600, -0.010263, -0.010590, -0.011248, -0.009571, -0.012369, -0.010597
#*# 	  -0.033290, -0.020672, -0.019585, -0.021260, -0.019366, -0.015679, -0.010806, -0.010101, -0.007238, -0.009146, -0.010024, -0.005427, -0.006720, -0.010652, -0.012708, -0.011811, -0.012075, -0.011636, -0.009692, -0.013489, -0.010521, -0.011927, -0.010593, -0.010378, -0.010082
#*# 	  -0.042605, -0.037767, -0.030380, -0.032156, -0.019016, -0.019263, -0.015350, -0.011053, -0.007835, -0.005599, -0.009167, -0.009271, -0.006961, -0.011387, -0.009797, -0.013828, -0.011392, -0.014753, -0.014261, -0.008286, -0.010891, -0.006459, -0.009085, -0.010459, -0.011394
#*# 	  -0.043226, -0.037750, -0.035502, -0.035803, -0.028106, -0.026236, -0.017881, -0.011968, -0.011015, -0.000889, -0.011274, -0.000372, -0.002058, -0.016131, -0.004222, -0.008764, -0.010399, -0.010948, -0.007231, -0.009341, -0.008690, -0.009273, -0.004695, -0.006042, -0.013847
#*# 	  -0.040991, -0.039602, -0.039317, -0.039348, -0.027450, -0.019136, -0.016050, -0.015645, -0.010145, -0.009243, -0.006462, -0.012751, -0.007076, -0.011086, -0.011312, -0.011525, -0.009810, -0.006159, -0.014789, -0.008086, -0.012019, -0.008140, -0.012938, -0.011569, -0.009579
#*# 	  -0.040312, -0.038377, -0.037192, -0.037815, -0.026971, -0.024816, -0.016879, -0.013421, -0.013988, -0.006397, -0.005835, -0.007484, -0.009638, -0.002579, -0.012153, -0.005281, -0.000797, -0.008967, -0.014389, -0.012997, -0.012846, -0.004921, -0.009538, -0.008448, -0.010486
#*# 	  -0.036825, -0.035791, -0.032068, -0.027475, -0.023913, -0.021384, -0.014329, -0.013395, -0.012627, -0.010335, -0.006949, -0.004484, -0.006518, -0.006915, -0.003243, -0.011927, -0.005936, -0.004648, -0.006148, -0.003482, -0.009315, -0.010837, -0.010915, -0.004383, -0.010608
#*# 	  -0.028901, -0.028297, -0.027544, -0.020604, -0.019582, -0.013884, -0.013552, -0.011074, -0.011822, -0.005340, -0.003188, -0.004566, -0.004362, -0.005853, -0.008141, -0.004122, -0.009356, -0.004685, -0.008096, -0.011260, -0.011551, -0.004516, -0.002287, -0.011665, -0.006179
#*# 	  -0.020096, -0.013673, -0.013534, -0.014969, -0.012345, -0.011959, -0.009574, -0.005329, -0.006605, -0.005110, -0.004179, -0.003487, -0.003180, -0.003256, -0.002852, -0.004131, -0.003787, -0.004025, -0.003192, -0.003947, -0.003387, -0.005526, -0.003315, -0.005206, -0.003739
#*# 	  -0.020192, -0.010875, -0.014399, -0.010521, -0.011002, -0.007609, -0.006064, -0.003086, -0.003510, -0.002391, -0.000745, -0.000508, -0.001371, 0.005126, 0.003468, 0.000653, -0.001143, -0.003682, -0.001726, -0.002391, -0.002854, -0.003649, -0.003084, -0.002668, -0.002557
#*# 	  -0.016075, -0.014564, -0.011318, -0.011798, -0.006164, -0.005475, -0.007061, -0.006511, -0.004022, 0.000684, -0.002623, -0.002126, -0.000249, -0.001249, -0.001643, -0.002854, -0.003580, -0.002399, -0.000382, -0.002094, 0.001055, -0.000109, 0.003144, 0.005553, -0.001907
#*# 	  -0.020750, -0.020544, -0.030081, -0.011519, -0.015145, -0.013470, -0.009445, -0.010404, -0.006272, -0.003063, -0.002570, -0.001469, -0.003151, -0.001973, -0.003053, 0.000983, -0.000884, -0.002258, 0.000834, -0.003514, -0.005521, -0.000871, 0.002580, -0.001100, -0.001378
#*# 	  -0.025063, -0.022068, -0.013791, -0.011089, -0.017717, -0.014091, -0.010706, -0.004908, -0.007091, -0.005682, -0.010461, -0.003212, -0.003582, -0.004063, -0.002084, -0.003124, -0.003853, -0.006190, -0.003079, -0.002464, -0.001987, -0.003586, 0.004274, 0.004247, 0.002026
#*# 	  -0.023530, -0.017874, -0.019612, -0.010634, -0.011195, -0.017103, -0.008533, -0.008572, -0.006709, -0.004281, -0.007052, -0.003164, 0.002028, 0.000363, 0.003817, 0.001437, 0.001195, 0.000746, -0.003485, 0.000967, 0.001313, 0.007510, 0.003520, 0.013511, -0.003395
#*# 	  -0.022397, -0.011283, -0.013520, -0.014605, -0.028755, -0.010282, -0.006736, -0.009240, -0.002735, -0.004477, -0.004020, -0.002097, 0.000407, -0.000564, 0.000916, 0.000721, -0.000704, 0.003368, 0.003296, 0.011743, 0.007266, 0.014342, 0.014201, 0.015307, 0.009826
#*# 	  -0.020374, -0.010435, -0.029782, -0.010304, -0.009836, -0.009409, -0.009330, -0.006611, -0.006114, 0.001334, 0.003001, 0.001870, 0.003972, 0.005893, 0.005212, 0.006679, 0.000846, 0.013829, 0.014517, 0.014753, 0.007523, 0.014883, 0.014971, 0.018945, 0.017330
#*# 	  -0.021494, -0.010843, -0.007466, -0.011335, -0.010154, -0.011189, -0.012060, -0.008880, -0.006063, -0.005719, -0.006027, -0.000191, 0.000652, 0.002880, 0.005945, -0.000082, 0.012978, 0.000440, 0.015986, -0.005268, 0.014387, 0.015391, 0.016019, 0.018596, 0.019775
#*# 	  -0.025836, -0.019653, -0.017049, -0.011239, -0.013457, -0.006696, -0.017785, -0.008891, -0.010851, -0.007198, -0.005668, -0.004403, 0.000716, 0.001271, -0.000426, 0.001565, 0.002265, 0.002501, 0.004465, 0.015294, 0.010636, 0.015220, 0.016454, 0.016118, 0.015359
#*# 	  -0.023096, -0.021302, -0.020884, -0.015763, -0.022683, -0.009292, -0.014179, -0.015521, -0.010141, -0.009212, -0.007688, -0.002501, -0.005083, -0.002512, -0.005304, 0.000323, 0.001724, 0.001308, 0.002081, 0.006165, 0.010932, 0.012523, 0.018476, 0.013310, 0.014499
#*# 	  -0.025908, -0.023910, -0.022129, -0.019239, -0.019717, -0.012400, -0.023104, -0.022384, -0.010244, -0.009082, -0.006234, -0.005979, -0.007557, -0.006103, -0.004721, 0.001712, -0.000807, 0.004762, 0.000615, -0.001223, 0.004743, 0.016613, 0.015655, 0.016714, -0.003727
#*# 	  -0.031852, -0.025727, -0.023021, -0.021973, -0.012010, -0.008373, -0.006986, -0.012918, -0.007966, -0.014655, -0.009087, -0.007927, -0.008525, -0.006999, -0.005467, -0.006034, -0.006628, -0.001809, -0.002298, 0.000641, 0.000925, 0.010011, 0.012574, 0.017552, -0.000115
#*# 	  -0.029430, -0.028734, -0.023049, -0.020563, -0.018038, -0.014853, -0.008457, -0.019818, -0.009667, -0.011429, -0.007432, -0.010435, -0.006453, -0.006961, -0.007491, -0.009399, -0.003955, -0.006738, -0.002675, -0.004071, -0.001828, 0.002300, 0.003739, 0.000890, 0.008344
#*# 	  -0.033763, -0.030477, -0.030894, -0.029558, -0.024517, -0.023582, -0.022393, -0.023566, -0.021732, -0.020509, -0.018332, -0.007892, -0.006928, -0.007359, -0.018048, -0.006674, -0.009735, -0.007736, -0.006637, -0.008272, -0.006812, -0.005636, -0.005546, -0.002680, -0.000035
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 32.2
#*# max_x = 210.0
#*# min_y = 31.8
#*# max_y = 210.0
#*#
#*# [beacon model default]
#*# model_coef = 1.9257982386737142,
#*# 	2.1904011986275074,
#*# 	0.5881661108028357,
#*# 	0.30341866940870527,
#*# 	0.14823890288711727,
#*# 	-0.42807822476666274,
#*# 	-0.13716254071061182,
#*# 	0.612855529187592,
#*# 	0.08376843001203003,
#*# 	-0.2664564217100284
#*# model_domain = 3.352922478536077e-07,3.360945745364866e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 72.578002
#*# model_offset = -0.35500
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 77.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 51.6
