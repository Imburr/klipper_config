##########################
##### BASE CONFIG #######
##########################

[include mainsail.cfg]
[include ./backup/backup.cfg]

##########################
##### HARDWARE STUFF #####
##########################

[include ./hardware/xyz-stepper.cfg]
[include ./hardware/extruder.cfg]
#[include ./klicky/klicky-probe.cfg]
#[include ./hardware/adxl345.cfg]  This config now in canbus.cfg
[include ./hardware/fans.cfg] # Some fans config in canbus.cfg
[include ./hardware/canbus.cfg]

##########################
##### LIGHTS #############
##########################

[include ./hardware/chamber-lighting.cfg]
[include ./hardware/stealthburner-led.cfg]

##########################
##### CALIBRATION ########
##########################

[include ./calibration/z-tilt.cfg]
[include ./calibration/bed-mesh.cfg]
[include ./macros/unsafe.cfg]
[include ./calibration/pressure_advance.cfg]
[include ./calibration/test_speed.cfg]
[include ./calibration/pika.cfg]
[include test_probe_accuracy.cfg]

##########################
##### MACROS #############
##########################

[include ./macros/chamber-led.cfg]
[include ./macros/conditional-homing.cfg]
[include ./macros/print-end.cfg]
[include ./macros/print-start-mmu.cfg]
[include ./macros/dump-variables.cfg]
[include ./macros/movement-check.cfg]
[include ./macros/cancel-change.cfg]
[include ./macros/pause-resume.cfg]         ; Overridden by ERCF / subsequantly disabled
[include ./macros/load-unload.cfg]
[include ./macros/filament-change.cfg]
[include ./macros/park.cfg]
#[include ./macros/prusaslicer-accel.cfg]

##########################
##### THIRD PARTY ########
##########################

#[include ./third-party-cfg/nozzle_scrub.cfg]
[include KAMP_Settings.cfg]

##########################
##### ERCF ###############
##########################

[include mmu/base/*.cfg]
[include macros/mmu_adds.cfg]



##########################
##### LCD/MENU ###########
##########################

#[include ./third-party-cfg/nozzle_scrub_menu.cfg]
#[include ./menu/printer_menu.cfg]

##########################
##### NOT ENABLED YET ####
##########################

#[include ./todo/mini12864.cfg] Add this after adding mini12864 LED
#[include ./todo/lcd_tweaks.cfg] Need to figure this one out and then implement
#[include ./hardware/nevermore.cfg] Disabled as I prefer to chamber vent outside and needed the PWM

##########################
#### REPLACEMENT #########
##########################

[include ./replacement_macros/replace-m900.cfg]
[include ./replacement_macros/replace-m117.cfg]

[exclude_object]

[gcode_arcs]
resolution: 0.1

[respond]
default_type: echo
default_prefix:  

[force_move]
# Enable commands that force potentially unsafe movement
enable_force_move: True

[idle_timeout]
timeout: 14400

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_290040000750314D35323820-if00
restart_method: command

[mcu rpi]
# Add Rpi as secondary MCU to allow for ADXL use through SPI ribbon/adapter from LDO
serial: /tmp/klipper_host_mcu

[mcu sht]
canbus_uuid: 30993412e8e0

[printer]
kinematics: corexy
max_velocity: 200           # Changed from 200 on 7.11.23
max_accel:  6000            # tuned on 7.11.23 after beacon install.
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0 # Changed on 7.11.23

#####################################################################
#   Input Shaper
#####################################################################

[input_shaper]
#shaper_freq_x: 76.2               ; suggested max_accel <= 22600 mm/sec^2
#shaper_type_x: zv
#shaper_freq_y: 51.8               ; suggested max_accel <= 7900 mm/sec^2
#shaper_type_y: mzv


#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
heater_pin: PA2 #PA2 is LDO default
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 125
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  WAS TAP - NOW BEACON in CANBUS

#####################################################################
#   Additional Sensors
#####################################################################

[thermistor CMFB103F3950FANT]
temperature1: 0.0
resistance1: 32116.0
temperature2: 40.0
resistance2: 5309.0
temperature3: 80.0
resistance3: 1228.0

#[temperature_sensor sb_ambient_temp]
## Chamber Temperature - T1
#sensor_type: CMFB103F3950FANT
#sensor_pin: PF5
#min_temp: 0
#max_temp: 100
#gcode_id: chamber_th

[temperature_sensor back_chamber_temp]
## Chamber Temperature - T
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF6
min_temp: 0
max_temp: 100
gcode_id: chamber_th2

[temperature_sensor RPi4]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################

#[safe_z_home]
##  XY Location of the Z Endstop Switch
##  Update -10,-10 to the XY coordinates of your endstop pin 
##  (such as 157,305) after going through Z Endstop Pin
##  Location Definition step.
#home_xy_position: 147,256
#speed:100
#z_hop:10
#z_hop_speed:10


########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.889
#*# pid_ki = 0.964
#*# pid_kd = 412.851
#*#
#*# [probe]
#*# z_offset = -1.270
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.036348, -0.052714, -0.036113, -0.030457, -0.024451, -0.029714, -0.026836, -0.021952, -0.024312, -0.018201, -0.022003, -0.020220, -0.021598, -0.020885, -0.022602, -0.026864, -0.037828, -0.036762, -0.035321, -0.033517, -0.042927, -0.040935, -0.034564, -0.035433, -0.042884
#*# 	  -0.043539, -0.041868, -0.029831, -0.024629, -0.029778, -0.021324, -0.020471, -0.020573, -0.022865, -0.018157, -0.021245, -0.016567, -0.021129, -0.020968, -0.020026, -0.021758, -0.022131, -0.026355, -0.025012, -0.036366, -0.029779, -0.026077, -0.023625, -0.029522, -0.037065
#*# 	  -0.038623, -0.030471, -0.026608, -0.024988, -0.022186, -0.027144, -0.020413, -0.014548, -0.012993, -0.012422, -0.012369, -0.011289, -0.014109, -0.012860, -0.018094, -0.025474, -0.024231, -0.021571, -0.024406, -0.022859, -0.024572, -0.023193, -0.024580, -0.026143, -0.024174
#*# 	  -0.048070, -0.037563, -0.030289, -0.031091, -0.027469, -0.023063, -0.022771, -0.021056, -0.013483, -0.018096, -0.010277, -0.003574, -0.011090, -0.015803, -0.017106, -0.015077, -0.021605, -0.022614, -0.023301, -0.023694, -0.020189, -0.024797, -0.020286, -0.022113, -0.025103
#*# 	  -0.047360, -0.046750, -0.026586, -0.035287, -0.027336, -0.022773, -0.018186, -0.016734, -0.005914, -0.011469, -0.005194, -0.010476, -0.007236, -0.013367, -0.012222, -0.016145, -0.023402, -0.020994, -0.018332, -0.020441, -0.021057, -0.017624, -0.022421, -0.020746, -0.022858
#*# 	  -0.042314, -0.040011, -0.041508, -0.023962, -0.026399, -0.022675, -0.017501, -0.009751, -0.006030, -0.004848, -0.007430, -0.000613, -0.004731, -0.003634, -0.008595, -0.014017, -0.017079, -0.015223, 0.000453, -0.019080, -0.022331, -0.019111, -0.020578, -0.021681, -0.021904
#*# 	  -0.041342, -0.036932, -0.043344, -0.040526, -0.029365, -0.020510, -0.016975, -0.013607, -0.005465, -0.002316, 0.002190, 0.000205, 0.005255, -0.000591, -0.007736, -0.009691, -0.007567, -0.010681, -0.006209, -0.012458, -0.006120, -0.010390, -0.000517, -0.016265, -0.017576
#*# 	  -0.034283, -0.037851, -0.031745, -0.029489, -0.019087, -0.019373, -0.014656, -0.004452, 0.003978, -0.000807, 0.004900, -0.001336, 0.002336, 0.002694, 0.006629, -0.002924, -0.006273, -0.007055, -0.009709, -0.011402, -0.011765, -0.002130, -0.014421, -0.014260, -0.016591
#*# 	  -0.031126, -0.019584, -0.020711, -0.020023, -0.014806, -0.015040, -0.006431, -0.001400, 0.002279, -0.001206, 0.013959, 0.003369, 0.008969, -0.001539, -0.000012, 0.001493, -0.004059, -0.003846, -0.004437, -0.004914, -0.002883, 0.000623, -0.004832, -0.006462, -0.010194
#*# 	  -0.017739, -0.011458, -0.012330, -0.009166, -0.010939, -0.012253, -0.004893, -0.006334, 0.005081, 0.009902, 0.007852, 0.009736, 0.006733, 0.009752, 0.016303, 0.003041, 0.000883, 0.000721, -0.003847, -0.003969, 0.003878, -0.007425, -0.002365, -0.006433, -0.004975
#*# 	  -0.006958, -0.011046, -0.005917, -0.001552, -0.001420, -0.002872, 0.000707, 0.011455, 0.009127, 0.003136, 0.007733, 0.009203, 0.009159, 0.009240, 0.002524, -0.001015, 0.010581, -0.002608, -0.002751, -0.001204, -0.001527, -0.001757, -0.002534, -0.005024, -0.005192
#*# 	  -0.007058, 0.000827, 0.003191, 0.005932, 0.006962, 0.001463, 0.004805, 0.008671, 0.010890, 0.013870, 0.016403, 0.019014, 0.015092, 0.015563, 0.013729, 0.007096, 0.011270, 0.004480, -0.000463, 0.009692, -0.001044, -0.000076, -0.000239, -0.001288, -0.005185
#*# 	  0.000052, 0.003191, 0.005701, 0.007513, 0.005569, 0.005645, 0.007127, 0.011503, 0.006643, 0.016795, 0.014752, 0.020510, 0.017389, 0.013690, 0.006432, 0.011870, 0.010798, 0.002811, 0.002842, 0.006909, 0.001378, 0.001229, 0.004113, 0.002167, -0.000159
#*# 	  -0.007297, -0.000869, 0.007032, 0.003710, 0.005627, 0.003067, 0.011057, 0.012532, 0.006063, 0.005799, 0.005518, 0.011782, 0.018068, 0.015469, 0.013560, 0.008253, 0.010880, 0.006127, 0.004425, 0.002541, 0.002264, 0.002428, 0.003381, 0.005193, 0.006004
#*# 	  -0.009271, -0.002879, -0.000523, -0.001967, 0.007756, 0.002475, 0.004129, 0.007763, 0.008902, 0.012026, 0.010136, 0.011157, 0.013688, 0.006950, 0.006662, 0.007170, 0.003704, 0.001019, -0.003717, -0.001026, 0.002354, 0.005187, 0.006899, 0.005845, -0.001917
#*# 	  -0.008206, -0.004813, -0.000168, 0.005083, -0.001070, 0.000121, -0.001774, 0.001926, 0.004890, 0.010953, 0.009152, 0.010994, 0.013676, 0.008481, 0.009313, 0.009883, 0.006253, 0.007434, 0.006673, 0.007241, 0.011638, 0.006263, 0.011159, 0.011805, 0.006157
#*# 	  -0.001396, 0.009859, 0.002375, 0.005858, 0.006597, 0.006090, 0.009110, 0.008978, 0.012122, 0.015518, 0.017900, 0.012768, 0.015348, 0.016218, 0.016660, 0.007478, 0.007352, 0.010762, 0.008293, 0.009730, 0.009519, 0.014662, 0.014625, 0.015136, 0.012409
#*# 	  0.002320, 0.002869, 0.006942, 0.007098, 0.006318, 0.008216, 0.012441, 0.012537, 0.013169, 0.014446, 0.006682, 0.015404, 0.013641, 0.014807, 0.014715, 0.012610, 0.015870, 0.014463, 0.014624, 0.013703, 0.014235, 0.015821, 0.017168, 0.025910, 0.016674
#*# 	  0.002591, 0.011548, 0.015629, 0.014735, 0.010302, 0.009585, 0.014330, 0.014781, 0.015867, 0.017881, 0.015923, 0.018884, 0.018615, 0.018729, 0.017987, 0.017301, 0.015468, 0.015360, 0.015779, 0.017121, 0.017347, 0.018168, 0.022284, 0.019076, 0.016428
#*# 	  -0.006742, 0.001038, -0.008621, 0.003220, -0.007344, -0.000165, -0.000283, 0.004301, 0.003901, 0.017251, 0.010667, 0.013293, 0.014393, 0.007410, 0.015363, 0.009062, 0.014987, 0.013333, 0.014668, 0.014047, 0.014885, 0.016299, 0.015612, 0.021314, 0.015243
#*# 	  -0.004178, -0.003285, -0.002894, -0.005717, -0.001613, -0.002651, -0.002674, -0.001995, 0.003237, 0.001998, 0.001597, 0.004185, 0.003613, 0.004871, 0.000551, 0.004544, 0.004531, 0.003271, 0.002360, 0.004684, 0.001959, 0.006766, 0.010656, 0.009903, 0.009336
#*# 	  -0.006652, -0.001428, -0.005005, 0.003648, 0.005836, 0.007553, 0.010191, 0.007490, 0.007012, 0.005807, 0.006850, 0.005034, 0.006995, 0.012401, 0.009279, 0.008648, 0.003648, 0.009240, 0.009895, 0.005852, 0.004897, 0.009129, 0.009235, 0.013100, 0.009103
#*# 	  -0.008555, -0.001962, -0.008378, -0.000068, 0.004565, 0.001643, -0.000216, 0.001511, -0.003938, 0.001062, -0.005387, -0.000342, 0.000087, 0.000884, 0.004825, 0.000380, 0.005467, 0.005436, 0.006201, 0.007458, 0.003717, 0.008288, 0.011663, 0.012651, 0.004317
#*# 	  -0.008802, -0.001374, -0.003242, -0.005448, -0.000428, 0.000496, 0.003595, 0.003681, 0.001725, 0.002967, -0.002857, 0.002810, 0.001615, 0.002912, 0.004104, 0.003487, 0.001827, 0.001685, 0.003540, 0.002436, 0.001372, 0.003631, 0.004467, 0.001647, 0.007830
#*# 	  -0.010266, -0.010337, -0.007177, -0.007229, -0.001951, 0.000494, -0.001741, -0.000052, -0.012179, -0.006202, -0.001337, -0.004810, -0.001707, -0.006191, -0.003441, -0.003740, -0.005956, -0.012567, -0.002259, -0.001761, -0.002598, -0.003591, -0.003659, -0.004678, -0.001823
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 210.0
#*# min_y = 30.0
#*# max_y = 210.0
#*#
#*# [beacon model default]
#*# model_coef = 1.9257982386737142,
#*# 	2.1904011986275074,
#*# 	0.5881661108028357,
#*# 	0.30341866940870527,
#*# 	0.14823890288711727,
#*# 	-0.42807822476666274,
#*# 	-0.13716254071061182,
#*# 	0.612855529187592,
#*# 	0.08376843001203003,
#*# 	-0.2664564217100284
#*# model_domain = 3.352922478536077e-07,3.360945745364866e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 72.578002
#*# model_offset = -0.40500
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 77.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 51.6
