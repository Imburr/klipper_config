[include moonraker_obico_macros.cfg]
##########################
##### BASE CONFIG #######
##########################

[include mainsail.cfg]
[include ./backup/backup.cfg]

##########################
##### HARDWARE STUFF #####
##########################

[include ./hardware/xyz-stepper.cfg]
[include ./hardware/extruder.cfg]
#[include ./klicky/klicky-probe.cfg]
#[include ./hardware/adxl345.cfg]  This config now in canbus.cfg
[include ./hardware/fans.cfg] # Some fans config in canbus.cfg
[include ./hardware/canbus.cfg]

##########################
##### LIGHTS #############
##########################

[include ./hardware/chamber-lighting.cfg]
[include ./hardware/stealthburner-led.cfg]

##########################
##### CALIBRATION ########
##########################

[include ./calibration/z-tilt.cfg]
[include ./calibration/bed-mesh.cfg]
[include ./macros/unsafe.cfg]
[include ./calibration/pressure_advance.cfg]
[include ./calibration/test_speed.cfg]
[include ./calibration/pika.cfg]
[include ./calibration/microadjust.cfg]
[include test_probe_accuracy.cfg]

##########################
##### MACROS #############
##########################

[include ./macros/chamber-led.cfg]
[include ./macros/conditional-homing.cfg]
[include ./macros/print-end.cfg]
[include ./macros/print-start-mmu.cfg]
[include ./macros/dump-variables.cfg]
[include ./macros/movement-check.cfg]
[include ./macros/cancel-change.cfg]
[include ./macros/pause-resume.cfg]         ; Overridden by ERCF / subsequantly disabled
[include ./macros/load-unload.cfg]
[include ./macros/filament-change.cfg]
[include ./macros/park.cfg]
[include ./macros/heatsoak.cfg]

##########################
##### THIRD PARTY ########
##########################

#[include ./third-party-cfg/nozzle_scrub.cfg]
[include KAMP_Settings.cfg]

##########################
##### ERCF ###############
##########################

[include mmu/base/*.cfg]
[include macros/mmu_adds.cfg]
[include mmu/optional/mmu_ercf_cutter.cfg]

##########################
##### LCD/MENU ###########
##########################

#[include ./third-party-cfg/nozzle_scrub_menu.cfg]
#[include ./menu/printer_menu.cfg]

##########################
##### NOT ENABLED YET ####
##########################

#[include ./todo/mini12864.cfg] Add this after adding mini12864 LED
#[include ./todo/lcd_tweaks.cfg] Need to figure this one out and then implement
#[include ./hardware/nevermore.cfg] Disabled as I prefer to chamber vent outside and needed the PWM

##########################
#### REPLACEMENT #########
##########################

[include ./replacement_macros/replace-m900.cfg]
[include ./replacement_macros/replace-m117.cfg]

[exclude_object]

[gcode_arcs]
resolution: 0.1

[respond]
default_type: echo
default_prefix:  

[force_move]
# Enable commands that force potentially unsafe movement
enable_force_move: True

[idle_timeout]
timeout: 14400

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_290040000750314D35323820-if00
restart_method: command

[mcu rpi]
# Add Rpi as secondary MCU to allow for ADXL use through SPI ribbon/adapter from LDO
serial: /tmp/klipper_host_mcu

[mcu sht]
canbus_uuid: 30993412e8e0

[printer]
kinematics: corexy
max_velocity: 200           # Changed from 200 on 7.11.23
max_accel:  6000            # tuned on 7.11.23 after beacon install.
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0 # Changed on 7.11.23

#####################################################################
#   Input Shaper
#####################################################################

[input_shaper]
#shaper_freq_x: 76.2               ; suggested max_accel <= 22600 mm/sec^2
#shaper_type_x: zv
#shaper_freq_y: 51.8               ; suggested max_accel <= 7900 mm/sec^2
#shaper_type_y: mzv


#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
heater_pin: PA2 #PA2 is LDO default
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 125
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  WAS TAP - NOW BEACON in CANBUS

#####################################################################
#   Additional Sensors
#####################################################################

[thermistor CMFB103F3950FANT]
temperature1: 0.0
resistance1: 32116.0
temperature2: 40.0
resistance2: 5309.0
temperature3: 80.0
resistance3: 1228.0

#[temperature_sensor sb_ambient_temp]
## Chamber Temperature - T1
#sensor_type: CMFB103F3950FANT
#sensor_pin: PF5
#min_temp: 0
#max_temp: 100
#gcode_id: chamber_th

[temperature_sensor back_chamber_temp]
## Chamber Temperature - T
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF6
min_temp: 0
max_temp: 100
gcode_id: chamber_th2

[temperature_sensor RPi4]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################

#[safe_z_home]
##  XY Location of the Z Endstop Switch
##  Update -10,-10 to the XY coordinates of your endstop pin 
##  (such as 157,305) after going through Z Endstop Pin
##  Location Definition step.
#home_xy_position: 147,256
#speed:100
#z_hop:10
#z_hop_speed:10


########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.889
#*# pid_ki = 0.964
#*# pid_kd = 412.851
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.000749, -0.003085, 0.000340, 0.000638, 0.009094, 0.000729, 0.000304, 0.013133, 0.007134, 0.013735, 0.001054, -0.002297, 0.012106, 0.015415, 0.014449, 0.014977, 0.023767, 0.034283, 0.012653, 0.015178, 0.008001, 0.026302, 0.019469, 0.019688, 0.037383
#*# 	  -0.002300, -0.000496, 0.000429, 0.008319, 0.007995, 0.010921, 0.016108, 0.017891, 0.009853, 0.003989, 0.011965, 0.002942, 0.007975, 0.016206, 0.030111, 0.009912, 0.031045, 0.021301, 0.016836, 0.036856, 0.024778, 0.034624, 0.032065, 0.044224, 0.040065
#*# 	  -0.007494, -0.000695, 0.001977, 0.003647, 0.012756, 0.004644, 0.010355, 0.011093, 0.009130, 0.005083, 0.010037, 0.018758, 0.011823, 0.016253, 0.008336, 0.014415, 0.011987, 0.030801, 0.025841, 0.018390, 0.028315, 0.038233, 0.044836, 0.042206, 0.042164
#*# 	  -0.004756, -0.004293, 0.007921, 0.005443, 0.004871, 0.016013, 0.012817, 0.002647, 0.007096, 0.006448, 0.005391, 0.014620, 0.014416, 0.018341, -0.002216, 0.004035, 0.009393, 0.029661, 0.029168, 0.019966, 0.034039, 0.037946, 0.039380, 0.028905, 0.037418
#*# 	  -0.011084, -0.003217, 0.000026, 0.004135, -0.001501, 0.004764, -0.003039, 0.002860, 0.001414, 0.001562, -0.005617, 0.006500, 0.005086, 0.009731, 0.005076, 0.010050, 0.001286, -0.000457, 0.008155, 0.021173, 0.019912, 0.036584, 0.036438, 0.039987, 0.035089
#*# 	  -0.007089, -0.003010, -0.008930, 0.007265, 0.002634, 0.006837, 0.009186, -0.000968, 0.003439, 0.007528, 0.004629, 0.006838, 0.010646, 0.002269, 0.003039, 0.011442, 0.010567, 0.009568, 0.019124, 0.004280, 0.043941, 0.034028, 0.039638, 0.037306, 0.031026
#*# 	  -0.009719, -0.000511, 0.007815, 0.002926, 0.005593, -0.000508, 0.006143, -0.002218, 0.001423, -0.002515, 0.008218, 0.006805, 0.013214, 0.008979, 0.018327, 0.019022, 0.019762, 0.008502, 0.015237, -0.001098, 0.012888, 0.026589, 0.034916, 0.036062, 0.019901
#*# 	  -0.004554, 0.005138, 0.008249, 0.009276, 0.010830, 0.010965, 0.010226, 0.010257, 0.010406, 0.009754, 0.011265, 0.010202, 0.009809, 0.006232, 0.018502, 0.001725, 0.006357, 0.007832, 0.020103, 0.030935, 0.016966, 0.034927, 0.035857, 0.033932, 0.027356
#*# 	  -0.003383, -0.002701, 0.005716, 0.007811, 0.004029, 0.011679, 0.009550, -0.000431, -0.003410, 0.005545, 0.011261, 0.010692, 0.011446, 0.014945, 0.028939, 0.013817, 0.014621, 0.013259, 0.009970, 0.014598, 0.023159, 0.037027, 0.024253, 0.025414, 0.010117
#*# 	  -0.005563, 0.001644, 0.001702, 0.006228, 0.001413, 0.004553, 0.006026, -0.000107, 0.002373, 0.003516, -0.001751, 0.000206, 0.012771, 0.008380, 0.010240, 0.011863, 0.004734, -0.004031, 0.009505, 0.009412, 0.009485, 0.006431, 0.033130, 0.015101, 0.010276
#*# 	  -0.003369, -0.003855, 0.008811, -0.004155, 0.007663, 0.004211, 0.000055, -0.002784, -0.005408, -0.003264, -0.003875, 0.005165, 0.001457, 0.003914, 0.011264, 0.012998, 0.005609, 0.008414, 0.005752, 0.013735, 0.011180, 0.012695, 0.030522, 0.026410, 0.014221
#*# 	  -0.008230, 0.011273, 0.005683, 0.004869, 0.003030, -0.000192, -0.005605, 0.004357, 0.001479, -0.002459, 0.001056, 0.002787, 0.000668, 0.006187, -0.001231, 0.017515, 0.002226, 0.007157, 0.007692, 0.003193, 0.008213, 0.018620, 0.018577, 0.027391, 0.012184
#*# 	  -0.006205, 0.004117, 0.001819, -0.002443, 0.002946, 0.001372, 0.002424, 0.002752, 0.005103, 0.002614, 0.001109, -0.001863, 0.001897, -0.006252, 0.003297, 0.007208, 0.002255, 0.001640, -0.001127, 0.007622, 0.030964, 0.027830, 0.029440, 0.015484, 0.023209
#*# 	  -0.007370, -0.002644, 0.005358, -0.005969, -0.005389, -0.002868, -0.001871, 0.000130, -0.000237, -0.002660, 0.001208, 0.001118, 0.009893, 0.003475, 0.001046, 0.009452, 0.000299, -0.004760, 0.033097, 0.024004, 0.012132, 0.017567, 0.029093, 0.026157, 0.024880
#*# 	  -0.007292, -0.001899, -0.002194, 0.000465, -0.003362, -0.002425, -0.004352, -0.004483, -0.003301, -0.004793, -0.002640, -0.001119, 0.001010, -0.003832, 0.019741, 0.012417, 0.020530, 0.024327, 0.015712, 0.014536, 0.017363, 0.022795, 0.032538, 0.028838, 0.027270
#*# 	  -0.013809, -0.003421, -0.000702, 0.002770, 0.006150, 0.002705, 0.004768, -0.001913, 0.003098, 0.003692, -0.002239, 0.001433, 0.007299, -0.002030, -0.000611, 0.021157, 0.017174, 0.024591, 0.010848, 0.019598, 0.029203, 0.030261, 0.029461, 0.037319, 0.029247
#*# 	  -0.008273, 0.004120, -0.000362, 0.000089, 0.007373, 0.006193, 0.017035, 0.001037, 0.019811, -0.000278, 0.009004, -0.001745, 0.007457, 0.002694, 0.011274, 0.026122, 0.024599, 0.025251, 0.030033, 0.023107, 0.027450, 0.032370, 0.027454, 0.022201, 0.026324
#*# 	  0.001139, 0.009659, 0.010733, 0.001743, 0.000503, 0.010104, 0.018717, 0.020446, -0.000970, -0.000525, 0.001825, 0.010189, 0.009379, 0.017587, 0.012739, 0.022257, 0.023088, 0.022007, 0.024891, 0.028864, 0.035117, 0.038998, 0.043232, 0.036564, 0.032150
#*# 	  0.002192, 0.000913, 0.000228, 0.004415, -0.001526, 0.008522, -0.004027, 0.008732, -0.000711, 0.009834, 0.011737, 0.007945, 0.003419, 0.006430, 0.018261, 0.015227, 0.019057, 0.020689, 0.021702, 0.028195, 0.026748, 0.036420, 0.039522, 0.042492, 0.029159
#*# 	  -0.015026, -0.000455, 0.006165, -0.004847, 0.002282, 0.001188, 0.003784, -0.016486, -0.013268, -0.004136, 0.001627, -0.001721, 0.013292, 0.008342, 0.000911, 0.013517, 0.015409, 0.014829, 0.018981, 0.017075, 0.017227, 0.021443, 0.034617, 0.024766, 0.023906
#*# 	  -0.016747, -0.007705, -0.002680, -0.011274, 0.002291, -0.001834, 0.001949, -0.005982, -0.008515, -0.002087, -0.006083, 0.000689, -0.003939, 0.007055, 0.002746, 0.007870, 0.011614, 0.015388, 0.016459, 0.017143, 0.016700, 0.014386, 0.018381, 0.021849, 0.016937
#*# 	  -0.013428, 0.003748, 0.007589, -0.001151, -0.004256, 0.004226, 0.003025, -0.008621, 0.005314, -0.002818, -0.012686, -0.010922, 0.004401, 0.007778, 0.009093, 0.006940, 0.009670, 0.010636, 0.016971, 0.016393, 0.013317, 0.015979, 0.016404, 0.018124, 0.015412
#*# 	  0.003529, 0.007571, 0.005147, 0.005405, -0.008054, -0.002306, 0.001002, 0.003581, -0.002985, -0.013536, 0.003167, 0.009080, 0.004012, 0.004227, 0.006705, 0.013956, 0.013437, 0.014468, 0.014385, 0.015236, 0.015142, 0.017540, 0.021747, 0.014334, 0.015349
#*# 	  -0.024956, 0.002673, 0.007329, 0.010468, 0.003432, 0.011321, 0.010025, 0.005250, 0.006519, 0.008048, 0.000982, 0.009835, 0.006945, 0.003678, 0.009655, 0.009188, 0.011928, 0.011540, 0.010104, 0.011806, 0.015098, 0.012568, 0.014092, 0.013551, 0.008877
#*# 	  -0.007471, -0.009184, 0.003245, -0.006721, -0.008958, -0.007678, 0.004137, 0.005719, -0.009130, -0.005433, -0.000194, -0.002892, -0.018734, 0.009282, 0.010048, 0.004517, -0.012460, 0.005185, 0.009786, 0.002275, 0.005542, 0.006713, 0.006609, 0.005607, 0.006668
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 210.0
#*# min_y = 30.0
#*# max_y = 208.0
#*#
#*# [beacon model default]
#*# model_coef = 1.9986101587394336,
#*# 	  2.2330294655815703,
#*# 	  0.5683538419617058,
#*# 	  0.27303609554992636,
#*# 	  -0.13052055779098906,
#*# 	  -0.5026341317225997,
#*# 	  0.33763613969702233,
#*# 	  0.8024061151415637,
#*# 	  -0.15799795308980943,
#*# 	  -0.378283680492853
#*# model_domain = 3.356731262483608e-07,3.361668943651104e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 69.596304
#*# model_offset = -0.16000
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 77.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 51.6
#*#
#*# [beacon model pei_hot]
#*# model_coef = 1.9263519575030055,
#*# 	2.1946743347503372,
#*# 	0.6208794249910773,
#*# 	0.2775896555222557,
#*# 	0.06526221562750463,
#*# 	-0.2611119885640586,
#*# 	-0.05461829170887029,
#*# 	0.36810740679885895,
#*# 	0.05685001457152785,
#*# 	-0.15547240310186372
#*# model_domain = 3.351987055417817e-07,3.359664588035842e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 63.925584
#*# model_offset = 0.00000
