[include moonraker_obico_macros.cfg]
##########################
##### BASE CONFIG #######
##########################

[include mainsail.cfg]
[include ./backup/backup.cfg]

##########################
##### HARDWARE STUFF #####
##########################

[include ./hardware/xyz-stepper.cfg]
[include ./hardware/extruder.cfg]
#[include ./klicky/klicky-probe.cfg]
#[include ./hardware/adxl345.cfg]  This config now in canbus.cfg
[include ./hardware/fans.cfg] # Some fans config in canbus.cfg
[include ./hardware/canbus.cfg]

##########################
##### LIGHTS #############
##########################

[include ./hardware/chamber-lighting.cfg]
[include ./hardware/stealthburner-led.cfg]

##########################
##### CALIBRATION ########
##########################

[include ./calibration/z-tilt.cfg]
[include ./calibration/bed-mesh.cfg]
[include ./macros/unsafe.cfg]
[include ./calibration/pressure_advance.cfg]
[include ./calibration/test_speed.cfg]
[include ./calibration/pika.cfg]
[include test_probe_accuracy.cfg]

##########################
##### MACROS #############
##########################

[include ./macros/chamber-led.cfg]
[include ./macros/conditional-homing.cfg]
[include ./macros/print-end.cfg]
[include ./macros/print-start-mmu.cfg]
[include ./macros/dump-variables.cfg]
[include ./macros/movement-check.cfg]
[include ./macros/cancel-change.cfg]
[include ./macros/pause-resume.cfg]         ; Overridden by ERCF / subsequantly disabled
[include ./macros/load-unload.cfg]
[include ./macros/filament-change.cfg]
[include ./macros/park.cfg]
[include ./macros/heatsoak.cfg]

##########################
##### THIRD PARTY ########
##########################

#[include ./third-party-cfg/nozzle_scrub.cfg]
[include KAMP_Settings.cfg]

##########################
##### ERCF ###############
##########################

[include mmu/base/*.cfg]
[include macros/mmu_adds.cfg]
[include mmu/optional/mmu_ercf_cutter.cfg]

##########################
##### LCD/MENU ###########
##########################

#[include ./third-party-cfg/nozzle_scrub_menu.cfg]
#[include ./menu/printer_menu.cfg]

##########################
##### NOT ENABLED YET ####
##########################

#[include ./todo/mini12864.cfg] Add this after adding mini12864 LED
#[include ./todo/lcd_tweaks.cfg] Need to figure this one out and then implement
#[include ./hardware/nevermore.cfg] Disabled as I prefer to chamber vent outside and needed the PWM

##########################
#### REPLACEMENT #########
##########################

[include ./replacement_macros/replace-m900.cfg]
[include ./replacement_macros/replace-m117.cfg]

[exclude_object]

[gcode_arcs]
resolution: 0.1

[respond]
default_type: echo
default_prefix:  

[force_move]
# Enable commands that force potentially unsafe movement
enable_force_move: True

[idle_timeout]
timeout: 14400

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_290040000750314D35323820-if00
restart_method: command

[mcu rpi]
# Add Rpi as secondary MCU to allow for ADXL use through SPI ribbon/adapter from LDO
serial: /tmp/klipper_host_mcu

[mcu sht]
canbus_uuid: 30993412e8e0

[printer]
kinematics: corexy
max_velocity: 200           # Changed from 200 on 7.11.23
max_accel:  6000            # tuned on 7.11.23 after beacon install.
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0 # Changed on 7.11.23

#####################################################################
#   Input Shaper
#####################################################################

[input_shaper]
#shaper_freq_x: 76.2               ; suggested max_accel <= 22600 mm/sec^2
#shaper_type_x: zv
#shaper_freq_y: 51.8               ; suggested max_accel <= 7900 mm/sec^2
#shaper_type_y: mzv


#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
heater_pin: PA2 #PA2 is LDO default
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 125
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  WAS TAP - NOW BEACON in CANBUS

#####################################################################
#   Additional Sensors
#####################################################################

[thermistor CMFB103F3950FANT]
temperature1: 0.0
resistance1: 32116.0
temperature2: 40.0
resistance2: 5309.0
temperature3: 80.0
resistance3: 1228.0

#[temperature_sensor sb_ambient_temp]
## Chamber Temperature - T1
#sensor_type: CMFB103F3950FANT
#sensor_pin: PF5
#min_temp: 0
#max_temp: 100
#gcode_id: chamber_th

[temperature_sensor back_chamber_temp]
## Chamber Temperature - T
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF6
min_temp: 0
max_temp: 100
gcode_id: chamber_th2

[temperature_sensor RPi4]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################

#[safe_z_home]
##  XY Location of the Z Endstop Switch
##  Update -10,-10 to the XY coordinates of your endstop pin 
##  (such as 157,305) after going through Z Endstop Pin
##  Location Definition step.
#home_xy_position: 147,256
#speed:100
#z_hop:10
#z_hop_speed:10


########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.889
#*# pid_ki = 0.964
#*# pid_kd = 412.851
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.022537, -0.012942, -0.000611, 0.007178, 0.007051, 0.008298, 0.013267, 0.014769, 0.015747, 0.016489, 0.019586, 0.023263, 0.018250, 0.014195, 0.013631, 0.011564, 0.016472, 0.011706, 0.022407, 0.041864, 0.047187, 0.050548, 0.049998, 0.049465, 0.046445
#*# 	  -0.013403, -0.006275, 0.007192, 0.005952, 0.007188, 0.011518, 0.010749, 0.017652, 0.014342, 0.015966, 0.019756, 0.017818, 0.014053, 0.011072, 0.017458, 0.014065, 0.019755, 0.009616, 0.021858, 0.029372, 0.042328, 0.057460, 0.057331, 0.058014, 0.050063
#*# 	  -0.012851, 0.003157, 0.007154, 0.013079, 0.016750, 0.006047, 0.008128, 0.010592, 0.005427, 0.015435, 0.004920, 0.016230, 0.017103, 0.010930, 0.014255, 0.019168, -0.000927, 0.023218, 0.027089, 0.037187, 0.044105, 0.052012, 0.059261, 0.061004, 0.051278
#*# 	  -0.012074, -0.005379, -0.000387, -0.002553, 0.000402, 0.001993, 0.004145, 0.004026, 0.003446, 0.006365, 0.006855, 0.010908, 0.010872, 0.016276, 0.009836, 0.014477, 0.011942, 0.022612, 0.027095, 0.038541, 0.047653, 0.051630, 0.063100, 0.062926, 0.058690
#*# 	  -0.022125, -0.009087, -0.011066, -0.007466, -0.014119, 0.001974, -0.000462, 0.004554, -0.002571, 0.002948, 0.000949, 0.004125, 0.012444, 0.013048, 0.010190, 0.017394, -0.004567, 0.023807, 0.031800, 0.029425, 0.046703, 0.062782, 0.063721, 0.060420, 0.058017
#*# 	  -0.016762, -0.015117, -0.002193, -0.014163, -0.010228, -0.000990, -0.005502, -0.005728, 0.003074, 0.001313, 0.000865, 0.005792, 0.009047, 0.019256, 0.023161, 0.007482, 0.022786, 0.029890, 0.031062, 0.035760, 0.044756, 0.053270, 0.062203, 0.064946, 0.055322
#*# 	  -0.025240, -0.017961, -0.010974, -0.010899, -0.010902, -0.021561, -0.008959, -0.008735, 0.002038, -0.003939, 0.002490, 0.003583, 0.007919, 0.013474, 0.006951, 0.024331, 0.022316, 0.022666, 0.024738, 0.034029, 0.041565, 0.041860, 0.064902, 0.053789, 0.057166
#*# 	  -0.035586, -0.024655, -0.019988, -0.013000, -0.016017, -0.017229, -0.013856, -0.012563, -0.013573, -0.009715, -0.005889, 0.000507, 0.009979, 0.013592, 0.022960, 0.024922, 0.016010, 0.027775, 0.030522, 0.033424, 0.038201, 0.043352, 0.061481, 0.058714, 0.059722
#*# 	  -0.034332, -0.017098, -0.018754, -0.022065, -0.018138, -0.022651, -0.014627, -0.015267, -0.015325, -0.012943, -0.000260, 0.001505, 0.008886, 0.022681, 0.017945, 0.022657, 0.022153, 0.021307, 0.021968, 0.033273, 0.032619, 0.047485, 0.052656, 0.060289, 0.047973
#*# 	  -0.032086, -0.024529, -0.018255, -0.016074, -0.018205, -0.013957, -0.015779, -0.011322, -0.006173, -0.001440, -0.004325, -0.001594, 0.001966, 0.022334, 0.014608, 0.018011, 0.016188, 0.024436, 0.022815, 0.025909, 0.022467, 0.039611, 0.048548, 0.051453, 0.041903
#*# 	  -0.020601, -0.023413, -0.020550, -0.013511, -0.014535, -0.016003, -0.018824, -0.015237, -0.019628, -0.004994, -0.018119, -0.001319, 0.001159, -0.002163, 0.008174, 0.019088, 0.010337, 0.007659, 0.015663, 0.027128, 0.033823, 0.042325, 0.046272, 0.055934, 0.048614
#*# 	  -0.030317, -0.019491, -0.016267, -0.016215, -0.013104, -0.014914, -0.008113, -0.018987, -0.016719, -0.003582, -0.003884, 0.001784, 0.007815, 0.016487, 0.010172, 0.006120, 0.014921, 0.015016, 0.024286, 0.032844, 0.036033, 0.037616, 0.044140, 0.061831, 0.050560
#*# 	  -0.022501, -0.019641, -0.020600, -0.017851, -0.016373, -0.013791, -0.012520, -0.020941, -0.010188, 0.001244, -0.003083, -0.003944, 0.002971, -0.003111, -0.001498, 0.017107, 0.007498, 0.016376, 0.013474, 0.026060, 0.032321, 0.056540, 0.049173, 0.059709, 0.052344
#*# 	  -0.030095, -0.015963, -0.018628, -0.013346, -0.013196, -0.013288, -0.013373, -0.012058, -0.003515, -0.005251, -0.001716, 0.002325, -0.006794, 0.008357, -0.001422, 0.016070, -0.001246, 0.014265, 0.018865, 0.025518, 0.033131, 0.053920, 0.053149, 0.063510, 0.057264
#*# 	  -0.042988, -0.029587, -0.015409, -0.020402, -0.011730, -0.018295, -0.013384, -0.017095, -0.009887, -0.005169, -0.000902, -0.003090, 0.004054, -0.001074, -0.004076, 0.006313, 0.003655, 0.009701, 0.022143, 0.025999, 0.037568, 0.034885, 0.062324, 0.062194, 0.059838
#*# 	  -0.038702, -0.027905, -0.017480, -0.015084, -0.012567, -0.011289, -0.009351, -0.004688, -0.011730, -0.005946, -0.006018, -0.003600, -0.004341, 0.004879, -0.003701, 0.015775, 0.021381, 0.010732, 0.013516, 0.024787, 0.036189, 0.058702, 0.058887, 0.068638, 0.062156
#*# 	  -0.030899, -0.023831, -0.019678, -0.011324, -0.009970, -0.014924, -0.011479, -0.004800, -0.006934, -0.006298, -0.003363, -0.004135, 0.006466, -0.003009, 0.012608, 0.020001, 0.017971, 0.022686, 0.024185, 0.032513, 0.043880, 0.054370, 0.069471, 0.069148, 0.068430
#*# 	  -0.036622, -0.021198, -0.012257, -0.006471, -0.013428, -0.006555, -0.002900, -0.006526, -0.008203, -0.006505, -0.002075, -0.005260, 0.009037, -0.005966, 0.008781, 0.004813, 0.011502, 0.026606, 0.029937, 0.032127, 0.045209, 0.066338, 0.069401, 0.074944, 0.078578
#*# 	  -0.037071, -0.023137, -0.012814, -0.023545, -0.007487, -0.009295, -0.007439, -0.006181, -0.003946, -0.006575, -0.003536, -0.001191, 0.004152, 0.006312, 0.006096, 0.009262, 0.024499, 0.028973, 0.030424, 0.037196, 0.047839, 0.063961, 0.070750, 0.079791, 0.082819
#*# 	  -0.033150, -0.028105, -0.016676, -0.007792, -0.007512, -0.005406, -0.009670, -0.006200, -0.009955, -0.006122, -0.006875, -0.006914, -0.005423, -0.004241, 0.009069, 0.020405, 0.026453, 0.023336, 0.032445, 0.032108, 0.047239, 0.052421, 0.068011, 0.070925, 0.077056
#*# 	  -0.037013, -0.017948, -0.013385, -0.028317, -0.013420, -0.009512, -0.009045, -0.006527, -0.012714, -0.012217, -0.008624, -0.006463, -0.003585, -0.003551, 0.004192, 0.014691, 0.020633, 0.020837, 0.025416, 0.027575, 0.035530, 0.045476, 0.064286, 0.070166, 0.069796
#*# 	  -0.042397, -0.024465, -0.014347, -0.013568, -0.012877, -0.008190, -0.015557, -0.008491, -0.019795, -0.018384, -0.009712, -0.005529, -0.010962, -0.005992, 0.005292, 0.002540, 0.017513, 0.025195, 0.027588, 0.028577, 0.032150, 0.045654, 0.062278, 0.064261, 0.053553
#*# 	  -0.044579, -0.028721, -0.015416, -0.027018, -0.028041, -0.006348, -0.018015, -0.007245, -0.029543, -0.024409, -0.008487, -0.011266, -0.006812, -0.005770, -0.003808, 0.002029, 0.017358, 0.025020, 0.024948, 0.028856, 0.032861, 0.035573, 0.047725, 0.066575, 0.054798
#*# 	  -0.043597, -0.027076, -0.021555, -0.017741, -0.008840, -0.014772, -0.010571, -0.013774, -0.009235, -0.007799, -0.011866, -0.016528, -0.007814, -0.006229, -0.006026, -0.003378, 0.007221, 0.014344, 0.030861, 0.026907, 0.028349, 0.030924, 0.043606, 0.053471, 0.047599
#*# 	  -0.046347, -0.037087, -0.030716, -0.031288, -0.030143, -0.023119, -0.034570, -0.026671, -0.024663, -0.025929, -0.022925, -0.008440, -0.008209, -0.008167, -0.008574, -0.001685, -0.002481, 0.009647, 0.010517, 0.017029, 0.027148, 0.030912, 0.041962, 0.038575, 0.041358
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 210.0
#*# min_y = 30.0
#*# max_y = 210.0
#*#
#*# [beacon model default]
#*# model_coef = 1.9263519575030055,
#*# 	2.1946743347503372,
#*# 	0.6208794249910773,
#*# 	0.2775896555222557,
#*# 	0.06526221562750463,
#*# 	-0.2611119885640586,
#*# 	-0.05461829170887029,
#*# 	0.36810740679885895,
#*# 	0.05685001457152785,
#*# 	-0.15547240310186372
#*# model_domain = 3.351987055417817e-07,3.359664588035842e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 63.925584
#*# model_offset = 1.38000
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 77.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 51.6
#*#
#*# [beacon model pei_hot]
#*# model_coef = 1.9263519575030055,
#*# 	2.1946743347503372,
#*# 	0.6208794249910773,
#*# 	0.2775896555222557,
#*# 	0.06526221562750463,
#*# 	-0.2611119885640586,
#*# 	-0.05461829170887029,
#*# 	0.36810740679885895,
#*# 	0.05685001457152785,
#*# 	-0.15547240310186372
#*# model_domain = 3.351987055417817e-07,3.359664588035842e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 63.925584
#*# model_offset = 0.00000
