##########################
##### BASE CONFIG #######
##########################

[include mainsail.cfg]
[include ./backup/backup.cfg]

##########################
##### HARDWARE STUFF #####
##########################

[include ./hardware/xyz-stepper.cfg]
[include ./hardware/extruder.cfg]
#[include ./klicky/klicky-probe.cfg]
#[include ./hardware/adxl345.cfg]  This config now in canbus.cfg
[include ./hardware/fans.cfg] # Some fans config in canbus.cfg
[include ./hardware/canbus.cfg]

##########################
##### LIGHTS #############
##########################

[include ./hardware/chamber-lighting.cfg]
[include ./hardware/stealthburner-led.cfg]

##########################
##### CALIBRATION ########
##########################

[include ./calibration/z-tilt.cfg]
[include ./calibration/bed-mesh.cfg]
[include ./macros/unsafe.cfg]
[include ./calibration/pressure_advance.cfg]
[include ./calibration/test_speed.cfg]
[include ./calibration/pika.cfg]
[include test_probe_accuracy.cfg]

##########################
##### MACROS #############
##########################

[include ./macros/chamber-led.cfg]
[include ./macros/conditional-homing.cfg]
[include ./macros/print-end.cfg]
[include ./macros/print-start-mmu.cfg]
[include ./macros/dump-variables.cfg]
[include ./macros/movement-check.cfg]
[include ./macros/cancel-change.cfg]
[include ./macros/pause-resume.cfg]         ; Overridden by ERCF / subsequantly disabled
[include ./macros/load-unload.cfg]
[include ./macros/filament-change.cfg]
[include ./macros/park.cfg]
#[include ./macros/prusaslicer-accel.cfg]

##########################
##### THIRD PARTY ########
##########################

#[include ./third-party-cfg/nozzle_scrub.cfg]
[include KAMP_Settings.cfg]

##########################
##### ERCF ###############
##########################

[include mmu/base/*.cfg]
[include macros/mmu_adds.cfg]



##########################
##### LCD/MENU ###########
##########################

#[include ./third-party-cfg/nozzle_scrub_menu.cfg]
#[include ./menu/printer_menu.cfg]

##########################
##### NOT ENABLED YET ####
##########################

#[include ./todo/mini12864.cfg] Add this after adding mini12864 LED
#[include ./todo/lcd_tweaks.cfg] Need to figure this one out and then implement
#[include ./hardware/nevermore.cfg] Disabled as I prefer to chamber vent outside and needed the PWM

##########################
#### REPLACEMENT #########
##########################

[include ./replacement_macros/replace-m900.cfg]
[include ./replacement_macros/replace-m117.cfg]

[exclude_object]

[gcode_arcs]
resolution: 0.1

[respond]
default_type: echo
default_prefix:  

[force_move]
# Enable commands that force potentially unsafe movement
enable_force_move: True

[idle_timeout]
timeout: 14400

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_290040000750314D35323820-if00
restart_method: command

[mcu rpi]
# Add Rpi as secondary MCU to allow for ADXL use through SPI ribbon/adapter from LDO
serial: /tmp/klipper_host_mcu

[mcu sht]
canbus_uuid: 30993412e8e0

[printer]
kinematics: corexy
max_velocity: 200           # Changed from 200 on 7.11.23
max_accel:  6000            # tuned on 7.11.23 after beacon install.
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0 # Changed on 7.11.23

#####################################################################
#   Input Shaper
#####################################################################

[input_shaper]
#shaper_freq_x: 76.2               ; suggested max_accel <= 22600 mm/sec^2
#shaper_type_x: zv
#shaper_freq_y: 51.8               ; suggested max_accel <= 7900 mm/sec^2
#shaper_type_y: mzv


#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
heater_pin: PA2 #PA2 is LDO default
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 125
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  WAS TAP - NOW BEACON in CANBUS

#####################################################################
#   Additional Sensors
#####################################################################

[thermistor CMFB103F3950FANT]
temperature1: 0.0
resistance1: 32116.0
temperature2: 40.0
resistance2: 5309.0
temperature3: 80.0
resistance3: 1228.0

#[temperature_sensor sb_ambient_temp]
## Chamber Temperature - T1
#sensor_type: CMFB103F3950FANT
#sensor_pin: PF5
#min_temp: 0
#max_temp: 100
#gcode_id: chamber_th

[temperature_sensor back_chamber_temp]
## Chamber Temperature - T
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF6
min_temp: 0
max_temp: 100
gcode_id: chamber_th2

[temperature_sensor RPi4]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################

#[safe_z_home]
##  XY Location of the Z Endstop Switch
##  Update -10,-10 to the XY coordinates of your endstop pin 
##  (such as 157,305) after going through Z Endstop Pin
##  Location Definition step.
#home_xy_position: 147,256
#speed:100
#z_hop:10
#z_hop_speed:10


########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.889
#*# pid_ki = 0.964
#*# pid_kd = 412.851
#*#
#*# [probe]
#*# z_offset = -1.270
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.016035, -0.012671, -0.018198, -0.013616, -0.019746, -0.012410, -0.018226, -0.013089, -0.013511, -0.015233, -0.012485, -0.016175, -0.012523, -0.013287, 0.002226, 0.008373, 0.022164
#*# 	  -0.014320, -0.011209, -0.014694, -0.012714, -0.014795, -0.014262, -0.017621, -0.015636, -0.017518, -0.014141, -0.013839, -0.012428, -0.007253, -0.005550, 0.006588, 0.016241, 0.024615
#*# 	  -0.012194, -0.013769, -0.013984, -0.011884, -0.010656, -0.013162, -0.010080, -0.010286, -0.015064, -0.015461, -0.010956, -0.006811, -0.010757, -0.007309, 0.004196, 0.004820, 0.026232
#*# 	  -0.011772, -0.015299, -0.010717, -0.017580, -0.011292, -0.015776, -0.014956, -0.016161, -0.011819, -0.014449, -0.014419, -0.006446, -0.005638, -0.008461, -0.001825, 0.011312, 0.024190
#*# 	  -0.017485, -0.017602, -0.018023, -0.015898, -0.016909, -0.018416, -0.019769, -0.016782, -0.018316, -0.012491, -0.013030, -0.010770, -0.020216, -0.007780, -0.007305, -0.000105, 0.008628
#*# 	  -0.013752, -0.013575, -0.013697, -0.014610, -0.014248, -0.010081, -0.012942, -0.011519, -0.012698, -0.019829, -0.009108, -0.005970, -0.017152, -0.002682, -0.021440, -0.003361, -0.006241
#*# 	  -0.008274, -0.011009, -0.016934, -0.015893, -0.021473, -0.013234, -0.020109, -0.005944, -0.021712, -0.008042, -0.004494, -0.012308, -0.003573, -0.011513, -0.004605, -0.006037, -0.006942
#*# 	  -0.011192, -0.009859, -0.009710, -0.003356, -0.018330, -0.002950, -0.003354, -0.005632, -0.006809, -0.008024, -0.007112, -0.003951, -0.007199, -0.004722, -0.008260, -0.004587, -0.004894
#*# 	  -0.009539, -0.009161, -0.002049, -0.003079, -0.004135, -0.003556, -0.008014, -0.003136, -0.007659, -0.003971, -0.002999, -0.002055, -0.002326, -0.003119, -0.006282, -0.000740, -0.002929
#*# 	  -0.005484, -0.002610, -0.002245, -0.001728, -0.000026, -0.002970, -0.001819, -0.000502, -0.001545, -0.002160, -0.001317, -0.002566, -0.001889, -0.002129, -0.003010, -0.001363, 0.001314
#*# 	  -0.001091, 0.003642, -0.000617, 0.001274, -0.000506, -0.001217, 0.004628, 0.005339, 0.000587, 0.001883, 0.006221, 0.006168, -0.000144, 0.001101, -0.000314, 0.002557, 0.005721
#*# 	  0.005107, 0.000933, 0.000326, 0.001906, 0.002381, 0.007719, 0.008490, 0.006959, 0.009094, 0.007540, 0.005248, 0.007306, 0.010078, 0.005719, 0.012109, 0.009414, 0.011834
#*# 	  0.005147, 0.007261, 0.006696, 0.008689, 0.006356, 0.006727, 0.013043, 0.010994, 0.010562, 0.004265, 0.014740, 0.010380, 0.010288, 0.011155, 0.018815, 0.016352, 0.022692
#*# 	  0.004698, 0.008618, 0.004656, 0.007001, 0.008101, 0.010536, 0.009618, 0.011392, 0.008822, 0.015674, 0.003770, 0.016833, 0.001240, 0.010850, 0.016522, 0.020855, 0.022807
#*# 	  0.005676, 0.007924, 0.004240, 0.003862, 0.004115, 0.009913, 0.006456, 0.010330, 0.008011, 0.012298, 0.016571, 0.015635, 0.019165, 0.016115, 0.021821, 0.022515, 0.024122
#*# 	  0.005517, 0.006013, 0.007730, 0.001958, 0.002352, -0.000841, 0.002991, 0.006611, 0.010967, 0.013398, 0.011089, 0.011339, 0.018499, 0.008216, 0.008098, 0.019149, 0.022387
#*# 	  0.005275, 0.000410, 0.001728, -0.000819, 0.001984, 0.001462, 0.002826, 0.006147, 0.008586, 0.008810, 0.009798, 0.013118, 0.009250, 0.021101, 0.013777, 0.020726, 0.021321
#*# x_count = 17
#*# y_count = 17
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 66.722
#*# max_x = 179.282
#*# min_y = 66.71
#*# max_y = 179.286
#*#
#*# [beacon model default]
#*# model_coef = 1.9257982386737142,
#*# 	  2.1904011986275074,
#*# 	  0.5881661108028357,
#*# 	  0.30341866940870527,
#*# 	  0.14823890288711727,
#*# 	  -0.42807822476666274,
#*# 	  -0.13716254071061182,
#*# 	  0.612855529187592,
#*# 	  0.08376843001203003,
#*# 	  -0.2664564217100284
#*# model_domain = 3.352922478536077e-07,3.360945745364866e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 72.578002
#*# model_offset = -0.04500
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 77.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 51.6
