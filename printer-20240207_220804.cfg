[include moonraker_obico_macros.cfg]
##########################
##### BASE CONFIG #######
##########################

[include mainsail.cfg]
[include ./backup/backup.cfg]

##########################
##### HARDWARE STUFF #####
##########################

[include ./hardware/xyz-stepper.cfg]
[include ./hardware/extruder.cfg]
#[include ./klicky/klicky-probe.cfg]
#[include ./hardware/adxl345.cfg]  This config now in canbus.cfg
[include ./hardware/fans.cfg] # Some fans config in canbus.cfg
[include ./hardware/canbus.cfg]

##########################
##### LIGHTS #############
##########################

[include ./hardware/chamber-lighting.cfg]
[include ./hardware/stealthburner-led.cfg]

##########################
##### CALIBRATION ########
##########################

[include ./calibration/z-tilt.cfg]
[include ./calibration/bed-mesh.cfg]
[include ./macros/unsafe.cfg]
[include ./calibration/pressure_advance.cfg]
[include ./calibration/test_speed.cfg]
[include ./calibration/pika.cfg]
[include ./calibration/microadjust.cfg]
[include ./calibration/sensorless.cfg]
[include test_probe_accuracy.cfg]
[include K-ShakeTune/*.cfg]

##########################
##### MACROS #############
##########################

[include ./macros/chamber-led.cfg]
[include ./macros/conditional-homing.cfg]
[include ./macros/print-end.cfg]
[include ./macros/print-start-mmu.cfg]
[include ./macros/dump-variables.cfg]
[include ./macros/movement-check.cfg]
[include ./macros/cancel-change.cfg]
[include ./macros/pause-resume.cfg]         ; Overridden by ERCF / subsequantly disabled
[include ./macros/load-unload.cfg]
[include ./macros/filament-change.cfg]
[include ./macros/park.cfg]
[include ./macros/heatsoak.cfg]

##########################
##### THIRD PARTY ########
##########################

#[include ./third-party-cfg/nozzle_scrub.cfg]
[include KAMP_Settings.cfg]

##########################
##### ERCF ###############
##########################

#[include mmu/base/*.cfg]
#[include macros/mmu_adds.cfg]
#[include mmu/optional/mmu_ercf_cutter.cfg]

##########################
##### LCD/MENU ###########
##########################

#[include ./third-party-cfg/nozzle_scrub_menu.cfg]
#[include ./menu/printer_menu.cfg]

##########################
##### NOT ENABLED YET ####
##########################

#[include ./todo/mini12864.cfg] Add this after adding mini12864 LED
#[include ./todo/lcd_tweaks.cfg] Need to figure this one out and then implement
#[include ./hardware/nevermore.cfg] Disabled as I prefer to chamber vent outside and needed the PWM

##########################
#### REPLACEMENT #########
##########################

[include ./replacement_macros/replace-m900.cfg]
[include ./replacement_macros/replace-m117.cfg]

[exclude_object]

[gcode_arcs]
resolution: 0.1

[respond]
default_type: echo
default_prefix:  

[force_move]
# Enable commands that force potentially unsafe movement
enable_force_move: True

[idle_timeout]
timeout: 14400

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_290040000750314D35323820-if00
restart_method: command

[mcu rpi]
# Add Rpi as secondary MCU to allow for ADXL use through SPI ribbon/adapter from LDO
serial: /tmp/klipper_host_mcu

[mcu sht]
canbus_uuid: 30993412e8e0

[printer]
kinematics: corexy           # TESTING HIGHER SPEEDS ON 2/7/24 DUE TO SLICER SLOWWWWWWWW / ALSO SET IN PRINT START
max_velocity: 450            # Changed from 200 on 7.11.23
max_accel: 10000             # tuned on 7.11.23 after beacon install.
max_accel_to_decel:5000
max_z_velocity: 15           #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0 # Changed on 7.11.23

#####################################################################
#   Input Shaper
#####################################################################

[input_shaper]
shaper_freq_x: 71.0
shaper_type_x: mzv # 14900
shaper_freq_y: 47.8
shaper_type_y: mzv # 6700
damping_ratio_x: 0.043
damping_ratio_y: 0.055
# Not Noisy: 20-22.5 / 60.6-96.7 / 30.2-48 / 111.4-200 mm/s

#####################################################################
#   AutoTune / https://github.com/andrewmcgr/klipper_tmc_autotune
#####################################################################

#[motor_constants ldo-42sth48-2004mah_vrn]
#resistance: 1.45
#inductance: 0.002
#holding_torque: 0.40
#max_current: 2.0
#steps_per_revolution: 400

#[autotune_tmc stepper_x]
#motor: ldo-42sth48-2004mah_vrn
#sg4_thrs: 105
#tuning_goal: silent
#[autotune_tmc stepper_y]
#motor: ldo-42sth48-2004mah_vrn
#tuning_goal: silent

#[autotune_tmc stepper_z]
#motor: ldo-42sth40-1684l300e
#[autotune_tmc stepper_z1]
#motor: ldo-42sth40-1684l300e
#[autotune_tmc stepper_z2]
#motor: ldo-42sth40-1684l300e

#[autotune_tmc extruder]
#motor: moons-cse14hra1l410a

#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
heater_pin: PA2 #PA2 is LDO default
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 1
min_temp: 0
max_temp: 125
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  WAS TAP - NOW BEACON in CANBUS

#####################################################################
#   Additional Sensors
#####################################################################

[thermistor CMFB103F3950FANT]
temperature1: 0.0
resistance1: 32116.0
temperature2: 40.0
resistance2: 5309.0
temperature3: 80.0
resistance3: 1228.0

#[temperature_sensor sb_ambient_temp]
## Chamber Temperature - T1
#sensor_type: CMFB103F3950FANT
#sensor_pin: PF5
#min_temp: 0
#max_temp: 100
#gcode_id: chamber_th

[temperature_sensor back_chamber_temp]
## Chamber Temperature - T
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF6
min_temp: 0
max_temp: 100
gcode_id: chamber_th2

[temperature_sensor RPi4]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.889
#*# pid_ki = 0.964
#*# pid_kd = 412.851
#*#
#*# [beacon model default]
#*# model_coef = 1.4512742510883585,
#*# 	1.761046808550891,
#*# 	0.7522864365853444,
#*# 	0.3549299144690959,
#*# 	0.31534556763425187,
#*# 	0.38069145890810696,
#*# 	-0.06467795303797856,
#*# 	-0.28719882396266333,
#*# 	0.145761488672838,
#*# 	0.19251093552947954
#*# model_domain = 3.1531639165734805e-07,3.326954675116541e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 66.388976
#*# model_offset = 0.01000
#*#
#*# [beacon model pei_hot]
#*# model_coef = 1.9263519575030055,
#*# 	2.1946743347503372,
#*# 	0.6208794249910773,
#*# 	0.2775896555222557,
#*# 	0.06526221562750463,
#*# 	-0.2611119885640586,
#*# 	-0.05461829170887029,
#*# 	0.36810740679885895,
#*# 	0.05685001457152785,
#*# 	-0.15547240310186372
#*# model_domain = 3.351987055417817e-07,3.359664588035842e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 63.925584
#*# model_offset = 0.00000
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.001871, -0.011942, -0.021425, -0.030337, -0.035895, -0.040335, -0.043615, -0.045827, -0.046918, -0.048824, -0.053961, -0.058540, -0.058140, -0.056944, -0.055993, -0.054211, -0.053397, -0.054886, -0.055925, -0.056570, -0.054886, -0.051843, -0.047952, -0.039559, -0.026554
#*# 	  -0.001887, -0.014795, -0.025300, -0.034243, -0.041659, -0.048032, -0.052910, -0.055199, -0.055568, -0.057488, -0.062665, -0.067069, -0.067787, -0.067549, -0.067614, -0.066109, -0.063938, -0.063467, -0.063375, -0.061875, -0.060012, -0.056710, -0.053494, -0.048288, -0.038410
#*# 	  -0.003983, -0.014209, -0.025843, -0.035603, -0.044384, -0.050707, -0.056886, -0.059349, -0.059494, -0.059827, -0.067587, -0.071110, -0.073846, -0.073755, -0.075609, -0.075417, -0.071824, -0.070435, -0.068374, -0.065409, -0.061577, -0.058822, -0.056573, -0.052939, -0.044789
#*# 	  -0.004085, -0.015162, -0.025063, -0.034331, -0.043253, -0.050075, -0.056788, -0.059296, -0.060078, -0.061510, -0.068041, -0.073604, -0.077427, -0.079872, -0.081294, -0.080749, -0.077538, -0.075303, -0.072273, -0.067014, -0.062078, -0.057475, -0.054878, -0.051519, -0.043618
#*# 	  0.001901, -0.013026, -0.018678, -0.027665, -0.034892, -0.042678, -0.047611, -0.050188, -0.052646, -0.056398, -0.064279, -0.071601, -0.076091, -0.079187, -0.080957, -0.080508, -0.077568, -0.073960, -0.070295, -0.064106, -0.057869, -0.051105, -0.046876, -0.042606, -0.034493
#*# 	  0.008274, -0.002524, -0.010796, -0.017770, -0.024639, -0.029517, -0.033250, -0.036006, -0.040241, -0.045640, -0.056209, -0.064935, -0.070516, -0.074088, -0.077396, -0.076860, -0.073462, -0.070060, -0.065766, -0.059006, -0.051757, -0.043471, -0.037202, -0.031188, -0.022096
#*# 	  0.013887, 0.004023, -0.004007, -0.012911, -0.014639, -0.018274, -0.020279, -0.021814, -0.024941, -0.037953, -0.049556, -0.060686, -0.064915, -0.072503, -0.073329, -0.072731, -0.069319, -0.066109, -0.062495, -0.056452, -0.049532, -0.041568, -0.033341, -0.025683, -0.014922
#*# 	  0.021330, 0.011480, 0.004221, -0.001331, -0.005234, -0.006705, -0.007022, -0.007389, -0.012366, -0.024063, -0.038960, -0.050765, -0.058040, -0.062194, -0.063997, -0.061782, -0.059411, -0.057570, -0.054755, -0.049693, -0.043408, -0.036304, -0.029336, -0.019556, -0.006577
#*# 	  0.023770, 0.020247, 0.010601, 0.007920, -0.001055, 0.002049, 0.005719, 0.001839, 0.000972, -0.009740, -0.025660, -0.037382, -0.044830, -0.048307, -0.051678, -0.048837, -0.046788, -0.044206, -0.046043, -0.041556, -0.036167, -0.032000, -0.026044, -0.016960, -0.004075
#*# 	  0.023581, 0.015363, 0.011128, 0.004837, 0.002195, 0.004144, 0.007853, 0.011102, 0.009369, -0.000152, -0.014551, -0.025682, -0.032458, -0.037676, -0.036925, -0.037765, -0.037610, -0.038555, -0.039706, -0.038661, -0.038322, -0.034519, -0.030395, -0.022530, -0.010591
#*# 	  0.019226, 0.011254, 0.007570, 0.001929, 0.002656, 0.003588, 0.009584, 0.015804, 0.014046, 0.007715, -0.004595, -0.014683, -0.022825, -0.025839, -0.028877, -0.029229, -0.032174, -0.035963, -0.039166, -0.041562, -0.042480, -0.042025, -0.040703, -0.035831, -0.025445
#*# 	  0.021341, 0.015955, 0.011065, 0.006865, 0.004406, 0.013195, 0.020181, 0.027504, 0.028237, 0.020621, 0.008663, -0.002890, -0.008572, -0.014939, -0.020409, -0.024326, -0.026884, -0.032558, -0.038319, -0.042583, -0.044801, -0.046464, -0.045922, -0.041883, -0.032224
#*# 	  0.028109, 0.022323, 0.016973, 0.013423, 0.014854, 0.022034, 0.032628, 0.040765, 0.041461, 0.033113, 0.019768, 0.007860, -0.000630, -0.008537, -0.015336, -0.020571, -0.024205, -0.031559, -0.037161, -0.041135, -0.043904, -0.044559, -0.045314, -0.042388, -0.032321
#*# 	  0.032834, 0.025975, 0.020675, 0.017554, 0.020703, 0.028487, 0.038534, 0.047521, 0.047749, 0.038228, 0.023722, 0.009676, 0.000654, -0.007701, -0.015513, -0.020701, -0.023740, -0.029640, -0.034336, -0.037861, -0.039368, -0.039140, -0.040849, -0.037150, -0.027789
#*# 	  0.037197, 0.028293, 0.022104, 0.018143, 0.020967, 0.028866, 0.038827, 0.046738, 0.046536, 0.037379, 0.020354, 0.006030, -0.002910, -0.011383, -0.016861, -0.021073, -0.024901, -0.028172, -0.032601, -0.033988, -0.033919, -0.034082, -0.034323, -0.030701, -0.022868
#*# 	  0.044491, 0.035790, 0.026099, 0.021531, 0.022632, 0.030053, 0.040223, 0.047137, 0.046633, 0.036024, 0.019207, 0.004121, -0.003566, -0.010452, -0.015367, -0.017146, -0.018482, -0.021832, -0.023906, -0.024041, -0.023247, -0.022354, -0.021403, -0.018027, -0.010919
#*# 	  0.049217, 0.039650, 0.027412, 0.019938, 0.020611, 0.026538, 0.038053, 0.044877, 0.043803, 0.032920, 0.014657, 0.001014, -0.006955, -0.011374, -0.013662, -0.014025, -0.014800, -0.016266, -0.017318, -0.017093, -0.014742, -0.012761, -0.011755, -0.008278, -0.001421
#*# 	  0.046388, 0.037465, 0.024896, 0.015623, 0.016144, 0.022668, 0.034884, 0.042863, 0.041663, 0.028698, 0.010853, -0.002757, -0.008588, -0.011497, -0.013255, -0.013209, -0.013028, -0.013415, -0.013422, -0.012666, -0.009870, -0.007617, -0.005664, -0.001317, 0.004733
#*# 	  0.039981, 0.032052, 0.020962, 0.013132, 0.014042, 0.022013, 0.034632, 0.043775, 0.042644, 0.029773, 0.010621, -0.002217, -0.007331, -0.009756, -0.010510, -0.011662, -0.010640, -0.011115, -0.010121, -0.008573, -0.006733, -0.004721, -0.001742, 0.002547, 0.008876
#*# 	  0.029352, 0.021741, 0.013645, 0.009254, 0.012884, 0.020858, 0.033337, 0.042672, 0.041514, 0.028773, 0.010802, -0.002498, -0.007640, -0.010313, -0.012572, -0.013245, -0.012728, -0.012464, -0.010658, -0.009208, -0.007539, -0.005571, -0.004113, 0.000420, 0.008471
#*# 	  0.025850, 0.018044, 0.011040, 0.008777, 0.013849, 0.023360, 0.035777, 0.044716, 0.042626, 0.030648, 0.013168, 0.000069, -0.005340, -0.008649, -0.010058, -0.011067, -0.009851, -0.010021, -0.009086, -0.007528, -0.005794, -0.004866, -0.002833, 0.001193, 0.008966
#*# 	  0.029627, 0.021582, 0.016225, 0.014854, 0.019454, 0.028430, 0.040638, 0.047590, 0.044973, 0.034762, 0.018105, 0.006199, 0.001226, -0.001850, -0.002778, -0.002669, -0.001084, -0.000498, -0.000719, 0.000281, 0.001734, 0.002918, 0.004601, 0.008583, 0.016294
#*# 	  0.035757, 0.027078, 0.022039, 0.020327, 0.024688, 0.033410, 0.042268, 0.048246, 0.046686, 0.035361, 0.021726, 0.011493, 0.007972, 0.004638, 0.005131, 0.005761, 0.008315, 0.007479, 0.006702, 0.007471, 0.008625, 0.010575, 0.012053, 0.016319, 0.023673
#*# 	  0.039835, 0.031311, 0.026668, 0.024740, 0.028611, 0.034298, 0.041757, 0.047124, 0.045410, 0.035965, 0.023113, 0.014081, 0.011681, 0.009896, 0.009731, 0.012072, 0.014126, 0.013150, 0.010993, 0.011943, 0.014257, 0.016147, 0.017588, 0.021713, 0.029026
#*# 	  0.036819, 0.029325, 0.025834, 0.024862, 0.027111, 0.031594, 0.037438, 0.041878, 0.041004, 0.031969, 0.019966, 0.013018, 0.010341, 0.009496, 0.009913, 0.011574, 0.012790, 0.010857, 0.008612, 0.009520, 0.011989, 0.014487, 0.016559, 0.021292, 0.029228
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 210.0
#*# min_y = 30.0
#*# max_y = 208.0
