[include moonraker_obico_macros.cfg]
##########################
##### BASE CONFIG #######
##########################

[include mainsail.cfg]
[include ./backup/backup.cfg]

##########################
##### HARDWARE STUFF #####
##########################

[include ./hardware/xyz-stepper.cfg]
[include ./hardware/extruder.cfg]
#[include ./klicky/klicky-probe.cfg]
#[include ./hardware/adxl345.cfg]  This config now in canbus.cfg
[include ./hardware/fans.cfg] # Some fans config in canbus.cfg
[include ./hardware/canbus.cfg]

##########################
##### LIGHTS #############
##########################

[include ./hardware/chamber-lighting.cfg]
[include ./hardware/stealthburner-led.cfg]

##########################
##### CALIBRATION ########
##########################

[include ./calibration/z-tilt.cfg]
[include ./calibration/bed-mesh.cfg]
[include ./macros/unsafe.cfg]
[include ./calibration/pressure_advance.cfg]
[include ./calibration/test_speed.cfg]
[include ./calibration/pika.cfg]
[include test_probe_accuracy.cfg]

##########################
##### MACROS #############
##########################

[include ./macros/chamber-led.cfg]
[include ./macros/conditional-homing.cfg]
[include ./macros/print-end.cfg]
[include ./macros/print-start-mmu.cfg]
[include ./macros/dump-variables.cfg]
[include ./macros/movement-check.cfg]
[include ./macros/cancel-change.cfg]
[include ./macros/pause-resume.cfg]         ; Overridden by ERCF / subsequantly disabled
[include ./macros/load-unload.cfg]
[include ./macros/filament-change.cfg]
[include ./macros/park.cfg]
#[include ./macros/prusaslicer-accel.cfg]

##########################
##### THIRD PARTY ########
##########################

#[include ./third-party-cfg/nozzle_scrub.cfg]
[include KAMP_Settings.cfg]

##########################
##### ERCF ###############
##########################

[include mmu/base/*.cfg]
[include macros/mmu_adds.cfg]
[include mmu/optional/mmu_ercf_cutter.cfg]

##########################
##### LCD/MENU ###########
##########################

#[include ./third-party-cfg/nozzle_scrub_menu.cfg]
#[include ./menu/printer_menu.cfg]

##########################
##### NOT ENABLED YET ####
##########################

#[include ./todo/mini12864.cfg] Add this after adding mini12864 LED
#[include ./todo/lcd_tweaks.cfg] Need to figure this one out and then implement
#[include ./hardware/nevermore.cfg] Disabled as I prefer to chamber vent outside and needed the PWM

##########################
#### REPLACEMENT #########
##########################

[include ./replacement_macros/replace-m900.cfg]
[include ./replacement_macros/replace-m117.cfg]

[exclude_object]

[gcode_arcs]
resolution: 0.1

[respond]
default_type: echo
default_prefix:  

[force_move]
# Enable commands that force potentially unsafe movement
enable_force_move: True

[idle_timeout]
timeout: 14400

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_290040000750314D35323820-if00
restart_method: command

[mcu rpi]
# Add Rpi as secondary MCU to allow for ADXL use through SPI ribbon/adapter from LDO
serial: /tmp/klipper_host_mcu

[mcu sht]
canbus_uuid: 30993412e8e0

[printer]
kinematics: corexy
max_velocity: 200           # Changed from 200 on 7.11.23
max_accel:  6000            # tuned on 7.11.23 after beacon install.
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0 # Changed on 7.11.23

#####################################################################
#   Input Shaper
#####################################################################

[input_shaper]
#shaper_freq_x: 76.2               ; suggested max_accel <= 22600 mm/sec^2
#shaper_type_x: zv
#shaper_freq_y: 51.8               ; suggested max_accel <= 7900 mm/sec^2
#shaper_type_y: mzv


#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
heater_pin: PA2 #PA2 is LDO default
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 125
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  WAS TAP - NOW BEACON in CANBUS

#####################################################################
#   Additional Sensors
#####################################################################

[thermistor CMFB103F3950FANT]
temperature1: 0.0
resistance1: 32116.0
temperature2: 40.0
resistance2: 5309.0
temperature3: 80.0
resistance3: 1228.0

#[temperature_sensor sb_ambient_temp]
## Chamber Temperature - T1
#sensor_type: CMFB103F3950FANT
#sensor_pin: PF5
#min_temp: 0
#max_temp: 100
#gcode_id: chamber_th

[temperature_sensor back_chamber_temp]
## Chamber Temperature - T
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF6
min_temp: 0
max_temp: 100
gcode_id: chamber_th2

[temperature_sensor RPi4]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################

#[safe_z_home]
##  XY Location of the Z Endstop Switch
##  Update -10,-10 to the XY coordinates of your endstop pin 
##  (such as 157,305) after going through Z Endstop Pin
##  Location Definition step.
#home_xy_position: 147,256
#speed:100
#z_hop:10
#z_hop_speed:10


########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.889
#*# pid_ki = 0.964
#*# pid_kd = 412.851
#*#
#*# [probe]
#*# z_offset = -1.270
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.044307, -0.055086, -0.033266, -0.025596, -0.025100, -0.021043, -0.015230, -0.019903, -0.009635, -0.008191, -0.009934, -0.013406, -0.015411, -0.003400, 0.003232, -0.009105, 0.007832, 0.000697, 0.005344, 0.004524, 0.007935, 0.018712, 0.007978, 0.005311, -0.012345
#*# 	  -0.054735, -0.031929, -0.021041, -0.012759, -0.022597, -0.029860, -0.021790, -0.006227, -0.020612, -0.008765, -0.009086, -0.007658, -0.005091, -0.003659, 0.005210, 0.004130, 0.005730, 0.006691, 0.008610, 0.008036, -0.007022, 0.009777, 0.007936, 0.007468, -0.007552
#*# 	  -0.058934, -0.042203, -0.029461, -0.023567, -0.023371, -0.014884, -0.017222, -0.013269, -0.027893, -0.009671, -0.015318, -0.010433, -0.015215, -0.009181, -0.005566, -0.009238, 0.000877, 0.000911, -0.003470, -0.007337, 0.002412, 0.006667, 0.007185, 0.007715, 0.003506
#*# 	  -0.051709, -0.044046, -0.030157, -0.026755, -0.025343, -0.028676, -0.019735, -0.025844, -0.011830, -0.008163, 0.002193, -0.022199, -0.008919, -0.008110, -0.011058, -0.024434, -0.022095, -0.009703, 0.001672, 0.000868, -0.007554, 0.009261, 0.008708, 0.008971, 0.000810
#*# 	  -0.054968, -0.041760, -0.041107, -0.025574, -0.038660, -0.030569, -0.024168, -0.026565, -0.028686, -0.023031, -0.028879, -0.024734, -0.027868, -0.020441, -0.024043, -0.019288, -0.026972, -0.024149, -0.008189, -0.006205, 0.000968, 0.001292, 0.009449, 0.005271, 0.006748
#*# 	  -0.059201, -0.060437, -0.041158, -0.039867, -0.035557, -0.032075, -0.034565, -0.030220, -0.024210, -0.025971, -0.026575, -0.024511, -0.029862, -0.025765, -0.024276, -0.024570, -0.024516, -0.017888, -0.011322, -0.018705, 0.000282, 0.006484, 0.005638, 0.006364, 0.008419
#*# 	  -0.060585, -0.053807, -0.041081, -0.044495, -0.035148, -0.041537, -0.030558, -0.025926, -0.030824, -0.028738, -0.027797, -0.026065, -0.035844, -0.022748, -0.025425, -0.021724, -0.018270, -0.001755, -0.012043, -0.002862, 0.002542, 0.006376, 0.010728, 0.010991, 0.008424
#*# 	  -0.055986, -0.051246, -0.046569, -0.040767, -0.040997, -0.033956, -0.036134, -0.032264, -0.036579, -0.029378, -0.024585, -0.025911, -0.029529, -0.023720, -0.025469, -0.024752, -0.022854, -0.014063, -0.013936, -0.012041, -0.000076, 0.006006, 0.008466, 0.005144, 0.012550
#*# 	  -0.061028, -0.062595, -0.050848, -0.057384, -0.039780, -0.040849, -0.041660, -0.041240, -0.036978, -0.031835, -0.033835, -0.029675, -0.030941, -0.026618, -0.026793, -0.026643, -0.027604, -0.027543, -0.012973, -0.017461, -0.007899, 0.003016, 0.005366, 0.007667, 0.005405
#*# 	  -0.061036, -0.063549, -0.034651, -0.039829, -0.058864, -0.062370, -0.049618, -0.049104, -0.050906, -0.040589, -0.039933, -0.034991, -0.036595, -0.033381, -0.030194, -0.027549, -0.025230, -0.023678, -0.028552, -0.024414, -0.018379, -0.004040, 0.003478, 0.004472, 0.004686
#*# 	  -0.062571, -0.064302, -0.050365, -0.053395, -0.037117, -0.061150, -0.051164, -0.058547, -0.046578, -0.044399, -0.041519, -0.036279, -0.037760, -0.031091, -0.031284, -0.027306, -0.028224, -0.029069, -0.029295, -0.030327, -0.018092, -0.010219, -0.003994, 0.003805, 0.002273
#*# 	  -0.063627, -0.061537, -0.057501, -0.059617, -0.052612, -0.054237, -0.044446, -0.052909, -0.057623, -0.040483, -0.039594, -0.040790, -0.031494, -0.032073, -0.030919, -0.028770, -0.029362, -0.029939, -0.029152, -0.026680, -0.008979, -0.008313, 0.001634, 0.002047, 0.000632
#*# 	  -0.066321, -0.053557, -0.052930, -0.046778, -0.061254, -0.056236, -0.051907, -0.050408, -0.041763, -0.039162, -0.040769, -0.032998, -0.028955, -0.027885, -0.026100, -0.026445, -0.023425, -0.024972, -0.019787, -0.023542, -0.007848, -0.006293, -0.007174, 0.005620, -0.005362
#*# 	  -0.059860, -0.044954, -0.056064, -0.051040, -0.051010, -0.051723, -0.049451, -0.050398, -0.044010, -0.039413, -0.037699, -0.037656, -0.032243, -0.038400, -0.025419, -0.027363, -0.013962, -0.025339, -0.018386, -0.010148, -0.010265, -0.003794, 0.004783, 0.004499, 0.002891
#*# 	  -0.061321, -0.047682, -0.057464, -0.049341, -0.055007, -0.047874, -0.047011, -0.042015, -0.041517, -0.037734, -0.041920, -0.039837, -0.028846, -0.036313, -0.049740, -0.023899, -0.021129, -0.023357, -0.011633, -0.016457, -0.009199, 0.000124, 0.009509, 0.010532, 0.002989
#*# 	  -0.053432, -0.055189, -0.052215, -0.050904, -0.050647, -0.053701, -0.045484, -0.042106, -0.044177, -0.042161, -0.040334, -0.032502, -0.032343, -0.018337, -0.021376, -0.020055, -0.018683, -0.016192, -0.010439, -0.006864, -0.008800, 0.009885, 0.009873, 0.009830, 0.011910
#*# 	  -0.049820, -0.054620, -0.052924, -0.049680, -0.050715, -0.047905, -0.048046, -0.050080, -0.039687, -0.041988, -0.039718, -0.023603, -0.031149, -0.022103, -0.018840, -0.019754, -0.013817, -0.015737, -0.006706, -0.002539, 0.007956, 0.005901, 0.016491, 0.016245, 0.011741
#*# 	  -0.057836, -0.053729, -0.053172, -0.052542, -0.053028, -0.049921, -0.052586, -0.053127, -0.045881, -0.047998, -0.042109, -0.035428, -0.028557, -0.030075, -0.019316, -0.017308, -0.015928, -0.015334, -0.008753, 0.000870, 0.000121, 0.013151, 0.014769, 0.017330, 0.015400
#*# 	  -0.072476, -0.059623, -0.054242, -0.054950, -0.055882, -0.053357, -0.059001, -0.050587, -0.048014, -0.047610, -0.045028, -0.037745, -0.040768, -0.027706, -0.026285, -0.015500, -0.017072, -0.014360, -0.010991, -0.004572, -0.005295, 0.005067, 0.011891, 0.012300, 0.011197
#*# 	  -0.077626, -0.075626, -0.057900, -0.065257, -0.060211, -0.061970, -0.057837, -0.056066, -0.058671, -0.059207, -0.049709, -0.048527, -0.043919, -0.024750, -0.028612, -0.024599, -0.022282, -0.020243, -0.014059, -0.013715, -0.004789, 0.000979, 0.006613, 0.010604, 0.006264
#*# 	  -0.078541, -0.070689, -0.058978, -0.060006, -0.069979, -0.059098, -0.059517, -0.061359, -0.056608, -0.056401, -0.045003, -0.046603, -0.042682, -0.037025, -0.036088, -0.026173, -0.023506, -0.022259, -0.010555, -0.009650, -0.009691, -0.009264, 0.006103, 0.006948, 0.007858
#*# 	  -0.074248, -0.062568, -0.064997, -0.062613, -0.062394, -0.055232, -0.059472, -0.057149, -0.057656, -0.054161, -0.044437, -0.039811, -0.030876, -0.040894, -0.029367, -0.028229, -0.027465, -0.008554, -0.021397, -0.016262, -0.009645, -0.009311, 0.005537, 0.006574, 0.000514
#*# 	  -0.067640, -0.059531, -0.054621, -0.061436, -0.056383, -0.062258, -0.060079, -0.057723, -0.054307, -0.043820, -0.038285, -0.041585, -0.033792, -0.029800, -0.026331, -0.021784, -0.027318, -0.021094, -0.023338, -0.011061, -0.012357, -0.000649, 0.002555, 0.001172, -0.001588
#*# 	  -0.066118, -0.059327, -0.057084, -0.060421, -0.058812, -0.054882, -0.053130, -0.051575, -0.040222, -0.042998, -0.043368, -0.034972, -0.038543, -0.032295, -0.030837, -0.025652, -0.032250, -0.023099, -0.022722, -0.023109, -0.006691, -0.006193, -0.006656, -0.001716, -0.013617
#*# 	  -0.072671, -0.071746, -0.069026, -0.069194, -0.067264, -0.072153, -0.066898, -0.063911, -0.064883, -0.060164, -0.060848, -0.055585, -0.038324, -0.038440, -0.040827, -0.037702, -0.036702, -0.037248, -0.034293, -0.033882, -0.030069, -0.029092, -0.022312, -0.018099, -0.019089
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 210.0
#*# min_y = 30.0
#*# max_y = 210.0
#*#
#*# [beacon model default]
#*# model_coef = 1.934243930597146,
#*# 	2.206808199797723,
#*# 	0.6436025413836176,
#*# 	0.3095345837351202,
#*# 	-0.15977813582327796,
#*# 	-0.5908394974077775,
#*# 	0.4266719892497021,
#*# 	1.046422592108256,
#*# 	-0.23184944767066623,
#*# 	-0.5507144312738391
#*# model_domain = 3.353607345856729e-07,3.361070372275538e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 79.449632
#*# model_offset = 0.58000
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 77.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 51.6
