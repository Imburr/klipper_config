##########################
##### BASE CONFIG #######
##########################

[include mainsail.cfg]
[include ./backup/backup.cfg]

##########################
##### HARDWARE STUFF #####
##########################

[include ./hardware/xyz-stepper.cfg]
[include ./hardware/extruder.cfg]
#[include ./klicky/klicky-probe.cfg]
#[include ./hardware/adxl345.cfg]  This config now in canbus.cfg
[include ./hardware/fans.cfg] # Some fans config in canbus.cfg
[include ./hardware/canbus.cfg]

##########################
##### LIGHTS #############
##########################

[include ./hardware/chamber-lighting.cfg]
[include ./hardware/stealthburner-led.cfg]

##########################
##### CALIBRATION ########
##########################

[include ./calibration/z-tilt.cfg]
[include ./calibration/bed-mesh.cfg]
[include ./macros/unsafe.cfg]
[include ./calibration/pressure_advance.cfg]
[include ./calibration/test_speed.cfg]
[include ./calibration/pika.cfg]
[include test_probe_accuracy.cfg]

##########################
##### MACROS #############
##########################

[include ./macros/chamber-led.cfg]
[include ./macros/conditional-homing.cfg]
[include ./macros/print-end.cfg]
[include ./macros/print-start-mmu.cfg]
[include ./macros/dump-variables.cfg]
[include ./macros/movement-check.cfg]
[include ./macros/cancel-change.cfg]
[include ./macros/pause-resume.cfg]         ; Overridden by ERCF / subsequantly disabled
[include ./macros/load-unload.cfg]
[include ./macros/filament-change.cfg]
[include ./macros/park.cfg]
#[include ./macros/prusaslicer-accel.cfg]

##########################
##### THIRD PARTY ########
##########################

#[include ./third-party-cfg/nozzle_scrub.cfg]
[include KAMP_Settings.cfg]

##########################
##### ERCF ###############
##########################

[include mmu/base/*.cfg]
[include macros/mmu_adds.cfg]



##########################
##### LCD/MENU ###########
##########################

#[include ./third-party-cfg/nozzle_scrub_menu.cfg]
#[include ./menu/printer_menu.cfg]

##########################
##### NOT ENABLED YET ####
##########################

#[include ./todo/mini12864.cfg] Add this after adding mini12864 LED
#[include ./todo/lcd_tweaks.cfg] Need to figure this one out and then implement
#[include ./hardware/nevermore.cfg] Disabled as I prefer to chamber vent outside and needed the PWM

##########################
#### REPLACEMENT #########
##########################

[include ./replacement_macros/replace-m900.cfg]
[include ./replacement_macros/replace-m117.cfg]

[exclude_object]

[gcode_arcs]
resolution: 0.1

[respond]
default_type: echo
default_prefix:  

[force_move]
# Enable commands that force potentially unsafe movement
enable_force_move: True

[idle_timeout]
timeout: 14400

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_290040000750314D35323820-if00
restart_method: command

[mcu rpi]
# Add Rpi as secondary MCU to allow for ADXL use through SPI ribbon/adapter from LDO
serial: /tmp/klipper_host_mcu

[mcu sht]
canbus_uuid: 30993412e8e0

[printer]
kinematics: corexy
max_velocity: 200           # Changed from 200 on 7.11.23
max_accel:  6000            # tuned on 7.11.23 after beacon install.
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0 # Changed on 7.11.23

#####################################################################
#   Input Shaper
#####################################################################

[input_shaper]
#shaper_freq_x: 76.2               ; suggested max_accel <= 22600 mm/sec^2
#shaper_type_x: zv
#shaper_freq_y: 51.8               ; suggested max_accel <= 7900 mm/sec^2
#shaper_type_y: mzv


#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
heater_pin: PA2 #PA2 is LDO default
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 125
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  WAS TAP - NOW BEACON in CANBUS

#####################################################################
#   Additional Sensors
#####################################################################

[thermistor CMFB103F3950FANT]
temperature1: 0.0
resistance1: 32116.0
temperature2: 40.0
resistance2: 5309.0
temperature3: 80.0
resistance3: 1228.0

#[temperature_sensor sb_ambient_temp]
## Chamber Temperature - T1
#sensor_type: CMFB103F3950FANT
#sensor_pin: PF5
#min_temp: 0
#max_temp: 100
#gcode_id: chamber_th

[temperature_sensor back_chamber_temp]
## Chamber Temperature - T
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF6
min_temp: 0
max_temp: 100
gcode_id: chamber_th2

[temperature_sensor RPi4]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################

#[safe_z_home]
##  XY Location of the Z Endstop Switch
##  Update -10,-10 to the XY coordinates of your endstop pin 
##  (such as 157,305) after going through Z Endstop Pin
##  Location Definition step.
#home_xy_position: 147,256
#speed:100
#z_hop:10
#z_hop_speed:10


########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.889
#*# pid_ki = 0.964
#*# pid_kd = 412.851
#*#
#*# [probe]
#*# z_offset = -1.270
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.030396, -0.023333, -0.034147, -0.029255, -0.022361, -0.021081, -0.041306, -0.020791, -0.031064, -0.029895, -0.022318, -0.030705, -0.036054, -0.041950, -0.020414, -0.029784, -0.019078, -0.018904, -0.019526, -0.011829
#*# 	  -0.032858, -0.032468, -0.032739, -0.027975, -0.031831, -0.031096, -0.025890, -0.023700, -0.028774, -0.023344, -0.024180, -0.018485, -0.032161, -0.027771, -0.021657, -0.017917, -0.019085, -0.018129, -0.010531, -0.009831
#*# 	  -0.040754, -0.026466, -0.022278, -0.026413, -0.026838, -0.020020, -0.018702, -0.017843, -0.019923, -0.019750, -0.019143, -0.017861, -0.016985, -0.016011, -0.012958, -0.015501, -0.012924, -0.008710, -0.006056, -0.003331
#*# 	  -0.036265, -0.036154, -0.032434, -0.016919, -0.019071, -0.019134, -0.021390, -0.019775, -0.018203, -0.018295, -0.018455, -0.016438, -0.016158, -0.016763, -0.016509, -0.010263, -0.016158, -0.008049, -0.010324, -0.003736
#*# 	  -0.024137, -0.018766, -0.032114, -0.023385, -0.020458, -0.018354, -0.016297, -0.017002, -0.017252, -0.015510, -0.015563, -0.015421, -0.014878, -0.012934, -0.015335, -0.005326, -0.006816, -0.007179, -0.000741, 0.009340
#*# 	  -0.021741, -0.022674, -0.022715, -0.015864, -0.013325, -0.021569, -0.017523, -0.021905, -0.021292, -0.011979, -0.016298, -0.009972, -0.012675, -0.012283, -0.011997, -0.011214, -0.009022, -0.005528, 0.004718, -0.006724
#*# 	  -0.017727, -0.024676, -0.026054, -0.016762, -0.022035, -0.022459, -0.020397, -0.019777, -0.012547, -0.012810, -0.012956, -0.010568, -0.010820, -0.011237, -0.011290, -0.006973, -0.007632, 0.003576, -0.000902, 0.002957
#*# 	  -0.023410, -0.022501, -0.022538, -0.018458, -0.010821, -0.011105, -0.015512, -0.016446, -0.017127, -0.010746, -0.006121, -0.009722, -0.004713, -0.008575, -0.001380, -0.007594, 0.005599, 0.004696, 0.005795, 0.006111
#*# 	  -0.021120, -0.022777, -0.022336, -0.019877, -0.017653, -0.010618, -0.015495, -0.012444, -0.009733, -0.009354, -0.008405, -0.003372, 0.002519, 0.003921, -0.002641, 0.002282, 0.006269, 0.006969, 0.014975, 0.007666
#*# 	  -0.015120, -0.020963, -0.014563, -0.011771, -0.009215, -0.008105, -0.013427, -0.008237, -0.007455, -0.003403, 0.006115, -0.004893, -0.000260, 0.001181, 0.005243, 0.006875, 0.006739, 0.018324, 0.016773, 0.012622
#*# 	  -0.019381, -0.017984, -0.007989, -0.020418, -0.015005, -0.012716, -0.010956, -0.009273, -0.007200, -0.005248, -0.001919, 0.002888, 0.003315, 0.002137, 0.003915, 0.006329, 0.006141, 0.013213, 0.020378, 0.027145
#*# 	  -0.011067, -0.007531, -0.005896, -0.007130, -0.009696, -0.007922, -0.008161, -0.006451, -0.002247, -0.004633, 0.000279, 0.001443, 0.002447, 0.005489, 0.009481, 0.017377, 0.022362, 0.013800, 0.025945, 0.023308
#*# 	  -0.011286, -0.007994, -0.011505, -0.010733, -0.006910, -0.005922, -0.006464, -0.006330, -0.004655, -0.000026, 0.002642, 0.005346, 0.008642, 0.008263, 0.006301, 0.021613, 0.020176, 0.022957, 0.027507, 0.028417
#*# 	  -0.004341, -0.009098, -0.004879, -0.008456, -0.005597, -0.002745, -0.004742, -0.004475, -0.002340, -0.001260, 0.000470, 0.007559, 0.007965, 0.021419, 0.013178, 0.016634, 0.021433, 0.022433, 0.027396, 0.033002
#*# 	  -0.006416, -0.006425, -0.006292, -0.023958, -0.006325, -0.007969, -0.003760, -0.004635, -0.003308, -0.003400, -0.001430, 0.006272, 0.008924, 0.010999, 0.022543, 0.022690, 0.022762, 0.024315, 0.031128, 0.030889
#*# 	  -0.021402, -0.014177, -0.015808, -0.018294, -0.018544, -0.017959, -0.005261, -0.004295, -0.003474, -0.004517, -0.002108, 0.004341, 0.008861, 0.007712, 0.021363, 0.020061, 0.021955, 0.023946, 0.025165, 0.027230
#*# 	  -0.024398, -0.025239, -0.024140, -0.021332, -0.022546, -0.020597, -0.016480, -0.004913, -0.008727, -0.006935, -0.002147, -0.000700, 0.007146, 0.006326, 0.006704, 0.020167, 0.015906, 0.020820, 0.024052, 0.024460
#*# 	  -0.021461, -0.027264, -0.026052, -0.024836, -0.021451, -0.017759, -0.014541, -0.014734, -0.025832, -0.004641, -0.002317, -0.001908, 0.007340, 0.000823, 0.006840, 0.009551, 0.011005, 0.021161, 0.022993, 0.023447
#*# 	  -0.021518, -0.015847, -0.021497, -0.021443, -0.021193, -0.017505, -0.016920, -0.010156, -0.007797, -0.002376, -0.003929, 0.001791, -0.001171, 0.004896, 0.006740, 0.008752, 0.011793, 0.024021, 0.021643, 0.023066
#*# x_count = 20
#*# y_count = 19
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 54.652
#*# max_x = 191.225
#*# min_y = 57.854
#*# max_y = 188.15
#*#
#*# [beacon model default]
#*# model_coef = 1.9257982386737142,
#*# 	  2.1904011986275074,
#*# 	  0.5881661108028357,
#*# 	  0.30341866940870527,
#*# 	  0.14823890288711727,
#*# 	  -0.42807822476666274,
#*# 	  -0.13716254071061182,
#*# 	  0.612855529187592,
#*# 	  0.08376843001203003,
#*# 	  -0.2664564217100284
#*# model_domain = 3.352922478536077e-07,3.360945745364866e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 72.578002
#*# model_offset = 0.21500
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 77.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 51.6
