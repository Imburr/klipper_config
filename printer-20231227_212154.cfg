[include moonraker_obico_macros.cfg]
##########################
##### BASE CONFIG #######
##########################

[include mainsail.cfg]
[include ./backup/backup.cfg]

##########################
##### HARDWARE STUFF #####
##########################

[include ./hardware/xyz-stepper.cfg]
[include ./hardware/extruder.cfg]
#[include ./klicky/klicky-probe.cfg]
#[include ./hardware/adxl345.cfg]  This config now in canbus.cfg
[include ./hardware/fans.cfg] # Some fans config in canbus.cfg
[include ./hardware/canbus.cfg]

##########################
##### LIGHTS #############
##########################

[include ./hardware/chamber-lighting.cfg]
[include ./hardware/stealthburner-led.cfg]

##########################
##### CALIBRATION ########
##########################

[include ./calibration/z-tilt.cfg]
[include ./calibration/bed-mesh.cfg]
[include ./macros/unsafe.cfg]
[include ./calibration/pressure_advance.cfg]
[include ./calibration/test_speed.cfg]
[include ./calibration/pika.cfg]
[include test_probe_accuracy.cfg]

##########################
##### MACROS #############
##########################

[include ./macros/chamber-led.cfg]
[include ./macros/conditional-homing.cfg]
[include ./macros/print-end.cfg]
[include ./macros/print-start-mmu.cfg]
[include ./macros/dump-variables.cfg]
[include ./macros/movement-check.cfg]
[include ./macros/cancel-change.cfg]
[include ./macros/pause-resume.cfg]         ; Overridden by ERCF / subsequantly disabled
[include ./macros/load-unload.cfg]
[include ./macros/filament-change.cfg]
[include ./macros/park.cfg]
[include ./macros/heatsoak.cfg]

##########################
##### THIRD PARTY ########
##########################

#[include ./third-party-cfg/nozzle_scrub.cfg]
[include KAMP_Settings.cfg]

##########################
##### ERCF ###############
##########################

[include mmu/base/*.cfg]
[include macros/mmu_adds.cfg]
[include mmu/optional/mmu_ercf_cutter.cfg]

##########################
##### LCD/MENU ###########
##########################

#[include ./third-party-cfg/nozzle_scrub_menu.cfg]
#[include ./menu/printer_menu.cfg]

##########################
##### NOT ENABLED YET ####
##########################

#[include ./todo/mini12864.cfg] Add this after adding mini12864 LED
#[include ./todo/lcd_tweaks.cfg] Need to figure this one out and then implement
#[include ./hardware/nevermore.cfg] Disabled as I prefer to chamber vent outside and needed the PWM

##########################
#### REPLACEMENT #########
##########################

[include ./replacement_macros/replace-m900.cfg]
[include ./replacement_macros/replace-m117.cfg]

[exclude_object]

[gcode_arcs]
resolution: 0.1

[respond]
default_type: echo
default_prefix:  

[force_move]
# Enable commands that force potentially unsafe movement
enable_force_move: True

[idle_timeout]
timeout: 14400

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_290040000750314D35323820-if00
restart_method: command

[mcu rpi]
# Add Rpi as secondary MCU to allow for ADXL use through SPI ribbon/adapter from LDO
serial: /tmp/klipper_host_mcu

[mcu sht]
canbus_uuid: 30993412e8e0

[printer]
kinematics: corexy
max_velocity: 200           # Changed from 200 on 7.11.23
max_accel:  6000            # tuned on 7.11.23 after beacon install.
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0 # Changed on 7.11.23

#####################################################################
#   Input Shaper
#####################################################################

[input_shaper]
#shaper_freq_x: 76.2               ; suggested max_accel <= 22600 mm/sec^2
#shaper_type_x: zv
#shaper_freq_y: 51.8               ; suggested max_accel <= 7900 mm/sec^2
#shaper_type_y: mzv


#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
heater_pin: PA2 #PA2 is LDO default
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 125
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  WAS TAP - NOW BEACON in CANBUS

#####################################################################
#   Additional Sensors
#####################################################################

[thermistor CMFB103F3950FANT]
temperature1: 0.0
resistance1: 32116.0
temperature2: 40.0
resistance2: 5309.0
temperature3: 80.0
resistance3: 1228.0

#[temperature_sensor sb_ambient_temp]
## Chamber Temperature - T1
#sensor_type: CMFB103F3950FANT
#sensor_pin: PF5
#min_temp: 0
#max_temp: 100
#gcode_id: chamber_th

[temperature_sensor back_chamber_temp]
## Chamber Temperature - T
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF6
min_temp: 0
max_temp: 100
gcode_id: chamber_th2

[temperature_sensor RPi4]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################

#[safe_z_home]
##  XY Location of the Z Endstop Switch
##  Update -10,-10 to the XY coordinates of your endstop pin 
##  (such as 157,305) after going through Z Endstop Pin
##  Location Definition step.
#home_xy_position: 147,256
#speed:100
#z_hop:10
#z_hop_speed:10


########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.889
#*# pid_ki = 0.964
#*# pid_kd = 412.851
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.024174, -0.006504, -0.018829, -0.011117, -0.004442, -0.001921, 0.004248, 0.005894, 0.006696, 0.020245, 0.016435, 0.015517, 0.008929, 0.019225, 0.020086, 0.018309, 0.026985, 0.031348, 0.030188, 0.033871, 0.039826, 0.036107, 0.035197, 0.035357, 0.032975
#*# 	  -0.018675, -0.008784, 0.004073, 0.000975, -0.003275, -0.001070, 0.016509, 0.013553, 0.020330, 0.018829, 0.017577, 0.004941, 0.020492, 0.020029, 0.021128, 0.023729, 0.025589, 0.029044, 0.026436, 0.032888, 0.033952, 0.035617, 0.035308, 0.043698, 0.043298
#*# 	  -0.020201, -0.011585, -0.008188, -0.007932, -0.007994, -0.001878, 0.007292, 0.009248, 0.014999, 0.016498, 0.017897, 0.018789, 0.016215, 0.018930, 0.017099, 0.021066, 0.024145, 0.027219, 0.010140, 0.032318, 0.031075, 0.030528, 0.054846, 0.043673, 0.039469
#*# 	  -0.024764, -0.008694, -0.007000, -0.009450, 0.002994, -0.004556, 0.001257, 0.000813, 0.007368, 0.016353, 0.010245, -0.001629, 0.017422, 0.017779, 0.014862, 0.015909, 0.009657, 0.020674, 0.023725, 0.027801, 0.028720, 0.032151, 0.036444, 0.049681, 0.031450
#*# 	  -0.023638, -0.011255, -0.011921, -0.007615, -0.007884, -0.008507, -0.007623, -0.005497, -0.000305, 0.003744, 0.005978, 0.007341, 0.000157, 0.012317, 0.000935, 0.001703, 0.003369, 0.011089, 0.022449, 0.025313, 0.027026, 0.026438, 0.030202, 0.041104, 0.032930
#*# 	  -0.035275, -0.013440, -0.017807, -0.006769, -0.005859, -0.005657, -0.006628, -0.001329, -0.005591, 0.002599, 0.008382, 0.003881, 0.003166, 0.004522, 0.010031, 0.004590, 0.009158, 0.010822, 0.022308, 0.026695, 0.024337, 0.028859, 0.038748, 0.033505, 0.035916
#*# 	  -0.021740, -0.015381, -0.008807, -0.011183, -0.009934, -0.007686, -0.004624, -0.003909, -0.002302, 0.002803, 0.002499, 0.005661, 0.003939, 0.014585, 0.016585, 0.016791, 0.020096, 0.024170, 0.021127, 0.019546, 0.021991, 0.031475, 0.036512, 0.034462, 0.042190
#*# 	  -0.031082, -0.018603, -0.012529, -0.014464, -0.004790, -0.001212, -0.002902, -0.004498, -0.004269, 0.001320, -0.001764, 0.008322, 0.002666, 0.009285, 0.010286, 0.014737, 0.018974, 0.017039, 0.006493, 0.028116, 0.030170, 0.035219, 0.033855, 0.043824, 0.036875
#*# 	  -0.021457, -0.018573, -0.021537, -0.011184, -0.014357, -0.012886, -0.003231, -0.002871, 0.001540, 0.000634, 0.002101, 0.001455, 0.002283, 0.014822, 0.014360, 0.016728, 0.016221, 0.013823, 0.016010, 0.013204, 0.015162, 0.027392, 0.035240, 0.036794, 0.036593
#*# 	  -0.024408, -0.022409, -0.010143, -0.013405, -0.001015, -0.005694, -0.011316, -0.002728, -0.006466, -0.003891, -0.001998, -0.000637, 0.007408, -0.000510, 0.013181, 0.007524, 0.010407, 0.013487, 0.012801, 0.014541, 0.016499, 0.032630, 0.035918, 0.032847, 0.021584
#*# 	  -0.037930, -0.024197, -0.023926, -0.024619, -0.024160, -0.015678, -0.012015, -0.012967, -0.006979, -0.001871, -0.002841, 0.000027, -0.000540, 0.001407, -0.001146, 0.010260, 0.003180, 0.010440, 0.012138, 0.013072, 0.015124, 0.014783, 0.039773, 0.024321, 0.017368
#*# 	  -0.028337, -0.027146, -0.025963, -0.021711, -0.021351, -0.015768, -0.005161, 0.000737, 0.000902, 0.001447, -0.012434, 0.001823, 0.003076, -0.001522, 0.007660, 0.012113, 0.007523, 0.004946, 0.013374, 0.016335, 0.014253, 0.031926, 0.031582, 0.036697, 0.024044
#*# 	  -0.037655, -0.033087, -0.026404, -0.023205, -0.028335, -0.016322, -0.010311, -0.001648, -0.015549, 0.000905, -0.010593, 0.004041, -0.010065, 0.006055, 0.006562, 0.007749, 0.008534, 0.010262, 0.016439, 0.015735, 0.025716, 0.026363, 0.025375, 0.040286, 0.028797
#*# 	  -0.036342, -0.028980, -0.026976, -0.028114, -0.016351, -0.019311, -0.017357, -0.010549, -0.019825, 0.005858, 0.007940, 0.007029, 0.005713, 0.007679, 0.009240, 0.014905, 0.009697, 0.016143, 0.018843, 0.021511, 0.020906, 0.038127, 0.042815, 0.046886, 0.028772
#*# 	  -0.038845, -0.030722, -0.025233, -0.026759, -0.024070, -0.017229, -0.022547, -0.008462, 0.003777, -0.000991, -0.006377, 0.002368, 0.003463, 0.009680, 0.010042, 0.012013, 0.018164, 0.018484, 0.029300, 0.028911, 0.043272, 0.021737, 0.043298, 0.045778, 0.041763
#*# 	  -0.033498, -0.029864, -0.028331, -0.025003, -0.014747, -0.015769, -0.015619, -0.007204, -0.002523, -0.000064, -0.000511, 0.008610, 0.005926, 0.008748, 0.012333, 0.011472, 0.021189, 0.021348, 0.030655, 0.044249, 0.046102, 0.039447, 0.047885, 0.046759, 0.041262
#*# 	  -0.041603, -0.025776, -0.022090, -0.026580, -0.024770, -0.018370, -0.007483, -0.009427, -0.013614, -0.019882, -0.010706, 0.008825, 0.006629, 0.005515, 0.011281, 0.013746, 0.024400, 0.021863, 0.043469, 0.032603, 0.032742, 0.044430, 0.048905, 0.049976, 0.044807
#*# 	  -0.034659, -0.026323, -0.024211, -0.019695, -0.020770, -0.016931, -0.014728, -0.012785, -0.013927, -0.011439, -0.015769, 0.004308, 0.003980, 0.009026, 0.012755, 0.016771, 0.013634, 0.026135, 0.025364, 0.042131, 0.038366, 0.043010, 0.051367, 0.052414, 0.051347
#*# 	  -0.033450, -0.028225, -0.025992, -0.025840, -0.022044, -0.021126, -0.022015, -0.018538, -0.020712, -0.020455, -0.010930, 0.006583, 0.004629, 0.004421, 0.009540, 0.013960, 0.017061, 0.023410, 0.031690, 0.036202, 0.042221, 0.040348, 0.048855, 0.052509, 0.049461
#*# 	  -0.043502, -0.033974, -0.032275, -0.031252, -0.028309, -0.028244, -0.029261, -0.028318, -0.024402, -0.024454, -0.021948, -0.023086, -0.003595, 0.002108, 0.006004, 0.014650, 0.013757, 0.015618, 0.020627, 0.028778, 0.031527, 0.041734, 0.043910, 0.041925, 0.041968
#*# 	  -0.043656, -0.028533, -0.033252, -0.033686, -0.033923, -0.032579, -0.027810, -0.033551, -0.026291, -0.025364, -0.028916, -0.016974, -0.014886, 0.005408, 0.000398, 0.012430, 0.013087, 0.017220, 0.018830, 0.026425, 0.029536, 0.040210, 0.043485, 0.038093, 0.041508
#*# 	  -0.037781, -0.034510, -0.034112, -0.033525, -0.030199, -0.032381, -0.029874, -0.025363, -0.022643, -0.027709, -0.017932, -0.013987, -0.003577, 0.003451, 0.003934, 0.006412, 0.016446, 0.015664, 0.016970, 0.021823, 0.023989, 0.018775, 0.037754, 0.044120, 0.040928
#*# 	  -0.038564, -0.031194, -0.033949, -0.034189, -0.028658, -0.027104, -0.030070, -0.025258, -0.019783, -0.014566, -0.015056, -0.016676, -0.005057, -0.013983, 0.001283, 0.009771, 0.015340, 0.017106, 0.016027, 0.025630, 0.026445, 0.024038, 0.044662, 0.038155, 0.039990
#*# 	  -0.047397, -0.032603, -0.034066, -0.028342, -0.027697, -0.028870, -0.027490, -0.026662, -0.025986, -0.015467, -0.014066, -0.018351, -0.014283, -0.019163, 0.005208, 0.004896, 0.008544, 0.012840, 0.015855, 0.016651, 0.013531, 0.028019, 0.027097, 0.033989, 0.030428
#*# 	  -0.048410, -0.050661, -0.052192, -0.044648, -0.051985, -0.054810, -0.043202, -0.031393, -0.030138, -0.030074, -0.029693, -0.028205, -0.029256, -0.020329, -0.019365, -0.014827, -0.007987, 0.000558, -0.012965, 0.008785, 0.003614, 0.005626, 0.008694, 0.014036, 0.009920
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 210.0
#*# min_y = 30.0
#*# max_y = 210.0
#*#
#*# [beacon model default]
#*# model_coef = 1.9263519575030055,
#*# 	  2.1946743347503372,
#*# 	  0.6208794249910773,
#*# 	  0.2775896555222557,
#*# 	  0.06526221562750463,
#*# 	  -0.2611119885640586,
#*# 	  -0.05461829170887029,
#*# 	  0.36810740679885895,
#*# 	  0.05685001457152785,
#*# 	  -0.15547240310186372
#*# model_domain = 3.351987055417817e-07,3.359664588035842e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 63.925584
#*# model_offset = 1.27000
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 77.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 51.6
#*#
#*# [beacon model pei_hot]
#*# model_coef = 1.9263519575030055,
#*# 	2.1946743347503372,
#*# 	0.6208794249910773,
#*# 	0.2775896555222557,
#*# 	0.06526221562750463,
#*# 	-0.2611119885640586,
#*# 	-0.05461829170887029,
#*# 	0.36810740679885895,
#*# 	0.05685001457152785,
#*# 	-0.15547240310186372
#*# model_domain = 3.351987055417817e-07,3.359664588035842e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 63.925584
#*# model_offset = 1.27000
