[include moonraker_obico_macros.cfg]
##########################
##### BASE CONFIG #######
##########################

[include mainsail.cfg]
[include ./backup/backup.cfg]

##########################
##### HARDWARE STUFF #####
##########################

[include ./hardware/xyz-stepper.cfg]
[include ./hardware/extruder.cfg]
#[include ./klicky/klicky-probe.cfg]
#[include ./hardware/adxl345.cfg]  This config now in canbus.cfg
[include ./hardware/fans.cfg] # Some fans config in canbus.cfg
[include ./hardware/canbus.cfg]

##########################
##### LIGHTS #############
##########################

[include ./hardware/chamber-lighting.cfg]
[include ./hardware/stealthburner-led.cfg]

##########################
##### CALIBRATION ########
##########################

[include ./calibration/z-tilt.cfg]
[include ./calibration/bed-mesh.cfg]
[include ./macros/unsafe.cfg]
[include ./calibration/pressure_advance.cfg]
[include ./calibration/test_speed.cfg]
[include ./calibration/pika.cfg]
[include ./calibration/microadjust.cfg]
[include ./calibration/sensorless.cfg]
[include test_probe_accuracy.cfg]

##########################
##### MACROS #############
##########################

[include ./macros/chamber-led.cfg]
[include ./macros/conditional-homing.cfg]
[include ./macros/print-end.cfg]
[include ./macros/print-start-mmu.cfg]
[include ./macros/dump-variables.cfg]
[include ./macros/movement-check.cfg]
[include ./macros/cancel-change.cfg]
[include ./macros/pause-resume.cfg]         ; Overridden by ERCF / subsequantly disabled
[include ./macros/load-unload.cfg]
[include ./macros/filament-change.cfg]
[include ./macros/park.cfg]
[include ./macros/heatsoak.cfg]

##########################
##### THIRD PARTY ########
##########################

#[include ./third-party-cfg/nozzle_scrub.cfg]
[include KAMP_Settings.cfg]

##########################
##### ERCF ###############
##########################

[include mmu/base/*.cfg]
[include macros/mmu_adds.cfg]
[include mmu/optional/mmu_ercf_cutter.cfg]

##########################
##### LCD/MENU ###########
##########################

#[include ./third-party-cfg/nozzle_scrub_menu.cfg]
#[include ./menu/printer_menu.cfg]

##########################
##### NOT ENABLED YET ####
##########################

#[include ./todo/mini12864.cfg] Add this after adding mini12864 LED
#[include ./todo/lcd_tweaks.cfg] Need to figure this one out and then implement
#[include ./hardware/nevermore.cfg] Disabled as I prefer to chamber vent outside and needed the PWM

##########################
#### REPLACEMENT #########
##########################

[include ./replacement_macros/replace-m900.cfg]
[include ./replacement_macros/replace-m117.cfg]

[exclude_object]

[gcode_arcs]
resolution: 0.1

[respond]
default_type: echo
default_prefix:  

[force_move]
# Enable commands that force potentially unsafe movement
enable_force_move: True

[idle_timeout]
timeout: 14400

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_290040000750314D35323820-if00
restart_method: command

[mcu rpi]
# Add Rpi as secondary MCU to allow for ADXL use through SPI ribbon/adapter from LDO
serial: /tmp/klipper_host_mcu

[mcu sht]
canbus_uuid: 30993412e8e0

[printer]
kinematics: corexy
max_velocity: 200           # Changed from 200 on 7.11.23
max_accel:  6000            # tuned on 7.11.23 after beacon install.
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0 # Changed on 7.11.23

#####################################################################
#   Input Shaper
#####################################################################

[input_shaper]
#shaper_freq_x: 76.2               ; suggested max_accel <= 22600 mm/sec^2
#shaper_type_x: zv
#shaper_freq_y: 51.8               ; suggested max_accel <= 7900 mm/sec^2
#shaper_type_y: mzv

#####################################################################
#   AutoTune / https://github.com/andrewmcgr/klipper_tmc_autotune
#####################################################################

[motor_constants ldo-42sth48-2004mah_vrn]
resistance: 1.45
inductance: 0.002
holding_torque: 0.40
max_current: 2.0
steps_per_revolution: 400

#[autotune_tmc stepper_x]
#motor: ldo-42sth48-2004mah_vrn
#sg4_thrs: 105
#tuning_goal: silent
#[autotune_tmc stepper_y]
#motor: ldo-42sth48-2004mah_vrn
#tuning_goal: silent

[autotune_tmc stepper_z]
motor: ldo-42sth40-1684l300e
[autotune_tmc stepper_z1]
motor: ldo-42sth40-1684l300e
[autotune_tmc stepper_z2]
motor: ldo-42sth40-1684l300e

[autotune_tmc extruder]
motor: moons-cse14hra1l410a

#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
heater_pin: PA2 #PA2 is LDO default
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 125
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  WAS TAP - NOW BEACON in CANBUS

#####################################################################
#   Additional Sensors
#####################################################################

[thermistor CMFB103F3950FANT]
temperature1: 0.0
resistance1: 32116.0
temperature2: 40.0
resistance2: 5309.0
temperature3: 80.0
resistance3: 1228.0

#[temperature_sensor sb_ambient_temp]
## Chamber Temperature - T1
#sensor_type: CMFB103F3950FANT
#sensor_pin: PF5
#min_temp: 0
#max_temp: 100
#gcode_id: chamber_th

[temperature_sensor back_chamber_temp]
## Chamber Temperature - T
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF6
min_temp: 0
max_temp: 100
gcode_id: chamber_th2

[temperature_sensor RPi4]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.889
#*# pid_ki = 0.964
#*# pid_kd = 412.851
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.044458, 0.046192, 0.040585, 0.033258, 0.028206, 0.024106, 0.019994, 0.013903, 0.010885, 0.010239, 0.003811, 0.006009, 0.004648, 0.008083, 0.005183, 0.000722, 0.000363, -0.002950, -0.005897, -0.010728, -0.013859, -0.012643, -0.009394, -0.003761, 0.007625
#*# 	  0.049672, 0.044411, 0.038858, 0.033401, 0.029465, 0.025903, 0.020387, 0.015273, 0.013485, 0.010416, 0.006946, 0.005831, 0.005895, 0.006175, 0.001767, -0.002525, -0.002381, -0.005631, -0.007786, -0.010103, -0.011509, -0.009412, -0.007375, -0.003427, 0.005580
#*# 	  0.045399, 0.039862, 0.035017, 0.030778, 0.029146, 0.025338, 0.021304, 0.016039, 0.013190, 0.011290, 0.007623, 0.005461, 0.004132, 0.000681, -0.003312, -0.007164, -0.009484, -0.010650, -0.012471, -0.011709, -0.009219, -0.006937, -0.005130, -0.002278, 0.003523
#*# 	  0.039720, 0.033488, 0.029137, 0.025313, 0.022972, 0.020108, 0.016972, 0.012051, 0.009245, 0.007889, 0.003577, -0.000264, -0.001559, -0.005824, -0.010413, -0.014030, -0.016050, -0.018609, -0.020196, -0.017690, -0.013142, -0.007003, -0.004744, -0.003945, -0.000321
#*# 	  0.034627, 0.028848, 0.025344, 0.023950, 0.022297, 0.020254, 0.014011, 0.008670, 0.004910, 0.004379, 0.000606, -0.003153, -0.005721, -0.009098, -0.013679, -0.016997, -0.018562, -0.023381, -0.025155, -0.022351, -0.014981, -0.007271, -0.003254, -0.002810, -0.001754
#*# 	  0.031280, 0.025701, 0.023058, 0.021088, 0.019832, 0.015300, 0.008946, 0.002741, 0.000066, -0.000473, -0.003072, -0.006269, -0.006527, -0.009666, -0.013592, -0.016651, -0.019493, -0.024282, -0.026908, -0.023955, -0.017524, -0.008931, -0.004774, -0.004151, -0.002795
#*# 	  0.034006, 0.027081, 0.023293, 0.020205, 0.016940, 0.011369, 0.004406, -0.001068, -0.002830, -0.004113, -0.006054, -0.007920, -0.006247, -0.006251, -0.009384, -0.013391, -0.016314, -0.022092, -0.024697, -0.023725, -0.018791, -0.011605, -0.008586, -0.006855, -0.003814
#*# 	  0.039046, 0.032538, 0.027719, 0.023628, 0.018799, 0.012371, 0.006260, 0.001323, -0.001286, -0.002859, -0.004998, -0.006528, -0.001990, -0.000389, -0.002160, -0.004593, -0.009199, -0.015830, -0.019543, -0.020365, -0.017502, -0.012832, -0.010606, -0.008600, -0.004130
#*# 	  0.048355, 0.041182, 0.035664, 0.030313, 0.026095, 0.018831, 0.013434, 0.008401, 0.006583, 0.002795, -0.000453, -0.001627, 0.003335, 0.005244, 0.005539, 0.003980, -0.000307, -0.005914, -0.010954, -0.013229, -0.012097, -0.009493, -0.007759, -0.005696, -0.002061
#*# 	  0.048739, 0.040125, 0.034654, 0.029599, 0.024186, 0.018724, 0.014060, 0.010016, 0.007166, 0.002741, -0.001893, -0.003857, -0.000364, 0.001242, 0.003096, 0.002187, -0.000851, -0.006241, -0.012516, -0.014602, -0.014135, -0.012807, -0.012361, -0.010443, -0.006932
#*# 	  0.045372, 0.037457, 0.031356, 0.025324, 0.020748, 0.014167, 0.011104, 0.008539, 0.005157, 0.000849, -0.005639, -0.009006, -0.006722, -0.005014, -0.004417, -0.003975, -0.006335, -0.011770, -0.017458, -0.020546, -0.020022, -0.017741, -0.018036, -0.016873, -0.013475
#*# 	  0.045737, 0.037211, 0.031034, 0.025469, 0.019193, 0.014467, 0.010607, 0.009675, 0.007434, 0.001237, -0.004841, -0.008450, -0.006532, -0.005891, -0.006360, -0.006397, -0.008194, -0.013842, -0.020043, -0.021834, -0.020349, -0.017756, -0.016636, -0.016095, -0.013194
#*# 	  0.048330, 0.039747, 0.033402, 0.025795, 0.019409, 0.013691, 0.010714, 0.009222, 0.007987, 0.004027, -0.001400, -0.003823, -0.002537, -0.002360, -0.003994, -0.005286, -0.006128, -0.012045, -0.016794, -0.018942, -0.017133, -0.014258, -0.012609, -0.011185, -0.007932
#*# 	  0.049105, 0.041707, 0.034905, 0.026654, 0.019245, 0.014323, 0.010204, 0.007651, 0.007156, 0.004399, 0.000870, -0.000172, 0.001563, 0.001721, 0.000110, -0.001483, -0.004210, -0.008986, -0.013767, -0.014330, -0.013671, -0.010753, -0.008907, -0.006130, -0.001899
#*# 	  0.049579, 0.041635, 0.034938, 0.025868, 0.019717, 0.015263, 0.010544, 0.007204, 0.006720, 0.005122, 0.003000, 0.000947, 0.004072, 0.003760, 0.001584, 0.000742, -0.000797, -0.005575, -0.009118, -0.008988, -0.007905, -0.005498, -0.002942, -0.000429, 0.004387
#*# 	  0.058161, 0.050400, 0.043148, 0.035564, 0.029630, 0.025593, 0.021176, 0.017183, 0.016010, 0.015260, 0.012231, 0.010959, 0.012765, 0.012279, 0.010533, 0.008929, 0.008797, 0.006385, 0.003702, 0.004573, 0.006472, 0.009023, 0.010477, 0.013479, 0.018855
#*# 	  0.065225, 0.057667, 0.049714, 0.043183, 0.037757, 0.035530, 0.032295, 0.028044, 0.025927, 0.024236, 0.021827, 0.019252, 0.020527, 0.019498, 0.016552, 0.017635, 0.017986, 0.017145, 0.016340, 0.017651, 0.020273, 0.022456, 0.023950, 0.026431, 0.031997
#*# 	  0.066128, 0.058335, 0.050553, 0.043800, 0.038928, 0.036922, 0.034211, 0.029500, 0.027681, 0.025071, 0.021431, 0.020130, 0.020357, 0.019055, 0.018337, 0.019107, 0.020955, 0.020514, 0.019642, 0.021947, 0.025160, 0.027414, 0.028485, 0.031382, 0.037072
#*# 	  0.063737, 0.054851, 0.046576, 0.039379, 0.035238, 0.032671, 0.030174, 0.024866, 0.022153, 0.020723, 0.017245, 0.015539, 0.016326, 0.016693, 0.016131, 0.017733, 0.019481, 0.019186, 0.018798, 0.021337, 0.023926, 0.026744, 0.027967, 0.030653, 0.037270
#*# 	  0.058852, 0.049151, 0.040598, 0.033855, 0.028177, 0.024798, 0.020835, 0.015930, 0.014441, 0.012874, 0.009414, 0.008796, 0.010444, 0.011466, 0.013222, 0.014645, 0.016952, 0.015466, 0.014528, 0.016922, 0.019945, 0.021538, 0.022776, 0.026860, 0.033544
#*# 	  0.054291, 0.044124, 0.036404, 0.028044, 0.022719, 0.018953, 0.014037, 0.008939, 0.006785, 0.005710, 0.003388, 0.003507, 0.006228, 0.007649, 0.009238, 0.012038, 0.014689, 0.013000, 0.012137, 0.013408, 0.015202, 0.015863, 0.018305, 0.021649, 0.028336
#*# 	  0.056876, 0.045886, 0.037604, 0.029401, 0.023935, 0.019228, 0.014004, 0.009369, 0.007097, 0.006106, 0.003829, 0.004448, 0.007013, 0.009304, 0.011466, 0.013631, 0.015792, 0.015176, 0.013895, 0.014478, 0.015120, 0.014576, 0.015564, 0.019790, 0.025794
#*# 	  0.066637, 0.055032, 0.045748, 0.038306, 0.032649, 0.029093, 0.024531, 0.019715, 0.017484, 0.016222, 0.013552, 0.014013, 0.017028, 0.019125, 0.020546, 0.021708, 0.024214, 0.023322, 0.021916, 0.022396, 0.021714, 0.020255, 0.020936, 0.023793, 0.029663
#*# 	  0.075029, 0.063095, 0.053743, 0.045879, 0.040952, 0.037911, 0.034891, 0.030940, 0.029174, 0.027045, 0.024040, 0.024171, 0.027689, 0.028709, 0.028933, 0.029884, 0.030937, 0.029938, 0.028470, 0.027827, 0.026770, 0.024870, 0.024109, 0.025825, 0.030482
#*# 	  0.079962, 0.068348, 0.059448, 0.051455, 0.046226, 0.042450, 0.040523, 0.037596, 0.036008, 0.033683, 0.030996, 0.031674, 0.033601, 0.033695, 0.034017, 0.033530, 0.034110, 0.032280, 0.030100, 0.028532, 0.026458, 0.024533, 0.023888, 0.024314, 0.027300
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 210.0
#*# min_y = 30.0
#*# max_y = 208.0
#*#
#*# [beacon model default]
#*# model_coef = 1.4613818954269993,
#*# 	1.7756600472438397,
#*# 	0.7384172744186067,
#*# 	0.3398904593101075,
#*# 	0.3899746104559005,
#*# 	0.4162951819734925,
#*# 	-0.2058487068481297,
#*# 	-0.3393668279079826,
#*# 	0.21620390616642218,
#*# 	0.20874618374099485
#*# model_domain = 3.168808091292228e-07,3.3288555528608446e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 67.017932
#*# model_offset = -0.10000
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 77.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 51.6
#*#
#*# [beacon model pei_hot]
#*# model_coef = 1.9263519575030055,
#*# 	2.1946743347503372,
#*# 	0.6208794249910773,
#*# 	0.2775896555222557,
#*# 	0.06526221562750463,
#*# 	-0.2611119885640586,
#*# 	-0.05461829170887029,
#*# 	0.36810740679885895,
#*# 	0.05685001457152785,
#*# 	-0.15547240310186372
#*# model_domain = 3.351987055417817e-07,3.359664588035842e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 63.925584
#*# model_offset = 0.00000
