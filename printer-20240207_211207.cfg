[include moonraker_obico_macros.cfg]
##########################
##### BASE CONFIG #######
##########################

[include mainsail.cfg]
[include ./backup/backup.cfg]

##########################
##### HARDWARE STUFF #####
##########################

[include ./hardware/xyz-stepper.cfg]
[include ./hardware/extruder.cfg]
#[include ./klicky/klicky-probe.cfg]
#[include ./hardware/adxl345.cfg]  This config now in canbus.cfg
[include ./hardware/fans.cfg] # Some fans config in canbus.cfg
[include ./hardware/canbus.cfg]

##########################
##### LIGHTS #############
##########################

[include ./hardware/chamber-lighting.cfg]
[include ./hardware/stealthburner-led.cfg]

##########################
##### CALIBRATION ########
##########################

[include ./calibration/z-tilt.cfg]
[include ./calibration/bed-mesh.cfg]
[include ./macros/unsafe.cfg]
[include ./calibration/pressure_advance.cfg]
[include ./calibration/test_speed.cfg]
[include ./calibration/pika.cfg]
[include ./calibration/microadjust.cfg]
[include ./calibration/sensorless.cfg]
[include test_probe_accuracy.cfg]
[include K-ShakeTune/*.cfg]

##########################
##### MACROS #############
##########################

[include ./macros/chamber-led.cfg]
[include ./macros/conditional-homing.cfg]
[include ./macros/print-end.cfg]
[include ./macros/print-start-mmu.cfg]
[include ./macros/dump-variables.cfg]
[include ./macros/movement-check.cfg]
[include ./macros/cancel-change.cfg]
[include ./macros/pause-resume.cfg]         ; Overridden by ERCF / subsequantly disabled
[include ./macros/load-unload.cfg]
[include ./macros/filament-change.cfg]
[include ./macros/park.cfg]
[include ./macros/heatsoak.cfg]

##########################
##### THIRD PARTY ########
##########################

#[include ./third-party-cfg/nozzle_scrub.cfg]
[include KAMP_Settings.cfg]

##########################
##### ERCF ###############
##########################

#[include mmu/base/*.cfg]
#[include macros/mmu_adds.cfg]
#[include mmu/optional/mmu_ercf_cutter.cfg]

##########################
##### LCD/MENU ###########
##########################

#[include ./third-party-cfg/nozzle_scrub_menu.cfg]
#[include ./menu/printer_menu.cfg]

##########################
##### NOT ENABLED YET ####
##########################

#[include ./todo/mini12864.cfg] Add this after adding mini12864 LED
#[include ./todo/lcd_tweaks.cfg] Need to figure this one out and then implement
#[include ./hardware/nevermore.cfg] Disabled as I prefer to chamber vent outside and needed the PWM

##########################
#### REPLACEMENT #########
##########################

[include ./replacement_macros/replace-m900.cfg]
[include ./replacement_macros/replace-m117.cfg]

[exclude_object]

[gcode_arcs]
resolution: 0.1

[respond]
default_type: echo
default_prefix:  

[force_move]
# Enable commands that force potentially unsafe movement
enable_force_move: True

[idle_timeout]
timeout: 14400

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_290040000750314D35323820-if00
restart_method: command

[mcu rpi]
# Add Rpi as secondary MCU to allow for ADXL use through SPI ribbon/adapter from LDO
serial: /tmp/klipper_host_mcu

[mcu sht]
canbus_uuid: 30993412e8e0

[printer]
kinematics: corexy           # TESTING HIGHER SPEEDS ON 2/7/24 DUE TO SLICER SLOWWWWWWWW / ALSO SET IN PRINT START
max_velocity: 450            # Changed from 200 on 7.11.23
max_accel: 10000             # tuned on 7.11.23 after beacon install.
max_accel_to_decel:5000
max_z_velocity: 15           #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0 # Changed on 7.11.23

#####################################################################
#   Input Shaper
#####################################################################

[input_shaper]
shaper_freq_x: 71.0
shaper_type_x: mzv # 14900
shaper_freq_y: 47.8
shaper_type_y: mzv # 6700
damping_ratio_x: 0.043
damping_ratio_y: 0.055
# Not Noisy: 20-22.5 / 60.6-96.7 / 30.2-48 / 111.4-200 mm/s

#####################################################################
#   AutoTune / https://github.com/andrewmcgr/klipper_tmc_autotune
#####################################################################

#[motor_constants ldo-42sth48-2004mah_vrn]
#resistance: 1.45
#inductance: 0.002
#holding_torque: 0.40
#max_current: 2.0
#steps_per_revolution: 400

#[autotune_tmc stepper_x]
#motor: ldo-42sth48-2004mah_vrn
#sg4_thrs: 105
#tuning_goal: silent
#[autotune_tmc stepper_y]
#motor: ldo-42sth48-2004mah_vrn
#tuning_goal: silent

#[autotune_tmc stepper_z]
#motor: ldo-42sth40-1684l300e
#[autotune_tmc stepper_z1]
#motor: ldo-42sth40-1684l300e
#[autotune_tmc stepper_z2]
#motor: ldo-42sth40-1684l300e

#[autotune_tmc extruder]
#motor: moons-cse14hra1l410a

#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
heater_pin: PA2 #PA2 is LDO default
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 1
min_temp: 0
max_temp: 125
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  WAS TAP - NOW BEACON in CANBUS

#####################################################################
#   Additional Sensors
#####################################################################

[thermistor CMFB103F3950FANT]
temperature1: 0.0
resistance1: 32116.0
temperature2: 40.0
resistance2: 5309.0
temperature3: 80.0
resistance3: 1228.0

#[temperature_sensor sb_ambient_temp]
## Chamber Temperature - T1
#sensor_type: CMFB103F3950FANT
#sensor_pin: PF5
#min_temp: 0
#max_temp: 100
#gcode_id: chamber_th

[temperature_sensor back_chamber_temp]
## Chamber Temperature - T
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF6
min_temp: 0
max_temp: 100
gcode_id: chamber_th2

[temperature_sensor RPi4]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.889
#*# pid_ki = 0.964
#*# pid_kd = 412.851
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	0.049506, 0.036885, 0.024600, 0.014035, 0.005015, -0.000680, -0.005064, -0.008723, -0.010557, -0.012690, -0.018953, -0.024369, -0.026809, -0.028139, -0.029987, -0.029602, -0.028225, -0.031150, -0.033638, -0.034879, -0.035729, -0.032220, -0.024795, -0.012747, 0.004045
#*# 	0.044284, 0.028687, 0.017321, 0.006295, -0.001816, -0.009148, -0.015390, -0.018663, -0.020465, -0.022432, -0.028667, -0.034292, -0.035269, -0.036648, -0.038657, -0.038491, -0.036893, -0.036949, -0.038786, -0.039742, -0.039827, -0.037416, -0.031173, -0.023569, -0.010684
#*# 	0.038421, 0.024921, 0.014223, 0.003874, -0.005601, -0.013542, -0.020467, -0.024600, -0.025760, -0.027539, -0.033325, -0.038496, -0.040271, -0.041799, -0.044331, -0.044964, -0.043952, -0.043003, -0.042975, -0.042395, -0.042290, -0.039614, -0.036700, -0.032148, -0.021731
#*# 	0.036104, 0.023580, 0.013741, 0.002670, -0.005959, -0.014294, -0.022401, -0.026800, -0.028295, -0.029566, -0.035538, -0.040893, -0.042532, -0.044795, -0.047671, -0.048442, -0.046747, -0.046956, -0.046310, -0.044739, -0.043308, -0.041372, -0.039259, -0.035562, -0.027009
#*# 	0.038363, 0.025699, 0.014824, 0.005148, -0.002653, -0.010944, -0.017726, -0.022117, -0.025401, -0.027443, -0.032719, -0.038218, -0.040431, -0.042756, -0.045865, -0.046597, -0.046140, -0.046036, -0.045134, -0.043184, -0.041066, -0.039117, -0.036934, -0.033535, -0.023805
#*# 	0.040945, 0.027816, 0.017221, 0.007548, -0.000253, -0.006577, -0.012457, -0.017605, -0.020736, -0.023809, -0.030769, -0.035379, -0.038288, -0.041128, -0.044166, -0.044898, -0.044228, -0.044046, -0.043592, -0.042167, -0.039856, -0.036744, -0.034620, -0.030409, -0.020210
#*# 	0.042874, 0.030198, 0.018606, 0.008825, 0.000858, -0.004997, -0.009000, -0.013013, -0.016996, -0.022701, -0.030439, -0.034577, -0.037803, -0.040738, -0.043824, -0.044464, -0.042534, -0.042723, -0.042712, -0.040944, -0.038927, -0.035889, -0.033624, -0.029560, -0.018466
#*# 	0.050196, 0.036712, 0.025190, 0.014776, 0.007688, 0.001829, -0.002502, -0.007106, -0.011414, -0.018429, -0.025488, -0.029997, -0.032761, -0.035297, -0.037677, -0.037794, -0.034796, -0.035408, -0.035449, -0.033332, -0.032166, -0.029913, -0.028305, -0.023678, -0.011747
#*# 	0.056050, 0.042971, 0.032963, 0.020023, 0.011503, 0.004647, 0.000140, -0.003520, -0.008017, -0.014374, -0.020851, -0.025570, -0.027067, -0.028780, -0.030852, -0.029746, -0.028207, -0.028451, -0.028167, -0.027087, -0.025464, -0.024510, -0.023770, -0.019229, -0.008522
#*# 	0.056222, 0.046262, 0.034704, 0.020798, 0.009566, 0.001357, -0.003977, -0.008538, -0.011804, -0.015864, -0.021910, -0.025374, -0.025177, -0.027088, -0.026596, -0.025995, -0.024692, -0.025887, -0.027328, -0.026155, -0.024918, -0.025005, -0.024525, -0.020931, -0.011847
#*# 	0.056986, 0.047374, 0.035199, 0.019820, 0.006298, -0.002276, -0.008532, -0.012802, -0.015760, -0.018460, -0.022815, -0.023410, -0.022551, -0.023460, -0.024624, -0.024733, -0.024134, -0.026538, -0.028551, -0.028769, -0.028539, -0.028661, -0.029105, -0.026913, -0.019411
#*# 	0.064533, 0.054447, 0.042926, 0.026428, 0.013610, 0.004202, -0.002235, -0.007621, -0.008581, -0.010455, -0.013356, -0.013320, -0.012888, -0.013503, -0.015200, -0.016837, -0.016866, -0.020624, -0.024118, -0.024458, -0.024721, -0.025103, -0.025126, -0.023804, -0.016206
#*# 	0.070858, 0.060131, 0.047277, 0.033108, 0.020063, 0.011475, 0.005222, 0.001433, -0.000020, -0.001804, -0.004255, -0.004674, -0.004578, -0.005497, -0.008854, -0.011050, -0.012566, -0.016245, -0.019652, -0.021001, -0.020679, -0.020267, -0.021259, -0.019147, -0.012010
#*# 	0.076253, 0.064002, 0.052093, 0.037589, 0.025825, 0.018896, 0.013462, 0.010801, 0.010023, 0.007550, 0.004182, 0.002551, 0.003470, 0.001546, -0.001038, -0.003987, -0.005882, -0.010186, -0.013787, -0.013808, -0.013657, -0.012479, -0.012745, -0.010385, -0.004016
#*# 	0.079528, 0.067316, 0.054049, 0.040787, 0.030186, 0.022991, 0.018583, 0.016622, 0.016684, 0.014612, 0.010721, 0.008640, 0.009058, 0.007610, 0.004894, 0.002329, 0.000396, -0.003063, -0.006315, -0.006335, -0.005731, -0.003972, -0.003222, -0.000683, 0.005893
#*# 	0.085638, 0.073437, 0.059506, 0.046235, 0.035842, 0.028899, 0.025303, 0.024446, 0.024953, 0.023437, 0.018956, 0.015464, 0.015361, 0.014366, 0.012802, 0.010835, 0.009753, 0.006041, 0.003674, 0.004030, 0.005274, 0.007468, 0.009123, 0.012446, 0.017692
#*# 	0.087940, 0.075858, 0.062489, 0.048236, 0.038180, 0.031668, 0.029342, 0.030249, 0.030585, 0.027541, 0.023055, 0.019186, 0.018708, 0.017966, 0.017429, 0.016398, 0.016623, 0.013216, 0.011307, 0.011719, 0.013626, 0.016552, 0.017953, 0.020725, 0.026018
#*# 	0.085005, 0.075341, 0.061366, 0.048891, 0.038876, 0.034046, 0.032596, 0.034839, 0.035657, 0.032208, 0.025122, 0.021238, 0.021097, 0.021586, 0.020704, 0.019981, 0.020418, 0.018174, 0.017295, 0.018029, 0.019691, 0.022531, 0.023694, 0.027088, 0.032751
#*# 	0.081111, 0.071682, 0.060744, 0.048826, 0.040939, 0.037417, 0.038032, 0.040152, 0.040743, 0.036765, 0.028999, 0.025391, 0.024933, 0.025621, 0.024995, 0.024694, 0.024676, 0.024095, 0.023226, 0.024085, 0.025478, 0.027559, 0.029277, 0.033035, 0.039807
#*# 	0.072981, 0.064539, 0.054304, 0.046055, 0.039830, 0.036986, 0.037907, 0.039779, 0.040113, 0.036085, 0.028909, 0.024834, 0.025487, 0.025248, 0.024626, 0.024246, 0.025541, 0.024895, 0.024254, 0.025722, 0.026614, 0.027479, 0.028321, 0.032718, 0.040153
#*# 	0.073480, 0.065203, 0.056324, 0.048719, 0.044149, 0.042651, 0.043046, 0.043043, 0.042817, 0.038339, 0.032301, 0.029128, 0.029373, 0.030231, 0.030530, 0.030589, 0.031508, 0.031229, 0.030757, 0.030992, 0.031964, 0.031910, 0.033284, 0.036673, 0.044403
#*# 	0.078398, 0.069078, 0.060735, 0.054141, 0.051006, 0.048699, 0.047507, 0.047566, 0.044489, 0.041484, 0.036140, 0.034839, 0.036169, 0.037734, 0.038359, 0.038881, 0.040120, 0.039692, 0.037939, 0.038711, 0.039152, 0.040425, 0.041233, 0.044690, 0.052457
#*# 	0.084802, 0.075798, 0.068268, 0.062171, 0.059466, 0.056529, 0.053073, 0.050648, 0.048333, 0.044421, 0.040685, 0.040557, 0.043808, 0.045407, 0.046529, 0.047898, 0.049348, 0.048280, 0.046296, 0.046663, 0.047748, 0.049237, 0.049760, 0.053616, 0.060648
#*# 	0.087507, 0.079414, 0.073271, 0.067986, 0.064439, 0.060278, 0.056715, 0.053719, 0.051354, 0.047913, 0.044532, 0.046110, 0.050146, 0.051162, 0.052017, 0.054058, 0.055101, 0.053339, 0.050553, 0.051128, 0.053068, 0.054270, 0.054928, 0.059141, 0.065732
#*# 	0.087204, 0.080252, 0.076259, 0.072011, 0.068165, 0.063082, 0.058584, 0.055380, 0.053051, 0.050901, 0.048243, 0.049968, 0.053382, 0.054161, 0.054951, 0.055381, 0.055341, 0.052658, 0.049856, 0.050799, 0.052967, 0.055016, 0.056218, 0.060537, 0.067058
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 210.0
#*# min_y = 30.0
#*# max_y = 208.0
#*#
#*# [beacon model default]
#*# model_coef = 1.4512742510883585,
#*# 	  1.761046808550891,
#*# 	  0.7522864365853444,
#*# 	  0.3549299144690959,
#*# 	  0.31534556763425187,
#*# 	  0.38069145890810696,
#*# 	  -0.06467795303797856,
#*# 	  -0.28719882396266333,
#*# 	  0.145761488672838,
#*# 	  0.19251093552947954
#*# model_domain = 3.1531639165734805e-07,3.326954675116541e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 66.388976
#*# model_offset = 0.01000
#*#
#*# [beacon model pei_hot]
#*# model_coef = 1.9263519575030055,
#*# 	2.1946743347503372,
#*# 	0.6208794249910773,
#*# 	0.2775896555222557,
#*# 	0.06526221562750463,
#*# 	-0.2611119885640586,
#*# 	-0.05461829170887029,
#*# 	0.36810740679885895,
#*# 	0.05685001457152785,
#*# 	-0.15547240310186372
#*# model_domain = 3.351987055417817e-07,3.359664588035842e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 63.925584
#*# model_offset = 0.00000
