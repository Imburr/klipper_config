[include moonraker_obico_macros.cfg]
##########################
##### BASE CONFIG #######
##########################

[include mainsail.cfg]
[include ./backup/backup.cfg]

##########################
##### HARDWARE STUFF #####
##########################

[include ./hardware/xyz-stepper.cfg]
[include ./hardware/extruder.cfg]
#[include ./klicky/klicky-probe.cfg]
#[include ./hardware/adxl345.cfg]  This config now in canbus.cfg
[include ./hardware/fans.cfg] # Some fans config in canbus.cfg
[include ./hardware/canbus.cfg]

##########################
##### LIGHTS #############
##########################

[include ./hardware/chamber-lighting.cfg]
[include ./hardware/stealthburner-led.cfg]

##########################
##### CALIBRATION ########
##########################

[include ./calibration/z-tilt.cfg]
[include ./calibration/bed-mesh.cfg]
[include ./macros/unsafe.cfg]
[include ./calibration/pressure_advance.cfg]
[include ./calibration/test_speed.cfg]
[include ./calibration/pika.cfg]
[include test_probe_accuracy.cfg]

##########################
##### MACROS #############
##########################

[include ./macros/chamber-led.cfg]
[include ./macros/conditional-homing.cfg]
[include ./macros/print-end.cfg]
[include ./macros/print-start-mmu.cfg]
[include ./macros/dump-variables.cfg]
[include ./macros/movement-check.cfg]
[include ./macros/cancel-change.cfg]
[include ./macros/pause-resume.cfg]         ; Overridden by ERCF / subsequantly disabled
[include ./macros/load-unload.cfg]
[include ./macros/filament-change.cfg]
[include ./macros/park.cfg]
#[include ./macros/prusaslicer-accel.cfg]

##########################
##### THIRD PARTY ########
##########################

#[include ./third-party-cfg/nozzle_scrub.cfg]
[include KAMP_Settings.cfg]

##########################
##### ERCF ###############
##########################

[include mmu/base/*.cfg]
[include macros/mmu_adds.cfg]
[include mmu/optional/mmu_ercf_cutter.cfg]

##########################
##### LCD/MENU ###########
##########################

#[include ./third-party-cfg/nozzle_scrub_menu.cfg]
#[include ./menu/printer_menu.cfg]

##########################
##### NOT ENABLED YET ####
##########################

#[include ./todo/mini12864.cfg] Add this after adding mini12864 LED
#[include ./todo/lcd_tweaks.cfg] Need to figure this one out and then implement
#[include ./hardware/nevermore.cfg] Disabled as I prefer to chamber vent outside and needed the PWM

##########################
#### REPLACEMENT #########
##########################

[include ./replacement_macros/replace-m900.cfg]
[include ./replacement_macros/replace-m117.cfg]

[exclude_object]

[gcode_arcs]
resolution: 0.1

[respond]
default_type: echo
default_prefix:  

[force_move]
# Enable commands that force potentially unsafe movement
enable_force_move: True

[idle_timeout]
timeout: 14400

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_290040000750314D35323820-if00
restart_method: command

[mcu rpi]
# Add Rpi as secondary MCU to allow for ADXL use through SPI ribbon/adapter from LDO
serial: /tmp/klipper_host_mcu

[mcu sht]
canbus_uuid: 30993412e8e0

[printer]
kinematics: corexy
max_velocity: 200           # Changed from 200 on 7.11.23
max_accel:  6000            # tuned on 7.11.23 after beacon install.
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0 # Changed on 7.11.23

#####################################################################
#   Input Shaper
#####################################################################

[input_shaper]
#shaper_freq_x: 76.2               ; suggested max_accel <= 22600 mm/sec^2
#shaper_type_x: zv
#shaper_freq_y: 51.8               ; suggested max_accel <= 7900 mm/sec^2
#shaper_type_y: mzv


#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
heater_pin: PA2 #PA2 is LDO default
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 125
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  WAS TAP - NOW BEACON in CANBUS

#####################################################################
#   Additional Sensors
#####################################################################

[thermistor CMFB103F3950FANT]
temperature1: 0.0
resistance1: 32116.0
temperature2: 40.0
resistance2: 5309.0
temperature3: 80.0
resistance3: 1228.0

#[temperature_sensor sb_ambient_temp]
## Chamber Temperature - T1
#sensor_type: CMFB103F3950FANT
#sensor_pin: PF5
#min_temp: 0
#max_temp: 100
#gcode_id: chamber_th

[temperature_sensor back_chamber_temp]
## Chamber Temperature - T
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF6
min_temp: 0
max_temp: 100
gcode_id: chamber_th2

[temperature_sensor RPi4]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################

#[safe_z_home]
##  XY Location of the Z Endstop Switch
##  Update -10,-10 to the XY coordinates of your endstop pin 
##  (such as 157,305) after going through Z Endstop Pin
##  Location Definition step.
#home_xy_position: 147,256
#speed:100
#z_hop:10
#z_hop_speed:10


########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.889
#*# pid_ki = 0.964
#*# pid_kd = 412.851
#*#
#*# [probe]
#*# z_offset = -1.270
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.003832, -0.003515, -0.000256, 0.005869, 0.008513, 0.012849, 0.014728, 0.008558, 0.013681, 0.012228, 0.009173, 0.010518, 0.009499, 0.009395, 0.019823, 0.020147, 0.013629, 0.025022, 0.027201, 0.024810, 0.025997
#*# 	  -0.008128, -0.007747, -0.004686, 0.001538, -0.001730, 0.002572, 0.005933, 0.001878, 0.004063, 0.002046, 0.002706, 0.005557, 0.000251, 0.008372, 0.004168, 0.009314, 0.009473, 0.018924, 0.021012, 0.012984, 0.026149
#*# 	  -0.006745, -0.005079, -0.008882, -0.006411, -0.006792, -0.001017, -0.005524, -0.001397, -0.001491, -0.000848, -0.003325, -0.001791, -0.001020, -0.000096, 0.001147, -0.000734, 0.012877, 0.017372, 0.018381, 0.027729, 0.028654
#*# 	  -0.007756, -0.024532, -0.006745, -0.006717, -0.006331, -0.003282, -0.005685, -0.002292, -0.004379, -0.002952, -0.002613, -0.002934, 0.004036, 0.003477, -0.002097, 0.007877, 0.010319, 0.018584, 0.027775, 0.023748, 0.028415
#*# 	  -0.010119, -0.017076, -0.004847, -0.008759, -0.012247, -0.003531, -0.005562, -0.007180, -0.006837, -0.003155, -0.002525, -0.002036, -0.002279, 0.002519, 0.002457, 0.006273, 0.014316, 0.023985, 0.026800, 0.026177, 0.029966
#*# 	  -0.021275, -0.020973, -0.022603, -0.012105, -0.007405, -0.007368, -0.009269, -0.009048, -0.011946, -0.005173, -0.006216, -0.005921, -0.003858, -0.002069, -0.002270, 0.003319, 0.006583, 0.015670, 0.013579, 0.026440, 0.025666
#*# 	  -0.024321, -0.026748, -0.030270, -0.030371, -0.021024, -0.027328, -0.022772, -0.012887, -0.007079, -0.013119, -0.005960, -0.008264, -0.004662, -0.002239, -0.004643, -0.003558, 0.007241, 0.010278, 0.015267, 0.022110, 0.025847
#*# 	  -0.025925, -0.022266, -0.029264, -0.024485, -0.026072, -0.013062, -0.016433, -0.010814, -0.004812, -0.008061, -0.004539, -0.004716, -0.006310, -0.004065, -0.004023, -0.004094, 0.001692, -0.000785, 0.011640, 0.026243, 0.026823
#*# 	  -0.024754, -0.030063, -0.025226, -0.025280, -0.020656, -0.019405, -0.022997, -0.016479, -0.008297, -0.013296, -0.008777, -0.006860, -0.004897, -0.002920, -0.005002, -0.001489, 0.003621, 0.003187, 0.014899, 0.025619, 0.026066
#*# 	  -0.023932, -0.029935, -0.024910, -0.031110, -0.020762, -0.028471, -0.014306, -0.007991, -0.011128, -0.006562, -0.006293, -0.004268, -0.003458, -0.002884, 0.000341, 0.002004, 0.006333, 0.008271, 0.019528, 0.024354, 0.020121
#*# 	  -0.024123, -0.019083, -0.016688, -0.020513, -0.014175, -0.017547, -0.015325, -0.013168, -0.005140, -0.009196, -0.001384, -0.000802, -0.002030, -0.001949, -0.000882, 0.007124, 0.014234, 0.019328, 0.016551, 0.018750, 0.029702
#*# 	  -0.029871, -0.013118, -0.011484, -0.014147, -0.011577, -0.013135, -0.012579, -0.011544, -0.009773, -0.010056, -0.006061, 0.000134, 0.002621, 0.003842, 0.010463, 0.007178, -0.000075, 0.020845, 0.023284, 0.023133, 0.028203
#*# 	  -0.010492, -0.020864, -0.015273, -0.012352, -0.015213, -0.013482, -0.011259, -0.011522, -0.008449, 0.000337, 0.000182, 0.001920, 0.004851, 0.006497, 0.011025, 0.018453, 0.021766, 0.022058, 0.028836, 0.022468, 0.036126
#*# 	  -0.022834, -0.017856, -0.015418, -0.014998, -0.015484, -0.015408, -0.014169, -0.015622, -0.000457, 0.001178, 0.002549, 0.004499, 0.012560, 0.011069, 0.015974, 0.020122, 0.020118, 0.013986, 0.031636, 0.033927, 0.035641
#*# 	  -0.024172, -0.019885, -0.015383, -0.014920, -0.014356, -0.013556, -0.014688, -0.007786, -0.011964, 0.001300, 0.000271, 0.004262, 0.004269, 0.015735, 0.013367, 0.017047, 0.019155, 0.020426, 0.035272, 0.046040, 0.050030
#*# 	  -0.019614, -0.026246, -0.028365, -0.019422, -0.017589, -0.017699, -0.017250, -0.016131, -0.008755, -0.006434, 0.001754, 0.004886, 0.017125, 0.015728, 0.017255, 0.016931, 0.023318, 0.015826, 0.035683, 0.040090, 0.046201
#*# 	  -0.028549, -0.027431, -0.034592, -0.032349, -0.022678, -0.024714, -0.022588, -0.015319, -0.019429, -0.005437, 0.004842, 0.000919, 0.007321, 0.014088, 0.009941, 0.012835, 0.021752, 0.023453, 0.032335, 0.035898, 0.041969
#*# 	  -0.035183, -0.027046, -0.026254, -0.025655, -0.036554, -0.022891, -0.022651, -0.019506, -0.017864, -0.011595, -0.009118, 0.003725, 0.005321, 0.013430, 0.014052, 0.012516, 0.017704, 0.014194, 0.018640, 0.019076, 0.041170
#*# 	  -0.035707, -0.030688, -0.024522, -0.026863, -0.023966, -0.021433, -0.025041, -0.021174, -0.019254, -0.011767, 0.000484, -0.004183, 0.010894, 0.002413, 0.009947, 0.012662, 0.018104, 0.016819, 0.019236, 0.027653, 0.033846
#*# 	  -0.021713, -0.031512, -0.022916, -0.023343, -0.023668, -0.022279, -0.020042, -0.019461, -0.015453, -0.009227, -0.001277, 0.001576, 0.012688, 0.005773, 0.010189, 0.016729, 0.013235, 0.014928, 0.017479, 0.026750, 0.030081
#*# 	  -0.023274, -0.021226, -0.022428, -0.020822, -0.022040, -0.021347, -0.019968, -0.015380, -0.008633, -0.005571, 0.008118, 0.009031, 0.006638, 0.007755, 0.011275, 0.013847, 0.013321, 0.014061, 0.021201, 0.026571, 0.031214
#*# x_count = 21
#*# y_count = 21
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 48.0
#*# max_x = 198.0
#*# min_y = 48.0
#*# max_y = 198.0
#*#
#*# [beacon model default]
#*# model_coef = 1.934243930597146,
#*# 	  2.206808199797723,
#*# 	  0.6436025413836176,
#*# 	  0.3095345837351202,
#*# 	  -0.15977813582327796,
#*# 	  -0.5908394974077775,
#*# 	  0.4266719892497021,
#*# 	  1.046422592108256,
#*# 	  -0.23184944767066623,
#*# 	  -0.5507144312738391
#*# model_domain = 3.353607345856729e-07,3.361070372275538e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 79.449632
#*# model_offset = 0.58000
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 77.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 51.6
