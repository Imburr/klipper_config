##########################
##### BASE CONFIG #######
##########################

[include mainsail.cfg]
[include ./backup/backup.cfg]

##########################
##### HARDWARE STUFF #####
##########################

[include ./hardware/xyz-stepper.cfg]
[include ./hardware/extruder.cfg]
#[include ./klicky/klicky-probe.cfg]
#[include ./hardware/adxl345.cfg]  This config now in canbus.cfg
[include ./hardware/fans.cfg] # Some fans config in canbus.cfg
[include ./hardware/canbus.cfg]

##########################
##### LIGHTS #############
##########################

[include ./hardware/chamber-lighting.cfg]
[include ./hardware/stealthburner-led.cfg]

##########################
##### CALIBRATION ########
##########################

[include ./calibration/z-tilt.cfg]
[include ./calibration/bed-mesh.cfg]
[include ./macros/unsafe.cfg]
[include ./calibration/pressure_advance.cfg]
[include ./calibration/test_speed.cfg]
[include test_probe_accuracy.cfg]

##########################
##### MACROS #############
##########################

[include ./macros/chamber-led.cfg]
[include ./macros/conditional-homing.cfg]
[include ./macros/print-end.cfg]
[include ./macros/print-start-mmu.cfg]
[include ./macros/dump-variables.cfg]
[include ./macros/movement-check.cfg]
[include ./macros/cancel-change.cfg]
[include ./macros/pause-resume.cfg]         ; Overridden by ERCF / subsequantly disabled
[include ./macros/load-unload.cfg]
[include ./macros/filament-change.cfg]
[include ./macros/park.cfg]
#[include ./macros/prusaslicer-accel.cfg]

##########################
##### THIRD PARTY ########
##########################

#[include ./third-party-cfg/nozzle_scrub.cfg]
[include KAMP_Settings.cfg]

##########################
##### ERCF ###############
##########################

[include mmu/base/*.cfg]


##########################
##### LCD/MENU ###########
##########################

#[include ./third-party-cfg/nozzle_scrub_menu.cfg]
#[include ./menu/printer_menu.cfg]

##########################
##### NOT ENABLED YET ####
##########################

#[include ./todo/mini12864.cfg] Add this after adding mini12864 LED
#[include ./todo/lcd_tweaks.cfg] Need to figure this one out and then implement
#[include ./hardware/nevermore.cfg] Disabled as I prefer to chamber vent outside and needed the PWM

##########################
#### REPLACEMENT #########
##########################

[include ./replacement_macros/replace-m900.cfg]
[include ./replacement_macros/replace-m117.cfg]

[exclude_object]

[gcode_arcs]
resolution: 0.1

[respond]
default_type: echo
default_prefix:  

[force_move]
# Enable commands that force potentially unsafe movement
enable_force_move: True

[idle_timeout]
timeout: 14400

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_290040000750314D35323820-if00
restart_method: command

[mcu rpi]
# Add Rpi as secondary MCU to allow for ADXL use through SPI ribbon/adapter from LDO
serial: /tmp/klipper_host_mcu

[mcu sht]
canbus_uuid: 30993412e8e0

[printer]
kinematics: corexy
max_velocity: 200           # Changed from 200 on 7.11.23
max_accel:  6000            # tuned on 7.11.23 after beacon install.
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0 # Changed on 7.11.23

#####################################################################
#   Input Shaper
#####################################################################

[input_shaper]
#shaper_freq_x: 76.2               ; suggested max_accel <= 22600 mm/sec^2
#shaper_type_x: zv
#shaper_freq_y: 51.8               ; suggested max_accel <= 7900 mm/sec^2
#shaper_type_y: mzv


#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
heater_pin: PA2 #PA2 is LDO default
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 125
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  WAS TAP - NOW BEACON in CANBUS

#####################################################################
#   Additional Sensors
#####################################################################

[thermistor CMFB103F3950FANT]
temperature1: 0.0
resistance1: 32116.0
temperature2: 40.0
resistance2: 5309.0
temperature3: 80.0
resistance3: 1228.0

#[temperature_sensor sb_ambient_temp]
## Chamber Temperature - T1
#sensor_type: CMFB103F3950FANT
#sensor_pin: PF5
#min_temp: 0
#max_temp: 100
#gcode_id: chamber_th

[temperature_sensor back_chamber_temp]
## Chamber Temperature - T
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF6
min_temp: 0
max_temp: 100
gcode_id: chamber_th2

[temperature_sensor RPi4]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################

#[safe_z_home]
##  XY Location of the Z Endstop Switch
##  Update -10,-10 to the XY coordinates of your endstop pin 
##  (such as 157,305) after going through Z Endstop Pin
##  Location Definition step.
#home_xy_position: 147,256
#speed:100
#z_hop:10
#z_hop_speed:10


########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.889
#*# pid_ki = 0.964
#*# pid_kd = 412.851
#*#
#*# [probe]
#*# z_offset = -1.270
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.078196, -0.065771, -0.050817, -0.045090, -0.050433, -0.045773, -0.045694, -0.040754, -0.053717, -0.044290, -0.045748, -0.044921, -0.046082, -0.035827, -0.044077, -0.052319, -0.048071, -0.052742, -0.048621, -0.054338, -0.051154, -0.047363, -0.046981, -0.047443, -0.056504
#*# 	  -0.053925, -0.065010, -0.044571, -0.045717, -0.041938, -0.051547, -0.044248, -0.040408, -0.044255, -0.039437, -0.047924, -0.043846, -0.044920, -0.045699, -0.044677, -0.044602, -0.056872, -0.045903, -0.051091, -0.046117, -0.074956, -0.044413, -0.038828, -0.046518, -0.050517
#*# 	  -0.054702, -0.047268, -0.045704, -0.045955, -0.041981, -0.040485, -0.031741, -0.037773, -0.039689, -0.035509, -0.036345, -0.035604, -0.037338, -0.044011, -0.038881, -0.045064, -0.045644, -0.042843, -0.047229, -0.051084, -0.044630, -0.039125, -0.046739, -0.052232, -0.045437
#*# 	  -0.060447, -0.058057, -0.050440, -0.040377, -0.046863, -0.041405, -0.040913, -0.033092, -0.033359, -0.036391, -0.034815, -0.033301, -0.041991, -0.035605, -0.042666, -0.045262, -0.052574, -0.044085, -0.038600, -0.045344, -0.042949, -0.043553, -0.043898, -0.050754, -0.046237
#*# 	  -0.065294, -0.066706, -0.061313, -0.052188, -0.049210, -0.049846, -0.042731, -0.039344, -0.034546, -0.034033, -0.033517, -0.035914, -0.037655, -0.041115, -0.038035, -0.046221, -0.043861, -0.040952, -0.041732, -0.047143, -0.046880, -0.039104, -0.043336, -0.044581, -0.045497
#*# 	  -0.068190, -0.062046, -0.056780, -0.058028, -0.052565, -0.049650, -0.043180, -0.036216, -0.035885, -0.034908, -0.033061, -0.036683, -0.033521, -0.031110, -0.031063, -0.041959, -0.042441, -0.042008, -0.040787, -0.042744, -0.038115, -0.039678, -0.039110, -0.037076, -0.047228
#*# 	  -0.075442, -0.067846, -0.065479, -0.068310, -0.057334, -0.057835, -0.049552, -0.042745, -0.034523, -0.028823, -0.022302, -0.032424, -0.033403, -0.033749, -0.038151, -0.035187, -0.038120, -0.041051, -0.041675, -0.044055, -0.040527, -0.041536, -0.043627, -0.042270, -0.043724
#*# 	  -0.067648, -0.069693, -0.055185, -0.059764, -0.055802, -0.052547, -0.046348, -0.034147, -0.037594, -0.032457, -0.029212, -0.034127, -0.032647, -0.035126, -0.044215, -0.044078, -0.041259, -0.042204, -0.039175, -0.041861, -0.043935, -0.040666, -0.042760, -0.049557, -0.050357
#*# 	  -0.066431, -0.057740, -0.062521, -0.061942, -0.057389, -0.058402, -0.043537, -0.041013, -0.040474, -0.032504, -0.033230, -0.030949, -0.035128, -0.036335, -0.037486, -0.041447, -0.038108, -0.041305, -0.039908, -0.040166, -0.041945, -0.040438, -0.041847, -0.042913, -0.044424
#*# 	  -0.060308, -0.049367, -0.048715, -0.049972, -0.048784, -0.046774, -0.035610, -0.046174, -0.034118, -0.034282, -0.033983, -0.032538, -0.033465, -0.032983, -0.034477, -0.035897, -0.034925, -0.035543, -0.038692, -0.039266, -0.042583, -0.041776, -0.041295, -0.041581, -0.050922
#*# 	  -0.054488, -0.044571, -0.045485, -0.043244, -0.041942, -0.042792, -0.037619, -0.032313, -0.034514, -0.035704, -0.032185, -0.023417, -0.033780, -0.031388, -0.030122, -0.035238, -0.036710, -0.034821, -0.038172, -0.036571, -0.044172, -0.046370, -0.033737, -0.041020, -0.038281
#*# 	  -0.049113, -0.042474, -0.038972, -0.037775, -0.042659, -0.038463, -0.037268, -0.033877, -0.031895, -0.031182, -0.033611, -0.028959, -0.020979, -0.021455, -0.033400, -0.027695, -0.030740, -0.031492, -0.035466, -0.036666, -0.036939, -0.041319, -0.037080, -0.034653, -0.038601
#*# 	  -0.044110, -0.044789, -0.041619, -0.040537, -0.039717, -0.040116, -0.029095, -0.038915, -0.031774, -0.021248, -0.029989, -0.021603, -0.021617, -0.026612, -0.024486, -0.026641, -0.029746, -0.029758, -0.027799, -0.031715, -0.025854, -0.031997, -0.038396, -0.029900, -0.040465
#*# 	  -0.045416, -0.042966, -0.041252, -0.038924, -0.038714, -0.038358, -0.039470, -0.041744, -0.029405, -0.034475, -0.029713, -0.028840, -0.027822, -0.027113, -0.024837, -0.029262, -0.037593, -0.037606, -0.038664, -0.036045, -0.040874, -0.040388, -0.033550, -0.040099, -0.038357
#*# 	  -0.044700, -0.040768, -0.043067, -0.041746, -0.037038, -0.040164, -0.039909, -0.034402, -0.033968, -0.039979, -0.031501, -0.030121, -0.027531, -0.029963, -0.023122, -0.037534, -0.027491, -0.039804, -0.038479, -0.034158, -0.028524, -0.029284, -0.038153, -0.028155, -0.034723
#*# 	  -0.044197, -0.042464, -0.041295, -0.045407, -0.041450, -0.037695, -0.040752, -0.037811, -0.030874, -0.026858, -0.022009, -0.025888, -0.029080, -0.031353, -0.029604, -0.019435, -0.024006, -0.024322, -0.030705, -0.035316, -0.016072, -0.020829, -0.021636, -0.023991, -0.027915
#*# 	  -0.046947, -0.041854, -0.039662, -0.038022, -0.038013, -0.034184, -0.034281, -0.036720, -0.032897, -0.030504, -0.034351, -0.022980, -0.025210, -0.024120, -0.023842, -0.021177, -0.024715, -0.031510, -0.026048, -0.023224, -0.023955, -0.023258, -0.022145, -0.017372, -0.021193
#*# 	  -0.042061, -0.040298, -0.037196, -0.042825, -0.034619, -0.034765, -0.034667, -0.036738, -0.022699, -0.023458, -0.020851, -0.025412, -0.022143, -0.024098, -0.020262, -0.021547, -0.022178, -0.020994, -0.019849, -0.019760, -0.020924, -0.022524, -0.015275, -0.015562, -0.015246
#*# 	  -0.046797, -0.039615, -0.036267, -0.033760, -0.033572, -0.033460, -0.033312, -0.032688, -0.024814, -0.026142, -0.020276, -0.023944, -0.023273, -0.020510, -0.021668, -0.022395, -0.018981, -0.027247, -0.022184, -0.022247, -0.014189, -0.013858, -0.011134, -0.012967, -0.013691
#*# 	  -0.039036, -0.036767, -0.038637, -0.038671, -0.034742, -0.033975, -0.038638, -0.034551, -0.028826, -0.025743, -0.026047, -0.030046, -0.033977, -0.018405, -0.027737, -0.025032, -0.014048, -0.025341, -0.023880, -0.023146, -0.023842, -0.017662, -0.014757, -0.021512, -0.017585
#*# 	  -0.044984, -0.038447, -0.039327, -0.035687, -0.038780, -0.035214, -0.037040, -0.036288, -0.031548, -0.026058, -0.026605, -0.028593, -0.024854, -0.025234, -0.023630, -0.023683, -0.023788, -0.026927, -0.025579, -0.022436, -0.022485, -0.018538, -0.017560, -0.020976, -0.019944
#*# 	  -0.048663, -0.038217, -0.036564, -0.035393, -0.030989, -0.026589, -0.028024, -0.027845, -0.029549, -0.028027, -0.029261, -0.029238, -0.029369, -0.024305, -0.024369, -0.025985, -0.024188, -0.029179, -0.022825, -0.027269, -0.021865, -0.020122, -0.016175, -0.018403, -0.018640
#*# 	  -0.049791, -0.038689, -0.038076, -0.032733, -0.030707, -0.034817, -0.034697, -0.029512, -0.028168, -0.031235, -0.029792, -0.024099, -0.028276, -0.026572, -0.028229, -0.027480, -0.026634, -0.026112, -0.028820, -0.024311, -0.021627, -0.019817, -0.027497, -0.024645, -0.022332
#*# 	  -0.043614, -0.033677, -0.035936, -0.030325, -0.033788, -0.034404, -0.034222, -0.030827, -0.031887, -0.029459, -0.031434, -0.030241, -0.029934, -0.028702, -0.029287, -0.031469, -0.029454, -0.031147, -0.029197, -0.029491, -0.023887, -0.022132, -0.021655, -0.018768, -0.023777
#*# 	  -0.056403, -0.052314, -0.043536, -0.036467, -0.034684, -0.032340, -0.034952, -0.033918, -0.036590, -0.034198, -0.033945, -0.034040, -0.032513, -0.034538, -0.033606, -0.034757, -0.032888, -0.032442, -0.032556, -0.032900, -0.029785, -0.032928, -0.030879, -0.029504, -0.028314
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 210.0
#*# min_y = 30.0
#*# max_y = 210.0
#*#
#*# [beacon model default]
#*# model_coef = 1.9257982386737142,
#*# 	  2.1904011986275074,
#*# 	  0.5881661108028357,
#*# 	  0.30341866940870527,
#*# 	  0.14823890288711727,
#*# 	  -0.42807822476666274,
#*# 	  -0.13716254071061182,
#*# 	  0.612855529187592,
#*# 	  0.08376843001203003,
#*# 	  -0.2664564217100284
#*# model_domain = 3.352922478536077e-07,3.360945745364866e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 72.578002
#*# model_offset = -0.37500
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 77.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 51.6
