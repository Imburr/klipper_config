##########################
##### BASE CONFIG #######
##########################

[include mainsail.cfg]
[include ./backup/backup.cfg]

##########################
##### HARDWARE STUFF #####
##########################

[include ./hardware/xyz-stepper.cfg]
[include ./hardware/extruder.cfg]
#[include ./klicky/klicky-probe.cfg]
#[include ./hardware/adxl345.cfg]  This config now in canbus.cfg
[include ./hardware/fans.cfg] # Some fans config in canbus.cfg
[include ./hardware/canbus.cfg]

##########################
##### LIGHTS #############
##########################

[include ./hardware/chamber-lighting.cfg]
[include ./hardware/stealthburner-led.cfg]

##########################
##### CALIBRATION ########
##########################

[include ./calibration/z-tilt.cfg]
[include ./calibration/bed-mesh.cfg]
[include ./macros/unsafe.cfg]
[include ./calibration/pressure_advance.cfg]
[include ./calibration/test_speed.cfg]
[include ./calibration/pika.cfg]
[include test_probe_accuracy.cfg]

##########################
##### MACROS #############
##########################

[include ./macros/chamber-led.cfg]
[include ./macros/conditional-homing.cfg]
[include ./macros/print-end.cfg]
[include ./macros/print-start-mmu.cfg]
[include ./macros/dump-variables.cfg]
[include ./macros/movement-check.cfg]
[include ./macros/cancel-change.cfg]
[include ./macros/pause-resume.cfg]         ; Overridden by ERCF / subsequantly disabled
[include ./macros/load-unload.cfg]
[include ./macros/filament-change.cfg]
[include ./macros/park.cfg]
#[include ./macros/prusaslicer-accel.cfg]

##########################
##### THIRD PARTY ########
##########################

#[include ./third-party-cfg/nozzle_scrub.cfg]
[include KAMP_Settings.cfg]

##########################
##### ERCF ###############
##########################

[include mmu/base/*.cfg]
[include macros/mmu_adds.cfg]
[include mmu/optional/mmu_ercf_cutter.cfg]

##########################
##### LCD/MENU ###########
##########################

#[include ./third-party-cfg/nozzle_scrub_menu.cfg]
#[include ./menu/printer_menu.cfg]

##########################
##### NOT ENABLED YET ####
##########################

#[include ./todo/mini12864.cfg] Add this after adding mini12864 LED
#[include ./todo/lcd_tweaks.cfg] Need to figure this one out and then implement
#[include ./hardware/nevermore.cfg] Disabled as I prefer to chamber vent outside and needed the PWM

##########################
#### REPLACEMENT #########
##########################

[include ./replacement_macros/replace-m900.cfg]
[include ./replacement_macros/replace-m117.cfg]

[exclude_object]

[gcode_arcs]
resolution: 0.1

[respond]
default_type: echo
default_prefix:  

[force_move]
# Enable commands that force potentially unsafe movement
enable_force_move: True

[idle_timeout]
timeout: 14400

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_290040000750314D35323820-if00
restart_method: command

[mcu rpi]
# Add Rpi as secondary MCU to allow for ADXL use through SPI ribbon/adapter from LDO
serial: /tmp/klipper_host_mcu

[mcu sht]
canbus_uuid: 30993412e8e0

[printer]
kinematics: corexy
max_velocity: 200           # Changed from 200 on 7.11.23
max_accel:  6000            # tuned on 7.11.23 after beacon install.
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0 # Changed on 7.11.23

#####################################################################
#   Input Shaper
#####################################################################

[input_shaper]
#shaper_freq_x: 76.2               ; suggested max_accel <= 22600 mm/sec^2
#shaper_type_x: zv
#shaper_freq_y: 51.8               ; suggested max_accel <= 7900 mm/sec^2
#shaper_type_y: mzv


#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
heater_pin: PA2 #PA2 is LDO default
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 125
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  WAS TAP - NOW BEACON in CANBUS

#####################################################################
#   Additional Sensors
#####################################################################

[thermistor CMFB103F3950FANT]
temperature1: 0.0
resistance1: 32116.0
temperature2: 40.0
resistance2: 5309.0
temperature3: 80.0
resistance3: 1228.0

#[temperature_sensor sb_ambient_temp]
## Chamber Temperature - T1
#sensor_type: CMFB103F3950FANT
#sensor_pin: PF5
#min_temp: 0
#max_temp: 100
#gcode_id: chamber_th

[temperature_sensor back_chamber_temp]
## Chamber Temperature - T
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF6
min_temp: 0
max_temp: 100
gcode_id: chamber_th2

[temperature_sensor RPi4]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################

#[safe_z_home]
##  XY Location of the Z Endstop Switch
##  Update -10,-10 to the XY coordinates of your endstop pin 
##  (such as 157,305) after going through Z Endstop Pin
##  Location Definition step.
#home_xy_position: 147,256
#speed:100
#z_hop:10
#z_hop_speed:10


########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.889
#*# pid_ki = 0.964
#*# pid_kd = 412.851
#*#
#*# [probe]
#*# z_offset = -1.270
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.042928, -0.029509, -0.024670, -0.015932, -0.013941, -0.013748, -0.013814, -0.011962, -0.012439, -0.011309, -0.007061, -0.006231, -0.000005, -0.001019, -0.007469, -0.006141, -0.007857, -0.007205, -0.003292, -0.007144, -0.001735, 0.011443, -0.002581, 0.010352, -0.002654
#*# 	  -0.019120, -0.015251, -0.014303, -0.010147, -0.003179, -0.012073, -0.012858, -0.002987, -0.009137, -0.002769, -0.004875, 0.002304, -0.002087, 0.002974, -0.000587, 0.001448, -0.000047, -0.001244, -0.002261, -0.004463, -0.000141, 0.005814, 0.014120, 0.013797, 0.013952
#*# 	  -0.015003, -0.015183, -0.006259, -0.005161, -0.004310, -0.001149, 0.000973, -0.003961, -0.001256, -0.007317, -0.004137, -0.005588, 0.000447, -0.001726, -0.003666, -0.004508, -0.002656, -0.002300, 0.000278, 0.000196, 0.006252, 0.009402, 0.012781, 0.012208, 0.012801
#*# 	  -0.018039, -0.016366, -0.011571, -0.010382, -0.007962, -0.001586, -0.001632, -0.007053, -0.004687, -0.006127, -0.009175, -0.006076, -0.009446, -0.006239, -0.008092, -0.006520, -0.008361, -0.008724, -0.005722, -0.005380, 0.007135, 0.012319, 0.012686, 0.013595, 0.011499
#*# 	  -0.023521, -0.016463, -0.013176, -0.015990, -0.008793, -0.005304, -0.009204, -0.000048, -0.007335, -0.004778, -0.008026, -0.008585, -0.006951, -0.007020, -0.008335, -0.008850, -0.006132, -0.004704, -0.000226, 0.006552, 0.003327, 0.010806, 0.009947, 0.011313, 0.010817
#*# 	  -0.021406, -0.017684, -0.015212, -0.015353, -0.008480, -0.011150, -0.004241, -0.004108, -0.010957, -0.009543, -0.009211, -0.005364, -0.009627, -0.007510, -0.003324, -0.005061, -0.002844, -0.009945, -0.005753, 0.006325, 0.010703, 0.008701, 0.011961, 0.011324, 0.010044
#*# 	  -0.018801, -0.018098, -0.009745, -0.012938, -0.007576, -0.006387, -0.003230, -0.004666, -0.007147, -0.002541, -0.007094, -0.004109, 0.003299, -0.003222, -0.002469, -0.010443, -0.008096, 0.005524, 0.008750, 0.006233, 0.009659, 0.010488, 0.011865, 0.010769, 0.011530
#*# 	  -0.017830, -0.017188, -0.011442, -0.008338, -0.004916, -0.008748, -0.008641, -0.007082, -0.007521, 0.007524, -0.006049, -0.005129, -0.004812, -0.009460, 0.006617, 0.002236, -0.004064, 0.007454, 0.008742, 0.009229, 0.010115, 0.014101, 0.011855, 0.016724, 0.019815
#*# 	  -0.018694, -0.019847, -0.010827, -0.006576, -0.007792, -0.006220, -0.003929, -0.004604, -0.005909, 0.000665, 0.007075, -0.000825, 0.005161, 0.007152, 0.004315, 0.004488, 0.005637, 0.004133, 0.005578, 0.007615, 0.014472, 0.014357, 0.014514, 0.014877, 0.014969
#*# 	  -0.017921, -0.010087, -0.009530, -0.006164, -0.009124, -0.005366, -0.010422, -0.006022, -0.007494, -0.006829, 0.007414, 0.005517, 0.007961, 0.005228, 0.001245, 0.004483, 0.006553, 0.008275, 0.005046, 0.006321, 0.008324, 0.013547, 0.014361, 0.014758, 0.012582
#*# 	  -0.017086, -0.009929, -0.010369, -0.007932, -0.006986, -0.007650, -0.006363, -0.002822, -0.002802, 0.002599, 0.004167, -0.001198, 0.001533, 0.003138, 0.004508, 0.003824, 0.003898, 0.005711, 0.007590, 0.009486, 0.013427, 0.010109, 0.017118, 0.015445, 0.016392
#*# 	  -0.018328, -0.013441, -0.014387, -0.010115, -0.008887, -0.008338, -0.003275, 0.002128, 0.000944, -0.001483, 0.004439, 0.001128, 0.001646, 0.003095, 0.008279, 0.010184, 0.002564, 0.009918, 0.010242, 0.012828, 0.019729, 0.017596, 0.017419, 0.026765, 0.023062
#*# 	  -0.019193, -0.011492, -0.010283, -0.012435, -0.010109, -0.009118, -0.001650, -0.003187, -0.002646, 0.003037, 0.000196, 0.001947, 0.003173, 0.000038, 0.006643, 0.008389, 0.008504, 0.009538, 0.008257, 0.013335, 0.014708, 0.027256, 0.024396, 0.031966, 0.026405
#*# 	  -0.017081, -0.012843, -0.008091, -0.008896, -0.004732, -0.001561, -0.006874, 0.000981, -0.000412, 0.003520, 0.002617, 0.000415, 0.010059, 0.010309, 0.009933, 0.012577, 0.011279, 0.011878, 0.012723, 0.018239, 0.027133, 0.026422, 0.027135, 0.028684, 0.027003
#*# 	  -0.016907, -0.008251, -0.002882, -0.015568, -0.000913, -0.005274, -0.003452, -0.000089, -0.001106, -0.000229, 0.009334, 0.007978, 0.011681, 0.011916, 0.012008, 0.016246, 0.013767, 0.027345, 0.018912, 0.025303, 0.022710, 0.036110, 0.038617, 0.040498, 0.040699
#*# 	  -0.012491, -0.004952, -0.002688, -0.001671, -0.003167, -0.002091, 0.003093, -0.001738, -0.001422, 0.002150, 0.005583, 0.011588, 0.011911, 0.012362, 0.012796, 0.026177, 0.021138, 0.023731, 0.025841, 0.024567, 0.025533, 0.039942, 0.039292, 0.048257, 0.040055
#*# 	  -0.002902, -0.005146, -0.001764, -0.001145, -0.000945, 0.002139, -0.000649, 0.011122, -0.002194, 0.009635, 0.011041, 0.013165, 0.011613, 0.022677, 0.021590, 0.026224, 0.025550, 0.025852, 0.036277, 0.033092, 0.039294, 0.042084, 0.046148, 0.051155, 0.047368
#*# 	  -0.007881, -0.005794, -0.002749, -0.001861, -0.003393, -0.004575, 0.001714, 0.004839, 0.004760, 0.009938, 0.012119, 0.013663, 0.018508, 0.018351, 0.022313, 0.022728, 0.027616, 0.037409, 0.032246, 0.036620, 0.039745, 0.040473, 0.049392, 0.052434, 0.052969
#*# 	  -0.014551, -0.005492, -0.005246, -0.005476, -0.004869, -0.005156, -0.004567, -0.005054, -0.004187, 0.001705, 0.005179, 0.013797, 0.014319, 0.022220, 0.019678, 0.021313, 0.024334, 0.023852, 0.028725, 0.032896, 0.042830, 0.047660, 0.047046, 0.049548, 0.046821
#*# 	  -0.012594, -0.011953, -0.008663, -0.008831, -0.009820, -0.009864, -0.006790, -0.007589, -0.007594, -0.007613, -0.006548, -0.003311, 0.008371, 0.014410, 0.016836, 0.020307, 0.021807, 0.022571, 0.023811, 0.029536, 0.037051, 0.042121, 0.043907, 0.049222, 0.041496
#*# 	  -0.021575, -0.009191, -0.009233, -0.013165, -0.012189, -0.009200, -0.010926, -0.009411, -0.010353, -0.005106, -0.005445, -0.000127, 0.014698, 0.016102, 0.017044, 0.019777, 0.019781, 0.023249, 0.026032, 0.033843, 0.030436, 0.043664, 0.048674, 0.043812, 0.044514
#*# 	  -0.009074, -0.010058, -0.009332, -0.008875, -0.009713, -0.011480, -0.011065, -0.009923, -0.007848, -0.006144, -0.003504, 0.004526, 0.015437, 0.002383, 0.014940, 0.021868, 0.020027, 0.021016, 0.026951, 0.026344, 0.030438, 0.040082, 0.040864, 0.043894, 0.034580
#*# 	  -0.008227, -0.006376, -0.005102, -0.012086, -0.003693, -0.008445, -0.009357, -0.002418, -0.000338, -0.001608, 0.007654, -0.002459, 0.012819, 0.015191, 0.016234, 0.017416, 0.025849, 0.024156, 0.025387, 0.025568, 0.030118, 0.044414, 0.041003, 0.043668, 0.037788
#*# 	  -0.001626, 0.000299, -0.003482, 0.000026, 0.003377, -0.005094, 0.000692, -0.003724, 0.004806, 0.012475, 0.002922, 0.015952, 0.015576, 0.017792, 0.016901, 0.022790, 0.019882, 0.020230, 0.028062, 0.033861, 0.029963, 0.030304, 0.039224, 0.039376, 0.031871
#*# 	  -0.009470, -0.002111, -0.003952, -0.007366, -0.006688, -0.009112, -0.005462, -0.006408, -0.003633, -0.000890, 0.001552, 0.004709, 0.009370, 0.008423, 0.016162, 0.017748, 0.016672, 0.016874, 0.017194, 0.016555, 0.020483, 0.026770, 0.025427, 0.028353, 0.028239
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 210.0
#*# min_y = 30.0
#*# max_y = 210.0
#*#
#*# [beacon model default]
#*# model_coef = 1.9257982386737142,
#*# 	  2.1904011986275074,
#*# 	  0.5881661108028357,
#*# 	  0.30341866940870527,
#*# 	  0.14823890288711727,
#*# 	  -0.42807822476666274,
#*# 	  -0.13716254071061182,
#*# 	  0.612855529187592,
#*# 	  0.08376843001203003,
#*# 	  -0.2664564217100284
#*# model_domain = 3.352922478536077e-07,3.360945745364866e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 72.578002
#*# model_offset = 0.21500
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 77.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 51.6
