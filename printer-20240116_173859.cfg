[include moonraker_obico_macros.cfg]
##########################
##### BASE CONFIG #######
##########################

[include mainsail.cfg]
[include ./backup/backup.cfg]

##########################
##### HARDWARE STUFF #####
##########################

[include ./hardware/xyz-stepper.cfg]
[include ./hardware/extruder.cfg]
#[include ./klicky/klicky-probe.cfg]
#[include ./hardware/adxl345.cfg]  This config now in canbus.cfg
[include ./hardware/fans.cfg] # Some fans config in canbus.cfg
[include ./hardware/canbus.cfg]

##########################
##### LIGHTS #############
##########################

[include ./hardware/chamber-lighting.cfg]
[include ./hardware/stealthburner-led.cfg]

##########################
##### CALIBRATION ########
##########################

[include ./calibration/z-tilt.cfg]
[include ./calibration/bed-mesh.cfg]
[include ./macros/unsafe.cfg]
[include ./calibration/pressure_advance.cfg]
[include ./calibration/test_speed.cfg]
[include ./calibration/pika.cfg]
[include ./calibration/microadjust.cfg]
[include ./calibration/sensorless.cfg]
[include test_probe_accuracy.cfg]

##########################
##### MACROS #############
##########################

[include ./macros/chamber-led.cfg]
[include ./macros/conditional-homing.cfg]
[include ./macros/print-end.cfg]
[include ./macros/print-start-mmu.cfg]
[include ./macros/dump-variables.cfg]
[include ./macros/movement-check.cfg]
[include ./macros/cancel-change.cfg]
[include ./macros/pause-resume.cfg]         ; Overridden by ERCF / subsequantly disabled
[include ./macros/load-unload.cfg]
[include ./macros/filament-change.cfg]
[include ./macros/park.cfg]
[include ./macros/heatsoak.cfg]

##########################
##### THIRD PARTY ########
##########################

#[include ./third-party-cfg/nozzle_scrub.cfg]
[include KAMP_Settings.cfg]

##########################
##### ERCF ###############
##########################

[include mmu/base/*.cfg]
[include macros/mmu_adds.cfg]
[include mmu/optional/mmu_ercf_cutter.cfg]

##########################
##### LCD/MENU ###########
##########################

#[include ./third-party-cfg/nozzle_scrub_menu.cfg]
#[include ./menu/printer_menu.cfg]

##########################
##### NOT ENABLED YET ####
##########################

#[include ./todo/mini12864.cfg] Add this after adding mini12864 LED
#[include ./todo/lcd_tweaks.cfg] Need to figure this one out and then implement
#[include ./hardware/nevermore.cfg] Disabled as I prefer to chamber vent outside and needed the PWM

##########################
#### REPLACEMENT #########
##########################

[include ./replacement_macros/replace-m900.cfg]
[include ./replacement_macros/replace-m117.cfg]

[exclude_object]

[gcode_arcs]
resolution: 0.1

[respond]
default_type: echo
default_prefix:  

[force_move]
# Enable commands that force potentially unsafe movement
enable_force_move: True

[idle_timeout]
timeout: 14400

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_290040000750314D35323820-if00
restart_method: command

[mcu rpi]
# Add Rpi as secondary MCU to allow for ADXL use through SPI ribbon/adapter from LDO
serial: /tmp/klipper_host_mcu

[mcu sht]
canbus_uuid: 30993412e8e0

[printer]
kinematics: corexy
max_velocity: 200           # Changed from 200 on 7.11.23
max_accel:  6000            # tuned on 7.11.23 after beacon install.
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0 # Changed on 7.11.23

#####################################################################
#   Input Shaper
#####################################################################

[input_shaper]
#shaper_freq_x: 76.2               ; suggested max_accel <= 22600 mm/sec^2
#shaper_type_x: zv
#shaper_freq_y: 51.8               ; suggested max_accel <= 7900 mm/sec^2
#shaper_type_y: mzv

#####################################################################
#   AutoTune / https://github.com/andrewmcgr/klipper_tmc_autotune
#####################################################################

[motor_constants ldo-42sth48-2004mah_vrn]
resistance: 1.45
inductance: 0.002
holding_torque: 0.40
max_current: 2.0
steps_per_revolution: 400

#[autotune_tmc stepper_x]
#motor: ldo-42sth48-2004mah_vrn
#sg4_thrs: 105
#tuning_goal: silent
#[autotune_tmc stepper_y]
#motor: ldo-42sth48-2004mah_vrn
#tuning_goal: silent

[autotune_tmc stepper_z]
motor: ldo-42sth40-1684l300e
[autotune_tmc stepper_z1]
motor: ldo-42sth40-1684l300e
[autotune_tmc stepper_z2]
motor: ldo-42sth40-1684l300e

[autotune_tmc extruder]
motor: moons-cse14hra1l410a

#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
heater_pin: PA2 #PA2 is LDO default
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 125
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  WAS TAP - NOW BEACON in CANBUS

#####################################################################
#   Additional Sensors
#####################################################################

[thermistor CMFB103F3950FANT]
temperature1: 0.0
resistance1: 32116.0
temperature2: 40.0
resistance2: 5309.0
temperature3: 80.0
resistance3: 1228.0

#[temperature_sensor sb_ambient_temp]
## Chamber Temperature - T1
#sensor_type: CMFB103F3950FANT
#sensor_pin: PF5
#min_temp: 0
#max_temp: 100
#gcode_id: chamber_th

[temperature_sensor back_chamber_temp]
## Chamber Temperature - T
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF6
min_temp: 0
max_temp: 100
gcode_id: chamber_th2

[temperature_sensor RPi4]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.889
#*# pid_ki = 0.964
#*# pid_kd = 412.851
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.039837, 0.034978, 0.031089, 0.023636, 0.016318, 0.008362, 0.002769, 0.000535, 0.000322, 0.001720, -0.000784, -0.005079, -0.006729, -0.009429, -0.014562, -0.020140, -0.023671, -0.025145, -0.021548, -0.015325, -0.009960, -0.002811, 0.001253, 0.002829, 0.009650
#*# 	  0.048381, 0.037567, 0.031573, 0.024157, 0.015041, 0.007448, 0.002673, 0.000692, -0.000493, 0.000466, -0.002375, -0.006865, -0.007999, -0.011419, -0.017481, -0.021617, -0.024275, -0.024767, -0.020838, -0.015943, -0.010320, -0.003870, -0.001466, -0.002544, 0.001991
#*# 	  0.049173, 0.035992, 0.031463, 0.022421, 0.018512, 0.008961, 0.005356, 0.002099, 0.000829, 0.000935, -0.003216, -0.005967, -0.010654, -0.015058, -0.019438, -0.022186, -0.026016, -0.024179, -0.021710, -0.016804, -0.014525, -0.007061, -0.005013, -0.006116, -0.002622
#*# 	  0.044704, 0.033594, 0.026184, 0.019473, 0.013429, 0.007294, 0.003196, -0.000050, -0.002552, -0.003508, -0.006651, -0.011180, -0.014648, -0.019539, -0.023488, -0.026687, -0.026269, -0.026009, -0.022824, -0.017593, -0.015330, -0.010397, -0.007275, -0.008249, -0.003751
#*# 	  0.037610, 0.026957, 0.019251, 0.011422, 0.006688, 0.002357, -0.001101, -0.004440, -0.008013, -0.007600, -0.014085, -0.016183, -0.018967, -0.023343, -0.026534, -0.026797, -0.026527, -0.025407, -0.023231, -0.018690, -0.015300, -0.010046, -0.007460, -0.007837, -0.003396
#*# 	  0.029476, 0.017863, 0.010987, 0.004160, -0.002477, -0.006023, -0.008318, -0.010757, -0.014478, -0.016789, -0.019309, -0.020463, -0.024027, -0.027325, -0.027770, -0.027441, -0.025953, -0.026380, -0.025118, -0.022719, -0.019884, -0.012933, -0.010030, -0.008590, -0.004717
#*# 	  0.023887, 0.011411, 0.004948, -0.003007, -0.011033, -0.012990, -0.014365, -0.016830, -0.020436, -0.022479, -0.023659, -0.026132, -0.027458, -0.028483, -0.026893, -0.026979, -0.025389, -0.028220, -0.029196, -0.028595, -0.026386, -0.020484, -0.015511, -0.011407, -0.005795
#*# 	  0.022216, 0.012169, 0.004724, -0.002313, -0.009237, -0.012969, -0.014123, -0.016252, -0.019360, -0.021517, -0.024296, -0.025271, -0.026396, -0.024721, -0.023288, -0.021582, -0.022171, -0.025180, -0.029098, -0.029191, -0.027483, -0.022477, -0.015701, -0.007677, 0.000398
#*# 	  0.023513, 0.014023, 0.007730, -0.001061, -0.005324, -0.011665, -0.012385, -0.013166, -0.014951, -0.020393, -0.021448, -0.022265, -0.022768, -0.022658, -0.019044, -0.017622, -0.018912, -0.024059, -0.027558, -0.028001, -0.028082, -0.023642, -0.015171, -0.003736, 0.007179
#*# 	  0.028413, 0.018622, 0.012778, 0.005524, -0.002029, -0.006723, -0.008054, -0.009723, -0.011854, -0.014245, -0.015878, -0.016525, -0.016703, -0.016824, -0.015360, -0.013461, -0.015922, -0.019643, -0.023881, -0.024592, -0.023750, -0.018980, -0.010436, 0.001816, 0.014607
#*# 	  0.035163, 0.025150, 0.019176, 0.011804, 0.004929, -0.001311, -0.003109, -0.005276, -0.007126, -0.007975, -0.009577, -0.010993, -0.010759, -0.011570, -0.010966, -0.010792, -0.012138, -0.015884, -0.019384, -0.019821, -0.018132, -0.013409, -0.004278, 0.007547, 0.019851
#*# 	  0.038545, 0.027313, 0.021963, 0.014830, 0.007445, 0.002332, 0.000655, -0.002138, -0.003378, -0.004715, -0.005252, -0.005157, -0.005439, -0.006866, -0.007940, -0.009457, -0.010894, -0.013399, -0.014417, -0.014950, -0.012786, -0.007467, 0.001432, 0.012735, 0.024428
#*# 	  0.037980, 0.027396, 0.021018, 0.014319, 0.007712, 0.003586, 0.001985, -0.000594, -0.002720, -0.003478, -0.003288, -0.002068, -0.002538, -0.006005, -0.008415, -0.009908, -0.011199, -0.013244, -0.013638, -0.012439, -0.010160, -0.005386, 0.004763, 0.016303, 0.026139
#*# 	  0.038896, 0.027748, 0.022206, 0.016175, 0.010929, 0.007953, 0.005621, 0.002697, 0.001884, 0.001501, 0.001803, 0.002020, 0.001512, -0.001860, -0.004948, -0.006558, -0.008724, -0.010275, -0.009097, -0.007413, -0.004169, 0.002009, 0.011679, 0.022834, 0.032482
#*# 	  0.038444, 0.028710, 0.023354, 0.018584, 0.013969, 0.010406, 0.008818, 0.006070, 0.003693, 0.003693, 0.004159, 0.004419, 0.003126, -0.000265, -0.002455, -0.005086, -0.007069, -0.009207, -0.007127, -0.004642, -0.001129, 0.006127, 0.016946, 0.028419, 0.036846
#*# 	  0.039495, 0.030512, 0.026417, 0.021215, 0.017766, 0.015602, 0.013375, 0.010413, 0.007279, 0.005977, 0.006004, 0.005676, 0.004729, 0.001838, -0.000789, -0.003450, -0.005531, -0.007349, -0.004457, -0.001113, 0.002654, 0.009737, 0.020489, 0.032244, 0.039451
#*# 	  0.047769, 0.039525, 0.035021, 0.030378, 0.027859, 0.025913, 0.023311, 0.019013, 0.016539, 0.014183, 0.013756, 0.013333, 0.011447, 0.009703, 0.007188, 0.005426, 0.004122, 0.003351, 0.006904, 0.011258, 0.014190, 0.020151, 0.029456, 0.040030, 0.046938
#*# 	  0.055392, 0.047548, 0.043667, 0.039543, 0.036824, 0.034620, 0.032258, 0.028441, 0.025038, 0.023181, 0.021780, 0.020293, 0.019451, 0.017898, 0.015838, 0.015474, 0.015490, 0.015563, 0.019851, 0.023853, 0.027044, 0.031621, 0.040794, 0.048807, 0.055511
#*# 	  0.055127, 0.046772, 0.043960, 0.040658, 0.037141, 0.034336, 0.031681, 0.029082, 0.025921, 0.023858, 0.021932, 0.020186, 0.019719, 0.018894, 0.018538, 0.017918, 0.018694, 0.020319, 0.025271, 0.029531, 0.032211, 0.036248, 0.042820, 0.050894, 0.057624
#*# 	  0.051195, 0.042604, 0.039474, 0.036819, 0.033890, 0.030263, 0.027568, 0.024305, 0.021373, 0.019021, 0.016240, 0.014873, 0.015625, 0.016111, 0.016393, 0.016752, 0.018283, 0.019918, 0.025212, 0.028527, 0.030234, 0.034328, 0.041030, 0.048317, 0.056304
#*# 	  0.052493, 0.044403, 0.040465, 0.037338, 0.034653, 0.031746, 0.027375, 0.023678, 0.019526, 0.016566, 0.014379, 0.014010, 0.014558, 0.015463, 0.016795, 0.018393, 0.020354, 0.021900, 0.024886, 0.027623, 0.030518, 0.034990, 0.041634, 0.048959, 0.057090
#*# 	  0.055367, 0.047834, 0.043836, 0.040561, 0.037749, 0.034034, 0.029911, 0.025365, 0.019342, 0.015993, 0.014293, 0.013687, 0.015110, 0.015830, 0.017978, 0.020534, 0.022435, 0.022920, 0.024492, 0.026342, 0.028751, 0.034464, 0.042008, 0.049197, 0.057514
#*# 	  0.056680, 0.049446, 0.046438, 0.043106, 0.039729, 0.036089, 0.031201, 0.026103, 0.019917, 0.016397, 0.013877, 0.013628, 0.014624, 0.015329, 0.017151, 0.020982, 0.022770, 0.022057, 0.022183, 0.023117, 0.026325, 0.031875, 0.039706, 0.047815, 0.055254
#*# 	  0.062496, 0.056151, 0.052230, 0.048684, 0.045174, 0.041337, 0.036582, 0.032064, 0.026857, 0.022474, 0.019254, 0.018157, 0.018610, 0.019373, 0.021911, 0.025340, 0.027669, 0.025833, 0.026552, 0.025995, 0.027997, 0.033185, 0.040453, 0.048036, 0.057625
#*# 	  0.068346, 0.062792, 0.058654, 0.053565, 0.049132, 0.044463, 0.041035, 0.038537, 0.034273, 0.030421, 0.026148, 0.023454, 0.022901, 0.024163, 0.026063, 0.030230, 0.032378, 0.032458, 0.032582, 0.032958, 0.033447, 0.037202, 0.042942, 0.050736, 0.059798
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 210.0
#*# min_y = 30.0
#*# max_y = 208.0
#*#
#*# [beacon model default]
#*# model_coef = 1.4613818954269993,
#*# 	  1.7756600472438397,
#*# 	  0.7384172744186067,
#*# 	  0.3398904593101075,
#*# 	  0.3899746104559005,
#*# 	  0.4162951819734925,
#*# 	  -0.2058487068481297,
#*# 	  -0.3393668279079826,
#*# 	  0.21620390616642218,
#*# 	  0.20874618374099485
#*# model_domain = 3.168808091292228e-07,3.3288555528608446e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 67.017932
#*# model_offset = -0.17000
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 77.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 51.6
#*#
#*# [beacon model pei_hot]
#*# model_coef = 1.9263519575030055,
#*# 	2.1946743347503372,
#*# 	0.6208794249910773,
#*# 	0.2775896555222557,
#*# 	0.06526221562750463,
#*# 	-0.2611119885640586,
#*# 	-0.05461829170887029,
#*# 	0.36810740679885895,
#*# 	0.05685001457152785,
#*# 	-0.15547240310186372
#*# model_domain = 3.351987055417817e-07,3.359664588035842e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 63.925584
#*# model_offset = 0.00000
