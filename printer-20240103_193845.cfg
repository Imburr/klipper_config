[include moonraker_obico_macros.cfg]
##########################
##### BASE CONFIG #######
##########################

[include mainsail.cfg]
[include ./backup/backup.cfg]

##########################
##### HARDWARE STUFF #####
##########################

[include ./hardware/xyz-stepper.cfg]
[include ./hardware/extruder.cfg]
#[include ./klicky/klicky-probe.cfg]
#[include ./hardware/adxl345.cfg]  This config now in canbus.cfg
[include ./hardware/fans.cfg] # Some fans config in canbus.cfg
[include ./hardware/canbus.cfg]

##########################
##### LIGHTS #############
##########################

[include ./hardware/chamber-lighting.cfg]
[include ./hardware/stealthburner-led.cfg]

##########################
##### CALIBRATION ########
##########################

[include ./calibration/z-tilt.cfg]
[include ./calibration/bed-mesh.cfg]
[include ./macros/unsafe.cfg]
[include ./calibration/pressure_advance.cfg]
[include ./calibration/test_speed.cfg]
[include ./calibration/pika.cfg]
[include ./calibration/microadjust.cfg]
[include test_probe_accuracy.cfg]

##########################
##### MACROS #############
##########################

[include ./macros/chamber-led.cfg]
[include ./macros/conditional-homing.cfg]
[include ./macros/print-end.cfg]
[include ./macros/print-start-mmu.cfg]
[include ./macros/dump-variables.cfg]
[include ./macros/movement-check.cfg]
[include ./macros/cancel-change.cfg]
[include ./macros/pause-resume.cfg]         ; Overridden by ERCF / subsequantly disabled
[include ./macros/load-unload.cfg]
[include ./macros/filament-change.cfg]
[include ./macros/park.cfg]
[include ./macros/heatsoak.cfg]

##########################
##### THIRD PARTY ########
##########################

#[include ./third-party-cfg/nozzle_scrub.cfg]
[include KAMP_Settings.cfg]

##########################
##### ERCF ###############
##########################

[include mmu/base/*.cfg]
[include macros/mmu_adds.cfg]
[include mmu/optional/mmu_ercf_cutter.cfg]

##########################
##### LCD/MENU ###########
##########################

#[include ./third-party-cfg/nozzle_scrub_menu.cfg]
#[include ./menu/printer_menu.cfg]

##########################
##### NOT ENABLED YET ####
##########################

#[include ./todo/mini12864.cfg] Add this after adding mini12864 LED
#[include ./todo/lcd_tweaks.cfg] Need to figure this one out and then implement
#[include ./hardware/nevermore.cfg] Disabled as I prefer to chamber vent outside and needed the PWM

##########################
#### REPLACEMENT #########
##########################

[include ./replacement_macros/replace-m900.cfg]
[include ./replacement_macros/replace-m117.cfg]

[exclude_object]

[gcode_arcs]
resolution: 0.1

[respond]
default_type: echo
default_prefix:  

[force_move]
# Enable commands that force potentially unsafe movement
enable_force_move: True

[idle_timeout]
timeout: 14400

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_290040000750314D35323820-if00
restart_method: command

[mcu rpi]
# Add Rpi as secondary MCU to allow for ADXL use through SPI ribbon/adapter from LDO
serial: /tmp/klipper_host_mcu

[mcu sht]
canbus_uuid: 30993412e8e0

[printer]
kinematics: corexy
max_velocity: 200           # Changed from 200 on 7.11.23
max_accel:  6000            # tuned on 7.11.23 after beacon install.
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0 # Changed on 7.11.23

#####################################################################
#   Input Shaper
#####################################################################

[input_shaper]
#shaper_freq_x: 76.2               ; suggested max_accel <= 22600 mm/sec^2
#shaper_type_x: zv
#shaper_freq_y: 51.8               ; suggested max_accel <= 7900 mm/sec^2
#shaper_type_y: mzv


#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
heater_pin: PA2 #PA2 is LDO default
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 125
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  WAS TAP - NOW BEACON in CANBUS

#####################################################################
#   Additional Sensors
#####################################################################

[thermistor CMFB103F3950FANT]
temperature1: 0.0
resistance1: 32116.0
temperature2: 40.0
resistance2: 5309.0
temperature3: 80.0
resistance3: 1228.0

#[temperature_sensor sb_ambient_temp]
## Chamber Temperature - T1
#sensor_type: CMFB103F3950FANT
#sensor_pin: PF5
#min_temp: 0
#max_temp: 100
#gcode_id: chamber_th

[temperature_sensor back_chamber_temp]
## Chamber Temperature - T
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF6
min_temp: 0
max_temp: 100
gcode_id: chamber_th2

[temperature_sensor RPi4]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################

#[safe_z_home]
##  XY Location of the Z Endstop Switch
##  Update -10,-10 to the XY coordinates of your endstop pin 
##  (such as 157,305) after going through Z Endstop Pin
##  Location Definition step.
#home_xy_position: 147,256
#speed:100
#z_hop:10
#z_hop_speed:10


########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.889
#*# pid_ki = 0.964
#*# pid_kd = 412.851
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.036258, -0.026233, -0.019428, -0.014262, -0.009332, 0.001075, -0.000247, 0.000883, 0.001232, -0.000002, -0.000924, 0.004531, 0.001550, -0.000619, 0.003844, -0.001859, 0.001969, 0.004499, 0.017204, 0.017856, 0.039069, 0.047715, 0.053168, 0.059786, 0.050531
#*# 	  -0.030258, -0.014105, -0.004933, -0.012967, -0.001520, -0.006980, -0.002376, 0.003245, 0.004525, 0.007304, 0.000770, 0.000309, -0.000141, 0.006299, -0.001127, 0.002424, 0.010327, 0.007989, 0.021412, 0.024947, 0.037694, 0.050799, 0.058530, 0.059303, 0.053593
#*# 	  -0.022023, -0.008038, -0.012575, -0.009935, -0.003123, 0.001197, -0.002017, 0.007372, 0.005257, 0.003184, 0.000151, 0.001483, 0.002305, 0.000001, 0.000616, 0.003999, 0.007155, 0.016639, 0.034247, 0.039603, 0.046079, 0.055211, 0.076852, 0.045221, 0.056812
#*# 	  -0.032911, -0.021932, -0.016270, -0.032752, -0.013511, -0.005727, 0.000697, -0.018757, 0.000127, 0.001615, -0.000520, 0.003382, 0.001527, 0.000665, 0.000539, 0.002091, 0.010896, 0.012302, 0.041089, 0.039811, 0.053010, 0.059788, 0.055212, 0.072966, 0.069121
#*# 	  -0.030090, -0.025806, -0.024116, -0.027608, -0.019857, -0.020727, -0.020856, -0.022605, -0.006763, 0.002467, -0.012403, 0.003589, -0.002285, 0.000938, 0.001481, 0.006683, 0.007918, 0.021763, 0.038118, 0.042592, 0.046954, 0.065091, 0.063384, 0.071927, 0.061538
#*# 	  -0.030380, -0.022381, -0.027850, -0.024663, -0.022806, -0.029848, -0.020689, -0.020104, -0.014027, 0.000039, -0.015701, -0.000193, 0.002307, -0.003755, 0.005320, 0.014368, 0.016179, 0.027213, 0.043169, 0.040747, 0.054474, 0.076715, 0.074160, 0.072224, 0.079205
#*# 	  -0.037673, -0.031012, -0.031240, -0.027486, -0.033517, -0.027076, -0.021259, -0.018607, -0.018381, -0.013536, 0.001769, 0.003435, 0.000673, 0.001077, 0.012577, 0.008291, 0.021776, 0.035376, 0.038065, 0.044439, 0.045622, 0.062964, 0.077298, 0.075444, 0.078072
#*# 	  -0.032732, -0.031090, -0.032063, -0.029893, -0.030829, -0.030915, -0.025028, -0.025834, -0.023386, -0.014851, -0.023219, -0.001873, -0.001949, 0.001913, 0.007929, 0.019161, 0.017968, 0.027556, 0.036780, 0.043847, 0.047089, 0.060163, 0.068491, 0.078210, 0.079573
#*# 	  -0.038434, -0.037717, -0.032879, -0.031426, -0.033431, -0.025373, -0.028305, -0.020272, -0.024005, -0.016796, -0.012955, 0.002982, -0.023500, 0.002307, 0.009381, 0.012156, 0.020881, 0.021456, 0.041855, 0.042120, 0.047739, 0.057248, 0.070195, 0.079967, 0.076753
#*# 	  -0.044718, -0.032151, -0.032327, -0.030919, -0.030259, -0.026159, -0.024064, -0.024568, -0.018172, -0.022029, -0.015758, -0.008521, 0.001527, 0.004298, 0.006332, 0.005456, 0.013685, 0.021190, 0.016264, 0.042694, 0.046176, 0.053048, 0.042685, 0.077692, 0.078221
#*# 	  -0.036142, -0.036126, -0.033807, -0.033800, -0.033151, -0.031759, -0.032328, -0.023475, -0.025593, -0.022417, -0.017396, -0.032056, 0.005381, 0.000923, 0.002909, 0.007219, 0.014378, 0.020079, 0.027827, 0.041692, 0.043358, 0.054201, 0.080000, 0.083686, 0.079512
#*# 	  -0.039425, -0.033502, -0.033868, -0.032730, -0.033484, -0.032948, -0.031053, -0.029603, -0.020028, -0.015581, 0.000457, -0.005691, 0.001303, 0.007103, 0.007656, 0.006922, 0.019447, 0.019328, 0.028377, 0.031443, 0.046800, 0.060505, 0.066603, 0.085857, 0.080762
#*# 	  -0.048406, -0.035704, -0.036632, -0.032082, -0.031910, -0.030835, -0.022438, -0.027535, -0.020467, -0.015323, 0.003004, -0.000406, 0.002803, 0.003152, 0.011211, 0.006726, 0.015883, 0.020904, 0.023379, 0.044608, 0.045771, 0.061746, 0.079840, 0.081216, 0.085673
#*# 	  -0.046693, -0.054182, -0.040221, -0.034636, -0.038115, -0.033099, -0.031687, -0.033896, -0.027143, -0.019720, -0.014369, 0.002506, -0.001352, 0.004236, 0.003534, 0.002592, 0.012568, 0.018037, 0.024016, 0.041793, 0.045472, 0.065740, 0.077172, 0.085175, 0.081674
#*# 	  -0.060535, -0.066315, -0.043707, -0.046350, -0.036672, -0.032762, -0.032889, -0.029831, -0.028565, -0.016012, -0.017089, 0.001440, 0.003697, -0.007041, 0.000297, 0.003229, 0.005940, 0.016102, 0.019979, 0.039437, 0.045733, 0.058547, 0.071345, 0.087417, 0.083018
#*# 	  -0.060098, -0.060103, -0.038400, -0.036057, -0.035925, -0.033596, -0.034444, -0.031179, -0.031057, -0.024494, -0.017447, -0.026861, -0.009661, 0.000761, 0.005887, 0.002907, 0.007169, 0.008866, 0.023329, 0.043663, 0.047417, 0.061666, 0.080569, 0.087508, 0.089296
#*# 	  -0.065484, -0.036769, -0.036142, -0.041852, -0.037172, -0.038945, -0.033367, -0.031854, -0.026269, -0.029324, -0.022747, -0.007637, -0.005620, -0.014165, -0.005447, -0.002149, 0.007938, 0.017001, 0.024914, 0.037534, 0.044344, 0.060055, 0.077772, 0.090416, 0.091392
#*# 	  -0.064212, -0.053287, -0.048992, -0.064979, -0.034042, -0.038066, -0.035933, -0.032202, -0.034274, -0.031307, -0.021760, -0.010500, -0.013528, 0.004256, 0.000559, 0.004226, 0.006493, 0.017119, 0.029138, 0.041096, 0.045241, 0.066718, 0.078945, 0.089803, 0.095588
#*# 	  -0.074254, -0.059870, -0.058166, -0.053007, -0.052290, -0.047518, -0.044870, -0.036269, -0.036397, -0.033981, -0.027782, -0.019458, -0.024898, -0.014775, 0.005090, 0.004342, 0.006475, 0.014660, 0.022095, 0.042026, 0.045255, 0.058831, 0.080092, 0.088029, 0.099595
#*# 	  -0.077554, -0.070717, -0.064728, -0.063444, -0.053647, -0.062720, -0.058572, -0.052632, -0.048291, -0.045359, -0.038719, -0.035334, -0.032202, -0.023550, -0.007546, -0.029211, 0.001065, 0.004786, 0.012450, 0.029047, 0.040049, 0.049683, 0.067832, 0.081672, 0.084443
#*# 	  -0.099157, -0.072535, -0.075143, -0.075347, -0.066728, -0.066940, -0.065749, -0.063329, -0.064185, -0.057805, -0.054890, -0.033902, -0.036752, -0.032113, -0.032851, -0.020947, -0.009990, 0.007046, 0.005932, 0.007811, 0.021201, 0.043492, 0.047582, 0.079934, 0.078677
#*# 	  -0.102649, -0.090622, -0.076002, -0.075186, -0.076761, -0.077777, -0.074824, -0.074211, -0.076642, -0.073520, -0.068463, -0.062535, -0.040695, -0.037659, -0.034041, -0.026230, -0.020595, -0.017602, 0.003208, 0.004820, 0.013789, 0.035191, 0.042337, 0.055473, 0.056557
#*# 	  -0.109428, -0.093065, -0.092620, -0.098187, -0.072891, -0.074968, -0.089296, -0.080995, -0.076650, -0.075145, -0.070905, -0.071770, -0.062251, -0.044739, -0.037538, -0.038380, -0.032456, -0.023485, -0.012328, -0.005569, 0.004388, 0.016533, 0.019566, 0.038249, 0.047243
#*# 	  -0.115645, -0.110547, -0.110730, -0.105085, -0.101271, -0.097167, -0.103273, -0.093359, -0.094909, -0.086788, -0.073865, -0.075367, -0.071191, -0.070511, -0.061610, -0.041931, -0.037813, -0.034288, -0.028178, -0.016784, 0.003657, 0.006338, 0.017006, 0.023400, 0.030629
#*# 	  -0.143263, -0.122634, -0.112940, -0.120645, -0.118407, -0.113097, -0.112929, -0.112417, -0.104851, -0.106960, -0.095354, -0.103099, -0.092148, -0.082673, -0.073426, -0.070702, -0.059249, -0.042096, -0.038259, -0.035548, -0.031961, -0.018848, -0.007370, 0.006785, 0.011432
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 210.0
#*# min_y = 30.0
#*# max_y = 210.0
#*#
#*# [beacon model default]
#*# model_coef = 1.9263519575030055,
#*# 	2.1946743347503372,
#*# 	0.6208794249910773,
#*# 	0.2775896555222557,
#*# 	0.06526221562750463,
#*# 	-0.2611119885640586,
#*# 	-0.05461829170887029,
#*# 	0.36810740679885895,
#*# 	0.05685001457152785,
#*# 	-0.15547240310186372
#*# model_domain = 3.351987055417817e-07,3.359664588035842e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 63.925584
#*# model_offset = 1.59000
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 77.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 51.6
#*#
#*# [beacon model pei_hot]
#*# model_coef = 1.9263519575030055,
#*# 	2.1946743347503372,
#*# 	0.6208794249910773,
#*# 	0.2775896555222557,
#*# 	0.06526221562750463,
#*# 	-0.2611119885640586,
#*# 	-0.05461829170887029,
#*# 	0.36810740679885895,
#*# 	0.05685001457152785,
#*# 	-0.15547240310186372
#*# model_domain = 3.351987055417817e-07,3.359664588035842e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 63.925584
#*# model_offset = 0.00000
