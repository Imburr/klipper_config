[include moonraker_obico_macros.cfg]
##########################
##### BASE CONFIG #######
##########################

[include mainsail.cfg]
[include ./backup/backup.cfg]

##########################
##### HARDWARE STUFF #####
##########################

[include ./hardware/xyz-stepper.cfg]
[include ./hardware/extruder.cfg]
#[include ./klicky/klicky-probe.cfg]
#[include ./hardware/adxl345.cfg]  This config now in canbus.cfg
[include ./hardware/fans.cfg] # Some fans config in canbus.cfg
[include ./hardware/canbus.cfg]

##########################
##### LIGHTS #############
##########################

[include ./hardware/chamber-lighting.cfg]
[include ./hardware/stealthburner-led.cfg]

##########################
##### CALIBRATION ########
##########################

[include ./calibration/z-tilt.cfg]
[include ./calibration/bed-mesh.cfg]
[include ./macros/unsafe.cfg]
[include ./calibration/pressure_advance.cfg]
[include ./calibration/test_speed.cfg]
[include ./calibration/pika.cfg]
[include ./calibration/microadjust.cfg]
[include ./calibration/sensorless.cfg]
[include test_probe_accuracy.cfg]

##########################
##### MACROS #############
##########################

[include ./macros/chamber-led.cfg]
[include ./macros/conditional-homing.cfg]
[include ./macros/print-end.cfg]
[include ./macros/print-start-mmu.cfg]
[include ./macros/dump-variables.cfg]
[include ./macros/movement-check.cfg]
[include ./macros/cancel-change.cfg]
[include ./macros/pause-resume.cfg]         ; Overridden by ERCF / subsequantly disabled
[include ./macros/load-unload.cfg]
[include ./macros/filament-change.cfg]
[include ./macros/park.cfg]
[include ./macros/heatsoak.cfg]

##########################
##### THIRD PARTY ########
##########################

#[include ./third-party-cfg/nozzle_scrub.cfg]
[include KAMP_Settings.cfg]

##########################
##### ERCF ###############
##########################

[include mmu/base/*.cfg]
[include macros/mmu_adds.cfg]
[include mmu/optional/mmu_ercf_cutter.cfg]

##########################
##### LCD/MENU ###########
##########################

#[include ./third-party-cfg/nozzle_scrub_menu.cfg]
#[include ./menu/printer_menu.cfg]

##########################
##### NOT ENABLED YET ####
##########################

#[include ./todo/mini12864.cfg] Add this after adding mini12864 LED
#[include ./todo/lcd_tweaks.cfg] Need to figure this one out and then implement
#[include ./hardware/nevermore.cfg] Disabled as I prefer to chamber vent outside and needed the PWM

##########################
#### REPLACEMENT #########
##########################

[include ./replacement_macros/replace-m900.cfg]
[include ./replacement_macros/replace-m117.cfg]

[exclude_object]

[gcode_arcs]
resolution: 0.1

[respond]
default_type: echo
default_prefix:  

[force_move]
# Enable commands that force potentially unsafe movement
enable_force_move: True

[idle_timeout]
timeout: 14400

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_290040000750314D35323820-if00
restart_method: command

[mcu rpi]
# Add Rpi as secondary MCU to allow for ADXL use through SPI ribbon/adapter from LDO
serial: /tmp/klipper_host_mcu

[mcu sht]
canbus_uuid: 30993412e8e0

[printer]
kinematics: corexy
max_velocity: 200           # Changed from 200 on 7.11.23
max_accel:  6000            # tuned on 7.11.23 after beacon install.
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0 # Changed on 7.11.23

#####################################################################
#   Input Shaper
#####################################################################

[input_shaper]
#shaper_freq_x: 76.2               ; suggested max_accel <= 22600 mm/sec^2
#shaper_type_x: zv
#shaper_freq_y: 51.8               ; suggested max_accel <= 7900 mm/sec^2
#shaper_type_y: mzv

#####################################################################
#   AutoTune / https://github.com/andrewmcgr/klipper_tmc_autotune
#####################################################################

[motor_constants ldo-42sth48-2004mah_vrn]
resistance: 1.45
inductance: 0.002
holding_torque: 0.40
max_current: 2.0
steps_per_revolution: 400

#[autotune_tmc stepper_x]
#motor: ldo-42sth48-2004mah_vrn
#sg4_thrs: 105
#tuning_goal: silent
#[autotune_tmc stepper_y]
#motor: ldo-42sth48-2004mah_vrn
#tuning_goal: silent

[autotune_tmc stepper_z]
motor: ldo-42sth40-1684l300e
[autotune_tmc stepper_z1]
motor: ldo-42sth40-1684l300e
[autotune_tmc stepper_z2]
motor: ldo-42sth40-1684l300e

[autotune_tmc extruder]
motor: moons-cse14hra1l410a

#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
heater_pin: PA2 #PA2 is LDO default
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 125
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  WAS TAP - NOW BEACON in CANBUS

#####################################################################
#   Additional Sensors
#####################################################################

[thermistor CMFB103F3950FANT]
temperature1: 0.0
resistance1: 32116.0
temperature2: 40.0
resistance2: 5309.0
temperature3: 80.0
resistance3: 1228.0

#[temperature_sensor sb_ambient_temp]
## Chamber Temperature - T1
#sensor_type: CMFB103F3950FANT
#sensor_pin: PF5
#min_temp: 0
#max_temp: 100
#gcode_id: chamber_th

[temperature_sensor back_chamber_temp]
## Chamber Temperature - T
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF6
min_temp: 0
max_temp: 100
gcode_id: chamber_th2

[temperature_sensor RPi4]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.889
#*# pid_ki = 0.964
#*# pid_kd = 412.851
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.037281, 0.035968, 0.032648, 0.028385, 0.029500, 0.024597, 0.019434, 0.015212, 0.013383, 0.010342, 0.009157, 0.008747, 0.007242, 0.010254, 0.009911, 0.010277, 0.014429, 0.013659, 0.011180, 0.010552, 0.007421, 0.002045, 0.004395, 0.006202, 0.013581
#*# 	  0.041647, 0.038505, 0.034417, 0.031975, 0.027873, 0.023832, 0.021643, 0.018228, 0.015511, 0.012000, 0.012881, 0.010146, 0.008978, 0.008679, 0.006986, 0.006889, 0.008587, 0.008121, 0.006763, 0.007988, 0.005899, 0.004307, 0.005169, 0.005344, 0.013453
#*# 	  0.038393, 0.028510, 0.031942, 0.030183, 0.031893, 0.023942, 0.020012, 0.017507, 0.015057, 0.014284, 0.012056, 0.013589, 0.002803, 0.004454, 0.000786, 0.004796, -0.003163, 0.000190, 0.000874, 0.003098, 0.002770, 0.004851, 0.003137, 0.005412, 0.009012
#*# 	  0.035121, 0.030642, 0.025107, 0.025969, 0.019289, 0.020508, 0.013666, 0.011301, 0.010146, 0.007927, 0.005787, -0.000375, 0.002066, -0.004392, -0.008116, -0.010895, -0.005024, -0.010694, -0.010554, -0.006618, -0.005053, -0.006464, -0.001789, 0.001630, 0.005322
#*# 	  0.028933, 0.027575, 0.021685, 0.020867, 0.019374, 0.019714, 0.005408, 0.006092, 0.002642, 0.007089, -0.003944, -0.001986, -0.005790, -0.008415, -0.012266, -0.013442, -0.009534, -0.019871, -0.016620, -0.012359, -0.009531, -0.006201, -0.002707, 0.004439, 0.002794
#*# 	  0.025240, 0.017872, 0.016273, 0.016220, 0.017845, 0.010692, 0.003005, 0.003049, -0.001837, -0.002485, -0.006685, -0.003770, -0.008061, -0.010515, -0.014387, -0.015107, -0.016523, -0.018923, -0.019970, -0.016107, -0.016271, -0.006738, -0.005288, 0.002013, 0.001530
#*# 	  0.031657, 0.019609, 0.017000, 0.017142, 0.009188, 0.009227, 0.003692, -0.001050, -0.003501, -0.005342, -0.000825, -0.011135, -0.006031, -0.006839, -0.005252, -0.016440, -0.013645, -0.017193, -0.017834, -0.014688, -0.012539, -0.012366, -0.005741, -0.003854, 0.005464
#*# 	  0.033220, 0.025157, 0.020607, 0.022531, 0.016747, 0.008650, 0.005444, 0.001316, -0.002065, -0.003149, -0.004473, -0.004000, -0.004829, 0.002526, -0.003688, -0.005264, -0.010298, -0.006760, -0.012329, -0.010885, -0.005995, -0.006683, -0.003467, -0.000171, 0.004704
#*# 	  0.043090, 0.033898, 0.029720, 0.022408, 0.026923, 0.013723, 0.012757, 0.009661, 0.009665, -0.001229, 0.001195, 0.001730, 0.004434, 0.004402, 0.003598, 0.002657, -0.002898, -0.002296, -0.005196, -0.000062, -0.006103, 0.002236, 0.000484, 0.004579, 0.007766
#*# 	  0.042414, 0.037188, 0.029267, 0.025686, 0.017871, 0.016792, 0.012142, 0.005329, 0.007623, 0.001954, -0.000234, -0.003701, 0.003980, 0.001543, 0.001853, 0.002222, 0.000909, -0.003928, -0.010478, -0.004534, -0.005713, -0.004433, -0.002871, 0.000297, 0.001960
#*# 	  0.037374, 0.034355, 0.026082, 0.024304, 0.016450, 0.010937, 0.007642, 0.006329, 0.003192, -0.000540, -0.008573, -0.005642, -0.005417, -0.000460, -0.007217, -0.001680, -0.003379, -0.008666, -0.012542, -0.012356, -0.008018, -0.008726, -0.007388, -0.005820, -0.005229
#*# 	  0.040576, 0.026836, 0.024847, 0.018845, 0.013481, 0.008292, 0.005016, 0.004756, 0.002747, -0.000450, -0.005145, -0.006422, -0.005739, -0.008387, -0.002002, -0.003468, -0.004370, -0.012385, -0.013662, -0.014015, -0.014205, -0.008143, -0.009889, -0.005900, -0.004968
#*# 	  0.041214, 0.031688, 0.026468, 0.022011, 0.014990, 0.009084, 0.006420, 0.008388, 0.001489, 0.002143, -0.000900, -0.002197, -0.000716, -0.001296, -0.000531, 0.000065, -0.001443, -0.007492, -0.008372, -0.014085, -0.008817, -0.006877, -0.004749, -0.002941, 0.000658
#*# 	  0.039578, 0.032959, 0.027153, 0.021269, 0.013088, 0.010333, 0.004305, 0.003547, 0.000592, 0.004296, 0.000262, 0.000530, 0.001177, 0.001549, 0.000798, 0.001538, 0.000643, -0.004117, -0.008174, -0.009108, -0.004597, -0.006558, -0.001813, 0.002167, 0.005028
#*# 	  0.040817, 0.033393, 0.027270, 0.019886, 0.015164, 0.009701, 0.006096, 0.005051, 0.004782, 0.001601, 0.002763, 0.002714, 0.006206, 0.002592, 0.004764, 0.004980, 0.004974, 0.001484, -0.000771, -0.000402, -0.000611, 0.002033, 0.003844, 0.010679, 0.012083
#*# 	  0.046369, 0.044018, 0.036450, 0.030721, 0.026700, 0.020534, 0.016760, 0.014863, 0.014155, 0.013969, 0.012388, 0.012392, 0.014397, 0.013945, 0.011541, 0.015816, 0.016140, 0.013714, 0.010130, 0.014370, 0.014461, 0.015218, 0.018693, 0.022194, 0.026268
#*# 	  0.055840, 0.049268, 0.043568, 0.039333, 0.031431, 0.029234, 0.028537, 0.022436, 0.021608, 0.021621, 0.019744, 0.020047, 0.021069, 0.020105, 0.020271, 0.021277, 0.024021, 0.025690, 0.020538, 0.025196, 0.026383, 0.025229, 0.027688, 0.032351, 0.036714
#*# 	  0.056015, 0.047251, 0.040733, 0.036607, 0.031010, 0.026735, 0.025445, 0.022054, 0.020869, 0.019737, 0.019334, 0.018181, 0.019222, 0.019236, 0.018907, 0.021581, 0.024033, 0.025031, 0.024234, 0.026054, 0.027476, 0.027659, 0.029464, 0.033959, 0.038294
#*# 	  0.053556, 0.045193, 0.038795, 0.032983, 0.028535, 0.024235, 0.021024, 0.018530, 0.016050, 0.015038, 0.013504, 0.015285, 0.013375, 0.016607, 0.016978, 0.021399, 0.023019, 0.023005, 0.023158, 0.025107, 0.026522, 0.026877, 0.027854, 0.031945, 0.036859
#*# 	  0.048307, 0.040073, 0.032328, 0.027687, 0.020594, 0.017536, 0.012660, 0.010469, 0.008314, 0.007733, 0.006519, 0.006523, 0.011762, 0.011985, 0.014305, 0.017040, 0.020985, 0.019371, 0.019151, 0.021807, 0.022490, 0.021281, 0.022210, 0.027057, 0.031904
#*# 	  0.045102, 0.035110, 0.027158, 0.021312, 0.015779, 0.011493, 0.005949, 0.003024, 0.001510, 0.001302, 0.000837, 0.003199, 0.005264, 0.007981, 0.011619, 0.016033, 0.018361, 0.015665, 0.016465, 0.018024, 0.016992, 0.015219, 0.015957, 0.020083, 0.025236
#*# 	  0.047983, 0.037403, 0.029331, 0.023591, 0.017972, 0.013843, 0.008761, 0.006786, 0.003895, 0.003084, 0.002718, 0.004976, 0.009444, 0.011596, 0.014062, 0.018921, 0.021577, 0.020049, 0.018912, 0.019176, 0.017647, 0.015736, 0.015680, 0.019467, 0.024506
#*# 	  0.058030, 0.046909, 0.037544, 0.032750, 0.026306, 0.023032, 0.019991, 0.018082, 0.015154, 0.014017, 0.014187, 0.014322, 0.018113, 0.020849, 0.022390, 0.027011, 0.029260, 0.027897, 0.025633, 0.025466, 0.023811, 0.021451, 0.021119, 0.024016, 0.028984
#*# 	  0.067407, 0.056053, 0.046719, 0.041192, 0.036000, 0.032912, 0.031425, 0.029782, 0.026583, 0.025741, 0.022407, 0.024027, 0.026963, 0.029556, 0.030824, 0.033526, 0.035209, 0.033815, 0.031805, 0.029490, 0.027572, 0.025791, 0.024663, 0.026848, 0.031238
#*# 	  0.071769, 0.060197, 0.051075, 0.044813, 0.039179, 0.037014, 0.035246, 0.034872, 0.032573, 0.031356, 0.028651, 0.029377, 0.030921, 0.032810, 0.033528, 0.035228, 0.036376, 0.034820, 0.032767, 0.029293, 0.027129, 0.025214, 0.025183, 0.026390, 0.029849
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 210.0
#*# min_y = 30.0
#*# max_y = 208.0
#*#
#*# [beacon model default]
#*# model_coef = 1.4613818954269993,
#*# 	  1.7756600472438397,
#*# 	  0.7384172744186067,
#*# 	  0.3398904593101075,
#*# 	  0.3899746104559005,
#*# 	  0.4162951819734925,
#*# 	  -0.2058487068481297,
#*# 	  -0.3393668279079826,
#*# 	  0.21620390616642218,
#*# 	  0.20874618374099485
#*# model_domain = 3.168808091292228e-07,3.3288555528608446e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 67.017932
#*# model_offset = -0.04000
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 77.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 51.6
#*#
#*# [beacon model pei_hot]
#*# model_coef = 1.9263519575030055,
#*# 	2.1946743347503372,
#*# 	0.6208794249910773,
#*# 	0.2775896555222557,
#*# 	0.06526221562750463,
#*# 	-0.2611119885640586,
#*# 	-0.05461829170887029,
#*# 	0.36810740679885895,
#*# 	0.05685001457152785,
#*# 	-0.15547240310186372
#*# model_domain = 3.351987055417817e-07,3.359664588035842e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 63.925584
#*# model_offset = 0.00000
