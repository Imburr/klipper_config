##########################
##### BASE CONFIG #######
##########################

[include mainsail.cfg]
[include ./backup/backup.cfg]

##########################
##### HARDWARE STUFF #####
##########################

[include ./hardware/xyz-stepper.cfg]
[include ./hardware/extruder.cfg]
#[include ./klicky/klicky-probe.cfg]
#[include ./hardware/adxl345.cfg]  This config now in canbus.cfg
[include ./hardware/fans.cfg] # Some fans config in canbus.cfg
[include ./hardware/canbus.cfg]

##########################
##### LIGHTS #############
##########################

[include ./hardware/chamber-lighting.cfg]
[include ./hardware/stealthburner-led.cfg]

##########################
##### CALIBRATION ########
##########################

[include ./calibration/z-tilt.cfg]
[include ./calibration/bed-mesh.cfg]
[include ./macros/unsafe.cfg]
[include ./calibration/pressure_advance.cfg]
[include ./calibration/test_speed.cfg]
[include ./calibration/pika.cfg]
[include test_probe_accuracy.cfg]

##########################
##### MACROS #############
##########################

[include ./macros/chamber-led.cfg]
[include ./macros/conditional-homing.cfg]
[include ./macros/print-end.cfg]
[include ./macros/print-start-mmu.cfg]
[include ./macros/dump-variables.cfg]
[include ./macros/movement-check.cfg]
[include ./macros/cancel-change.cfg]
[include ./macros/pause-resume.cfg]         ; Overridden by ERCF / subsequantly disabled
[include ./macros/load-unload.cfg]
[include ./macros/filament-change.cfg]
[include ./macros/park.cfg]
#[include ./macros/prusaslicer-accel.cfg]

##########################
##### THIRD PARTY ########
##########################

#[include ./third-party-cfg/nozzle_scrub.cfg]
[include KAMP_Settings.cfg]

##########################
##### ERCF ###############
##########################

[include mmu/base/*.cfg]
[include macros/mmu_adds.cfg]



##########################
##### LCD/MENU ###########
##########################

#[include ./third-party-cfg/nozzle_scrub_menu.cfg]
#[include ./menu/printer_menu.cfg]

##########################
##### NOT ENABLED YET ####
##########################

#[include ./todo/mini12864.cfg] Add this after adding mini12864 LED
#[include ./todo/lcd_tweaks.cfg] Need to figure this one out and then implement
#[include ./hardware/nevermore.cfg] Disabled as I prefer to chamber vent outside and needed the PWM

##########################
#### REPLACEMENT #########
##########################

[include ./replacement_macros/replace-m900.cfg]
[include ./replacement_macros/replace-m117.cfg]

[exclude_object]

[gcode_arcs]
resolution: 0.1

[respond]
default_type: echo
default_prefix:  

[force_move]
# Enable commands that force potentially unsafe movement
enable_force_move: True

[idle_timeout]
timeout: 14400

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_290040000750314D35323820-if00
restart_method: command

[mcu rpi]
# Add Rpi as secondary MCU to allow for ADXL use through SPI ribbon/adapter from LDO
serial: /tmp/klipper_host_mcu

[mcu sht]
canbus_uuid: 30993412e8e0

[printer]
kinematics: corexy
max_velocity: 200           # Changed from 200 on 7.11.23
max_accel:  6000            # tuned on 7.11.23 after beacon install.
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0 # Changed on 7.11.23

#####################################################################
#   Input Shaper
#####################################################################

[input_shaper]
#shaper_freq_x: 76.2               ; suggested max_accel <= 22600 mm/sec^2
#shaper_type_x: zv
#shaper_freq_y: 51.8               ; suggested max_accel <= 7900 mm/sec^2
#shaper_type_y: mzv


#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
heater_pin: PA2 #PA2 is LDO default
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 125
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  WAS TAP - NOW BEACON in CANBUS

#####################################################################
#   Additional Sensors
#####################################################################

[thermistor CMFB103F3950FANT]
temperature1: 0.0
resistance1: 32116.0
temperature2: 40.0
resistance2: 5309.0
temperature3: 80.0
resistance3: 1228.0

#[temperature_sensor sb_ambient_temp]
## Chamber Temperature - T1
#sensor_type: CMFB103F3950FANT
#sensor_pin: PF5
#min_temp: 0
#max_temp: 100
#gcode_id: chamber_th

[temperature_sensor back_chamber_temp]
## Chamber Temperature - T
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF6
min_temp: 0
max_temp: 100
gcode_id: chamber_th2

[temperature_sensor RPi4]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################

#[safe_z_home]
##  XY Location of the Z Endstop Switch
##  Update -10,-10 to the XY coordinates of your endstop pin 
##  (such as 157,305) after going through Z Endstop Pin
##  Location Definition step.
#home_xy_position: 147,256
#speed:100
#z_hop:10
#z_hop_speed:10


########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.889
#*# pid_ki = 0.964
#*# pid_kd = 412.851
#*#
#*# [probe]
#*# z_offset = -1.270
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.123808, -0.109485, -0.106239, -0.095308, -0.094749, -0.095896, -0.081527, -0.080938, -0.081016, -0.079232, -0.078198, -0.075695, -0.071080, -0.070043, -0.068952, -0.058485, -0.060340, -0.051385, -0.049890, -0.054727, -0.042641, -0.045245, -0.043746, -0.026617, -0.038886
#*# 	  -0.108917, -0.099134, -0.080476, -0.084909, -0.081496, -0.077692, -0.073284, -0.071970, -0.072434, -0.062996, -0.072535, -0.061779, -0.059476, -0.053823, -0.054886, -0.053317, -0.051529, -0.046204, -0.043320, -0.032383, -0.035106, -0.027110, -0.017824, -0.018696, -0.017592
#*# 	  -0.103748, -0.097556, -0.083989, -0.078801, -0.071357, -0.069654, -0.067228, -0.063135, -0.063886, -0.059393, -0.057199, -0.052946, -0.053234, -0.052454, -0.045551, -0.049691, -0.048253, -0.043122, -0.031256, -0.032702, -0.025940, -0.021162, -0.017382, -0.016336, -0.008040
#*# 	  -0.098379, -0.093289, -0.078444, -0.075429, -0.069709, -0.066864, -0.066128, -0.054523, -0.066787, -0.056590, -0.059558, -0.053493, -0.051506, -0.054057, -0.047993, -0.048921, -0.042231, -0.042549, -0.028237, -0.023260, -0.026881, -0.020711, -0.006685, -0.006572, -0.005682
#*# 	  -0.097779, -0.083088, -0.073203, -0.070169, -0.072172, -0.058071, -0.072454, -0.056199, -0.060712, -0.054670, -0.049182, -0.049048, -0.048697, -0.046092, -0.042964, -0.044906, -0.043085, -0.030759, -0.021897, -0.021632, -0.018117, -0.014999, 0.002342, -0.000986, 0.004257
#*# 	  -0.092303, -0.080756, -0.074584, -0.066374, -0.066661, -0.056761, -0.049191, -0.054149, -0.053660, -0.049589, -0.050681, -0.047533, -0.047753, -0.042432, -0.036317, -0.035477, -0.037141, -0.024347, -0.023626, -0.017810, -0.013948, -0.000092, 0.003859, 0.006011, 0.002655
#*# 	  -0.079040, -0.074808, -0.067362, -0.059324, -0.046303, -0.047782, -0.050191, -0.049239, -0.045927, -0.041344, -0.041361, -0.040594, -0.024511, -0.027942, -0.027800, -0.026962, -0.026766, -0.018977, -0.009206, -0.014346, -0.002185, 0.001185, 0.006702, 0.009372, 0.013959
#*# 	  -0.071537, -0.069275, -0.060697, -0.056743, -0.042989, -0.048792, -0.047696, -0.042987, -0.042575, -0.041042, -0.038739, -0.028879, -0.021326, -0.024479, -0.024069, -0.019057, -0.016312, -0.010084, 0.000781, 0.004862, 0.007953, 0.007277, 0.013385, 0.025616, 0.013089
#*# 	  -0.068155, -0.067591, -0.055374, -0.048535, -0.047310, -0.045493, -0.040965, -0.032735, -0.032963, -0.032814, -0.033025, -0.021154, -0.027777, -0.020654, -0.015527, -0.011939, -0.003003, -0.005187, -0.002930, 0.001766, 0.010021, 0.024724, 0.013541, 0.022149, 0.023368
#*# 	  -0.060285, -0.058858, -0.049884, -0.049870, -0.040576, -0.042241, -0.037942, -0.036867, -0.032013, -0.033940, -0.026578, -0.015530, -0.016732, -0.012591, -0.022281, -0.004796, -0.003772, -0.000823, -0.005122, 0.006560, 0.016603, 0.018475, 0.022602, 0.023567, 0.024294
#*# 	  -0.061709, -0.056104, -0.048290, -0.041792, -0.040971, -0.040134, -0.034053, -0.037914, -0.030541, -0.032073, -0.026840, -0.023723, -0.014705, -0.012392, -0.009894, -0.008123, -0.004261, -0.003691, 0.003054, 0.013351, 0.021611, 0.017762, 0.024682, 0.029523, 0.025612
#*# 	  -0.058504, -0.048835, -0.049083, -0.047086, -0.037472, -0.034468, -0.036201, -0.033737, -0.031029, -0.026792, -0.021173, -0.019243, -0.020003, -0.007200, -0.005867, -0.003246, 0.006255, 0.008261, 0.014448, 0.020434, 0.019191, 0.022999, 0.031153, 0.034169, 0.042152
#*# 	  -0.059024, -0.049067, -0.044747, -0.031843, -0.047511, -0.034274, -0.032885, -0.030989, -0.025340, -0.020768, -0.020392, -0.009128, -0.010160, -0.008583, -0.005539, -0.001537, 0.003987, 0.006310, 0.015797, 0.016817, 0.026413, 0.034688, 0.033099, 0.046792, 0.043424
#*# 	  -0.053217, -0.051197, -0.040270, -0.039394, -0.034578, -0.028124, -0.026974, -0.026027, -0.016844, -0.018438, -0.013653, -0.008162, -0.006775, 0.000180, 0.005761, 0.009782, 0.012904, 0.017948, 0.014047, 0.029030, 0.031630, 0.035687, 0.041761, 0.049790, 0.044119
#*# 	  -0.053261, -0.042114, -0.039495, -0.026399, -0.027267, -0.029679, -0.026314, -0.018973, -0.014005, -0.013370, -0.012566, -0.002479, 0.001300, 0.003539, 0.010322, 0.013047, 0.010430, 0.020745, 0.023545, 0.031029, 0.038885, 0.038303, 0.053392, 0.053084, 0.053438
#*# 	  -0.046380, -0.037873, -0.046420, -0.026980, -0.026678, -0.036160, -0.021998, -0.022400, -0.017162, -0.017255, 0.000762, 0.001861, 0.003570, 0.010074, 0.011508, 0.021675, 0.021348, 0.025682, 0.033720, 0.037467, 0.043815, 0.052295, 0.063178, 0.065354, 0.065418
#*# 	  -0.044305, -0.035875, -0.027937, -0.027308, -0.024010, -0.024238, -0.020383, -0.019713, -0.019260, -0.010729, -0.006787, 0.002366, 0.002105, 0.012694, 0.016258, 0.024930, 0.025815, 0.031069, 0.036775, 0.050450, 0.044950, 0.054416, 0.064733, 0.065035, 0.078337
#*# 	  -0.040853, -0.024691, -0.025603, -0.022739, -0.024760, -0.020973, -0.017951, -0.016291, -0.012066, -0.002284, 0.002016, 0.004686, 0.010461, 0.013378, 0.014638, 0.025389, 0.030908, 0.034827, 0.044274, 0.036458, 0.054518, 0.058568, 0.068420, 0.079692, 0.078362
#*# 	  -0.039119, -0.023702, -0.036279, -0.026844, -0.022616, -0.024390, -0.019840, -0.020458, -0.016362, -0.010666, -0.002053, 0.001623, 0.005387, 0.013695, 0.027448, 0.020697, 0.027948, 0.034388, 0.043505, 0.054118, 0.053222, 0.059961, 0.065196, 0.074049, 0.082124
#*# 	  -0.041809, -0.044240, -0.039431, -0.030681, -0.031803, -0.029250, -0.029024, -0.028869, -0.017600, -0.020694, -0.014095, -0.005661, 0.000463, 0.005358, 0.012568, 0.019073, 0.025634, 0.029895, 0.036550, 0.050382, 0.051385, 0.057965, 0.061919, 0.064058, 0.072903
#*# 	  -0.041033, -0.040037, -0.037398, -0.032719, -0.031845, -0.027162, -0.025240, -0.024714, -0.019265, -0.022675, -0.008111, -0.008311, 0.004904, 0.011014, 0.021131, 0.020781, 0.022444, 0.030926, 0.035565, 0.041965, 0.043251, 0.052407, 0.053728, 0.067897, 0.066128
#*# 	  -0.040186, -0.036406, -0.035248, -0.035477, -0.034716, -0.032976, -0.028878, -0.022415, -0.019451, -0.010203, -0.010953, -0.007002, 0.002591, 0.017710, 0.014626, 0.019039, 0.027542, 0.033876, 0.035129, 0.044028, 0.046327, 0.051231, 0.060810, 0.070582, 0.070504
#*# 	  -0.039254, -0.031238, -0.030646, -0.028904, -0.023147, -0.024653, -0.013776, -0.016963, -0.013453, -0.008901, -0.005706, -0.000773, 0.005398, 0.016252, 0.020522, 0.021548, 0.024584, 0.037851, 0.039400, 0.045953, 0.050086, 0.055860, 0.066605, 0.067798, 0.073867
#*# 	  -0.025085, -0.019977, -0.023071, -0.024846, -0.020245, -0.019861, -0.018041, -0.018926, -0.009510, -0.016969, 0.006725, 0.008600, 0.009427, 0.012414, 0.024828, 0.023804, 0.035868, 0.036563, 0.040089, 0.042435, 0.053158, 0.056836, 0.066693, 0.063967, 0.073391
#*# 	  -0.037980, -0.024225, -0.032717, -0.039057, -0.032199, -0.023824, -0.025519, -0.018363, -0.019027, -0.007953, -0.008885, 0.003596, 0.001396, 0.007961, 0.010148, 0.014781, 0.023950, 0.027103, 0.030016, 0.032282, 0.042122, 0.046400, 0.058140, 0.059494, 0.060748
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 210.0
#*# min_y = 30.0
#*# max_y = 210.0
#*#
#*# [beacon model default]
#*# model_coef = 1.9257982386737142,
#*# 	2.1904011986275074,
#*# 	0.5881661108028357,
#*# 	0.30341866940870527,
#*# 	0.14823890288711727,
#*# 	-0.42807822476666274,
#*# 	-0.13716254071061182,
#*# 	0.612855529187592,
#*# 	0.08376843001203003,
#*# 	-0.2664564217100284
#*# model_domain = 3.352922478536077e-07,3.360945745364866e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 72.578002
#*# model_offset = 0.11500
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 77.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 51.6
