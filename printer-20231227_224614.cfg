[include moonraker_obico_macros.cfg]
##########################
##### BASE CONFIG #######
##########################

[include mainsail.cfg]
[include ./backup/backup.cfg]

##########################
##### HARDWARE STUFF #####
##########################

[include ./hardware/xyz-stepper.cfg]
[include ./hardware/extruder.cfg]
#[include ./klicky/klicky-probe.cfg]
#[include ./hardware/adxl345.cfg]  This config now in canbus.cfg
[include ./hardware/fans.cfg] # Some fans config in canbus.cfg
[include ./hardware/canbus.cfg]

##########################
##### LIGHTS #############
##########################

[include ./hardware/chamber-lighting.cfg]
[include ./hardware/stealthburner-led.cfg]

##########################
##### CALIBRATION ########
##########################

[include ./calibration/z-tilt.cfg]
[include ./calibration/bed-mesh.cfg]
[include ./macros/unsafe.cfg]
[include ./calibration/pressure_advance.cfg]
[include ./calibration/test_speed.cfg]
[include ./calibration/pika.cfg]
[include test_probe_accuracy.cfg]

##########################
##### MACROS #############
##########################

[include ./macros/chamber-led.cfg]
[include ./macros/conditional-homing.cfg]
[include ./macros/print-end.cfg]
[include ./macros/print-start-mmu.cfg]
[include ./macros/dump-variables.cfg]
[include ./macros/movement-check.cfg]
[include ./macros/cancel-change.cfg]
[include ./macros/pause-resume.cfg]         ; Overridden by ERCF / subsequantly disabled
[include ./macros/load-unload.cfg]
[include ./macros/filament-change.cfg]
[include ./macros/park.cfg]
[include ./macros/heatsoak.cfg]

##########################
##### THIRD PARTY ########
##########################

#[include ./third-party-cfg/nozzle_scrub.cfg]
[include KAMP_Settings.cfg]

##########################
##### ERCF ###############
##########################

[include mmu/base/*.cfg]
[include macros/mmu_adds.cfg]
[include mmu/optional/mmu_ercf_cutter.cfg]

##########################
##### LCD/MENU ###########
##########################

#[include ./third-party-cfg/nozzle_scrub_menu.cfg]
#[include ./menu/printer_menu.cfg]

##########################
##### NOT ENABLED YET ####
##########################

#[include ./todo/mini12864.cfg] Add this after adding mini12864 LED
#[include ./todo/lcd_tweaks.cfg] Need to figure this one out and then implement
#[include ./hardware/nevermore.cfg] Disabled as I prefer to chamber vent outside and needed the PWM

##########################
#### REPLACEMENT #########
##########################

[include ./replacement_macros/replace-m900.cfg]
[include ./replacement_macros/replace-m117.cfg]

[exclude_object]

[gcode_arcs]
resolution: 0.1

[respond]
default_type: echo
default_prefix:  

[force_move]
# Enable commands that force potentially unsafe movement
enable_force_move: True

[idle_timeout]
timeout: 14400

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_290040000750314D35323820-if00
restart_method: command

[mcu rpi]
# Add Rpi as secondary MCU to allow for ADXL use through SPI ribbon/adapter from LDO
serial: /tmp/klipper_host_mcu

[mcu sht]
canbus_uuid: 30993412e8e0

[printer]
kinematics: corexy
max_velocity: 200           # Changed from 200 on 7.11.23
max_accel:  6000            # tuned on 7.11.23 after beacon install.
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0 # Changed on 7.11.23

#####################################################################
#   Input Shaper
#####################################################################

[input_shaper]
#shaper_freq_x: 76.2               ; suggested max_accel <= 22600 mm/sec^2
#shaper_type_x: zv
#shaper_freq_y: 51.8               ; suggested max_accel <= 7900 mm/sec^2
#shaper_type_y: mzv


#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
heater_pin: PA2 #PA2 is LDO default
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 125
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  WAS TAP - NOW BEACON in CANBUS

#####################################################################
#   Additional Sensors
#####################################################################

[thermistor CMFB103F3950FANT]
temperature1: 0.0
resistance1: 32116.0
temperature2: 40.0
resistance2: 5309.0
temperature3: 80.0
resistance3: 1228.0

#[temperature_sensor sb_ambient_temp]
## Chamber Temperature - T1
#sensor_type: CMFB103F3950FANT
#sensor_pin: PF5
#min_temp: 0
#max_temp: 100
#gcode_id: chamber_th

[temperature_sensor back_chamber_temp]
## Chamber Temperature - T
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF6
min_temp: 0
max_temp: 100
gcode_id: chamber_th2

[temperature_sensor RPi4]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################

#[safe_z_home]
##  XY Location of the Z Endstop Switch
##  Update -10,-10 to the XY coordinates of your endstop pin 
##  (such as 157,305) after going through Z Endstop Pin
##  Location Definition step.
#home_xy_position: 147,256
#speed:100
#z_hop:10
#z_hop_speed:10


########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.889
#*# pid_ki = 0.964
#*# pid_kd = 412.851
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.084917, -0.052452, -0.046760, -0.050003, -0.047018, -0.046510, -0.027116, -0.035743, -0.041423, -0.025449, -0.035868, -0.024941, -0.025858, -0.020504, -0.014988, -0.011369, -0.021399, -0.009613, -0.010879, -0.006132, -0.013659, -0.011941, -0.013320, -0.008879, -0.010230
#*# 	  -0.062432, -0.047499, -0.043282, -0.027330, -0.034274, -0.029020, -0.022617, -0.025803, -0.024573, -0.020252, -0.022166, -0.025468, -0.016855, -0.015500, -0.013876, -0.008250, -0.010597, -0.003221, -0.015595, -0.007762, -0.007308, -0.006424, 0.002209, 0.003455, -0.004297
#*# 	  -0.047604, -0.036040, -0.031388, -0.028104, -0.026696, -0.025799, -0.025129, -0.023734, -0.022227, -0.023630, -0.019424, -0.022789, -0.024329, -0.012547, -0.022183, -0.019942, -0.014304, -0.022589, -0.004393, -0.002896, -0.003681, -0.002445, 0.007939, 0.011628, 0.008596
#*# 	  -0.041756, -0.039721, -0.029471, -0.024947, -0.028525, -0.031839, -0.027523, -0.027666, -0.023640, -0.018446, -0.023410, -0.012666, -0.015907, -0.009883, -0.011268, -0.008120, -0.006183, -0.014821, -0.004195, -0.002003, 0.003867, 0.001589, 0.006549, 0.008842, 0.009910
#*# 	  -0.042055, -0.043032, -0.032410, -0.027968, -0.028515, -0.031589, -0.029854, -0.027956, -0.025838, -0.027811, -0.020713, -0.019929, -0.016670, -0.019168, -0.013964, -0.008780, -0.007071, -0.012700, -0.008507, -0.020104, -0.022718, -0.001782, 0.006155, 0.008968, 0.006713
#*# 	  -0.055432, -0.038620, -0.035363, -0.032118, -0.027519, -0.035233, -0.033921, -0.025448, -0.026828, -0.024434, -0.022055, -0.019503, -0.015456, 0.001439, -0.002777, -0.004795, -0.008349, -0.001774, -0.004622, -0.010677, -0.004559, -0.000328, 0.009619, 0.009361, 0.008321
#*# 	  -0.038049, -0.037535, -0.032242, -0.033779, -0.030579, -0.033963, -0.031842, -0.031061, -0.021224, -0.022893, -0.018409, -0.017184, -0.002725, 0.006070, 0.010214, 0.004448, 0.003552, -0.001230, -0.000238, -0.000684, -0.003966, 0.002816, 0.011089, 0.011267, 0.005447
#*# 	  -0.032326, -0.029356, -0.023330, -0.024889, -0.021953, -0.029505, -0.018768, -0.016586, -0.015914, -0.016119, -0.019149, 0.001690, 0.002478, 0.012333, 0.013733, 0.018150, 0.008661, 0.007984, 0.006905, 0.004508, 0.006456, 0.015586, 0.017396, 0.016172, 0.013002
#*# 	  -0.041357, -0.030073, -0.022172, -0.025929, -0.020813, -0.025819, -0.016405, -0.019088, -0.018471, -0.017438, -0.000448, -0.004604, 0.001409, 0.011551, 0.016118, 0.016531, 0.007784, -0.001145, 0.004749, 0.005216, 0.011684, 0.010879, 0.016791, 0.019761, 0.011643
#*# 	  -0.041874, -0.038048, -0.023473, -0.027059, -0.025089, -0.024039, -0.026513, -0.020810, -0.027748, -0.021737, -0.003487, -0.002243, 0.004080, 0.008791, 0.009545, 0.013089, 0.010126, 0.009098, 0.005552, 0.000010, 0.013497, 0.011643, 0.017605, 0.010700, 0.009796
#*# 	  -0.038442, -0.036593, -0.026150, -0.025251, -0.025117, -0.022092, -0.023994, -0.024775, -0.017991, -0.011146, -0.010214, -0.012834, -0.001571, 0.006774, 0.007012, 0.005706, 0.009179, -0.002188, 0.003208, 0.007133, 0.008989, 0.013414, 0.013933, 0.015033, 0.012727
#*# 	  -0.037813, -0.028359, -0.022348, -0.023578, -0.017046, -0.024469, -0.017145, -0.016511, -0.022468, -0.006736, -0.005116, -0.009985, -0.000846, 0.001583, 0.005518, 0.012947, 0.009695, 0.014493, 0.009422, 0.012879, 0.012903, 0.024292, 0.026082, 0.016361, 0.017849
#*# 	  -0.039005, -0.023237, -0.027209, -0.025858, -0.020687, -0.016150, -0.011098, -0.017006, -0.015864, -0.018183, -0.004276, -0.005603, -0.006503, -0.002430, 0.013647, 0.015636, 0.004639, 0.008429, 0.008659, 0.014793, 0.023743, 0.024669, 0.029115, 0.031597, 0.020759
#*# 	  -0.040419, -0.034436, -0.027227, -0.026110, -0.015834, -0.016103, -0.022288, -0.019372, -0.005832, -0.005707, -0.009718, -0.010666, -0.003616, -0.000661, 0.007813, -0.000075, 0.011452, 0.016355, 0.014899, 0.016049, 0.027605, 0.031183, 0.033712, 0.024880, 0.027682
#*# 	  -0.037545, -0.022073, -0.022779, -0.015933, -0.020785, -0.015953, -0.015839, -0.022899, -0.015613, -0.004753, -0.009679, -0.011362, -0.006106, -0.002488, -0.008436, 0.014237, 0.011250, 0.008587, 0.015714, 0.026633, 0.028850, 0.030922, 0.030190, 0.036632, 0.027456
#*# 	  -0.020907, -0.026390, -0.018180, -0.016871, -0.014933, -0.015926, -0.015561, -0.010729, -0.007804, -0.010854, -0.010524, 0.000206, 0.000776, 0.015809, 0.012983, 0.014288, 0.017246, 0.019849, 0.026013, 0.030234, 0.031201, 0.049280, 0.049916, 0.049007, 0.036305
#*# 	  -0.036412, -0.016653, -0.013084, -0.012031, -0.014175, -0.012056, -0.007921, -0.009735, -0.009505, -0.007772, -0.008619, -0.006878, 0.000885, 0.016302, 0.018143, 0.018537, 0.023191, 0.023140, 0.029648, 0.035599, 0.033208, 0.045619, 0.051001, 0.053755, 0.046917
#*# 	  -0.038688, -0.015198, -0.015266, -0.012670, -0.009866, -0.012862, -0.008234, -0.008928, -0.008243, -0.006035, -0.007213, -0.003951, 0.007866, 0.017310, 0.015376, 0.020505, 0.021934, 0.025298, 0.030694, 0.039575, 0.046016, 0.048389, 0.052494, 0.058244, 0.049108
#*# 	  -0.029880, -0.019215, -0.011802, -0.013183, -0.015762, -0.016177, -0.013527, -0.016512, -0.012860, -0.007982, -0.009864, -0.001147, 0.004167, 0.016961, 0.019971, 0.022997, 0.029859, 0.027459, 0.035014, 0.034658, 0.036738, 0.046815, 0.049165, 0.057755, 0.050878
#*# 	  -0.035640, -0.017240, -0.021504, -0.024691, -0.029884, -0.017683, -0.017189, -0.015551, -0.014717, -0.012228, -0.010784, -0.007564, 0.009519, 0.019052, 0.020707, 0.026660, 0.022493, 0.026790, 0.032316, 0.033020, 0.042479, 0.047722, 0.055346, 0.054389, 0.053084
#*# 	  -0.039945, -0.021428, -0.025376, -0.023010, -0.018151, -0.030175, -0.013435, -0.012957, -0.014962, -0.013423, -0.016304, -0.007287, 0.009167, 0.018226, 0.017712, 0.023503, 0.030269, 0.037857, 0.026429, 0.036533, 0.045570, 0.043135, 0.045760, 0.054655, 0.040645
#*# 	  -0.029910, -0.020470, -0.011704, -0.016096, -0.018540, -0.019844, -0.012368, -0.019117, -0.014977, -0.009802, -0.008907, 0.000239, 0.010364, 0.024355, 0.023535, 0.027210, 0.038922, 0.035564, 0.040657, 0.039891, 0.038729, 0.055054, 0.044376, 0.053323, 0.032294
#*# 	  -0.042318, -0.014949, -0.018396, -0.009502, -0.011041, -0.011567, -0.012359, -0.018564, -0.012498, -0.006232, -0.001330, 0.003292, 0.003142, 0.019115, 0.027661, 0.029583, 0.034873, 0.039339, 0.038010, 0.043119, 0.043794, 0.025724, 0.041228, 0.049117, 0.043443
#*# 	  -0.028171, -0.016373, -0.013890, -0.016320, -0.011275, -0.009837, -0.012248, -0.004671, -0.002480, -0.001527, -0.002478, 0.006398, 0.022773, 0.018506, 0.025768, 0.031633, 0.032518, 0.033204, 0.039037, 0.035857, 0.036018, 0.041075, 0.056930, 0.057750, 0.041420
#*# 	  -0.017667, -0.013607, -0.014412, -0.013781, -0.012739, -0.023307, -0.014482, -0.014959, -0.011956, -0.011809, -0.007646, -0.004975, 0.001538, 0.002364, 0.017740, 0.023103, 0.019429, 0.018267, 0.021924, 0.022568, 0.021799, 0.025806, 0.026962, 0.030675, 0.025014
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 210.0
#*# min_y = 30.0
#*# max_y = 210.0
#*#
#*# [beacon model default]
#*# model_coef = 1.9263519575030055,
#*# 	2.1946743347503372,
#*# 	0.6208794249910773,
#*# 	0.2775896555222557,
#*# 	0.06526221562750463,
#*# 	-0.2611119885640586,
#*# 	-0.05461829170887029,
#*# 	0.36810740679885895,
#*# 	0.05685001457152785,
#*# 	-0.15547240310186372
#*# model_domain = 3.351987055417817e-07,3.359664588035842e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 63.925584
#*# model_offset = 1.27000
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 77.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 51.6
#*#
#*# [beacon model pei_hot]
#*# model_coef = 1.9263519575030055,
#*# 	2.1946743347503372,
#*# 	0.6208794249910773,
#*# 	0.2775896555222557,
#*# 	0.06526221562750463,
#*# 	-0.2611119885640586,
#*# 	-0.05461829170887029,
#*# 	0.36810740679885895,
#*# 	0.05685001457152785,
#*# 	-0.15547240310186372
#*# model_domain = 3.351987055417817e-07,3.359664588035842e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 63.925584
#*# model_offset = 0.00000
