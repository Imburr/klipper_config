[include moonraker_obico_macros.cfg]
##########################
##### BASE CONFIG #######
##########################

[include mainsail.cfg]
[include ./backup/backup.cfg]

##########################
##### HARDWARE STUFF #####
##########################

[include ./hardware/xyz-stepper.cfg]
[include ./hardware/extruder.cfg]
#[include ./klicky/klicky-probe.cfg]
#[include ./hardware/adxl345.cfg]  This config now in canbus.cfg
[include ./hardware/fans.cfg] # Some fans config in canbus.cfg
[include ./hardware/canbus.cfg]

##########################
##### LIGHTS #############
##########################

[include ./hardware/chamber-lighting.cfg]
[include ./hardware/stealthburner-led.cfg]

##########################
##### CALIBRATION ########
##########################

[include ./calibration/z-tilt.cfg]
[include ./calibration/bed-mesh.cfg]
[include ./macros/unsafe.cfg]
[include ./calibration/pressure_advance.cfg]
[include ./calibration/test_speed.cfg]
[include ./calibration/pika.cfg]
[include test_probe_accuracy.cfg]

##########################
##### MACROS #############
##########################

[include ./macros/chamber-led.cfg]
[include ./macros/conditional-homing.cfg]
[include ./macros/print-end.cfg]
[include ./macros/print-start-mmu.cfg]
[include ./macros/dump-variables.cfg]
[include ./macros/movement-check.cfg]
[include ./macros/cancel-change.cfg]
[include ./macros/pause-resume.cfg]         ; Overridden by ERCF / subsequantly disabled
[include ./macros/load-unload.cfg]
[include ./macros/filament-change.cfg]
[include ./macros/park.cfg]
[include ./macros/heatsoak.cfg]

##########################
##### THIRD PARTY ########
##########################

#[include ./third-party-cfg/nozzle_scrub.cfg]
[include KAMP_Settings.cfg]

##########################
##### ERCF ###############
##########################

[include mmu/base/*.cfg]
[include macros/mmu_adds.cfg]
[include mmu/optional/mmu_ercf_cutter.cfg]

##########################
##### LCD/MENU ###########
##########################

#[include ./third-party-cfg/nozzle_scrub_menu.cfg]
#[include ./menu/printer_menu.cfg]

##########################
##### NOT ENABLED YET ####
##########################

#[include ./todo/mini12864.cfg] Add this after adding mini12864 LED
#[include ./todo/lcd_tweaks.cfg] Need to figure this one out and then implement
#[include ./hardware/nevermore.cfg] Disabled as I prefer to chamber vent outside and needed the PWM

##########################
#### REPLACEMENT #########
##########################

[include ./replacement_macros/replace-m900.cfg]
[include ./replacement_macros/replace-m117.cfg]

[exclude_object]

[gcode_arcs]
resolution: 0.1

[respond]
default_type: echo
default_prefix:  

[force_move]
# Enable commands that force potentially unsafe movement
enable_force_move: True

[idle_timeout]
timeout: 14400

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_290040000750314D35323820-if00
restart_method: command

[mcu rpi]
# Add Rpi as secondary MCU to allow for ADXL use through SPI ribbon/adapter from LDO
serial: /tmp/klipper_host_mcu

[mcu sht]
canbus_uuid: 30993412e8e0

[printer]
kinematics: corexy
max_velocity: 200           # Changed from 200 on 7.11.23
max_accel:  6000            # tuned on 7.11.23 after beacon install.
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0 # Changed on 7.11.23

#####################################################################
#   Input Shaper
#####################################################################

[input_shaper]
#shaper_freq_x: 76.2               ; suggested max_accel <= 22600 mm/sec^2
#shaper_type_x: zv
#shaper_freq_y: 51.8               ; suggested max_accel <= 7900 mm/sec^2
#shaper_type_y: mzv


#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
heater_pin: PA2 #PA2 is LDO default
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 125
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  WAS TAP - NOW BEACON in CANBUS

#####################################################################
#   Additional Sensors
#####################################################################

[thermistor CMFB103F3950FANT]
temperature1: 0.0
resistance1: 32116.0
temperature2: 40.0
resistance2: 5309.0
temperature3: 80.0
resistance3: 1228.0

#[temperature_sensor sb_ambient_temp]
## Chamber Temperature - T1
#sensor_type: CMFB103F3950FANT
#sensor_pin: PF5
#min_temp: 0
#max_temp: 100
#gcode_id: chamber_th

[temperature_sensor back_chamber_temp]
## Chamber Temperature - T
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF6
min_temp: 0
max_temp: 100
gcode_id: chamber_th2

[temperature_sensor RPi4]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################

#[safe_z_home]
##  XY Location of the Z Endstop Switch
##  Update -10,-10 to the XY coordinates of your endstop pin 
##  (such as 157,305) after going through Z Endstop Pin
##  Location Definition step.
#home_xy_position: 147,256
#speed:100
#z_hop:10
#z_hop_speed:10


########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.889
#*# pid_ki = 0.964
#*# pid_kd = 412.851
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.012348, -0.008984, 0.002729, -0.004030, 0.000749, -0.000759, 0.007000, 0.006794, 0.014759, 0.019349, 0.024454, 0.019570, 0.019144, 0.010442, 0.008267, 0.020454, 0.004375, 0.025107, 0.038404, 0.023907, 0.040980, 0.034463, 0.032339, 0.042807, 0.039721
#*# 	  -0.002360, 0.007186, 0.015617, 0.006885, 0.003718, 0.013747, 0.018617, 0.022219, 0.021094, 0.021569, 0.020882, 0.021555, 0.022461, 0.020489, 0.021927, 0.023096, 0.022768, 0.025911, 0.029939, 0.038381, 0.039723, 0.036722, 0.045951, 0.039316, 0.043353
#*# 	  0.001635, 0.012967, 0.019596, 0.014750, 0.015296, 0.011315, 0.013532, 0.011943, 0.029996, 0.029061, 0.026253, 0.023836, 0.017304, 0.019758, 0.020806, 0.022148, 0.020968, 0.033421, 0.039258, 0.038378, 0.041797, 0.039824, 0.040344, 0.041111, 0.041412
#*# 	  -0.006209, 0.001791, 0.012921, 0.011682, 0.003832, 0.003130, 0.002991, 0.005279, 0.014614, 0.012133, 0.021349, 0.021546, 0.014060, 0.022357, 0.021626, 0.020355, 0.028737, 0.013904, 0.023975, 0.023624, 0.036685, 0.037511, 0.040306, 0.049875, 0.037239
#*# 	  -0.004846, -0.008948, -0.000784, -0.000302, 0.002512, -0.001099, 0.003296, 0.003993, 0.007866, 0.006986, 0.009334, 0.014172, 0.017497, 0.011354, 0.012983, 0.010194, 0.007959, -0.003349, 0.011034, 0.022206, 0.028901, 0.034577, 0.037995, 0.040619, 0.036084
#*# 	  -0.013567, -0.007273, -0.005355, -0.002476, -0.004648, 0.000129, 0.000570, -0.004022, -0.001256, 0.006756, 0.002176, 0.002016, -0.000849, 0.013525, 0.015465, 0.014119, -0.001123, 0.002614, 0.019267, 0.023753, 0.029685, 0.031845, 0.033465, 0.034015, 0.036287
#*# 	  -0.017337, -0.014606, -0.003041, -0.009952, -0.005936, -0.011338, 0.000544, 0.002477, -0.004015, 0.002916, -0.001647, 0.005677, 0.017012, 0.005868, 0.013829, 0.002711, 0.006675, -0.006531, 0.009198, 0.021545, 0.020447, 0.025764, 0.028582, 0.028883, 0.028402
#*# 	  -0.017259, -0.011329, -0.015286, -0.012815, -0.009735, -0.004099, -0.008629, -0.005922, -0.004337, -0.011868, -0.015137, 0.004133, -0.000165, 0.004555, 0.003114, -0.006273, 0.000487, 0.011810, 0.020751, 0.017171, 0.010183, 0.021674, 0.023008, 0.024790, 0.024812
#*# 	  -0.012424, -0.016771, -0.012948, -0.013095, -0.014184, -0.009488, -0.012449, -0.011666, -0.005506, -0.006188, -0.012269, 0.003877, -0.006676, 0.012711, 0.016303, -0.009896, -0.009555, 0.012789, 0.015670, 0.009940, 0.005781, 0.018191, 0.030735, 0.026576, 0.020562
#*# 	  -0.014528, -0.012787, -0.016495, -0.015443, -0.013051, -0.008702, -0.009406, -0.012395, -0.012090, -0.008759, -0.005612, -0.006147, 0.012833, -0.003126, 0.007222, 0.004047, -0.003092, -0.008685, 0.011839, 0.015601, -0.000801, 0.004582, 0.016943, 0.017770, 0.018160
#*# 	  -0.013034, -0.011704, -0.012936, -0.014140, -0.012743, -0.010551, -0.013965, -0.012045, -0.012190, -0.013052, -0.008359, -0.001491, -0.000170, -0.010942, -0.011023, -0.008772, 0.003252, -0.007991, 0.012241, -0.008989, 0.004357, 0.011242, 0.011919, 0.012226, 0.011466
#*# 	  -0.011232, -0.015224, -0.015526, -0.009611, -0.015239, -0.013620, -0.012856, -0.012747, -0.011617, -0.007639, 0.007505, 0.012525, 0.001900, 0.005263, -0.007211, 0.003247, -0.011336, 0.011520, -0.003542, 0.008239, 0.004608, 0.011984, 0.019144, 0.016100, 0.014134
#*# 	  -0.011987, -0.012979, -0.012532, -0.013012, -0.014344, -0.011954, -0.012407, -0.011581, 0.005099, -0.011710, -0.010448, -0.000511, 0.003593, 0.008595, 0.006045, 0.005093, -0.011386, 0.007963, 0.008186, 0.009678, 0.011714, 0.010361, 0.018538, 0.010778, 0.013092
#*# 	  -0.015515, -0.015671, -0.015092, -0.013793, -0.014198, -0.016159, -0.018690, -0.014378, -0.014827, -0.000316, -0.004225, 0.006047, -0.002807, 0.002378, 0.008000, 0.001958, -0.006596, -0.012023, 0.004362, 0.010209, 0.012330, 0.014325, 0.019888, 0.017354, 0.024062
#*# 	  -0.018512, -0.013387, -0.016302, -0.014364, -0.015544, -0.014437, -0.015263, -0.015074, -0.009069, 0.007404, -0.000144, 0.008114, 0.007797, 0.008191, 0.003170, 0.007752, 0.006603, -0.000813, 0.008780, 0.008346, 0.011794, 0.019024, 0.024420, 0.028420, 0.014932
#*# 	  -0.012045, -0.010459, -0.012746, -0.015038, -0.006321, -0.012390, -0.008331, -0.013599, -0.005578, -0.006096, 0.000875, 0.008565, 0.005897, 0.009733, 0.011004, 0.010549, 0.008402, 0.010894, 0.011740, 0.016677, 0.018577, 0.021378, 0.030242, 0.026465, 0.026623
#*# 	  -0.011741, -0.005749, -0.000982, -0.010165, -0.005642, -0.006928, -0.013347, -0.010942, -0.006154, 0.001959, 0.005739, 0.011208, 0.012053, 0.008493, 0.010438, 0.011171, 0.013356, 0.013115, 0.017796, 0.028753, 0.026629, 0.025035, 0.031313, 0.052281, 0.029511
#*# 	  -0.005817, -0.010336, -0.013261, 0.009594, -0.006697, -0.006456, -0.014984, -0.014320, -0.011470, 0.005832, 0.004923, 0.014426, 0.015536, 0.016889, 0.014617, 0.024340, 0.015341, 0.024782, 0.024757, 0.025572, 0.027871, 0.029968, 0.054853, 0.028038, 0.039338
#*# 	  -0.014635, -0.003941, -0.008822, -0.010861, -0.009521, -0.010827, -0.006962, -0.011517, -0.015113, 0.013847, 0.003893, 0.008905, 0.011684, 0.013798, 0.013803, 0.023606, 0.017621, 0.022991, 0.018945, 0.027329, 0.027194, 0.030387, 0.056160, 0.047663, 0.057599
#*# 	  -0.019490, -0.016032, -0.017298, -0.018201, -0.017356, -0.016597, -0.017003, -0.017790, -0.007116, -0.004119, 0.007661, 0.001650, 0.012492, 0.015294, 0.016316, 0.015932, 0.024645, 0.020608, 0.016863, 0.021720, 0.023991, 0.028459, 0.038727, 0.046612, 0.032427
#*# 	  -0.018943, -0.013873, -0.017180, -0.016124, -0.016061, -0.016089, -0.017379, -0.016677, -0.018932, -0.006026, -0.006286, -0.005023, 0.014616, -0.006267, -0.000397, 0.011901, 0.014343, 0.017210, 0.017321, 0.023164, 0.025149, 0.032313, 0.031693, 0.030106, 0.041057
#*# 	  -0.015776, -0.017722, -0.015455, -0.018632, -0.014691, -0.011834, -0.011976, -0.019828, -0.019438, -0.010247, -0.015563, -0.004613, 0.005274, 0.000997, -0.009216, 0.017366, 0.015658, 0.005358, 0.020179, 0.023738, 0.023080, 0.025668, 0.024649, 0.037430, 0.031756
#*# 	  -0.018661, -0.018220, -0.015952, -0.009401, -0.013117, -0.023070, -0.021499, -0.015401, -0.014789, -0.006635, -0.009668, 0.000439, -0.001440, 0.000331, -0.006812, 0.018101, 0.014149, 0.018900, 0.014842, 0.019602, 0.023221, 0.023533, 0.034370, 0.032871, 0.034606
#*# 	  -0.018613, -0.010578, -0.009127, -0.014481, -0.019570, -0.019079, -0.015582, -0.016095, -0.010901, -0.009580, -0.011370, -0.002808, -0.007483, -0.011997, -0.005071, 0.002893, 0.011190, 0.003382, 0.018316, 0.018646, 0.020736, 0.022198, 0.023323, 0.034780, 0.035505
#*# 	  -0.033844, -0.020664, -0.019166, -0.019944, -0.021266, -0.022598, -0.021037, -0.022598, -0.020780, -0.021909, -0.021763, -0.017269, -0.019375, -0.018709, -0.021124, -0.014338, -0.010575, -0.009654, -0.003368, 0.003499, 0.017603, 0.017664, 0.020615, 0.021627, 0.021268
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 210.0
#*# min_y = 30.0
#*# max_y = 210.0
#*#
#*# [beacon model default]
#*# model_coef = 1.9263519575030055,
#*# 	  2.1946743347503372,
#*# 	  0.6208794249910773,
#*# 	  0.2775896555222557,
#*# 	  0.06526221562750463,
#*# 	  -0.2611119885640586,
#*# 	  -0.05461829170887029,
#*# 	  0.36810740679885895,
#*# 	  0.05685001457152785,
#*# 	  -0.15547240310186372
#*# model_domain = 3.351987055417817e-07,3.359664588035842e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 63.925584
#*# model_offset = 1.69000
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 77.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 51.6
#*#
#*# [beacon model pei_hot]
#*# model_coef = 1.9263519575030055,
#*# 	2.1946743347503372,
#*# 	0.6208794249910773,
#*# 	0.2775896555222557,
#*# 	0.06526221562750463,
#*# 	-0.2611119885640586,
#*# 	-0.05461829170887029,
#*# 	0.36810740679885895,
#*# 	0.05685001457152785,
#*# 	-0.15547240310186372
#*# model_domain = 3.351987055417817e-07,3.359664588035842e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 63.925584
#*# model_offset = 0.00000
