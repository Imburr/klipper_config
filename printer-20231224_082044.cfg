[include moonraker_obico_macros.cfg]
##########################
##### BASE CONFIG #######
##########################

[include mainsail.cfg]
[include ./backup/backup.cfg]

##########################
##### HARDWARE STUFF #####
##########################

[include ./hardware/xyz-stepper.cfg]
[include ./hardware/extruder.cfg]
#[include ./klicky/klicky-probe.cfg]
#[include ./hardware/adxl345.cfg]  This config now in canbus.cfg
[include ./hardware/fans.cfg] # Some fans config in canbus.cfg
[include ./hardware/canbus.cfg]

##########################
##### LIGHTS #############
##########################

[include ./hardware/chamber-lighting.cfg]
[include ./hardware/stealthburner-led.cfg]

##########################
##### CALIBRATION ########
##########################

[include ./calibration/z-tilt.cfg]
[include ./calibration/bed-mesh.cfg]
[include ./macros/unsafe.cfg]
[include ./calibration/pressure_advance.cfg]
[include ./calibration/test_speed.cfg]
[include ./calibration/pika.cfg]
[include test_probe_accuracy.cfg]

##########################
##### MACROS #############
##########################

[include ./macros/chamber-led.cfg]
[include ./macros/conditional-homing.cfg]
[include ./macros/print-end.cfg]
[include ./macros/print-start-mmu.cfg]
[include ./macros/dump-variables.cfg]
[include ./macros/movement-check.cfg]
[include ./macros/cancel-change.cfg]
[include ./macros/pause-resume.cfg]         ; Overridden by ERCF / subsequantly disabled
[include ./macros/load-unload.cfg]
[include ./macros/filament-change.cfg]
[include ./macros/park.cfg]
[include ./macros/heatsoak.cfg]

##########################
##### THIRD PARTY ########
##########################

#[include ./third-party-cfg/nozzle_scrub.cfg]
[include KAMP_Settings.cfg]

##########################
##### ERCF ###############
##########################

[include mmu/base/*.cfg]
[include macros/mmu_adds.cfg]
[include mmu/optional/mmu_ercf_cutter.cfg]

##########################
##### LCD/MENU ###########
##########################

#[include ./third-party-cfg/nozzle_scrub_menu.cfg]
#[include ./menu/printer_menu.cfg]

##########################
##### NOT ENABLED YET ####
##########################

#[include ./todo/mini12864.cfg] Add this after adding mini12864 LED
#[include ./todo/lcd_tweaks.cfg] Need to figure this one out and then implement
#[include ./hardware/nevermore.cfg] Disabled as I prefer to chamber vent outside and needed the PWM

##########################
#### REPLACEMENT #########
##########################

[include ./replacement_macros/replace-m900.cfg]
[include ./replacement_macros/replace-m117.cfg]

[exclude_object]

[gcode_arcs]
resolution: 0.1

[respond]
default_type: echo
default_prefix:  

[force_move]
# Enable commands that force potentially unsafe movement
enable_force_move: True

[idle_timeout]
timeout: 14400

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_290040000750314D35323820-if00
restart_method: command

[mcu rpi]
# Add Rpi as secondary MCU to allow for ADXL use through SPI ribbon/adapter from LDO
serial: /tmp/klipper_host_mcu

[mcu sht]
canbus_uuid: 30993412e8e0

[printer]
kinematics: corexy
max_velocity: 200           # Changed from 200 on 7.11.23
max_accel:  6000            # tuned on 7.11.23 after beacon install.
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0 # Changed on 7.11.23

#####################################################################
#   Input Shaper
#####################################################################

[input_shaper]
#shaper_freq_x: 76.2               ; suggested max_accel <= 22600 mm/sec^2
#shaper_type_x: zv
#shaper_freq_y: 51.8               ; suggested max_accel <= 7900 mm/sec^2
#shaper_type_y: mzv


#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
heater_pin: PA2 #PA2 is LDO default
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 125
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  WAS TAP - NOW BEACON in CANBUS

#####################################################################
#   Additional Sensors
#####################################################################

[thermistor CMFB103F3950FANT]
temperature1: 0.0
resistance1: 32116.0
temperature2: 40.0
resistance2: 5309.0
temperature3: 80.0
resistance3: 1228.0

#[temperature_sensor sb_ambient_temp]
## Chamber Temperature - T1
#sensor_type: CMFB103F3950FANT
#sensor_pin: PF5
#min_temp: 0
#max_temp: 100
#gcode_id: chamber_th

[temperature_sensor back_chamber_temp]
## Chamber Temperature - T
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF6
min_temp: 0
max_temp: 100
gcode_id: chamber_th2

[temperature_sensor RPi4]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################

#[safe_z_home]
##  XY Location of the Z Endstop Switch
##  Update -10,-10 to the XY coordinates of your endstop pin 
##  (such as 157,305) after going through Z Endstop Pin
##  Location Definition step.
#home_xy_position: 147,256
#speed:100
#z_hop:10
#z_hop_speed:10


########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.889
#*# pid_ki = 0.964
#*# pid_kd = 412.851
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.025123, -0.020597, -0.001863, 0.001379, -0.005444, -0.004126, 0.002585, 0.005955, 0.002557, 0.004275, 0.004111, 0.002831, 0.010192, 0.007477, 0.015006, 0.016154, 0.013192, 0.022166, 0.021247, 0.024770, 0.025566, 0.021826, 0.028555, 0.028353, 0.027730
#*# 	  -0.008811, -0.002687, -0.002997, 0.005173, 0.007760, 0.002330, 0.006438, 0.010304, 0.011119, 0.010119, 0.012920, 0.012955, 0.008696, 0.011336, 0.018751, 0.017694, 0.015510, 0.021553, 0.020043, 0.026676, 0.028690, 0.039243, 0.041940, 0.038704, 0.036154
#*# 	  -0.009565, -0.002144, -0.001793, 0.006386, 0.010947, 0.010083, 0.002372, 0.002522, 0.010631, 0.008183, 0.011136, 0.009063, 0.012696, 0.001202, 0.005446, 0.013097, 0.013690, 0.016880, 0.018490, 0.029790, 0.040120, 0.048274, 0.047051, 0.050390, 0.045401
#*# 	  -0.013163, -0.003092, 0.000648, 0.005091, -0.000780, 0.002421, 0.006335, 0.002301, 0.010638, 0.011954, 0.010306, 0.000958, 0.006018, 0.009903, 0.009341, 0.005680, 0.001057, 0.014096, 0.013251, 0.031629, 0.048822, 0.061498, 0.054364, 0.063035, 0.048463
#*# 	  -0.016670, -0.001542, 0.000739, -0.001444, 0.005618, -0.000813, -0.001906, -0.001300, 0.002392, 0.006729, 0.007194, 0.012290, 0.006586, -0.000493, 0.004534, 0.003475, 0.005204, 0.009379, 0.025036, 0.038770, 0.062575, 0.065242, 0.067290, 0.070388, 0.052182
#*# 	  -0.021200, -0.006341, -0.003582, -0.000177, -0.001482, 0.001220, -0.001413, 0.004507, -0.003269, 0.011832, 0.008322, 0.000587, 0.012009, 0.005103, -0.001321, 0.016275, 0.012014, 0.014119, 0.028845, 0.033854, 0.058695, 0.073116, 0.079339, 0.079007, 0.060378
#*# 	  -0.010604, -0.002525, -0.002187, 0.002042, 0.000377, -0.001738, 0.005134, 0.011964, 0.004100, 0.004950, 0.007179, 0.008655, 0.011584, 0.011759, 0.010122, 0.011030, 0.013622, 0.009653, 0.032905, 0.045779, 0.063733, 0.075529, 0.080742, 0.079925, 0.068062
#*# 	  -0.007745, 0.000364, -0.004484, 0.007571, 0.004557, 0.007566, 0.008040, 0.009574, 0.006940, 0.009344, 0.004962, 0.011048, 0.012046, 0.013448, 0.010662, 0.009534, 0.013526, 0.014336, 0.027303, 0.043448, 0.059150, 0.065007, 0.075714, 0.076034, 0.065428
#*# 	  -0.006262, 0.008653, -0.001129, 0.007206, 0.005407, 0.001083, 0.002952, 0.002168, 0.006635, 0.000177, 0.006309, 0.007273, 0.012332, 0.009852, 0.014299, 0.008448, 0.013494, 0.019419, 0.033065, 0.037298, 0.045914, 0.059386, 0.066791, 0.067269, 0.054183
#*# 	  -0.002147, -0.000459, 0.003723, 0.003614, -0.000335, 0.004045, -0.001505, 0.002878, 0.003974, 0.002935, 0.004106, 0.006089, 0.003852, 0.011551, 0.010713, 0.009490, 0.009093, 0.013167, 0.028283, 0.027731, 0.040607, 0.044931, 0.050106, 0.053127, 0.041915
#*# 	  -0.004586, -0.003858, -0.001460, -0.001886, -0.011167, 0.000351, 0.004280, 0.008047, 0.008413, 0.003558, 0.003039, 0.005549, 0.010088, 0.014869, 0.016362, 0.011896, 0.012053, 0.012170, 0.018369, 0.033073, 0.028946, 0.040370, 0.043724, 0.041211, 0.041987
#*# 	  -0.013594, -0.012058, 0.003168, 0.002103, 0.000022, -0.002946, 0.003093, 0.002921, 0.003402, 0.010300, 0.007012, 0.007234, 0.008455, 0.015351, 0.010850, 0.012114, 0.020677, 0.013523, 0.019970, 0.025214, 0.029843, 0.035795, 0.038268, 0.039968, 0.037336
#*# 	  -0.001412, 0.000365, 0.007436, 0.001394, -0.002287, -0.000376, -0.003799, -0.000437, 0.004557, 0.000125, 0.004956, 0.007534, 0.005455, 0.010246, 0.012424, 0.011399, 0.009679, 0.018265, 0.019366, 0.033349, 0.029140, 0.023700, 0.034966, 0.041454, 0.032583
#*# 	  -0.014625, -0.006637, 0.005458, -0.004663, 0.000767, -0.002295, 0.004316, 0.003213, 0.000244, 0.006335, 0.004244, 0.004377, 0.011631, 0.012606, 0.011204, 0.012963, 0.019074, 0.018723, 0.022930, 0.024497, 0.026327, 0.039783, 0.035851, 0.041263, 0.043079
#*# 	  -0.017807, -0.006946, -0.002508, -0.002049, -0.001842, -0.007648, 0.000810, 0.002764, -0.000832, 0.003450, 0.001912, 0.006269, 0.008822, 0.010559, 0.014062, 0.016958, 0.019017, 0.012644, 0.018544, 0.029129, 0.038124, 0.042365, 0.041721, 0.044604, 0.036195
#*# 	  -0.016266, -0.006487, 0.008356, -0.011920, 0.005324, 0.008057, 0.000434, 0.002023, 0.001941, 0.008357, 0.009525, 0.012427, 0.013831, 0.012044, 0.015132, 0.015862, 0.021944, 0.029322, 0.041639, 0.033317, 0.034437, 0.043092, 0.047588, 0.049653, 0.041802
#*# 	  -0.014218, -0.002367, -0.000838, 0.007879, 0.001184, -0.002403, 0.004449, 0.009935, 0.004064, 0.011219, 0.008732, 0.009069, 0.012301, 0.021380, 0.028588, 0.027497, 0.027897, 0.040802, 0.032424, 0.040649, 0.044098, 0.045970, 0.057095, 0.047190, 0.050243
#*# 	  -0.012506, -0.003925, 0.008058, -0.004901, -0.005449, 0.000082, 0.008711, 0.005464, 0.005601, 0.003770, 0.008163, 0.013045, 0.014165, 0.027187, 0.019523, 0.026825, 0.026673, 0.036235, 0.036995, 0.045522, 0.039801, 0.046247, 0.052446, 0.056371, 0.054089
#*# 	  -0.010953, -0.005827, -0.010615, -0.009922, -0.003783, -0.005918, -0.005038, 0.001784, -0.009396, -0.005501, 0.004239, 0.003760, 0.010446, 0.013963, 0.020643, 0.025812, 0.028661, 0.025801, 0.025169, 0.037347, 0.035356, 0.037970, 0.048234, 0.050194, 0.054154
#*# 	  -0.014826, -0.017827, -0.013313, -0.011986, -0.015034, -0.008663, -0.007277, -0.019028, -0.006471, -0.014070, -0.005088, -0.004398, 0.002805, 0.013346, 0.025197, 0.020537, 0.024588, 0.025535, 0.034575, 0.027630, 0.029354, 0.031646, 0.043956, 0.047228, 0.042406
#*# 	  -0.022633, -0.018248, -0.034932, -0.013186, -0.029257, -0.010234, -0.011580, -0.012345, -0.013828, -0.020229, -0.012828, -0.010971, 0.002420, 0.013173, 0.014940, 0.022096, 0.026072, 0.025810, 0.024721, 0.027804, 0.028391, 0.034451, 0.044677, 0.044100, 0.038706
#*# 	  -0.017670, -0.012429, -0.014369, -0.023343, -0.012717, -0.014995, -0.013420, -0.017949, -0.017512, -0.014941, -0.014567, -0.011172, 0.004244, 0.016005, 0.018385, 0.020675, 0.031126, 0.033210, 0.030143, 0.033334, 0.030137, 0.031491, 0.046139, 0.048364, 0.040296
#*# 	  -0.030169, -0.025535, -0.024993, -0.026935, -0.016445, -0.017069, -0.013200, -0.017927, -0.014544, -0.010989, -0.012741, -0.011067, 0.002495, 0.015784, 0.016989, 0.026228, 0.023814, 0.025730, 0.024026, 0.025401, 0.034126, 0.026765, 0.037855, 0.036315, 0.032551
#*# 	  -0.028665, -0.013769, -0.016762, -0.015528, -0.016879, -0.015559, -0.014803, -0.018086, -0.012272, -0.013129, -0.013806, -0.013254, -0.002870, 0.003408, 0.013292, 0.019699, 0.021246, 0.022003, 0.021720, 0.021978, 0.021742, 0.023494, 0.029103, 0.033280, 0.022619
#*# 	  -0.037439, -0.031997, -0.025701, -0.038704, -0.028377, -0.031241, -0.026225, -0.018098, -0.018354, -0.022361, -0.018857, -0.013778, -0.012357, -0.009942, -0.003759, 0.000689, 0.003654, 0.004426, 0.018446, -0.008343, 0.019495, 0.007839, 0.016957, 0.016651, 0.016747
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 210.0
#*# min_y = 30.0
#*# max_y = 210.0
#*#
#*# [beacon model default]
#*# model_coef = 1.9263519575030055,
#*# 	  2.1946743347503372,
#*# 	  0.6208794249910773,
#*# 	  0.2775896555222557,
#*# 	  0.06526221562750463,
#*# 	  -0.2611119885640586,
#*# 	  -0.05461829170887029,
#*# 	  0.36810740679885895,
#*# 	  0.05685001457152785,
#*# 	  -0.15547240310186372
#*# model_domain = 3.351987055417817e-07,3.359664588035842e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 63.925584
#*# model_offset = 1.26000
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 77.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 51.6
#*#
#*# [beacon model pei_hot]
#*# model_coef = 1.9263519575030055,
#*# 	2.1946743347503372,
#*# 	0.6208794249910773,
#*# 	0.2775896555222557,
#*# 	0.06526221562750463,
#*# 	-0.2611119885640586,
#*# 	-0.05461829170887029,
#*# 	0.36810740679885895,
#*# 	0.05685001457152785,
#*# 	-0.15547240310186372
#*# model_domain = 3.351987055417817e-07,3.359664588035842e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 63.925584
#*# model_offset = 0.00000
