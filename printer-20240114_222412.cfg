[include moonraker_obico_macros.cfg]
##########################
##### BASE CONFIG #######
##########################

[include mainsail.cfg]
[include ./backup/backup.cfg]

##########################
##### HARDWARE STUFF #####
##########################

[include ./hardware/xyz-stepper.cfg]
[include ./hardware/extruder.cfg]
#[include ./klicky/klicky-probe.cfg]
#[include ./hardware/adxl345.cfg]  This config now in canbus.cfg
[include ./hardware/fans.cfg] # Some fans config in canbus.cfg
[include ./hardware/canbus.cfg]

##########################
##### LIGHTS #############
##########################

[include ./hardware/chamber-lighting.cfg]
[include ./hardware/stealthburner-led.cfg]

##########################
##### CALIBRATION ########
##########################

[include ./calibration/z-tilt.cfg]
[include ./calibration/bed-mesh.cfg]
[include ./macros/unsafe.cfg]
[include ./calibration/pressure_advance.cfg]
[include ./calibration/test_speed.cfg]
[include ./calibration/pika.cfg]
[include ./calibration/microadjust.cfg]
[include ./calibration/sensorless.cfg]
[include test_probe_accuracy.cfg]

##########################
##### MACROS #############
##########################

[include ./macros/chamber-led.cfg]
[include ./macros/conditional-homing.cfg]
[include ./macros/print-end.cfg]
[include ./macros/print-start-mmu.cfg]
[include ./macros/dump-variables.cfg]
[include ./macros/movement-check.cfg]
[include ./macros/cancel-change.cfg]
[include ./macros/pause-resume.cfg]         ; Overridden by ERCF / subsequantly disabled
[include ./macros/load-unload.cfg]
[include ./macros/filament-change.cfg]
[include ./macros/park.cfg]
[include ./macros/heatsoak.cfg]

##########################
##### THIRD PARTY ########
##########################

#[include ./third-party-cfg/nozzle_scrub.cfg]
[include KAMP_Settings.cfg]

##########################
##### ERCF ###############
##########################

[include mmu/base/*.cfg]
[include macros/mmu_adds.cfg]
[include mmu/optional/mmu_ercf_cutter.cfg]

##########################
##### LCD/MENU ###########
##########################

#[include ./third-party-cfg/nozzle_scrub_menu.cfg]
#[include ./menu/printer_menu.cfg]

##########################
##### NOT ENABLED YET ####
##########################

#[include ./todo/mini12864.cfg] Add this after adding mini12864 LED
#[include ./todo/lcd_tweaks.cfg] Need to figure this one out and then implement
#[include ./hardware/nevermore.cfg] Disabled as I prefer to chamber vent outside and needed the PWM

##########################
#### REPLACEMENT #########
##########################

[include ./replacement_macros/replace-m900.cfg]
[include ./replacement_macros/replace-m117.cfg]

[exclude_object]

[gcode_arcs]
resolution: 0.1

[respond]
default_type: echo
default_prefix:  

[force_move]
# Enable commands that force potentially unsafe movement
enable_force_move: True

[idle_timeout]
timeout: 14400

[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_290040000750314D35323820-if00
restart_method: command

[mcu rpi]
# Add Rpi as secondary MCU to allow for ADXL use through SPI ribbon/adapter from LDO
serial: /tmp/klipper_host_mcu

[mcu sht]
canbus_uuid: 30993412e8e0

[printer]
kinematics: corexy
max_velocity: 200           # Changed from 200 on 7.11.23
max_accel:  6000            # tuned on 7.11.23 after beacon install.
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0 # Changed on 7.11.23

#####################################################################
#   Input Shaper
#####################################################################

[input_shaper]
#shaper_freq_x: 76.2               ; suggested max_accel <= 22600 mm/sec^2
#shaper_type_x: zv
#shaper_freq_y: 51.8               ; suggested max_accel <= 7900 mm/sec^2
#shaper_type_y: mzv

#####################################################################
#   AutoTune / https://github.com/andrewmcgr/klipper_tmc_autotune
#####################################################################

[motor_constants ldo-42sth48-2004mah_vrn]
resistance: 1.45
inductance: 0.002
holding_torque: 0.40
max_current: 2.0
steps_per_revolution: 400

#[autotune_tmc stepper_x]
#motor: ldo-42sth48-2004mah_vrn
#sg4_thrs: 105
#tuning_goal: silent
[autotune_tmc stepper_y]
motor: ldo-42sth48-2004mah_vrn
tuning_goal: silent

[autotune_tmc stepper_z]
motor: ldo-42sth40-1684l300e
[autotune_tmc stepper_z1]
motor: ldo-42sth40-1684l300e
[autotune_tmc stepper_z2]
motor: ldo-42sth40-1684l300e

[autotune_tmc extruder]
motor: moons-cse14hra1l410a

#####################################################################
#   Bed Heater
#####################################################################

##  SSR Pin - HE1
##  Thermistor - TB
[heater_bed]
heater_pin: PA2 #PA2 is LDO default
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.6
min_temp: 0
max_temp: 125
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

#####################################################################
#   Probe
#####################################################################

##  WAS TAP - NOW BEACON in CANBUS

#####################################################################
#   Additional Sensors
#####################################################################

[thermistor CMFB103F3950FANT]
temperature1: 0.0
resistance1: 32116.0
temperature2: 40.0
resistance2: 5309.0
temperature3: 80.0
resistance3: 1228.0

#[temperature_sensor sb_ambient_temp]
## Chamber Temperature - T1
#sensor_type: CMFB103F3950FANT
#sensor_pin: PF5
#min_temp: 0
#max_temp: 100
#gcode_id: chamber_th

[temperature_sensor back_chamber_temp]
## Chamber Temperature - T
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF6
min_temp: 0
max_temp: 100
gcode_id: chamber_th2

[temperature_sensor RPi4]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 39.889
#*# pid_ki = 0.964
#*# pid_kd = 412.851
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.003393, 0.009984, 0.007095, 0.003053, -0.001832, -0.005134, -0.008004, -0.011121, -0.014591, -0.010551, -0.015590, -0.015105, -0.019312, -0.011783, -0.012104, -0.011351, -0.008803, -0.006450, -0.008457, -0.012340, -0.011598, -0.011247, -0.010023, -0.009295, -0.001970
#*# 	  0.015163, 0.009181, 0.010584, 0.005918, 0.002742, -0.000027, -0.003620, -0.004590, -0.009090, -0.007130, -0.010224, -0.011281, -0.012506, -0.014162, -0.012750, -0.013643, -0.011125, -0.010228, -0.009839, -0.010607, -0.008813, -0.006324, -0.004377, -0.001644, 0.001770
#*# 	  0.015422, 0.014719, 0.010564, 0.007981, 0.005743, 0.002516, -0.001007, -0.003803, -0.003977, -0.004110, -0.006837, -0.009297, -0.012348, -0.014595, -0.016056, -0.017345, -0.016800, -0.015191, -0.013965, -0.011591, -0.007575, -0.002583, -0.000828, 0.000564, 0.003313
#*# 	  0.012990, 0.012757, 0.007671, 0.007115, 0.000103, 0.000027, -0.003522, -0.006209, -0.007176, -0.006987, -0.009910, -0.013310, -0.015681, -0.017392, -0.024192, -0.024134, -0.024047, -0.021878, -0.023981, -0.018565, -0.010219, -0.004508, 0.000406, 0.000360, 0.001466
#*# 	  0.008988, 0.005984, 0.004391, 0.002225, 0.002500, -0.001580, -0.006544, -0.010143, -0.012036, -0.010800, -0.014191, -0.016995, -0.019754, -0.022384, -0.025573, -0.027241, -0.027624, -0.029150, -0.028213, -0.022369, -0.012684, -0.003408, 0.001225, 0.001345, 0.000453
#*# 	  0.008758, 0.004807, 0.002689, 0.001305, 0.000949, -0.003255, -0.008707, -0.013517, -0.013595, -0.014821, -0.015753, -0.017745, -0.018493, -0.019794, -0.023619, -0.026808, -0.026773, -0.027999, -0.027972, -0.022836, -0.013912, -0.002783, 0.000654, 0.002988, 0.002090
#*# 	  0.013968, 0.008594, 0.005870, 0.003984, 0.002717, -0.001730, -0.007780, -0.012297, -0.013361, -0.013740, -0.014755, -0.015187, -0.013549, -0.013256, -0.015859, -0.019892, -0.020791, -0.023235, -0.023867, -0.018681, -0.010837, -0.003116, 0.001023, 0.002968, 0.003568
#*# 	  0.021319, 0.014544, 0.012420, 0.009665, 0.006619, 0.002221, -0.002856, -0.007709, -0.008943, -0.009868, -0.010239, -0.009631, -0.006440, -0.005424, -0.006888, -0.009393, -0.010586, -0.014130, -0.015194, -0.012685, -0.006580, 0.000304, 0.002795, 0.004800, 0.006699
#*# 	  0.032232, 0.025787, 0.021546, 0.020372, 0.015833, 0.011198, 0.005752, 0.001717, -0.000246, -0.002166, -0.004108, -0.002225, 0.000967, 0.003505, 0.002193, 0.000370, -0.000929, -0.004663, -0.005945, -0.004905, -0.000478, 0.004651, 0.006365, 0.007933, 0.010696
#*# 	  0.033807, 0.026525, 0.022289, 0.018666, 0.014962, 0.010902, 0.006713, 0.002829, -0.000248, -0.002419, -0.004595, -0.003979, -0.000700, 0.001332, 0.001953, 0.000888, -0.000675, -0.005172, -0.008381, -0.007447, -0.003775, -0.000415, 0.001598, 0.003093, 0.006506
#*# 	  0.031083, 0.023281, 0.018309, 0.013867, 0.009829, 0.005902, 0.002179, 0.000907, -0.001986, -0.005597, -0.008978, -0.009185, -0.007340, -0.004211, -0.003511, -0.003932, -0.006401, -0.010186, -0.013716, -0.013307, -0.009389, -0.005679, -0.005066, -0.003218, -0.000517
#*# 	  0.031851, 0.025844, 0.019264, 0.012802, 0.008886, 0.004433, 0.002570, 0.001469, -0.000381, -0.003728, -0.007541, -0.008332, -0.006478, -0.004938, -0.003789, -0.004734, -0.005382, -0.010113, -0.013869, -0.014157, -0.009729, -0.005888, -0.003698, -0.002643, 0.000409
#*# 	  0.035313, 0.029064, 0.022290, 0.015501, 0.010042, 0.005560, 0.002766, 0.002338, 0.002127, 0.000338, -0.002932, -0.004392, -0.002030, -0.000957, -0.000806, -0.000997, -0.002415, -0.006488, -0.010331, -0.010458, -0.006924, -0.002818, -0.000311, 0.001872, 0.006231
#*# 	  0.035481, 0.029870, 0.022800, 0.013680, 0.008401, 0.003653, 0.000681, 0.000284, 0.000258, 0.000698, -0.001694, -0.001741, 0.000438, 0.001448, 0.000819, 0.001147, -0.000366, -0.004535, -0.007368, -0.007917, -0.004788, -0.000540, 0.001827, 0.005773, 0.010303
#*# 	  0.035322, 0.029755, 0.022291, 0.014480, 0.010013, 0.005448, 0.002031, 0.000632, 0.001311, 0.002597, 0.001217, 0.001199, 0.003096, 0.004025, 0.003938, 0.003633, 0.003142, 0.001109, -0.001102, -0.001019, 0.001950, 0.005477, 0.007854, 0.012086, 0.017594
#*# 	  0.042564, 0.036733, 0.030251, 0.022991, 0.019554, 0.015392, 0.011626, 0.010207, 0.010372, 0.010895, 0.009720, 0.010586, 0.012118, 0.012822, 0.011660, 0.011680, 0.013689, 0.012208, 0.010951, 0.012076, 0.015396, 0.017752, 0.019887, 0.023927, 0.029466
#*# 	  0.048139, 0.042588, 0.035871, 0.029846, 0.026674, 0.023156, 0.020280, 0.018053, 0.017125, 0.018004, 0.016396, 0.016548, 0.018477, 0.018467, 0.018118, 0.018861, 0.020377, 0.021439, 0.021225, 0.022221, 0.024843, 0.027863, 0.030652, 0.033503, 0.039011
#*# 	  0.047278, 0.041172, 0.034835, 0.027741, 0.025620, 0.022943, 0.019805, 0.017140, 0.016718, 0.016420, 0.015139, 0.016021, 0.016987, 0.017436, 0.017136, 0.018546, 0.021727, 0.022472, 0.023121, 0.024213, 0.025301, 0.029193, 0.030922, 0.035477, 0.040735
#*# 	  0.044092, 0.036369, 0.029935, 0.023003, 0.019994, 0.017086, 0.014342, 0.011118, 0.010696, 0.010002, 0.008875, 0.009931, 0.011883, 0.013399, 0.014431, 0.015764, 0.019275, 0.020610, 0.020629, 0.021717, 0.024491, 0.025997, 0.028681, 0.032159, 0.038857
#*# 	  0.037180, 0.029004, 0.021146, 0.014782, 0.011179, 0.007982, 0.003914, 0.001103, 0.000324, 0.000358, -0.000781, 0.001324, 0.004166, 0.007165, 0.009216, 0.010612, 0.013974, 0.013919, 0.014316, 0.014935, 0.016860, 0.018658, 0.020203, 0.025158, 0.031594
#*# 	  0.030030, 0.021218, 0.013542, 0.006506, 0.002664, -0.000899, -0.005753, -0.008641, -0.009392, -0.008435, -0.009190, -0.007389, -0.003989, 0.000389, 0.002992, 0.006222, 0.008145, 0.008362, 0.008768, 0.008749, 0.009534, 0.009943, 0.010955, 0.015914, 0.022950
#*# 	  0.030017, 0.020147, 0.011864, 0.004184, 0.001442, -0.002576, -0.006033, -0.009325, -0.010761, -0.009813, -0.010827, -0.008955, -0.004696, -0.001131, 0.002223, 0.005165, 0.007758, 0.007887, 0.007017, 0.006828, 0.007391, 0.005593, 0.006655, 0.010951, 0.017612
#*# 	  0.035744, 0.025084, 0.016749, 0.009275, 0.005842, 0.003546, 0.000514, -0.001717, -0.003357, -0.004179, -0.004517, -0.003795, 0.000080, 0.003692, 0.006506, 0.008990, 0.011406, 0.011468, 0.010296, 0.008631, 0.007121, 0.006583, 0.007157, 0.011232, 0.017677
#*# 	  0.041353, 0.030485, 0.021667, 0.014558, 0.011698, 0.009487, 0.008167, 0.006400, 0.004043, 0.002946, 0.000555, 0.001968, 0.005489, 0.007962, 0.010118, 0.011598, 0.014304, 0.013167, 0.011235, 0.008840, 0.007277, 0.006792, 0.007773, 0.010472, 0.016130
#*# 	  0.042340, 0.031662, 0.023156, 0.016475, 0.013020, 0.011063, 0.010210, 0.008873, 0.007264, 0.005331, 0.003447, 0.003669, 0.006218, 0.007865, 0.009165, 0.011075, 0.011541, 0.010958, 0.008054, 0.005277, 0.003532, 0.003325, 0.003893, 0.006182, 0.010742
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 210.0
#*# min_y = 30.0
#*# max_y = 208.0
#*#
#*# [beacon model default]
#*# model_coef = 1.4613818954269993,
#*# 	  1.7756600472438397,
#*# 	  0.7384172744186067,
#*# 	  0.3398904593101075,
#*# 	  0.3899746104559005,
#*# 	  0.4162951819734925,
#*# 	  -0.2058487068481297,
#*# 	  -0.3393668279079826,
#*# 	  0.21620390616642218,
#*# 	  0.20874618374099485
#*# model_domain = 3.168808091292228e-07,3.3288555528608446e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 67.017932
#*# model_offset = 0.00000
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 77.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 51.6
#*#
#*# [beacon model pei_hot]
#*# model_coef = 1.9263519575030055,
#*# 	2.1946743347503372,
#*# 	0.6208794249910773,
#*# 	0.2775896555222557,
#*# 	0.06526221562750463,
#*# 	-0.2611119885640586,
#*# 	-0.05461829170887029,
#*# 	0.36810740679885895,
#*# 	0.05685001457152785,
#*# 	-0.15547240310186372
#*# model_domain = 3.351987055417817e-07,3.359664588035842e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 63.925584
#*# model_offset = 0.00000
